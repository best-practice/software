(function(){var D=26;var z=100;var C="";var o="";var S="";var u="";var n=null;var P=function(){if(!n){n=new Messenger.DCF();if(document.body){document.body.getDCF_=P}}return n};function m(V){if(document.cookie.length>0){var U,T=document.cookie.indexOf(V+"=");if(T!=-1){T=T+V.length+1;U=document.cookie.indexOf(";",T);if(U==-1){U=document.cookie.length}return unescape(document.cookie.substring(T,U))}}return""}function x(T,V,X,W){X=X||1;var U=new Date();U.setTime(U.getTime()+X*24*60*60*1000);W=W||"/";document.cookie=T+"="+escape(V)+";expires="+U.toGMTString()+";path="+W+";"}function y(U,V){if(document.cookie.length>0){var T=document.cookie.indexOf(U+"=");if(T!=-1){var W=new Date();W.setTime(W.getTime()-1);V=V||"/";document.cookie=U+"=;expires="+W.toGMTString()+";path="+V+";"}}}function q(T){if(T){return T.replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}else{return""}}function H(W,X,V,U){var T=null;if(window.XMLHttpRequest){T=new XMLHttpRequest()}else{if(window.ActiveXObject){T=new ActiveXObject("Microsoft.XMLHTTP")}}if(T!=null){T.onreadystatechange=function(){if(T.readyState==4){if(T.status==200){if(X){X(T.responseText)}}else{var Y=T.statusText||"Connection error";if(V){V(Y)}else{console.log(Y)}}T=null}};T.requestTimer=setTimeout(30000,function(){try{if(T){T.abort();T.aborted=true}}catch(Y){log(Y)}});if(typeof U=="string"||U instanceof ArrayBuffer){T.open("POST",W,true);T.send(U)}else{T.open("GET",W,true);T.send(null)}}}function M(X){var W=document.querySelector("div.area-dir");W.style.width=Math.max(100,window.innerWidth-z)+"px";var U=window.innerWidth-z,T=window.innerHeight-D;W=document.getElementById("doc-view");W.style.width=U+"px";W.style.height=T+"px";W=document.getElementById("mng-view");W.style.width=U+"px";W.style.height=T+"px";var Z=document.getElementById("doc-frm");var Y=U/920,V=T/720;if(Y>=V){Y=Math.min(V*1.1,Y)}else{V=Math.min(Y*1.1,V)}if((Y>=0.95&&V>=0.95)||(Y>=0.9&&Y<=1.1&&V>=0.88&&V<=1.1)||(Y>=1&&V>=0.88)){Y=1;V=1}if(Y==1&&V==1){Z.style[u]="";Z.style.marginLeft="0px";Z.style.width=U+"px";Z.style.height=T+"px"}else{Z.style.width="920px";Z.style.height="720px";Z.style[u]="scale("+Y+","+V+")";var aa=Y*920;if(U>aa){Z.style.marginLeft=((U-aa)/2)+"px"}else{Z.style.marginLeft="0px"}}}function d(V){var T=document.getElementById("mng-view");var U=document.getElementById("doc-view");if(V=="slide"){T.style.zIndex="0";T.style.visibility="hidden";U.style.zIndex="2000";U.style.visibility="visible"}else{T.style.zIndex="2000";T.style.visibility="visible";U.style.zIndex="0";U.style.visibility="hidden"}}function F(){var T=document.getElementById("doc-view");if(T.style.zIndex=="2000"){return true}else{return false}}var w={};var A={};var E={};var i=[];var a=[];var h="";function g(Z,aa){var W=[],V=Z.doc_list||[];var U=Z.repoUrl||("/"+Z.repos_name+"/");var T="$$"+aa+"/";for(var X=0,ab;ab=V[X];X++){if(ab.path.indexOf(T)==0){var Y=ab.thumb||"";if(Y&&Y[0]=="$"&&Y[1]=="$"){Y=U+Y}W.push([Z.user_name,Z.repos_name,ab.path,Y,ab.isUnread||false,ab.title||"",ab.desc||"",ab.modify_at||0])}}return W}function l(V,W){if(E.user_name==V&&E.repos_name==W){return E}for(var T=0,U;U=i[T];T++){if(U.user_name==V&&U.repos_name==W){return U}}return null}function f(T){if(T.target.nodeName!="IMG"){return}T.target.style.visibility="visible"}function b(Z,ac,V,ad,ab,X,Y){var U=document.createElement("div");U.setAttribute("uid",Y+"");U.setAttribute("user",ac);U.setAttribute("name",V);if(Y>0&&Y!=65535){U.setAttribute("loading","1");U.style.background="url(/software/blogger10/loading2.gif) no-repeat 2px 5px"}if(ab){U.setAttribute("title",ab)}U.className="btn-user"+(X?" current":"");var ae="/software/blogger10/unread"+(Z<=9?Z:10)+".png";var T=document.createElement("span");T.innerHTML=q(ad||V);U.appendChild(T);U.appendChild(document.createElement("br"));var W=document.createElement("img");W.onload=f;W.src=ae;U.appendChild(W);var aa=document.querySelector("div.left-btns");aa.appendChild(U)}function N(Y,T,Z,X,U){Y.setAttribute("user",Z);Y.setAttribute("name",X);if(U){var W=Y.querySelector("span");if(W){W.innerHTML=q(U)}}Y.removeAttribute("loading");Y.style.background="";var V=Y.querySelector("img");if(V){V.onload=f;V.src="/software/blogger10/unread"+(T<=9?T:10)+".png"}}function Q(){var U=document.querySelector("div.btn-user[loading]");if(U){return}if(i.length==0){return}var T=m("cate_"+E.user_name+"_@ALL")||"";if(T){w[E.user_name+"_@ALL"]=T}b(0,E.user_name,"ALL","","Collect above all",false,65535)}function r(X){var Z=[],V=[],ak={},ae="";if(X){ae="$$"+X+"/"}for(var ad=-1;ad<i.length;ad++){var W=ad<0?E:i[ad];var ab=W.repoUrl||("/"+W.repos_name+"/");var ah=W.doc_list||[];for(var ac=0,al;al=ah[ac];ac++){var af=al.path||"",T=af.indexOf("/"),aj="";if(T>3&&af[0]=="$"&&af[1]=="$"){aj=af.slice(2,T);if(!X){X=aj;ae="$$"+aj+"/"}}if(!aj){continue}var U=ak[aj];if(typeof U!="number"){ak[aj]=(al.isUnread?1:0);V.push(aj)}else{if(al.isUnread){ak[aj]=U+1}}if(af.indexOf(ae)==0){var am=al.thumb||"";if(am&&am[0]=="$"&&am[1]=="$"){am=ab+am}Z.push([W.user_name,W.repos_name,af,am,al.isUnread||false,al.title||"",al.desc||"",al.modify_at||0])}}}if(V.length==0||V.indexOf(X)<0){return}Z.sort(function(ao,an){return an[7]-ao[7]});var aa="<p>",Y=document.querySelector("#top-nav > div.area-dir");for(var ad=0,ag;ag=V[ad];ad++){aa+='<span class="btn-dir'+(ag==X?" current":"")+'"';aa+=' title="'+(ak[ag]||0)+' unread"';aa+=' name="@ALL" cate="'+ag+'">'+ag+"</span>"}aa+="&nbsp;</p>";Y.innerHTML=aa;d("list");var ai=document.getElementById("mng-frm");ai.onload=function(an){ai.onload=null;I();h=X;a=Z;P().call("mng-frm","setSlides",Z)};setTimeout(function(){I()},10000);O();ai.src="/software/blogger10/list_slide.html"}function R(V,Z,W){var aa=0,T=0;for(var X=0,Y;Y=Z[X];X++){var U=Y.modify_at||0;if(U>aa){aa=U}if(U>W){Y.isUnread=true;T+=1}}V.push(aa,T)}function c(Y){var W=Y.user_name;var ah=Y.repos_name;var ae=w[W+"_"+ah]||"";var T=A[W+"_"+ah]||0;var ai=Y.doc_list||[];var al={},X=[];for(var af=0,ag;ag=ai[af];af++){var ab=ag.path||"";if(ab.slice(0,2)=="$$"){var ak,V=ab.indexOf("/");if(V>2){ak=ab.slice(2,V)}else{continue}var U=al[ak];if(typeof U!="number"){X.push(ak);al[ak]=(ag.isUnread?1:0)}else{if(ag.isUnread){al[ak]=U+1}}}}var am=-1;if(X.length){if(ae){am=X.indexOf(ae)}if(am<0){am=0}}var ad="<p>",ac=document.querySelector("#top-nav > div.area-dir");for(var af=0,ag;ag=X[af];af++){ad+='<span class="btn-dir'+(af==am?" current":"")+'"';ad+=' title="'+(al[ag]||0)+' unread"';ad+=' user="'+W+'" name="'+ah+'" cate="'+ag+'">'+ag+"</span>"}ad+="&nbsp;</p>";ac.innerHTML=ad;var aa=[],Z="";if(X.length&&am>=0){Z=X[am];aa=g(Y,Z)}d("list");var aj=document.getElementById("mng-frm");aj.onload=function(an){aj.onload=null;I();h=Z;a=aa;P().call("mng-frm","setSlides",aa)};setTimeout(function(){I()},10000);O();aj.src="/software/blogger10/list_slide.html"}function K(W,T,U,Z){var V=document.querySelector("#left-nav > div.left-btns");if(W==0){V.innerHTML=""}var Y=T.slice(0,T.length-11);var X=T+"?time_="+(new Date()).valueOf();H(X,function(ai){var ag=null;try{ag=JSON.parse(ai)}catch(ah){alert(ah)}if(ag instanceof Object&&ag.repos_name){if(W==0){E=ag}else{i.push(ag)}var aj=ag.user_name;var af=ag.repos_name;var ak=m("cate_"+aj+"_"+af)||"";if(ak){w[aj+"_"+af]=ak}var ac=parseFloat(m("time_"+aj+"_"+af)||"0");A[aj+"_"+af]=ac;var ae=ag.doc_list||[];if(ag.sort_by=="modify_time"){ae.sort(function(am,al){return(al.modify_at||0)-(am.modify_at||0)})}else{if(ag.sort_by=="create_time"){ae.sort(function(am,al){return(al.create_at||0)-(am.create_at||0)})}else{if(ag.sort_by=="name"){ae.sort(function(am,al){var ao=am.path||"",an=al.path||"";if(ao==an){return 0}else{if(ao>an){return 1}else{return -1}}})}}}var aa=[];R(aa,ae,ac);ag.maxModiTime=aa[0];ag.unreadNum=aa[1];ag.repoUrl=(Y?Y:"/"+af+"/");x("time_"+aj+"_"+af,Math.max(ac,ag.maxModiTime)+"",30,"/"+E.repos_name);if(W==0){c(ag);b(ag.unreadNum,aj,af,ag.repos_desc||"",ag.repoUrl,true,W)}else{var ad=document.querySelector('div.btn-user[uid="'+W+'"]');var ab=(U?ag.repos_desc||"":"");if(ad){N(ad,ag.unreadNum,aj,af,ab)}}if(typeof Z=="function"){Z()}setTimeout(Q,0)}},function(aa){alert("Read config.json failed: "+aa)})}function v(T){var X=T.target;if(X&&X.nodeName=="SPAN"&&X.classList.contains("btn-dir")){var Y=X.getAttribute("user");var aa=X.getAttribute("name");var ac=X.getAttribute("cate");if(!ac){return}var ab=document.querySelector("span.btn-dir.current");if(ab===X){if(F()){d("list");return}}if(aa=="@ALL"){x("cate_"+E.user_name+"_@ALL",ac,30,"/"+E.repos_name);w[E.user_name+"_@ALL"]=ac;r(ac);return}if(!Y||!aa){return}x("cate_"+Y+"_"+aa,ac,30,"/"+aa);w[Y+"_"+aa]=ac;var W=l(Y,aa);if(!W){return}var U=document.querySelector("span.btn-dir.current");if(U){U.classList.remove("current")}X.classList.add("current");var V=g(W,ac);d("list");var Z=document.getElementById("mng-frm");Z.onload=function(ad){Z.onload=null;I();h=ac;a=V;P().call("mng-frm","setSlides",V)};setTimeout(function(){I()},10000);O();Z.src="/software/blogger10/list_slide.html"}}function s(U){var Z=U.target;while(Z){if(Z.nodeName=="DIV"&&Z.classList.contains("btn-user")){break}else{Z=Z.parentNode}}if(!Z){return}if(Z.getAttribute("loading")){return}var ae=Z.querySelector("div.btn-user > img");if(ae){ae.parentNode.removeChild(ae)}var V=Z.getAttribute("uid");var X=Z.getAttribute("name");var W=document.querySelector("div.btn-user.current");if(W===Z){if(F()){d("list")}else{if(V=="65535"){d("slide")}else{var T=document.getElementById("doc-frm");var aa=T.getAttribute("user")||"";var ac=T.getAttribute("repo")||"";if(aa&&ac&&ac==X&&aa==Z.getAttribute("user")){d("slide")}}}return}if(V=="65535"){if(W){W.classList.remove("current")}Z.classList.add("current");var ad=w[E.user_name+"_@ALL"]||"";r(ad)}else{if(X){if(W){W.classList.remove("current")}Z.classList.add("current");var ab=Z.getAttribute("user");if(X&&ab){var Y=l(ab,X);if(Y){c(Y)}}}}}function e(aa,V){var ac=document.querySelector("span.btn-dir.current");if(!ac){return""}var ak=ac.getAttribute("cate")||"";if(!ak||ak!=h){return""}var ag=ac.getAttribute("name")||"";var T=ac.getAttribute("user")||"";var Y=(ag=="@ALL");if(!Y){if(!T||!ag){return""}}var ab=document.getElementById("doc-frm");if(ab.parentNode.style.zIndex!="2000"){return""}var W=ab.getAttribute("path");if(!W){return""}var al="",Z="",aj="",U="",ai=a;for(var af=0,ah;ah=ai[af];af++){var ad=ah[2]||"",ae=ad;if(ad&&ad[ad.length-1]!="/"){ad+="/"}if(ad[0]=="$"&&ad[1]=="$"){var X=l(ah[0],ah[1]);if(X){ad=(X.repoUrl||("/"+X.repos_name+"/"))+ad}}if(ad==W){if(V){aa.push(al,Z,aj);return U}else{ah=ai[af+1];if(ah){ad=ah[2]||"";aa.push(ah[0],ah[1],ad);if(ad&&ad[ad.length-1]!="/"){ad+="/"}if(ad[0]=="$"&&ad[1]=="$"){var X=l(ah[0],ah[1]);if(X){ad=(X.repoUrl||("/"+X.repos_name+"/"))+ad}}return ad}else{return""}}}al=ah[0];Z=ah[1];aj=ae;U=ad}return""}function L(V){var T=V.target;if(T.nodeName=="DIV"&&T.classList.contains("prev-next-btn")){var W=[],U=e(W,T.classList.contains("left"));if(U){T.style.backgroundColor="rgba(220,220,220,0.8)"}}}function t(U){var T=U.target;if(T.nodeName=="DIV"&&T.classList.contains("prev-next-btn")){T.style.backgroundColor=""}}function J(V){var T=V.target;if(T.nodeName=="DIV"&&T.classList.contains("prev-next-btn")){var W=[],U=e(W,T.classList.contains("left"));if(U){setTimeout(function(){d("slide");var X=document.getElementById("doc-frm");X.setAttribute("user",W[0]);X.setAttribute("repo",W[1]);X.setAttribute("path",U);X.onload=function(Y){X.onload=null;I()};setTimeout(function(){I()},10000);O();X.src=U;P().call("mng-frm","setOpened",W)},0)}}}function k(V){switch(V.keyCode){case 39:case 40:case 13:case 32:case 34:case 37:case 38:case 33:case 36:case 35:case 27:case 113:var U=document.getElementById("doc-view");if(U.style.zIndex=="2000"){try{var W=document.getElementById("doc-frm");if(W.contentWindow&&W.contentWindow.window){var T=W.contentWindow.window.handleDocKeyDown;if(T){T(V)}}}catch(X){console.log(X)}}break}}function B(T){if(T.requestFullscreen){T.requestFullscreen()}else{if(T.mozRequestFullScreen){T.mozRequestFullScreen()}else{if(T.webkitRequestFullscreen){T.webkitRequestFullscreen()}else{if(T.msRequestFullscreen){T.msRequestFullscreen()}}}}}function p(){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}var j=false;function O(){var T=document.querySelector("div.to-fullscreen");T.style.backgroundImage="url(/software/blogger10/loading2.gif)"}function I(){var T=document.querySelector("div.to-fullscreen");if(j){T.style.backgroundImage="url(/software/blogger10/exit_fs.png)"}else{T.style.backgroundImage="url(/software/blogger10/enter_fs.png)"}}function G(U){var T=U.target;if(!T||!T.classList.contains("to-fullscreen")){return}if(Math.abs(screen.availHeight-window.innerHeight)<=1){p();T.style.backgroundImage="url(/software/blogger10/enter_fs.png)";j=false}else{B(document.documentElement);T.style.backgroundImage="url(/software/blogger10/exit_fs.png)";j=true}}document.addEventListener("DOMContentLoaded",function(U){if(!window.HTMLCanvasElement||!document.addEventListener){alert("The version of your web browser is too low for PINP Slide");return}var V=navigator.userAgent;V=V.toLowerCase();var T=V.match(/trident.*rv[ :]*([\d.]+)/);if(T){if(parseFloat(T[1])>=11){C="ie";o=T[1];S="MSTransitionEnd";u="-ms-transform"}}else{T=V.match(/firefox\/([\d.]+)/);if(T){C="firefox";o=T[1];S="transitionend";u="transform"}else{T=V.match(/chrome\/([\d.]+)/);if(T){C="chrome";o=T[1];S="webkitTransitionEnd";u="-webkit-transform"}else{T=V.match(/opera.([\d.]+)/);if(T){C="opera";o=T[1];S="oTransitionEnd";u="transform"}else{T=V.match(/safari\/([\d.]+)/);if(T){C="safari";o=T[1];S="webkitTransitionEnd";u="-webkit-transform"}else{T=V.match(/webkit\/([\d.]+)/);if(T){C="webkit";o=T[1];S="webkitTransitionEnd";u="-webkit-transform"}}}}}}if(C==""||o==""){if(V.match(/msie ([\d.]+)/)){alert("IE version too low for PINP Slide, please use IE11 or higher")}else{alert("PINP Slide only support: firefox/chrome/safari/opera/IE")}document.body.innerHTML="<h2>Unknown browser type</h2>";return}var W=function(X,Y){var Z=document.createElement("script");if(typeof Y=="function"){Z.onload=Y}Z.async=1;Z.src=X;document.querySelector("head").appendChild(Z)};W("//www.pinp.me/software/pages/blogger/js/menu.js")},false);window.addEventListener("load",function(T){M();window.addEventListener("resize",M,false);document.addEventListener("keydown",k,false);var U=document.querySelectorAll("div.prev-next-btn");for(var W=0,aa;aa=U[W];W++){aa.onmouseover=L;aa.onmouseout=t;aa.onclick=J}var V=document.querySelector("div.to-fullscreen");V.onclick=G;V=document.querySelector("div.area-dir");V.onclick=v;V=document.querySelector("div.left-btns");V.onclick=s;var ab=document.getElementById("mng-view");var X=document.getElementById("doc-view");var Z=document.getElementById("doc-frm");P().regist("loaded",function(ag){if(!Z.style[u]){var aj=ag[0];var al=false,ai=window.navigator.userAgent;if(ai.indexOf("Safari/")>0&&ai.indexOf("iPad;")>0){al=true}if(al&&aj.slice(0,5)=="slide"){var af=ag[1],ae=ag[2],ac=ag[3],ad=ag[4];var ak=Math.floor((X.clientWidth-ac)/2-af+0.5);var ah=Math.floor((X.clientHeight-ad)/2-ae+0.5);Z.style.left=ak+"px";Z.style.top=ah+"px"}}});P().regist("showSlideDoc",function(ae){var ah=ae[0],ai=ae[1],af=ae[2];if(af[0]=="$"&&af[1]=="$"){var ad=l(ah,ai);if(!ad){return}var ac=ad.repoUrl||("/"+ad.repos_name+"/");af=ac+af}d("slide");var ag=document.getElementById("doc-frm");ag.setAttribute("user",ah);ag.setAttribute("repo",ai);ag.setAttribute("path",af);setTimeout(function(){I()},10000);ag.onload=function(aj){ag.onload=null;I()};O();ag.src=af});P().regist("switchFullScreen",function(ad){var ac=j;var af=ad[0]||"none";if(af=="none"){return ac}var ae=document.querySelector("div.to-fullscreen");if(ae){if(af=="enter"){if(!j){G({target:ae})}}else{if(af=="exist"){if(j){G({target:ae})}}else{G({target:ae})}}}return ac});var Y=0;K(Y,"config.json",false,function(){for(var ag=0;ag<2;ag++){var aj=(ag==0?E.builtin_repos:E.imported_repos)||[];var ai=E.user_name;for(var ad=0,ah;ah=aj[ad];ad++){var ac,ak="";if((ah instanceof Array)&&ah.length==2){ac=ah[0];ak=ah[1]}else{if(typeof ah=="string"){ac=ah}else{continue}}var af=ac.split("/").pop();if(ag==0){ac="/"+af}else{if(ac[ac.length-1]=="/"){ac=ac.slice(0,ac.length-1)}}var ae=ac+"/";ac+="/config.json";Y+=1;b(0,"",af,ak,ae,false,Y);K(Y,ac,!ak);if(Y>=64){break}}}})},false)})();
