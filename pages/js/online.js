function EXTERN_MSG_CALL(f){if(!window.parent.window||window.parent.window===window){return}var h=f.method||"";if(h=="notiGetPlugLib"){var o=apiNode.getPluginCode();var o="[PINPSLIDE_11]"+JSON.stringify({method:"previewPlugLib",param:[o,curSlide]});window.parent.window.postMessage(o,"*")}else{if(h=="notiGetPageHtml"){var g=f.param[0];if(!g){return}var c=document.querySelector('section > article[id="'+g+'"]');if(c){var l=apiNode.getPageHtml(c);if(l&&l.length==3){l[2]="COMPONENT_OF_PINP_SLIDE,0,"+l[2];var o="[PINPSLIDE_11]"+JSON.stringify({method:"previewPageHtml",param:l});window.parent.window.postMessage(o,"*")}}}else{if(h=="turnSlideTo"){var g=f.param[0];for(var j=0,n;n=slideEls[j];j++){if(n.id==g){apiNode.gotoPage(j);break}}}else{if(h=="delSlidePage"){var g=f.param[0];apiNode.removePage(g)}else{if(h=="addSlidePage"){var a=f.param[0],e=f.param[1]||900,d=f.param[2]||700;apiNode.insertPage(a,e,d)}else{if(h=="tryUnselect"){hideMenuAndSelector();cancelInlineEdit();apiNode.unselect()}else{if(h=="startSave"){var k=f.param[0];apiNode.unselect();var m=apiNode.slideshowText();var o="[PINPSLIDE_11]"+JSON.stringify({method:"saveSlideShow",param:[k,m]});window.parent.window.postMessage(o,"*")}else{if(h=="savePrepost"){apiNode.savePrepost(f.param[0],f.param[1])}else{if(h=="saveSlideTxt"){apiNode.saveSlideTxt(f.param[0],f.param[1])}else{if(h=="saveTableData"){apiNode.saveTableData(f.param[0],f.param[1])}else{if(h=="saveShapeData"){apiNode.saveShapeData(f.param[0],f.param[1])}else{if(h=="savePaperData"){apiNode.savePaperData(f.param[0],f.param[1])}}}}}}}}}}}}}(function(){var b=false;var a=function(c){if(b){return}b=true;var m=window.parent.window&&window.parent.window!==window;var d={};apiNode.taskConfig=function(){return d};apiNode.isDropPrevious=function(){return !!d.dropBeforeCurr};apiNode.newTaskConfig=function(i){d={svgTool:!!i}};apiNode.setDropMouseXY=function(i,r){d.mouseX=i;d.mouseY=r};apiNode.runJsFile=function(i){var r=document.createElement("script");r.async=1;r.onload=function(s){r.parentNode.removeChild(r)};r.onerror=function(s){r.parentNode.removeChild(r)};document.body.appendChild(r);r.src=i};var k=function(i){if(apiNode.beenReadonly()){return}var r=getCookie__("drag_task");if(r=="run_js"||r=="exchange_page"){i.preventDefault()}};var f=function(v){if(apiNode.beenReadonly()){return}var s,w=getCookie__("drag_task");if(window.WEB_BROWSER_TYPE=="ie"){s=v.dataTransfer.getData("text")}else{s=v.dataTransfer.getData("text/args")}if(typeof s!="string"){return}if(w=="exchange_page"&&s.indexOf("pageindex,")==0){v.stopPropagation();v.preventDefault();s=s.slice(10);var y=-1,r=apiNode.totalSlides();for(var t=0,u;u=slideEls[t];t++){if(s==u.id){y=t;break}}if(y>=0&&y<r){var x=apiNode.currSlideIndex();if(v.target.id!="prev-slide-area"){x+=1}if(y!=x&&y+1!=x){apiNode.moveSlideTo(y,x)}}}};var p=document.getElementById("prev-slide-area");p.ondragover=k;p.ondrop=f;var e=document.getElementById("next-slide-area");e.ondragover=k;e.ondrop=f;apiNode.removePage=function(w){if(!w){return}if(apiNode.totalSlides()==1){alert("can not delete last page!");return}if(!confirm("do you want delete this page?")){return}var v=document.querySelector('section.slides > article[id="'+w+'"]');if(v){var u=v.parentNode;var r=apiNode.currSlideIndex();apiNode.unselect();u.removeChild(v);apiNode.renewSlides();var y=false,t=apiNode.totalSlides();if(r>=t){r=t-1;y=true}if(m){var z=[r];for(var x=0,A;A=slideEls[x];x++){z.push(A.id||"")}var B="[PINPSLIDE_11]"+JSON.stringify({method:"slideDelPage",param:z});window.parent.window.postMessage(B,"*")}if(y){setTimeout(function(){apiNode.gotoPage(r)},0)}}};apiNode.insertPage=function(C,z,w){var K=document.querySelector("section.slides");var J=apiNode.currSlideIndex();var u=slideEls[J];if(!K||!u){return}var A,x="",G=apiNode.newSlideId();if(!C){A='<article id="'+G+'">\n</article>\n'}else{var M=SLIDE_HALF_WIDTH+SLIDE_HALF_WIDTH,t=SLIDE_HALF_HEIGHT+SLIDE_HALF_HEIGHT;var E=z/w,B=SLIDE_HALF_WIDTH/SLIDE_HALF_HEIGHT;if(E>=B){w=Math.floor(M/E+0.5);z=M}else{z=Math.floor(t*E+0.5);w=t}var I=0-Math.floor(z*0.5+0.5);var F=0-Math.floor(w*0.5+0.5);x='<div class="pinp-image slideshow-img" _zindex="996" _config="fullsize-fixed contain-fit default-round2-round3-round0 default-looser-impacted p1-p2-p3-p0" _left="'+I+'" _top="'+F+'" _width="'+z+'" _height="'+w+'">';x+='<img draggable="false" src="'+C+'" _jump=""><div class="rotate-txt"></div></div>\n';A='<article id="'+G+'">\n'+x+"</article>\n"}apiNode.innerHTML=A;var r=apiNode.children[0];var v=u.nextElementSibling;if(v&&v.parentNode===K){K.insertBefore(r,v)}else{K.appendChild(r)}apiNode.innerHTML="";apiNode.initPagePos(G);apiNode.saveSlideDoc();apiNode.renewSlides();apiNode.nextSlide();if(m){var L=[J+1];for(var D=0,H;H=slideEls[D];D++){L.push(H.id||"")}var y="[PINPSLIDE_11]"+JSON.stringify({method:"slideAddPage",param:L});window.parent.window.postMessage(y,"*");if(x){setTimeout(function(){var i="[PINPSLIDE_11]"+JSON.stringify({method:"previewPageHtml",param:[G,"","COMPONENT_OF_PINP_SLIDE,0,"+x]});window.parent.window.postMessage(i,"*")},500)}}};apiNode.setPopContent=function(s,r,t,i){if(m&&window.parent.window.setPopContent){window.parent.window.setPopContent(s,r,t,i,PINP_EXTEND_STYLE)}};apiNode.getPopContent=function(i){if(m&&window.parent.window.getPopContent){return window.parent.window.getPopContent(i)}};apiNode.hidePopContent=function(){try{if(m&&window.parent.window.hidePopContent){return window.parent.window.hidePopContent()}}catch(i){}};var l=0;var j=null;var o=function(s,u){if(s.length){var t=s[s.length-1];var v=u.length;while(t.length>v){var i=t[v];if(i.rowspan>1){u.push({colspan:i.colspan,rowspan:i.rowspan-1,style:"",text:"<+>"});for(var r=1;r<i.colspan;r++){u.push({colspan:0,rowspan:0,style:"",text:"<->"})}v=u.length}else{break}}}};apiNode.dbclickEdit=function(N){var H=document.getElementById("slide-menu");H.style.display="none";if(!m){return}if(!N){N=getCurrSelected()}if(!N){return}apiNode.hidePopContent();if(N.classList.contains("code-block")){var X=N.querySelector(".code-block > pre");if(X){l+=1;j=N;var S="[PINPSLIDE_11]"+JSON.stringify({method:"editSlideTxt",param:[l,X.textContent]});window.parent.window.postMessage(S,"*")}}else{if(N.classList.contains("table-set")){var r=N.querySelector(".table-set > table");if(r){var M=0,z=[],ac=[];var ab=r.getAttribute("style");if(ab){ac.push(["style=",ab])}var u=r.className;if(u){ac.push(["class=",u])}var A=[],L=r.querySelectorAll("tr");for(var V=0,K;K=L[V];V++){var U={colspan:0,rowspan:0,style:"",text:"td"};var D=[U],J=false;var E=K.querySelectorAll("td,th");for(var C=0,v;v=E[C];C++){if(v.nodeName=="TH"){J=true}o(A,D);var y={colspan:1,rowspan:1,style:"",text:""};D.push(y);var aa=v.getAttribute("colspan");var Z=v.getAttribute("rowspan");var W=v.style.cssText;if(aa){y.colspan=parseInt(aa)}if(Z){y.rowspan=parseInt(Z)}if(W){var P=z.indexOf(W);if(P<0){P=z.push(W)-1}y.style=P+""}y.text=v.innerHTML;if(y.colspan>=2){for(var B=1;B<y.colspan;B++){D.push({colspan:0,rowspan:0,style:"",text:"<->"})}}}o(A,D);if(J){U.text="th"}if(M<D.length){M=D.length}A.push(D)}for(var V=0;V<z.length;V++){ac.push([V+"=",z[V]])}for(var V=0,K;K=A[V];V++){var D=[],w=true;for(var C=0,v;v=K[C];C++){if(w){w=false;if(v.text=="th"){D.push("header=")}else{D.push("")}}else{if(v.style){D.push("<"+v.style+":"+v.text+">")}else{D.push(v.text)}}}ac.push(D)}l+=1;j=N;var T="<p>Join to left cell: &lt;-&gt;<br>Join to above cell: &lt;+&gt;";var S="[PINPSLIDE_11]"+JSON.stringify({method:"editTableData",param:[l,ac,ac.length,M,PINP_SLIDE_FONT,T]});window.parent.window.postMessage(S,"*")}}else{if(N.classList.contains("frame-build")){var R=N.querySelector(".frame-build > iframe");if(R){var T=R.contentWindow.window.getHintText()||"";var ac=R.contentWindow.window.getContent();var x=ac.length,M=0;for(var V=0;V<x;V++){var K=ac[V];if(K.length>M){M=K.length}}l+=1;j=N;var S="[PINPSLIDE_11]"+JSON.stringify({method:"editTableData",param:[l,ac,x,M,PINP_SLIDE_FONT,T]});window.parent.window.postMessage(S,"*")}}else{if(N.classList.contains("svg-shape")){var O="",t="",I="",F=N.getAttribute("_widget")||"";var G=N.querySelector(".svg-shape > div.shape-canvas");if(G){sStyle=G.getAttribute("style")||"";I=G.innerHTML}var Y=N.querySelector(".svg-shape > div.shape-canvas");if(Y){t=Y.getAttribute("style")||""}l+=1;j=N;var S="[PINPSLIDE_11]"+JSON.stringify({method:"editShapeData",param:[l,N.className,I,F,sStyle,t]});window.parent.window.postMessage(S,"*")}else{if(N.classList.contains("svg-paper")){l+=1;j=N;var Q=N.getAttribute("name")||"";var S="[PINPSLIDE_11]"+JSON.stringify({method:"editPaperData",param:[l,N.innerHTML,N.className,Q,PINP_SLIDE_FONT,PINP_SOURCECODE_FONT,PINP_CONTENT_FONT,PINP_EXTEND_STYLE,CURR_USR_PATH]});window.parent.window.postMessage(S,"*")}}}}}};apiNode.setPrePost=function(u){var i=document.getElementById("slide-menu");i.style.display="none";if(!m){return}if(!u){u=getCurrSelected()}if(!u){return}apiNode.hidePopContent();var t=u.getAttribute("_prepost")||"";var v=apiNode.canPlay(u);l+=1;j=u;var r="[PINPSLIDE_11]"+JSON.stringify({method:"editPrepost",param:[l,t,v]});window.parent.window.postMessage(r,"*")};apiNode.savePrepost=function(r,i){if(l==r&&j&&j.parentNode){if(i){j.setAttribute("_prepost",i)}else{j.removeAttribute("_prepost")}apiNode.setPageModified()}};apiNode.saveSlideTxt=function(s,i){if(l==s&&j&&j.parentNode){var r=j.querySelector(".code-block > pre");if(r&&j.classList.contains("code-block")){j=null;r.textContent=i||"";apiNode.setPageModified()}}};apiNode.saveTableData=function(ad,ae){if(l==ad&&j&&j.parentNode){if(j.classList.contains("frame-build")){var Q=j.querySelector("iframe");if(Q){Q.contentWindow.window.setContent(ae);var I="[";for(var X=0;X<ae.length;X++){var L=ae[X];var D="[";for(var C=0;C<L.length;C++){var t=L[C];if(typeof t=="string"){if(t){D+=JSON.stringify(t)+","}else{D+=","}}else{D+=","}}while(D&&D[D.length-1]==","){D=D.slice(0,-1)}I+=D+"],"}if(I.length>1){I=I.slice(0,-1)}I+="]";Q.setAttribute("_widget",I.replace(/"/gm,"'"));j=null;apiNode.setPageModified()}return}else{if(!j.classList.contains("table-set")){return}}var r="",B={},V=0;for(var X=0;X<ae.length;X++){var ac=ae[X],aa=ac[0];if(ac.length>=2&&typeof aa=="string"){if(aa=="class="){r=ac[1]}else{if(aa=="header="||!aa){break}else{if(aa[aa.length-1]=="="){B[aa]=ac[1]||""}}}}V+=1}var P=0;for(var X=V;X<ae.length;X++){var L=ae[X];for(var C=1;C<L.length;C++){var S=L[C];if(S&&typeof S=="string"){if(P<C){P=C}}}}var x=[];for(var X=V;X<ae.length;X++){var L=ae[X];var J=L.length;if(J==0){continue}var D="",T="td";if(J>0&&L[0]=="header="){T="th"}var W=[{colspan:0,rowspan:0,style:"",text:T}];var E=true;var C=1;while(C<J){var H=L[C],F="";if(typeof H=="string"){F=H}var w=F.length;if(w){E=false}else{if(C>P){break}}C+=1;var v={colspan:1,rowspan:1,style:"",text:F};W.push(v);if(w==3&&F=="<->"){v.colspan=0;var af=W.length-2;while(af>=0){var U=W[af];af-=1;if(U.colspan>0){U.colspan+=1;break}}}else{if(w==3&&F=="<+>"){v.rowspan=0;var af=W.length-1;var u=x.length-1;while(u>=0){var ac=x[u];u-=1;if(ac.length>af){var U=ac[af];if(U.rowspan>0){U.rowspan+=1;break}}}}else{if(w>=2&&F[0]=="<"&&F[F.length-1]==">"){var M=F.charCodeAt(1);if(M>=48&&M<=57){var O=F.indexOf(":");if(O>0){var Y=F.sliceOf(1,O-1);if(Y.length){Y=B[Y+"="]||"";v.style=Y}v.text=F.slice(O+1,F.length-1)}}}}}}if(!E){x.push(W)}}for(var X=0;X<x.length;X++){var G=x[X];for(var C=1;C<G.length;C++){var v=G[C];if(v.colspan>1&&v.rowspan>1){for(var A=1;A<v.rowspan;A++){if(X+A<x.length){var N=x[X+A];var y=N.length;for(var z=1;z<v.colspan;z++){if(C+z<y){var U=N[C+z];U.colspan=0}else{break}}}else{break}}}}}var Z="<table";if(r.length){Z+=' class="'+r+'"'}var ab=B["style="]||"";if(ab){Z+=" style="+JSON.stringify(ab)}Z+=">";for(var X=0;X<x.length;X++){var K=x[X],D="",T="",s=true;for(var C=0;C<K.length;C++){var R=K[C];if(s){s=false;T=R.text}else{if(R.colspan<=0||R.rowspan<=0){continue}var Y="";if(R.style){Y=" style="+JSON.stringify(R.style)}if(R.colspan==1){if(R.rowspan==1){D+="<"+T+Y+">"+R.text+"</"+T+">"}else{D+="<"+T+' rowspan="'+R.rowspan+'"'+Y+">"+R.text+"</"+T+">"}}else{D+="<"+T+' colspan="'+R.colspan+'"';if(R.rowspan>1){D+=' rowspan="'+R.rowspan+'"'}D+=Y+">"+R.text+"</"+T+">"}}}Z+="<tr>"+D+"</tr>"}Z+="</table>";j.innerHTML=Z;j=null;apiNode.setPageModified()}};apiNode.saveShapeData=function(x,v){if(l==x&&j&&j.parentNode){if(j.classList.contains("svg-shape")){var i=v[0];if(i){j.setAttribute("_widget",i)}var w=v[1]||"";var u=v[2]||"";var r=j.querySelector("div.shape-canvas");if(r){if(w){var t="-webkit-transform:"+w+";-moz-transform:"+w+";-ms-transform:"+w+";-o-transform:"+w+";transform:"+w+";";r.setAttribute("style",t)}else{r.removeAttribute("style")}}var s=j.querySelector("div.rotate-txt");if(s){if(u){var t="-webkit-transform:"+u+";-moz-transform:"+u+";-ms-transform:"+u+";-o-transform:"+u+";transform:"+u+";";s.setAttribute("style",t)}else{s.removeAttribute("style")}}resetSvgColor(j);j=null;apiNode.setPageModified()}}};apiNode.savePaperData=function(r,i){if(l==r&&j&&j.parentNode){if(j.classList.contains("svg-paper")){j.innerHTML=i;j=null;apiNode.setPageModified()}}};if(m){var h=[];for(var g=0,n;n=slideEls[g];g++){h.push(n.id||"")}var q="[PINPSLIDE_11]"+JSON.stringify({method:"onSlideLoad",param:h});window.parent.window.postMessage(q,"*")}};window.addEventListener("load",a,false);setTimeout(a,2000)})();