function EXTERN_MSG_CALL(f){if(!window.parent.window||window.parent.window===window){return}var h=f.method||"";if(h=="notiGetPlugLib"){var o=apiNode.getPluginCode();var o="[PINPSLIDE_11]"+JSON.stringify({method:"previewPlugLib",param:[o,curSlide]});window.parent.window.postMessage(o,"*")}else{if(h=="notiGetPageHtml"){var g=f.param[0];if(!g){return}var c=document.querySelector('section > article[id="'+g+'"]');if(c){var l=apiNode.getPageHtml(c);if(l&&l.length==3){l[2]="COMPONENT_OF_PINP_SLIDE,0,"+l[2];var o="[PINPSLIDE_11]"+JSON.stringify({method:"previewPageHtml",param:l});window.parent.window.postMessage(o,"*")}}}else{if(h=="turnSlideTo"){var g=f.param[0];for(var j=0,n;n=slideEls[j];j++){if(n.id==g){apiNode.gotoPage(j);break}}}else{if(h=="delSlidePage"){var g=f.param[0];apiNode.removePage(g)}else{if(h=="addSlidePage"){var a=f.param[0],e=f.param[1]||900,d=f.param[2]||700;apiNode.insertPage(a,e,d)}else{if(h=="tryUnselect"){hideMenuAndSelector();cancelInlineEdit();apiNode.unselect()}else{if(h=="startSave"){var k=f.param[0];apiNode.unselect();var m=apiNode.slideshowText();var o="[PINPSLIDE_11]"+JSON.stringify({method:"saveSlideShow",param:[k,m]});window.parent.window.postMessage(o,"*")}else{if(h=="savePrepost"){apiNode.savePrepost(f.param[0],f.param[1])}else{if(h=="saveSlideTxt"){apiNode.saveSlideTxt(f.param[0],f.param[1])}else{if(h=="saveTableData"){apiNode.saveTableData(f.param[0],f.param[1])}else{if(h=="saveShapeData"){apiNode.saveShapeData(f.param[0],f.param[1])}else{if(h=="savePaperData"){apiNode.savePaperData(f.param[0],f.param[1])}}}}}}}}}}}}}(function(){window.addEventListener("load",function(a){var l=window.parent.window&&window.parent.window!==window;var c={};apiNode.taskConfig=function(){return c};apiNode.isDropPrevious=function(){return !!c.dropBeforeCurr};apiNode.newTaskConfig=function(b){c={svgTool:!!b}};apiNode.setDropMouseXY=function(b,i){c.mouseX=b;c.mouseY=i};apiNode.runJsFile=function(b){var i=document.createElement("script");i.async=1;i.onload=function(q){i.parentNode.removeChild(i)};i.onerror=function(q){i.parentNode.removeChild(i)};document.body.appendChild(i);i.src=b};var j=function(b){if(apiNode.beenReadonly()){return}var i=getCookie__("drag_task");if(i=="run_js"||i=="exchange_page"){b.preventDefault()}};var e=function(t){if(apiNode.beenReadonly()){return}var q,u=getCookie__("drag_task");if(window.WEB_BROWSER_TYPE=="ie"){q=t.dataTransfer.getData("text")}else{q=t.dataTransfer.getData("text/args")}if(typeof q!="string"){return}if(u=="exchange_page"&&q.indexOf("pageindex,")==0){t.stopPropagation();t.preventDefault();q=q.slice(10);var w=-1,b=apiNode.totalSlides();for(var r=0,s;s=slideEls[r];r++){if(q==s.id){w=r;break}}if(w>=0&&w<b){var v=apiNode.currSlideIndex();if(t.target.id!="prev-slide-area"){v+=1}if(w!=v&&w+1!=v){apiNode.moveSlideTo(w,v)}}}};var o=document.getElementById("prev-slide-area");o.ondragover=j;o.ondrop=e;var d=document.getElementById("next-slide-area");d.ondragover=j;d.ondrop=e;apiNode.removePage=function(v){if(!v){return}if(apiNode.totalSlides()==1){alert("can not delete last page!");return}if(!confirm("do you want delete this page?")){return}var u=document.querySelector('section.slides > article[id="'+v+'"]');if(u){var t=u.parentNode;var q=apiNode.currSlideIndex();apiNode.unselect();t.removeChild(u);apiNode.renewSlides();var x=false,r=apiNode.totalSlides();if(q>=r){q=r-1;x=true}if(l){var y=[q];for(var w=0,z;z=slideEls[w];w++){y.push(z.id||"")}var A="[PINPSLIDE_11]"+JSON.stringify({method:"slideDelPage",param:y});window.parent.window.postMessage(A,"*")}if(x){setTimeout(function(){apiNode.gotoPage(q)},0)}}};apiNode.insertPage=function(B,y,v){var J=document.querySelector("section.slides");var I=apiNode.currSlideIndex();var t=slideEls[I];if(!J||!t){return}var z,w="",F=apiNode.newSlideId();if(!B){z='<article id="'+F+'">\n</article>\n'}else{var L=SLIDE_HALF_WIDTH+SLIDE_HALF_WIDTH,r=SLIDE_HALF_HEIGHT+SLIDE_HALF_HEIGHT;var D=y/v,A=SLIDE_HALF_WIDTH/SLIDE_HALF_HEIGHT;if(D>=A){v=Math.floor(L/D+0.5);y=L}else{y=Math.floor(r*D+0.5);v=r}var H=0-Math.floor(y*0.5+0.5);var E=0-Math.floor(v*0.5+0.5);w='<div class="pinp-image slideshow-img" _zindex="996" _config="fullsize-fixed contain-fit default-round2-round3-round0 default-looser-impacted p1-p2-p3-p0" _left="'+H+'" _top="'+E+'" _width="'+y+'" _height="'+v+'">';w+='<img draggable="false" src="'+B+'" _jump=""><div class="rotate-txt"></div></div>\n';z='<article id="'+F+'">\n'+w+"</article>\n"}apiNode.innerHTML=z;var q=apiNode.children[0];var u=t.nextElementSibling;if(u&&u.parentNode===J){J.insertBefore(q,u)}else{J.appendChild(q)}apiNode.innerHTML="";apiNode.initPagePos(F);apiNode.saveSlideDoc();apiNode.renewSlides();apiNode.nextSlide();if(l){var K=[I+1];for(var C=0,G;G=slideEls[C];C++){K.push(G.id||"")}var x="[PINPSLIDE_11]"+JSON.stringify({method:"slideAddPage",param:K});window.parent.window.postMessage(x,"*");if(w){setTimeout(function(){var b="[PINPSLIDE_11]"+JSON.stringify({method:"previewPageHtml",param:[F,"","COMPONENT_OF_PINP_SLIDE,0,"+w]});window.parent.window.postMessage(b,"*")},500)}}};apiNode.setPopContent=function(q,i,r,b){if(l&&window.parent.window.setPopContent){window.parent.window.setPopContent(q,i,r,b,PINP_EXTEND_STYLE)}};apiNode.getPopContent=function(b){if(l&&window.parent.window.getPopContent){return window.parent.window.getPopContent(b)}};apiNode.hidePopContent=function(){try{if(l&&window.parent.window.hidePopContent){return window.parent.window.hidePopContent()}}catch(b){}};var k=0;var h=null;var n=function(q,s){if(q.length){var r=q[q.length-1];var t=s.length;while(r.length>t){var b=r[t];if(b.rowspan>1){s.push({colspan:b.colspan,rowspan:b.rowspan-1,style:"",text:"<+>"});for(var i=1;i<b.colspan;i++){s.push({colspan:0,rowspan:0,style:"",text:"<->"})}t=s.length}else{break}}}};apiNode.dbclickEdit=function(L){var F=document.getElementById("slide-menu");F.style.display="none";if(!l){return}if(!L){L=getCurrSelected()}if(!L){return}apiNode.hidePopContent();if(L.classList.contains("code-block")){var V=L.querySelector(".code-block > pre");if(V){k+=1;h=L;var Q="[PINPSLIDE_11]"+JSON.stringify({method:"editSlideTxt",param:[k,V.textContent]});window.parent.window.postMessage(Q,"*")}}else{if(L.classList.contains("table-set")){var b=L.querySelector(".table-set > table");if(b){var K=0,x=[],aa=[];var Z=b.getAttribute("style");if(Z){aa.push(["style=",Z])}var r=b.className;if(r){aa.push(["class=",r])}var y=[],J=b.querySelectorAll("tr");for(var T=0,I;I=J[T];T++){var S={colspan:0,rowspan:0,style:"",text:"td"};var B=[S],H=false;var C=I.querySelectorAll("td,th");for(var A=0,t;t=C[A];A++){if(t.nodeName=="TH"){H=true}n(y,B);var w={colspan:1,rowspan:1,style:"",text:""};B.push(w);var Y=t.getAttribute("colspan");var X=t.getAttribute("rowspan");var U=t.style.cssText;if(Y){w.colspan=parseInt(Y)}if(X){w.rowspan=parseInt(X)}if(U){var N=x.indexOf(U);if(N<0){N=x.push(U)-1}w.style=N+""}w.text=t.innerHTML;if(w.colspan>=2){for(var z=1;z<w.colspan;z++){B.push({colspan:0,rowspan:0,style:"",text:"<->"})}}}n(y,B);if(H){S.text="th"}if(K<B.length){K=B.length}y.push(B)}for(var T=0;T<x.length;T++){aa.push([T+"=",x[T]])}for(var T=0,I;I=y[T];T++){var B=[],u=true;for(var A=0,t;t=I[A];A++){if(u){u=false;if(t.text=="th"){B.push("header=")}else{B.push("")}}else{if(t.style){B.push("<"+t.style+":"+t.text+">")}else{B.push(t.text)}}}aa.push(B)}k+=1;h=L;var R="<p>Join to left cell: &lt;-&gt;<br>Join to above cell: &lt;+&gt;";var Q="[PINPSLIDE_11]"+JSON.stringify({method:"editTableData",param:[k,aa,aa.length,K,PINP_SLIDE_FONT,R]});window.parent.window.postMessage(Q,"*")}}else{if(L.classList.contains("frame-build")){var P=L.querySelector(".frame-build > iframe");if(P){var R=P.contentWindow.window.getHintText()||"";var aa=P.contentWindow.window.getContent();var v=aa.length,K=0;for(var T=0;T<v;T++){var I=aa[T];if(I.length>K){K=I.length}}k+=1;h=L;var Q="[PINPSLIDE_11]"+JSON.stringify({method:"editTableData",param:[k,aa,v,K,PINP_SLIDE_FONT,R]});window.parent.window.postMessage(Q,"*")}}else{if(L.classList.contains("svg-shape")){var M="",q="",G="",D=L.getAttribute("_widget")||"";var E=L.querySelector(".svg-shape > div.shape-canvas");if(E){sStyle=E.getAttribute("style")||"";G=E.innerHTML}var W=L.querySelector(".svg-shape > div.shape-canvas");if(W){q=W.getAttribute("style")||""}k+=1;h=L;var Q="[PINPSLIDE_11]"+JSON.stringify({method:"editShapeData",param:[k,L.className,G,D,sStyle,q]});window.parent.window.postMessage(Q,"*")}else{if(L.classList.contains("svg-paper")){k+=1;h=L;var O=L.getAttribute("name")||"";var Q="[PINPSLIDE_11]"+JSON.stringify({method:"editPaperData",param:[k,L.innerHTML,L.className,O,PINP_SLIDE_FONT,PINP_SOURCECODE_FONT,PINP_CONTENT_FONT,PINP_EXTEND_STYLE,CURR_USR_PATH]});window.parent.window.postMessage(Q,"*")}}}}}};apiNode.setPrePost=function(r){var b=document.getElementById("slide-menu");b.style.display="none";if(!l){return}if(!r){r=getCurrSelected()}if(!r){return}apiNode.hidePopContent();var q=r.getAttribute("_prepost")||"";var t=apiNode.canPlay(r);k+=1;h=r;var i="[PINPSLIDE_11]"+JSON.stringify({method:"editPrepost",param:[k,q,t]});window.parent.window.postMessage(i,"*")};apiNode.savePrepost=function(i,b){if(k==i&&h&&h.parentNode){if(b){h.setAttribute("_prepost",b)}else{h.removeAttribute("_prepost")}apiNode.setPageModified()}};apiNode.saveSlideTxt=function(q,b){if(k==q&&h&&h.parentNode){var i=h.querySelector(".code-block > pre");if(i&&h.classList.contains("code-block")){h=null;i.textContent=b||"";apiNode.setPageModified()}}};apiNode.saveTableData=function(ac,ad){if(k==ac&&h&&h.parentNode){if(h.classList.contains("frame-build")){var P=h.querySelector("iframe");if(P){P.contentWindow.window.setContent(ad);var H="[";for(var W=0;W<ad.length;W++){var K=ad[W];var C="[";for(var B=0;B<K.length;B++){var s=K[B];if(typeof s=="string"){if(s){C+=JSON.stringify(s)+","}else{C+=","}}else{C+=","}}while(C&&C[C.length-1]==","){C=C.slice(0,-1)}H+=C+"],"}if(H.length>1){H=H.slice(0,-1)}H+="]";P.setAttribute("_widget",H.replace(/"/gm,"'"));h=null;apiNode.setPageModified()}return}else{if(!h.classList.contains("table-set")){return}}var q="",A={},U=0;for(var W=0;W<ad.length;W++){var ab=ad[W],Z=ab[0];if(ab.length>=2&&typeof Z=="string"){if(Z=="class="){q=ab[1]}else{if(Z=="header="||!Z){break}else{if(Z[Z.length-1]=="="){A[Z]=ab[1]||""}}}}U+=1}var O=0;for(var W=U;W<ad.length;W++){var K=ad[W];for(var B=1;B<K.length;B++){var R=K[B];if(R&&typeof R=="string"){if(O<B){O=B}}}}var w=[];for(var W=U;W<ad.length;W++){var K=ad[W];var I=K.length;if(I==0){continue}var C="",S="td";if(I>0&&K[0]=="header="){S="th"}var V=[{colspan:0,rowspan:0,style:"",text:S}];var D=true;var B=1;while(B<I){var G=K[B],E="";if(typeof G=="string"){E=G}var v=E.length;if(v){D=false}else{if(B>O){break}}B+=1;var u={colspan:1,rowspan:1,style:"",text:E};V.push(u);if(v==3&&E=="<->"){u.colspan=0;var ae=V.length-2;while(ae>=0){var T=V[ae];ae-=1;if(T.colspan>0){T.colspan+=1;break}}}else{if(v==3&&E=="<+>"){u.rowspan=0;var ae=V.length-1;var t=w.length-1;while(t>=0){var ab=w[t];t-=1;if(ab.length>ae){var T=ab[ae];if(T.rowspan>0){T.rowspan+=1;break}}}}else{if(v>=2&&E[0]=="<"&&E[E.length-1]==">"){var L=E.charCodeAt(1);if(L>=48&&L<=57){var N=E.indexOf(":");if(N>0){var X=E.sliceOf(1,N-1);if(X.length){X=A[X+"="]||"";u.style=X}u.text=E.slice(N+1,E.length-1)}}}}}}if(!D){w.push(V)}}for(var W=0;W<w.length;W++){var F=w[W];for(var B=1;B<F.length;B++){var u=F[B];if(u.colspan>1&&u.rowspan>1){for(var z=1;z<u.rowspan;z++){if(W+z<w.length){var M=w[W+z];var x=M.length;for(var y=1;y<u.colspan;y++){if(B+y<x){var T=M[B+y];T.colspan=0}else{break}}}else{break}}}}}var Y="<table";if(q.length){Y+=' class="'+q+'"'}var aa=A["style="]||"";if(aa){Y+=" style="+JSON.stringify(aa)}Y+=">";for(var W=0;W<w.length;W++){var J=w[W],C="",S="",r=true;for(var B=0;B<J.length;B++){var Q=J[B];if(r){r=false;S=Q.text}else{if(Q.colspan<=0||Q.rowspan<=0){continue}var X="";if(Q.style){X=" style="+JSON.stringify(Q.style)}if(Q.colspan==1){if(Q.rowspan==1){C+="<"+S+X+">"+Q.text+"</"+S+">"}else{C+="<"+S+' rowspan="'+Q.rowspan+'"'+X+">"+Q.text+"</"+S+">"}}else{C+="<"+S+' colspan="'+Q.colspan+'"';if(Q.rowspan>1){C+=' rowspan="'+Q.rowspan+'"'}C+=X+">"+Q.text+"</"+S+">"}}}Y+="<tr>"+C+"</tr>"}Y+="</table>";h.innerHTML=Y;h=null;apiNode.setPageModified()}};apiNode.saveShapeData=function(v,t){if(k==v&&h&&h.parentNode){if(h.classList.contains("svg-shape")){var b=t[0];if(b){h.setAttribute("_widget",b)}var u=t[1]||"";var s=t[2]||"";var i=h.querySelector("div.shape-canvas");if(i){if(u){var r="-webkit-transform:"+u+";-moz-transform:"+u+";-ms-transform:"+u+";-o-transform:"+u+";transform:"+u+";";i.setAttribute("style",r)}else{i.removeAttribute("style")}}var q=h.querySelector("div.rotate-txt");if(q){if(s){var r="-webkit-transform:"+s+";-moz-transform:"+s+";-ms-transform:"+s+";-o-transform:"+s+";transform:"+s+";";q.setAttribute("style",r)}else{q.removeAttribute("style")}}resetSvgColor(h);h=null;apiNode.setPageModified()}}};apiNode.savePaperData=function(i,b){if(k==i&&h&&h.parentNode){if(h.classList.contains("svg-paper")){h.innerHTML=b;h=null;apiNode.setPageModified()}}};if(l){var g=[];for(var f=0,m;m=slideEls[f];f++){g.push(m.id||"")}var p="[PINPSLIDE_11]"+JSON.stringify({method:"onSlideLoad",param:g});window.parent.window.postMessage(p,"*")}},false)})();