var PINP_HOST_DOMAIN="www.pinp.me";require.config({paths:{basic10:"/software/pages/js/basic10"}});define(["basic10"],function(l){function k(F){if(document.cookie.length>0){var E,D=document.cookie.indexOf(F+"=");if(D!=-1){D=D+F.length+1;E=document.cookie.indexOf(";",D);if(E==-1){E=document.cookie.length}return unescape(document.cookie.substring(D,E))}}return""}function r(D,F,H,G){H=H||1;var E=new Date();E.setTime(E.getTime()+H*24*60*60*1000);G=G||"/";document.cookie=D+"="+escape(F)+";expires="+E.toGMTString()+";path="+G+";"}function A(E,F){if(document.cookie.length>0){var D=document.cookie.indexOf(E+"=");if(D!=-1){var G=new Date();G.setTime(G.getTime()-1);F=F||"/";document.cookie=E+"=;expires="+G.toGMTString()+";path="+F+";"}}}function q(F){if(F){F=F.slice(1)}var J={},D=F.split("&");for(var H=D.length-1;H>=0;H--){var I=D[H],E=I.split("="),G=(E[0]||"").trim();if(G){J[G]=E[1]||""}}return J}function o(E,F,G){var D=null;if(window.XMLHttpRequest){D=new XMLHttpRequest()}else{if(window.ActiveXObject){D=new ActiveXObject("Microsoft.XMLHTTP")}}if(D!=null){D.onreadystatechange=function(){if(D.readyState==4){var H=D.responseText;if(D.status==200){D=null;if(F){F(H)}}else{D=null;if(G){G.push(H);if(F){F("")}}}}};D.open("GET",E,true);D.send(null)}}function a(D){return D.replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function C(E){var D=document.createElement("a");D.href=E;if(D.host==""){D.href=D.href}return D}var d={__base__:l.BaseWidget,__widget__:["wdProjList","wdPopDlgForm","wdMarkdown","wdResPanel"],init:function(D){this._super(D);var F=this;var J=(F.get("__debug__")||0)&1;if(J){return}var E=F.wd.querySelectorAll(".head-toolbar > img");for(var G=0,I;I=E[G];G++){if(I.name=="refresh"){I.onclick=function(K){if(x){F.wdProjList.r.gotoHome()}else{F.wdProjList.r.fire("refresh")}}}else{if(I.name=="CreatePrj"){I.onclick=function(K){F.wdPopDlgForm.r.createPrj()}}else{if(I.name=="RemovePrj"){I.onclick=function(K){F.wdPopDlgForm.r.removePrj()}}else{if(I.name=="CreateSubPrj"){I.onclick=function(K){F.wdPopDlgForm.r.createSubPrj()}}else{if(I.name=="EditPrj"){I.onclick=function(L){var K=F.wdProjList.r.getCurrProj();if(K){F.wdMarkdown.r.startEditDoc(K)}else{alert("Please select a project node first")}}}else{if(I.name=="SharePrj"){I.onclick=function(K){F.wdPopDlgForm.r.startShareDoc()}}else{if(I.name=="SubmitPrj"){I.onclick=function(K){F.wdMarkdown.r.startSubmitDoc()}}else{if(I.name=="TransPrj"){I.onclick=function(K){F.wdMarkdown.r.startTransDoc()}}}}}}}}}}var H=F.wd.querySelector("img.head-nohover");H.classList.add("head-rotate");F.on("ssHeadbarClick",function(L){var K=L.original.target;if(K&&K.nodeName=="DIV"&&K.classList.contains("head-toolbar")){F.wdMarkdown.r.tryUnselectSS()}});F.on("ssResToolClick",function(L){var K=L.original.target;if(!K){return}var M=K.getAttribute("name");if(M=="collapse"){if(K.classList.contains("head-rotate")){K.classList.remove("head-rotate");F.wdResPanel.r.switch2Narrow();F.wdPopDlgForm.r.setPopupRightWd(28)}else{K.classList.add("head-rotate");F.wdResPanel.r.switch2Wide();F.wdPopDlgForm.r.setPopupRightWd(300)}}else{if(!H.classList.contains("head-rotate")){H.classList.add("head-rotate");F.wdResPanel.r.switch2Wide()}if(M=="syntax"){F.wdResPanel.r.fire("showSyntax")}else{if(M=="files"){F.wdResPanel.r.fire("showFolder")}}}})},selectProj:function(H,D){var F=D+': <a target="_blank" href="/'+H+'/">'+H+"</a>";if(F==this.data.infoTitle){return}var G=this.data.infoId+1;this.data.infoId=G;this.data.infoTitle=F;this.update();var E=this;setTimeout(function(){if(G==E.data.infoId){E.data.infoTitle=E.data.editingTitle;E.update()}},8000)},editProj:function(G,F,D){if(G=="blog"){this.data.submitWd="32px";this.data.transWd="32px"}else{if(G=="sshow"){this.data.submitWd="32px";this.data.transWd="0px"}}var E=D+": "+F;this.data.editingTitle=E;this.data.infoTitle=E;this.update()},clearInfo:function(){this.data.editingTitle="";this.data.infoTitle="";this.update()}};var f=[];var h={};var u="";var x=q(location.search).info||"";var B={};var c={};var s={};var i={};var e=[];function v(E,D){if(D.readyState<4){return D.statusText||"request abort"}else{return E.message||D.statusText||"error code:"+D.status}}function g(D,F){if(D.readyState<4){return D.statusText||"request abort"}else{var E="";if(F&&D.responseJSON){E=D.responseJSON[F]}return E||D.statusText||"error code:"+D.status}}function j(D){if(i.repos_name===D){return i}else{return _.find(e,function(E){return E.repos_name===D})}}function b(){this.succ=0;this.bErr=[];this.bOut=[]}b.prototype={checkRet:function(){if(this.succ+this.bErr.length>=this.bOut.length){this.callback(this.bErr,this.bOut)}},start:function(H,I){this.callback=I;var G=0;var D=this;var E=function(J,K,L){return function(){var M=new Gh3.File({path:"config.json"},B,K,"gh-pages");M.fetchContent(function(P,N){if(!D){return}if(P){D.bErr.push(K);D.checkRet();return}var Q=null;try{var O=M.getRawContent();if(O&&O.charCodeAt(0)==65279){O=O.slice(1)}Q=JSON.parse(O)}catch(R){alert("JSON format error: "+K+"/config.json");D.bErr.push(K);D.checkRet();return}c["/"+K+"/config.json"]=M.sha;D.bOut[J]=[K,L,Q];D.succ+=1;D.checkRet()})}};var F=[];_.each(H,function(K){var L="",J="";if(K instanceof Array&&K.length==2){L=K[0];J=K[1]}else{if(typeof K=="string"){L=K}}if(L){D.bOut.push(L);F.push(D.getAjaxFunc(G,L,J));G+=1}});setTimeout(function(){if(D.succ+D.bErr.length<D.bOut.length){I(D.bErr,D.bOut)}D=null},60000);_.each(F,function(J){J()})}};var y={__base__:l.BaseWidget,__widget__:["wdPopDlgForm","wdSplitterA","wdMarkdown","wdResPanel","wdToolbar","wdPreviewArea"],init:function(K){this._super(K);var R=this;var E=(R.get("__debug__")||0)&1;if(E){return}var L=navigator.userAgent.toLowerCase();if(L.match(/trident.*rv[ :]*([\d.]+)/)||L.match(/msie ([\d.]+)/)){window.WEB_IE_BROWSER=true}else{window.WEB_IE_BROWSER=false}var H="";var O="";var M=function(S){$.ajax({type:"GET",url:"//"+PINP_HOST_DOMAIN+"/software/pages/blogger/has_login.action",data:{info:S,login:B.login,uid:B.id,type:B.type=="User"?"user":"orgn"},success:function(T){},error:function(T){}})};var I=function(T,U,S){$.ajax({type:"GET",url:"https://api.github.com/user?access_token="+T,success:function(V){B=new Gh3.User(V.login,V);$.ajax({type:"GET",url:"//"+B.login+".github.io/software/blogger10.json",success:function(W){s=W;M(U);S()},error:function(W){if(W.status=="404"){$.ajax({type:"GET",url:"https://api.github.com/user/orgs?access_token="+T,success:function(Y){if(!(Y instanceof Array)||Y.length!=1){H="REPO_NOT_READY";O="no proper organization found";S()}else{var X=Y[0];B=new Gh3.User(X.login);B.fetch(function(aa,Z){if(aa){H="REPO_NOT_READY";O="unrecognized user: "+X.login;S()}else{$.ajax({type:"GET",url:"//"+B.login+".github.io/software/blogger10.json",success:function(ab){s=ab;M(U);S()},error:function(ab){H="GET_USER_ERR";O="read /software/blogger10.json failed ("+g(ab)+")";S()}})}})}},error:function(X){H="GET_USER_ERR";O="get organization failed ("+g(X,"message")+")";S()}})}else{H="GET_USER_ERR";O="read /software/blogger10.json failed ("+g(W)+")";S()}}})},error:function(V){H="GET_USER_ERR";O="get github user failed ("+g(V,"message")+")";S()}})};if(x){u=k("git_tok")||"";if(u){var Q=location.pathname.split("/");Q.pop();A("git_tok",Q.join("/"));Gh3.access_token=u;I(u,x,function(){if(H){R.data.errMsg="load config failed";R.update();alert(H+": "+O)}else{R.initGitLogin()}})}else{$.ajax({type:"GET",url:"//"+PINP_HOST_DOMAIN+"/software/pages/blogger/get_token.action?info="+x,success:function(S){if(S instanceof Array&&S.length){u=S[0];I(u,x,function(){if(H){R.data.errMsg="load config failed";R.update();alert(H+": "+O)}else{R.initGitLogin()}})}else{alert("Query authorization failed!")}},error:function(S){alert("Query authorization failed: "+g(S))}})}}var P=function(X,ab){var S=R.wd.querySelectorAll(".prj-item.prj-sub2-item");for(var Y=0,ag;ag=S[Y];Y++){ag.parentNode.removeChild(ag)}S=R.wd.querySelectorAll(".prj-item.prj-show");for(var Y=0,ag;ag=S[Y];Y++){ag.classList.remove("prj-show")}S=R.wd.querySelectorAll(".prj-item.prj-selected");for(var Y=0,ag;ag=S[Y];Y++){ag.classList.remove("prj-selected")}S=R.wd.querySelectorAll(".prj-item.prj-selected2");for(var Y=0,ag;ag=S[Y];Y++){ag.classList.remove("prj-selected2")}var Z={};for(var Y=0,ag;ag=f[Y];Y++){var ac=ag.title;if(ab&&ac.indexOf(ab)!=0){continue}var af=ac.split("/");var W=ac.indexOf("$$",ab.length);var V=ac.indexOf("/",ab.length);if(W==ab.length&&V>W){var U=ac.indexOf("/$$",ab.length);var aa=ab+ac.slice(W,V+1);if(!Z[aa]){var ae="folder.png",T=Y,ad=ac;while(true){if(ad.indexOf("$$",aa.length)==aa.length){ae="folder_sub.png";break}T+=1;if(T>=f.length){break}ad=f[T].title;if(!ad||ad.indexOf(aa)!=0){break}}Z[aa]=true;X.push({isFolder:true,hasThumb:false,logoUrl:ae,itemCls:"prj-cate-folder",title:ac.slice(W+2,V),alias:ag.alias,cateProj:ag.alias+"/"+aa})}if(U!=V){var ae=ag.hidden?"prj_unrelease.png":(ag.hasThumb?"prj_item.png":"prj_item_web.png");X.push({isFolder:false,hasThumb:ag.hasThumb,hasSub:ag.hasSub,logoUrl:ae,itemCls:"prj-sub-item",title:af[af.length-1],alias:ag.alias,cateProj:ag.alias+"/"+ac,canWrite:ag.canWrite,prjType:ag.type,prjSize:ag.size,prjAcl:ag.acl})}}else{if(W<0&&V<0&&ac.length>ab.length){var ae=ag.hidden?"prj_unrelease.png":(ag.hasThumb?"prj_item.png":"prj_item_web.png");var ad=ac.slice(ab.length);X.push({isFolder:false,hasThumb:ag.hasThumb,hasSub:ag.hasSub,logoUrl:ae,itemCls:"prj-curr-item",title:ad,alias:ag.alias,cateProj:ag.alias+"/"+ac,canWrite:ag.canWrite,prjType:ag.type,prjSize:ag.size,prjAcl:ag.acl})}}}};var D=function(X){var W=R.wd.querySelector(".prj-item.prj-selected");if(W){if(W===X){return}W.classList.remove("prj-selected")}var T=R.wd.querySelectorAll(".prj-item.prj-show");for(var U=0,V;V=T[U];U++){V.classList.remove("prj-show")}T=R.wd.querySelectorAll(".prj-item.prj-selected2");for(var U=0,V;V=T[U];U++){V.classList.remove("prj-selected2")}T=R.wd.querySelectorAll(".prj-item.prj-sub2-item");for(var U=0,V;V=T[U];U++){V.parentNode.removeChild(V)}X.classList.add("prj-selected");var S=X.getAttribute("title");if(!S){return}X=X.nextElementSibling;while(X&&X.classList.contains("prj-sub-item")){if(X.getAttribute("title").indexOf(S)!=0){break}X.classList.add("prj-show");X=X.nextElementSibling}};var J=function(V,ad){var ab=R.data.items[ad];if(!ab){return}var Y=ab.cateProj;if(!Y){return}var Z=Y.indexOf("/");if(Z<=0){return}var T=Y;var aa=Y.slice(0,Z);Y=Y.slice(Z+1);var S=R.wd.querySelectorAll(".prj-item.prj-selected2");for(var Z=0,af;af=S[Z];Z++){af.classList.remove("prj-selected2")}if(!ab.hasSub){V.classList.add("prj-selected2");return}var ac=function(ak){if(!V.parentNode){return}if(ab!==R.data.items[ad]){return}if(ak.length<=0){return}var ap=ab.prjAcl||"private";var ai=V.nextElementSibling;for(var aj=0,ao;ao=ak[aj];aj++){var an=T+"/$$/"+ao[0];if(R.wd.querySelector('.prj-item[title="'+an+'"]')){continue}var ah=ao[1];var am=ah?"prj_item.png":"prj_item_web.png";var al=document.createElement("div");al.setAttribute("title",an);al.setAttribute("allow",ap);al.setAttribute("alias",aa);al.setAttribute("thumb",ah?"1":"0");al.className="prj-item prj-sub2-item";al.innerHTML='<img class="noselect-txt" draggable="true" src="'+am+'"><span draggable="true">'+a(ao[0])+"</span>";if(ai){V.parentNode.insertBefore(al,ai)}else{V.parentNode.appendChild(al)}}};V.classList.add("prj-selected2");var X=V.nextElementSibling;if(X&&X.classList.contains("prj-sub2-item")){return}var ae=h[T];if(ae instanceof Array){ac(ae)}else{if(x){var U=[];var W=function(){if(U.length==0){ab.hasSub=false;h[T]=[]}else{var ah=[];_.each(U,function(ai){ah.push([ai,false])});h[T]=ah;ac(ah)}};var ag=new Gh3.Dir({path:Y+"/$$"},B,aa,"gh-pages");ag.fetchContents(function(ai,ah){if(ai){if(ah.status!=404){alert("List files ("+Y+"/$$/) failed: "+ai.message);return}W();return}ag.eachContent(function(aj){if(aj.type=="dir"){var ak=aj.name;if(ak[0]!="."&&ak[0]!="$"){U.push(ak)}}});W()});return}}};R.on("ssPrjClick",function(S){var Z=S.original.target,W=null;while(Z){if(Z.nodeName=="DIV"){if(Z.classList.contains("web-item")){break}if(Z.classList.contains("prj-item")){W=Z;break}}Z=Z.parentNode}if(W){var T=R.wd.querySelectorAll(".prj-item.prj-selected3");for(var Y=0,ac;ac=T[Y];Y++){ac.classList.remove("prj-selected3")}if(W.classList.contains("prj-cate-folder")){D(W)}else{if(W.classList.contains("prj-sub-item")||W.classList.contains("prj-curr-item")){var ab=W.getAttribute("title");if(ab){var V=W.getAttribute("allow")||"private";R.wdToolbar.r.selectProj(ab,V)}if(W.classList.contains("prj-selected2")){return}var X=W.getAttribute("name");if(X&&X.indexOf("prj-")==0){var aa=parseInt(X.slice(4));J(W,aa)}}else{if(W.classList.contains("prj-sub2-item")){W.classList.add("prj-selected3");var ab=W.getAttribute("title");if(ab){var T=R.wd.querySelectorAll(".prj-item.prj-selected2");for(var Y=0,ac;ac=T[Y];Y++){ac.classList.remove("prj-selected2")}var U=W.previousElementSibling;while(U){if(U.classList.contains("prj-sub-item")||U.classList.contains("prj-curr-item")){U.classList.add("prj-selected2");break}else{if(!U.classList.contains("prj-sub2-item")){break}}U=U.previousElementSibling}var V=W.getAttribute("allow")||"private";R.wdToolbar.r.selectProj(ab,V)}}}}}});R.on("ssPrjDblclick",function(T){var S=T.original.target;setTimeout(function(){var V=null,aa=S;while(aa){if(aa.nodeName=="DIV"){if(aa.classList.contains("web-item")){break}if(aa.classList.contains("prj-item")){V=aa;break}}aa=aa.parentNode}if(!V){return}var W=[],ae="",X=false,Z="";var Y=V.getAttribute("alias");if(!Y){return}if(V.classList.contains("prj-cate-folder")){if(!V.classList.contains("prj-selected")){return}ae=V.getAttribute("title");if(ae.indexOf(Y+"/")==0){ae=ae.slice(Y.length+1)}else{ae=""}X=true}else{if(V.classList.contains("prj-up-folder")){Z=R.data.currCate;var ac=Z.split("/$$");if(x&&ac.length<=2){ae=""}else{if(ac.length<=1){ae=""}else{ac.pop();ae=ac.join("/$$")+"/"}}X=true}else{if(V.classList.contains("prj-sub-item")||V.classList.contains("prj-curr-item")||V.classList.contains("prj-sub2-item")){var ad=V.getAttribute("title");if(ad){var U=V.getAttribute("allow")||"private";R.wdResPanel.r.selectProj(ad,U)}}}}if(X){R.data.items=W;R.data.currCate=ae;P(W,ae);R.update();if(ae){var ab=R.wd.querySelector(".prj-item.prj-up-folder");if(ab){ab.setAttribute("title",Y+"/"+ae);ab.setAttribute("alias",Y)}}if(Z){setTimeout(function(){var af=R.wd.querySelector('.prj-cate-folder[title="'+Y+"/"+Z+'"]');if(af){D(af)}},0)}}},0)});var G=function(S){var Y=S.target;while(Y){if(Y.nodeName=="DIV"){if(Y.classList.contains("prj-item")){break}else{if(Y.classList.contains("prj-root-node")){return}}}Y=Y.parentNode}var ab=0,Z="",T=false,V=1;if(Y.classList.contains("prj-sub-item")){ab=1;Z=Y.getAttribute("title")||"";V=(Z.slice(Z.length-5)==".blog"?3:1);var W=Y.getAttribute("name");if(W&&W.indexOf("prj-")==0){var aa=parseInt(W.slice(4));var X=R.data.items[aa];if(X){T=X.hasThumb;V=X.prjType}}}else{if(Y.classList.contains("prj-sub2-item")){ab=2;Z=Y.getAttribute("title")||"";T=parseInt(Y.getAttribute("thumb")||"0");V=(Z.slice(Z.length-5)==".blog"?3:1)}}var ac=(ab?Y.querySelector("img"):null);if(ab&&Z&&ac){r("drag_task","put_prj");var U="project,"+(T?"1":"0")+","+V;S.dataTransfer.effectAllowed="copy";S.dataTransfer.setData(window.WEB_IE_BROWSER?"text":"text/args",U+","+Z);if(S.dataTransfer.setDragImage){S.dataTransfer.setDragImage(ac,0,0)}}};R.on("ssDragStart",function(S){R.wdMarkdown.r.saveCaretPos();G(S.original)});R.on("ssDragEnd",function(S){A("drag_task")});R.on("refreshShow",function(U){var W="";var T=R.wd.querySelector(".prj-cate-folder.prj-selected");if(T){W=T.getAttribute("title")}var X=[],S=R.data.currCate;R.data.items=X;P(X,S);R.update();if(S&&T){var V=T.getAttribute("alias");var Y=R.wd.querySelector(".prj-item.prj-up-folder");if(Y){Y.setAttribute("title",V+"/"+S);Y.setAttribute("alias",V)}}if(W){setTimeout(function(){var Z=R.wd.querySelector('.prj-cate-folder[title="'+W+'"]');if(Z){D(Z)}},0)}});R.on("refresh",function(S){});var N=R.wdMarkdown.parentNode.parentNode.parentNode;var F=function(X,W){var V=Math.max(R.wd.clientHeight,R.wdMarkdown.parentNode.clientHeight+R.wdPreviewArea.clientHeight);V=Math.max(window.innerHeight-R.wdToolbar.parentNode.clientHeight,V);R.wdSplitterA.style.height=V+"px";var T=N.parentNode.clientWidth-4-60-R.wdResPanel.clientWidth;var S=Math.max(1,Math.min(T,X+W));var U=N.parentNode.clientWidth-R.wdSplitterA.clientWidth-S;R.wd.parentNode.style.width=S+"px";N.style.width=U+"px";if(R.wdMarkdown.r){R.wdMarkdown.r.fire("resized")}if(R.wdPreviewArea.r){R.wdPreviewArea.r.fire("resized")}};document.body.addEventListener("mousemove",function(U){var V=R.wdSplitterA.r.data;if(V.inMoving){var S=U.clientX,T=S-V.moveFromX;if(!V.moved&&Math.abs(T)>=4){V.moved=true}if(V.moved){F(V.leftWidth,T)}}},false);document.body.addEventListener("mouseup",function(T){var U=R.wdSplitterA.r.data;if(U.inMoving){var S=T.clientX-U.moveFromX;if(U.moved){F(U.leftWidth,S)}U.inMoving=false}},false);document.getElementById("web-body")["on-resize"]=function(S,T){F(R.wd.parentNode.clientWidth,0)};R.on("resized",function(S){F(R.wd.parentNode.clientWidth,0)});R.on("resized2",function(S){F(R.wd.parentNode.clientWidth,R.data.resizeGap||0)})},initGitLogin:function(){if(!B.login){return}var G=this;G.data.errMsg="loading...";G.update();c={};e=[];f=[];h={};var F="";var J="";var E=function(L){for(var O=-1;O<L.length;O++){var P=i,Q="",N="";if(O>=0){var M=L[O];Q=M[0];P=M[2];if(Q!==P.repos_name){P.repos_name=Q}N=M[1]||Q;e.push(P)}else{Q=P.repos_name;N=P.repos_desc||""}var K=P.doc_list;K.sort(function(S,R){if(S.path>R.path){return 1}else{if(S.path===R.path){return 0}else{return -1}}});_.each(K,function(T){var S=T.path,V=S.slice(-5);var R=T.flag||3,X=(R&255)!=3,U=(R&256)!=0;var W={title:S,alias:Q,time:T.modify_at,hidden:U?1:0,type:V==".blog"?3:1,size:0,acl:"public",canWrite:X?0:1};W.hasSub=true;W.hasThumb=!!T.thumb;f.push(W)})}G.data.currCate="";G.data.friendGroup=[];if(f.length==0){G.data.errMsg="No project exists";G.update()}else{G.data.errMsg="";G.data.currCate="";G.fire("refreshShow")}};var H=function(){if(F){G.data.errMsg="loading config failed";G.update();alert(F+": "+J)}else{var L=i.builtin_repos||[],K=new b();if(L.length==0){G.data.errMsg="";G.update();E([]);return}K.start(L,function(O,M){if(O.length){var Q="load failed";_.each(O,function(R){Q+=", "+R+"/config.json"});G.data.errMsg="loading config failed";G.update();alert(Q);return}for(var N=0,P;P=M[N];N++){if(typeof P=="string"){G.data.errMsg="loading config failed";G.update();alert("load file failed: "+P+"/config.json");return}}G.data.errMsg="";G.update();E(M)})}};var I=s.home_repository;var D=new Gh3.File({path:"config.json"},B,I,"gh-pages");D.fetchContent(function(M,K){if(M){F="LOAD_FAILED";J="load config.json failed";H();return}var N=null;try{var L=D.getRawContent();if(L&&L.charCodeAt(0)==65279){L=L.slice(1)}N=JSON.parse(L)}catch(O){alert("JSON format error: "+I+"/config.json");F="LOAD_FAILED";J="load config.json failed";H();return}c["/"+I+"/config.json"]=D.sha;i=N;H()})},addPrjNode:function(E){if(E.length<9){return}var H=E[0],D=E[1];var I={title:D,alias:H,time:E[2],type:E[3],size:E[4],hidden:E[5],acl:E[6],canWrite:1,hasThumb:E[7],hasSub:E[8]};for(var F=0,G;G=f[F];F++){if(H==G.alias&&D<G.title){f.splice(F,0,I);I=null;break}}if(I){f.push(I)}this.data.errMsg="";this.fire("refreshShow")},afterSharePrj:function(G,D,H){for(var E=0,F;F=f[E];E++){if(G==F.alias&&D==F.title){F.hidden=0;F.hasThumb=H;break}}this.data.errMsg="";this.fire("refreshShow")},addSubPrjNode:function(J,E){if(E.length<2){return}var F=E.shift();if(!F){return}for(var G=0,H;H=f[G];G++){if(J==H.alias&&F==H.title){H.hasSub=true;break}}var I=J+"/"+F;if(x){var D=h[I];if(!D){D=[];h[I]=D}for(var G=0,H;H=E[G];G++){D.push(H)}}else{h[I]=E}this.data.errMsg="";this.fire("refreshShow")},rmvPrjNode:function(I,E,G){var J=I.indexOf("/");if(J<=0){return}var N=I.slice(0,J),M=I.slice(J+1);var H=this.wdResPanel.r.data.currProj;var O=!!E[0];if(O){for(var K=0,Q;Q=f[K];K++){if(N==Q.alias&&M==Q.title){f.splice(K,1);if(I==H||(H&&H.indexOf(I+"/")==0)){this.wdResPanel.r.resetFolder()}break}}delete h[I]}else{if(x){G=[];var P=h[I]||[];for(var K=0,Q;Q=P[K];K++){var R=false,D=false;for(var F=1,L;L=E[F];F++){if(L==Q[0]){R=true;break}}if(!R){G.push([Q[0],Q[1]])}}}h[I]=G;if(H&&H.indexOf(I+"/")==0){this.wdResPanel.r.resetFolder()}}this.data.errMsg="";this.fire("refreshShow")},getCurrProj:function(){var H=[],G="",I=null;var J=this.wd.querySelector(".prj-item.prj-selected2");if(J){G=J.getAttribute("title");var K=J.getAttribute("name");if(K&&K.indexOf("prj-")==0){var D=parseInt(K.slice(4));I=this.data.items[D]}}if(G&&I){H.push([J.getAttribute("allow")||"private",G,I.canWrite]);var F=this.wd.querySelector(".prj-item.prj-selected3");var E=F?F.getAttribute("title"):"";if(E){H.push([F.getAttribute("allow")||"private",E,I.canWrite])}}if(H.length){return H}else{return null}},resize2Width:function(D,F){if(D<8){return}var E=this.wd.parentNode.clientWidth;if(F&&E<D){return}this.data.resizeGap=D-E;this.fire("resized2")},gotoHome:function(){location.replace("//www.pinp.me/software/pages/blogger/editor.action")}};var p={__base__:l.BaseWidget,__widget__:["wdProjList"],init:function(D){this._super(D);var E=this;var F=(E.get("__debug__")||0)&1;if(F){return}E.wd.addEventListener("mousedown",function(G){E.data.inMoving=true;E.data.moved=false;E.data.moveFromX=G.clientX;E.data.leftWidth=E.wdProjList.parentNode.clientWidth},false)}};var w={__base__:l.BaseWidget,__widget__:["wdToolbar","wdProjList","wdResPanel","wdPopDlgForm","wdPreviewArea"],init:function(E){this._super(E);var G=this;var H=(G.get("__debug__")||0)&1;if(H){return}G.on("resized",function(J){var I=G.wd.parentNode.parentNode.clientWidth-G.wdResPanel.clientWidth-1;G.wd.parentNode.style.width=I+"px"});G.on("ssChanged",function(I){G.data.changed=true});var F=function(I){var J=G.wd.querySelector("textarea.markdown-editor");if(!J){return}J.focus();setTimeout(function(){var M=G.data.caretPos;if(M>=0){var K=J.value;if(M>K.length){M=K.length}J.value=K.substring(0,M)+I+K.substring(M)}else{if(document.selection){var L=document.selection.createRange();if(L){L.text=I}}else{if("selectionStart" in J){M=J.selectionStart;var K=J.value;if(M>K.length){M=K.length}J.value=K.substring(0,M)+I+K.substring(M)}else{J.value=I+"\n"+J.value}}}},0)};var D=l.getDCF();D.regist("dropTextInfo",function(I){G.wdPopDlgForm.r.hideDlg();var J=I[0];if(J){F(J)}});D.regist("saveSlideShow",function(O){var R=O[0],T=O[1];if(!R||!T){return}var M=R.indexOf("/");if(M<=0){return}var P=R.slice(0,M),U=R.slice(M+1);var S=false;var N=G.wdToolbar.querySelector('img[name="SubmitPrj"]');N.src="loading.gif";setTimeout(function(){if(!S){S=true;N.src="prj_submit.png"}},20000);var J=function(W){if(!S){S=true;N.src="prj_submit.png"}if(W){alert(W)}};if(x){var K=U+"/$index.txt";var I=(new Date()).toLocaleDateString();var Q=c["/"+P+"/"+K];var L=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+P+"/contents/"+K+"?access_token="+u,data:JSON.stringify({path:K,message:I,content:Gh3.Base64.encode(T),sha:Q,branch:"gh-pages"}),success:function(W){c["/"+P+"/"+K]=W.content.sha;G.data.changed=false;J("Submit project successful")},error:function(W){c["/"+P+"/"+K]="";J("Upload failed: "+g(W,"message"))}})};if(!Q){var V=new Gh3.Dir({path:U},B,P,"gh-pages");V.fetchContents(function(Y,X){if(Y){J("List files ("+U+") failed: "+Y.message);return}var W=V.getFileByName("$index.txt");if(!W){J("Read file failed: "+K);return}Q=W.sha;c["/"+P+"/"+K]=Q;L()})}else{L()}return}});G.on("ssDragOver",function(I){var J=k("drag_task");if(J=="put_prj"||J=="put_img"){I.original.preventDefault();I.original.dataTransfer.dropEffect="copy"}});G.on("ssDragDrop",function(I){var V;if(window.WEB_IE_BROWSER){V=I.original.dataTransfer.getData("text")||""}else{V=I.original.dataTransfer.getData("text/args")||""}var R=V.split(",");if(R.length<=3){return}var N=R.slice(3).join(",");if(!N){return}if(R[0]=="project"){I.original.preventDefault();var P="",J=parseInt(R[1]||"0"),U=R[2]||"3";if(J){if(x){var M=N.indexOf("/");if(M>0){var O=N.slice(0,M),S=N.slice(M+1);var Q=j(O);if(Q){var T=_.find(Q.doc_list,function(W){return W.path==S});if(T){P=T.thumb||"";if(P[0]=="$"&&P[1]=="$"){P="/"+O+"/"+Q.repos_name+"/"+P}}}}}else{P="/"+N+"/$thumbnail.png"}}G.wdPopDlgForm.r.addDropPrjFrame(P,U,N)}else{if(R[0]=="image"){var L=parseInt(R[1]||"0"),K=parseInt(R[2]||"0");if(L&&K){I.original.preventDefault();G.wdPopDlgForm.r.addDropImgFrame(L,K,N)}}}})},saveCaretPos:function(){this.data.caretPos=-1;if(this.data.isMarkdown){var D=this.wd.querySelector("textarea.markdown-editor");if(D&&("selectionStart" in D)){this.data.caretPos=D.selectionStart}}},tryResetAcl:function(E,D){if(this.data.currProj==E){this.data.currAcl=D;if(this.data.editingCss=="block"){this.update()}}},startEditDoc:function(D){if(!D||D.length<=0){return}var N=D[D.length-1],R=N[0],M=N[1],H=N[2];if(!H){alert("Project is not blog or slideshow, online editing is not supported!");return}if(this.data.editingCss!="none"&&this.data.currProj){if(M&&this.data.currProj==M){if(!confirm("The project already in editing, do you want reload it?")){return}}if(this.data.changed&&!confirm("A project already in editing, do you want to contine (without submit previous one)?")){return}}if(typeof M!="string"){return}var K=M.indexOf("/");if(K<=0){return}var L=M.slice(0,K),O=M.slice(K+1);if(M.slice(M.length-5)==".blog"){this.el.style.background="url(loading2.gif) no-repeat center";this.data.isMarkdown=true;this.data.editingCss="none";this.update();var P=this;var E=function(S){P.el.style.background="";if(S){alert(S)}};var I=function(T){P.wdToolbar.r.editProj("blog",M,R);P.wdResPanel.r.editProj("blog");P.wdPreviewArea.r.editProj("blog",M);var V=P.data.hasPreview;var S=P.wdPreviewArea.querySelector(".preview-md");if(S){S.innerHTML=""}P.data.hasPreview=false;var U=P.wd.querySelector("textarea.markdown-editor");U.onkeydown=function(W){if(W.ctrlKey&&!W.shiftKey&&!W.altKey&&W.keyCode==77){var X=P.data.currProj;if(P.data.editingCss=="none"||!X){return}if(X.slice(X.length-5)!=".blog"){return}W.stopPropagation();W.preventDefault();P.startTransDoc()}};U.value=T;P.data.changed=false;P.data.currAcl=R;P.data.currProj=M;P.data.editingCss="block";P.update();if(V){P.wdProjList.r.fire("resized")}};if(x){var G=new Gh3.File({path:O+"/$index.md"},B,L,"gh-pages");G.fetchContent(function(T,S){if(T){E("Load file failed: $index.md");return}c["/"+L+"/"+O+"/$index.md"]=G.sha;I(G.getRawContent())});return}}else{if(M.slice(M.length-6)==".sshow"){this.el.style.background="url(loading2.gif) no-repeat center";this.data.isMarkdown=false;this.data.editingCss="none";this.update();var J=this.wd.querySelector("iframe.markdown-frame");if(!J){return}var P=this;var E=function(S){P.el.style.background="";if(S){alert(S)}};var F="/"+M+"/?editing=1";var I=function(){J.onerror=function(S){E(S+"")};J.onload=function(T){E("");P.wdToolbar.r.editProj("sshow",M,R);P.wdResPanel.r.editProj("sshow");P.wdPreviewArea.r.editProj("sshow",M);P.data.hasPreview=false;P.data.changed=false;P.data.currAcl=R;P.data.currProj=M;P.data.editingCss="block";P.update();var S=window.innerWidth-300-616-4;P.wdProjList.r.resize2Width(S,true)};J.src=F};if(x){var Q=new Gh3.Dir({path:O},B,L,"gh-pages");Q.fetchContents(function(U,T){if(U){E("List files ("+O+") failed: "+U.message);return}var S=Q.getFileByName("$index.txt");if(!S){E("Read file failed: "+O+"/$index.txt");return}c["/"+L+"/"+O+"/$index.txt"]=S.sha;I()});return}}}},startSubmitDoc:function(){var L=this.data.currProj;if(this.data.editingCss=="none"||!L){alert("No project in editing");return}if(!this.data.changed){alert("no changes, submition canceled");return}if(L.slice(-5)==".blog"){var H=L.indexOf("/");if(H<=0){return}var J=L.slice(0,H),P=L.slice(H+1);var F=this.wd.querySelector("textarea.markdown-editor");var N=F.value;var M=false;var I=this.wdToolbar.querySelector('img[name="SubmitPrj"]');I.src="loading.gif";setTimeout(function(){if(!M){M=true;I.src="prj_submit.png"}},20000);var Q=this;var E=function(T){if(!M){M=true;I.src="prj_submit.png"}if(T){alert(T)}};var G=function(T){E();if(typeof T=="string"&&T){T=JSON.parse(T);if(typeof T=="string"){if(T=="OK"){Q.data.changed=false;if(Q.data.hasPreview){Q.startTransDoc()}alert("Submit project successful")}else{if(T=="NOT_LOGIN"){Q.wdPopDlgForm.r.checkLogin(true,"submit")}else{alert(T)}}}}};if(x){var O=P+"/$index.md";var D=(new Date()).toLocaleDateString();var K=c["/"+J+"/"+O];var S=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+J+"/contents/"+O+"?access_token="+u,data:JSON.stringify({path:O,message:D,content:Gh3.Base64.encode(N),sha:K,branch:"gh-pages"}),success:function(T){c["/"+J+"/"+O]=T.content.sha;G('"OK"')},error:function(T){c["/"+J+"/"+O]="";E("Upload failed: "+g(T,"message"))}})};if(!K){var R=new Gh3.Dir({path:P},B,J,"gh-pages");R.fetchContents(function(V,U){if(V){E("List files ("+P+") failed: "+V.message);return}var T=R.getFileByName("$index.md");if(!T){E("Read file failed: "+O);return}K=T.sha;c["/"+J+"/"+O]=K;S()})}else{S()}return}}else{if(L.slice(L.length-6)==".sshow"){this.postSlideMsg("startSave",[L])}}},startTransDoc:function(){var I=this.data.currProj;if(this.data.editingCss=="none"||!I){alert("No project in editing");return}if(I.slice(I.length-5)==".blog"){var E=this;var F=E.wd.querySelector("textarea.markdown-editor");var H=E.wdPreviewArea.querySelector(".preview-md");if(H){var G=(E.data.hasPreview)?H.scrollTop:0;var D=E.data.hasPreview&&H.scrollTop>0&&(H.scrollTop+H.clientHeight>H.scrollHeight-10);require(["js/marked.min"],function(J){var K=J(F.value);H.innerHTML=K;E.data.hasPreview=true;E.wdProjList.r.fire("resized");setTimeout(function(){if(D){H.scrollTop=H.scrollHeight}else{H.scrollTop=G}},500)})}}},prjInEditing:function(D){var E=this.data.currProj;if(this.data.editingCss=="none"||!E){return""}if(!this.data.changed){return""}if(E==D){return"*"}else{if(E.indexOf(D+"/$$/")==0){return E.slice(D.length+4)}else{return""}}},cancelEditing:function(){var G=this.data.currProj;if(this.data.editingCss=="none"||!G){return}var F=this.data.hasPreview;var D=this.wdPreviewArea.querySelector(".preview-md");if(D){D.innerHTML=""}this.data.hasPreview=false;var E=this.wd.querySelector("textarea.markdown-editor");if(E){E.value=""}this.data.changed=false;this.data.currProj="";this.data.editingCss="none";this.update();this.wdToolbar.r.clearInfo();if(F){this.wdProjList.r.fire("resized")}},projState:function(){var E=this.data.currProj;if(this.data.editingCss=="none"||!E){return""}var D=E.length;if(D>5&&E.slice(D-5)==".blog"){return"blog"}else{if(D>6&&E.slice(D-6)==".sshow"){return"sshow"}else{return""}}},postSlideMsg:function(D,F){var G=this.wd.querySelector("iframe.markdown-frame");if(G){var E="[PINPSLIDE_11]"+JSON.stringify({method:D,param:F});G.contentWindow.postMessage(E,"*")}},tryUnselectSS:function(){var E=this.wd.querySelector("iframe.markdown-frame");if(E){var D="[PINPSLIDE_11]"+JSON.stringify({method:"tryUnselect",param:[]});E.contentWindow.postMessage(D,"*")}}};var t=[];var n={__base__:l.BaseWidget,__widget__:["wdProjList","wdMarkdown","wdPopDlgForm"],init:function(K){this._super(K);var Q=this;var E=(Q.get("__debug__")||0)&1;if(E){return}Q.on("rewidth",function(U){var T=Q.data.sWidth=="100%"?300:1;var S=Q.wdMarkdown.parentNode;S.style.width=(S.parentNode.clientWidth-T-1)+"px";Q.wd.parentNode.style.width=T+"px"});Q.on("showSyntax",function(S){if(Q.data.pages[0].show!="block"){Q.data.pages[0].show="block";Q.data.pages[1].show="none";Q.update()}});Q.on("showFolder",function(S){if(Q.data.pages[1].show!="block"){Q.data.pages[1].show="block";Q.data.pages[0].show="none";Q.update()}});Q.on("ssDropClick",function(T){var S=Q.wd.querySelector("div.res-dropholder > input");S.click()});Q.on("ssFileChange",function(T){var S=T.original.target;if(S&&S.files&&S.files.length){R(S.files)}});Q.on("ssDragStart",function(S){Q.wdMarkdown.r.saveCaretPos();var aa=S.original.target,U=null;while(aa){if(aa.nodeName=="DIV"){if(aa.classList.contains("res-imgitem")){U=aa;break}else{if(aa.classList.contains("res-files")){return}}}aa=aa.parentNode}if(!U){return}var ad=U.querySelector("img");if(ad&&ad.complete){var Z=null;var ab=parseInt(U.getAttribute("idx")||"0");for(var Y=0,ae;ae=t[Y];Y++){if(ae.id===ab){Z=ae;break}}if(!Z||!Z.realUrl){return}var X,W,V=ad.getAttribute("_size");if(V){var ac=V.split("x");if(ac.length!=2){return}X=ac[0];W=ac[1]}else{X=ad.naturalWidth+"";W=ad.naturalHeight+""}r("drag_task","put_img");var T=S.original.dataTransfer;T.effectAllowed="copy";T.setData(window.WEB_IE_BROWSER?"text":"text/args","image,"+X+","+W+","+Z.realUrl);if(T.setDragImage){T.setDragImage(ad,0,0)}}});Q.on("ssDragEnd",function(S){A("drag_task")});Q.on("ssTempDragStart",function(V){var U=V.original.target;if(U&&U.nodeName=="IMG"){var T=U.getAttribute("src");r("drag_task","run_js");var S=V.original.dataTransfer;S.effectAllowed="copy";S.setData(window.WEB_IE_BROWSER?"text":"text/args","image,0,0,"+T);if(S.setDragImage){S.setDragImage(U,0,0)}}});Q.on("ssTempDragEnd",function(S){A("drag_task")});var N=0;var J=".jpg.jpeg.png.gif.ico.tiff.bmp.svg.svgz.";var O=".jpg.jpeg.png.gif.ico.tiff.bmp.";var F=function(S,U,T){};var G=function(W){var T="res-imgitem";if(W.cls){T+=" "+W.cls}var V=document.createElement("div");V.className=T;V.setAttribute("idx",W.id+"");var S=document.createElement("img");S.setAttribute("draggable","true");S.setAttribute("title",W.title);S.onload=function(X){var af=X.target;if(af.nodeName!="IMG"||!af.naturalHeight){return}var ad=af.parentNode.classList.contains("res-uploading");if(ad){return}var Y=af.getAttribute("src");if(Y=="warning.jpg"||Y=="uploading.gif"){return}var ae=af.getAttribute("_size");if(ae){var Z=af.naturalWidth,aa=af.naturalHeight;af.style.marginLeft=Math.floor((90-Z)/2+0.5)+"px";af.style.marginTop=Math.floor((80-aa)/2+0.5)+"px";af.style.width=Z+"px";af.style.height=aa+"px";return}var ac=af.naturalWidth/af.naturalHeight;if(ac<1.125){var Z=Math.floor(80*ac+0.5);af.style.width=Z+"px";af.style.marginLeft=Math.floor((90-Z)/2+0.5)+"px"}else{var aa=Math.floor(90/ac+0.5);af.style.height=aa+"px";af.style.marginTop=Math.floor((80-aa)/2+0.5)+"px"}var ab=af.getAttribute("_error");if(ab){af.title=ab}else{af.title=af.naturalWidth+"x"+af.naturalHeight}};S.src=W.url;V.appendChild(S);var U=document.createElement("div");U.className="res-rmvimg";U.onclick=function(Y){var ai=Y.target,Z=null;while(ai){if(ai.nodeName=="DIV"){if(ai.classList.contains("res-imgitem")){Z=ai;break}else{if(ai.classList.contains("res-files")){break}}}ai=ai.parentNode}if(!Z){return}var af=null,ak=parseInt(Z.getAttribute("idx")||"0");if(ak>0){for(var ad=0,am;am=t[ad];ad++){if(am.id==ak){af=am;break}}}if(!af||!af.realUrl){return}var ag=C(af.realUrl);var ac=ag.pathname,ae=af.alias;if(ac[0]!="/"){ac="/"+ac}if(ac.indexOf("/"+ae+"/")==0){ac=ac.slice(1);var aj=ac.split("/").pop();if(!confirm("Do you want remove file ("+aj+")?")){return}var X=function(){if(!Z.parentNode){return}Z.parentNode.removeChild(Z);for(var ao=0,ap;ap=t[ao];ao++){if(ap.id==ak){t.splice(ao,1);break}}};if(x){var al=ac.slice(ae.length+1);var ab=al.slice(0,al.length-aj.length-1);var ah=af.sha||"";var aa=function(){$.ajax({type:"DELETE",url:"https://api.github.com/repos/"+B.login+"/"+af.alias+"/contents/"+al+"?access_token="+u,data:JSON.stringify({path:al,message:(new Date()).toLocaleDateString(),sha:ah,branch:"gh-pages"}),success:function(ao){X()},error:function(ao){alert("Remove file failed: "+aj)}})};if(!ah){var an=new Gh3.Dir({path:ab},B,ae,"gh-pages");an.fetchContent(function(aq,ap){var ao=null;if(!aq){ao=an.getFileByName(aj)}if(!ao){alert("Remove file failed: "+aj);return}ah=ao.sha;aa()})}else{aa()}return}}};V.appendChild(U);return V};var L=function(){var U=Q.wd.querySelector("div.res-btm-line");if(!U){return}var T=Q.wd.querySelectorAll("div.res-imgitem");for(var V=0,X;X=T[V];V++){X.parentNode.removeChild(X)}if(!t.length){return}var S=U.parentNode;for(var V=0,Y;Y=t[V];V++){var W=G(Y);S.insertBefore(W,U)}};var P=function(U){var S=Q.wd.querySelector("div.res-btm-line");if(!S){return}var T=G(U);S.parentNode.insertBefore(T,S)};Q.on("loadRes",function(W){var Z=Q.data.currProj;if(!Z){return}var Y=Z.indexOf("/");if(Y<=0){return}var X=Z.slice(0,Y),T=Z.slice(Y+1);if(x){var V=[];var S=function(){t=[];var aa=Q.data.pages[1].canModifyCss=="block"?"res-canrmv":"";_.each(V,function(ab){var ac=ab[0];N+=1;var ad={realUrl:"//"+B.login+".github.io/"+Z+"/"+ac,cls:aa,alias:X,title:ac,id:N,sha:ab[1]};ad.url=ad.realUrl;t.push(ad)});L()};var U=new Gh3.Dir({path:T},B,X,"gh-pages");U.fetchContents(function(ab,aa){if(ab){Q.showMsg("load image resource failed");return}U.eachContent(function(ac){if(ac.type=="file"){var ae=ac.name,ad=ae.split(".").pop();if(J.indexOf("."+ad+".")>=0){V.push([ae,ac.sha])}}});S()});return}});var M=function(an,ab,ac,ah,aa){var T=Q.data.currProj,ae=Q.data.currAllow;if(!T){return false}var X=T.indexOf("/");if(X<=0){return false}var ap=T.slice(0,X),am=T.slice(X+1);var ad="",aj="",Y="bin",ak=false;if(an){var al=an.name.split(".");ab=an.type;aj=al.pop();ad=al.join(".");if(x){ak=true}}else{if(!aa){return false}ad=ac;aj=ah;Y="base64"}if(!ab||!ad||!aj){return false}var Z=ad+"."+aj;var ao=1,W=_.find(t,function(aq){return Z==(aq.realUrl||"").split("/").pop()});while(W){ao+=1;Z=ad+ao+"."+aj;W=_.find(t,function(aq){return Z==(aq.realUrl||"").split("/").pop()})}N+=1;var ag=N;var af={id:ag,url:"uploading.gif",cls:"res-uploading",title:Z,alias:ap};t.push(af);P(af);var V=function(ar,aq,au){if(aq!="warning.jpg"){af.realUrl=aq}af.url=aq;af.cls="";ar.classList.remove("res-uploading");var at=ar.querySelector("img");if(at){if(au){at.setAttribute("_error",au)}else{if(Q.data.pages[1].canModifyCss=="block"){ar.classList.add("res-canrmv")}}at.setAttribute("src",aq)}};if(x){var ai=function(au,aq,at,ar){af.realUrl=aq;af.url=aq;af.cls="";au.classList.remove("res-uploading");var av=au.querySelector("img");if(av){if(Q.data.pages[1].canModifyCss=="block"){au.classList.add("res-canrmv")}av.src=at+ar}};var U=function(at){var ar=at.indexOf(";base64,"),aq="";if(ar>0&&ar<64){aq=at.slice(0,ar+8);at=at.slice(ar+8)}var au=am+"/"+Z;$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+ap+"/contents/"+au+"?access_token="+u,data:JSON.stringify({path:au,message:(new Date()).toLocaleDateString(),content:at,branch:"gh-pages"}),success:function(av){var aw=Q.wd.querySelector('div.res-uploading[idx="'+ag+'"]');if(!aw){return}af.sha=av.content.sha;aw.style.backgroundSize="40px 2px";setTimeout(function(){aw.style.backgroundSize="70px 2px";setTimeout(function(){var ax="//"+B.login+".github.io/"+ap+"/"+au;ai(aw,ax,aq,at)},500)},500)},error:function(av){var aw=Q.wd.querySelector('div.res-uploading[idx="'+ag+'"]');if(!aw){return}aw.style.backgroundSize="70px 2px";V(aw,"warning.jpg","upload failed: "+Z)}})};if(ak){var S=new FileReader();S.onload=function(aq){U(S.result)};S.readAsDataURL(an)}else{if(!aa||Y!="base64"){return false}U(aa)}return true}};var I=function(U){var S;if(window.WEB_IE_BROWSER){S=U.dataTransfer.getData("text")||""}else{S=U.dataTransfer.getData("text/args")||""}if(S.indexOf("project,")==0||S.indexOf("image,")==0){return}U.stopPropagation();U.preventDefault();var T=U.target;if(T&&T.classList.contains("res-dropholder")){if(U.type=="dragover"){T.classList.add("res-draghover")}else{T.classList.remove("res-draghover")}}};var R=function(V){var Y=[],X=0;for(var T=0,W;W=V[T];T++){var S=W.name.split("."),U=S[S.length-1];if(S.length>1&&U&&J.indexOf("."+U+".")>=0){if(M(W)){X+=1;if(X>=64){break}}}else{Y.push(W.name)}}if(Y.length){alert("Only image file can upload, following ignored: "+Y.join(","))}if(X){Q.update()}};var H=function(T,V,U){var S=new Image();S.onload=function(){var X=document.createElement("canvas");var W=X.getContext("2d");X.width=this.width;X.height=this.height;W.drawImage(this,0,0);var Y=X.toDataURL(U);V(Y);X=null};S.crossOrigin="Anonymous";S.src=T};var D=function(V){I(V);var U=V.target.files||V.dataTransfer.files;if(U.length){R(U)}else{var Y="",T="",W="",Z=V.dataTransfer.getData("url")||"";if(Z){Y=Z.split("?")[0].split("/").pop()}if(Y){var S=Y.split(".");if(S.length>=2){W=S.pop();T=S.join(".")}}if(T&&W&&J.indexOf("."+W+".")>=0){var X="image/"+W;H(Z,function(aa){M(null,X,T,W,aa)},X)}}};if(window.File&&window.FileList&&window.FileReader&&window.XMLHttpRequest&&(new XMLHttpRequest()).upload){Q.set("pages[1].canUpload",true);setTimeout(function(){var S=document.getElementById("dragndropimage");if(S){S.addEventListener("dragover",I,false);S.addEventListener("dragleave",I,false);S.addEventListener("drop",D,false)}},0)}Q.on("ssTempDbclick",function(V){var T=V.original.target,U=null;while(T){if(T.nodeName=="DIV"){if(T.classList.contains("res-temp-folder")){U=T;break}else{if(T.classList.contains("res-template")){break}}}T=T.parentNode}if(!U){return}var S=U.getAttribute("_url");if(S){Q.loadTemplate(S,U.querySelector("img.res-temp-loading"))}});Q.on("ssTempRefresh",function(U){var T=U.original.target,S=null;if(T.nodeName=="IMG"){T=T.parentNode}if(T.nodeName=="DIV"&&T.classList.contains("res-temp-refresh")){S=T.querySelector("img.res-temp-loading")}Q.loadTemplate("software/pages/template",S)})},switch2Wide:function(){if(this.data.sWidth=="100%"){return}this.data.showPage="block";this.data.sWidth="100%";this.update();this.fire("rewidth")},switch2Narrow:function(){if(this.data.sWidth!="100%"){return}this.data.showPage="none";this.data.sWidth="1px";this.update();this.fire("rewidth")},pageState:function(){if(this.data.sWidth=="100%"){if(this.data.pages[0].show=="block"){return"syntax"}else{return"files"}}else{return""}},showMsg:function(D){var E=this.wd.querySelector(".res-show-info");if(E){E.innerHTML=a(D);E.style.display="block";setTimeout(function(){E.style.display="none"},5000)}},tryResetAcl:function(F,E){if(this.data.currProj!=F){return}this.data.currAllow=E;var H=this.wd.querySelector(".res-proj-info");if(H){var D=H.getAttribute("title")||"";var I=D.indexOf(":");if(I>0){var G=D.slice(0,I).trim();if(G=="public"||G=="protected"||G=="private"){H.setAttribute(E+D.slice(I))}}}},selectProj:function(K,F){if(this.pageState()!="files"){return}var J="none",E=this.wdMarkdown.r.data.currProj;if(E==K||(E&&K.indexOf(E+"/")==0)){J="block"}if(this.data.currProj==K&&this.data.pages[1].canModifyCss==J){if(!confirm("Do you want reload image resource?")){return}}var I=this.wd.querySelector(".res-proj-info");if(I){var G,H=K.indexOf("/");if(H>0){G=K.slice(H+1)}else{G=K}var D=G.split("/");I.innerHTML="<p> "+a(G)+"</p>";I.setAttribute("title",F+": "+D[D.length-1])}t=[];this.data.pages[1].canModifyCss=J;this.data.currProj=K;this.data.currAllow=F;this.update();this.fire("loadRes")},resetFolder:function(){var D=this.wd.querySelector(".res-proj-info");if(D){D.innerHTML="";D.removeAttribute("title")}t=[];this.data.pages[1].canModifyCss="none";this.data.currProj="";this.update()},editProj:function(E){if(E=="blog"){this.data.pages[0].isTemplate=false;this.update()}else{if(E=="sshow"){this.data.pages[0].isTemplate=true;this.update();var D=this.wd.querySelector("div.res-temp-refresh");if(D){this.loadTemplate("software/pages/template")}}}},loadTemplate:function(E,F){if(!this.data.pages[0].isTemplate){return}if(!E){return}if(E[E.length-1]=="/"){E=E.slice(0,-1)}var K=E.indexOf("/");if(K<=0){return}if(F){F.style.visibility="visible"}var G=function(L){if(L){alert(L)}if(F){F.style.visibility="hidden"}};var D=this,I=E.slice(0,K),J=E.slice(K+1);if(x){var H=new Gh3.Dir({path:J},B,I,"gh-pages");H.fetchContents(function(Q,N){if(Q){G("load template ("+J+") failed: "+Q.message);return}var L=[],R={};H.eachContent(function(U){if(U.type=="dir"){L.push([U.name,U.path])}else{if(U.type=="file"){var W=U.path,V=W.slice(-7);if(V==".png.js"||V==".gif.js"){var X=W.slice(0,-3);var T=R[X]||0;if(T){R[X]=T+2}else{R[X]=2}}else{V=W.slice(-4);if(V==".png"||V==".gif"){var T=R[W]||0;if(T){R[W]=T+1}else{R[W]=1}}}}}});var P=[];_.each(R,function(U,T){if(U==3){P.push(T)}});P.sort();L.sort(function(U,T){U=U[0];T=T[0];if(U>T){return 1}else{if(U===T){return 0}else{return -1}}});var S=[];var O="pages/template";if(J.length>O.length){var M=J.split("/");M.pop();S.push({isDir:true,name:"..",img:"file_up.png",url:I+"/"+M.join("/")})}_.each(L,function(T){S.push({isDir:true,name:T[0],img:"file_folder.png",url:I+"/"+T[1]})});_.each(P,function(U){var T=U.split("/").pop();S.push({isDir:false,name:T,img:"/"+I+"/"+U})});G();if(S.length==0){D.data.pages[0].res=[{isDir:true,name:"",img:"file_refresh.png",url:"software/pages/template"}]}else{D.data.pages[0].res=S}D.update()});return}}};var z={__base__:l.IFrame,__widget__:["wdMarkdown"],init:function(E){this._super(E);var F=this;var G=(F.get("__debug__")||0)&1;if(G){return}window.setPopContent=function(M,L,N,K,H){var I=F.wd.querySelector("div.preview-ss");var J=F.wd.querySelector("div.preview-inst > iframe");if(I&&J&&J.contentWindow.setContent){I.style.display="none";J.parentNode.style.display="block";J.contentWindow.setContent(M,L,N,K,H)}};window.getPopContent=function(I){var H=F.wd.querySelector("div.preview-inst > iframe");if(H&&H.contentWindow.getContent){return H.contentWindow.getContent(I)}};window.hidePopContent=function(){var H=F.wd.querySelector("div.preview-ss");var I=F.wd.querySelector("div.preview-inst > iframe");if(H&&I&&I.contentWindow.hideContent){I.contentWindow.hideContent();H.style.display="block";I.parentNode.style.display="none"}};var D=l.getDCF();D.regist("previewPlugLib",function(H){console.log("here4",F.data.frameReady);if(F.data.frameReady){H.unshift(F.data.pages);H.push(F.wd.clientWidth);D.call("frm-preview","setPlugLib",H)}});D.regist("previewPageHtml",function(H){console.log("here5",F.data.frameReady);if(F.data.frameReady){H.unshift(F.data.pages);D.call("frm-preview","setPageHtml",H)}});D.regist("previewPageModi",function(H){F.wdMarkdown.r.data.changed=true;if(F.data.frameReady){H.unshift(null);D.call("frm-preview","setPageHtml",H)}});D.regist("onSlideLoad",function(H){F.data.pages=H;console.log("here1",H.length,F.data.frameReady);if(H.length&&F.data.frameReady){F.initPreviewPg()}});D.regist("slideDelPage",function(I){var H=I.shift();F.data.pages=I;F.wdMarkdown.r.data.changed=true;if(F.data.frameReady){D.call("frm-preview","setPageHtml",[I,H])}});D.regist("slideAddPage",function(I){var H=I.shift();F.data.pages=I;F.wdMarkdown.r.data.changed=true;if(F.data.frameReady){D.call("frm-preview","setPageHtml",[I,H])}});D.regist("slideChangeOrder",function(I){var H=I.shift();F.data.pages=I;F.wdMarkdown.r.data.changed=true;if(F.data.frameReady){D.call("frm-preview","setPageHtml",[I,H])}});D.regist("nav_shift",function(H){if(F.data.frameReady){D.call("frm-preview","nav_shift",H)}});D.regist("turnSlideTo",function(H){F.wdMarkdown.r.postSlideMsg("turnSlideTo",H)});D.regist("delSlidePage",function(H){F.wdMarkdown.r.postSlideMsg("delSlidePage",H)});D.regist("addSlidePage",function(H){F.wdMarkdown.r.postSlideMsg("addSlidePage",H)});F.on("resized",function(H){var J=F.wd.querySelector("div.preview-ss > iframe");if(J){D.call("frm-preview","setVisibleWidth",[F.wd.clientWidth])}var I=F.wd.querySelector("div.preview-inst > iframe");if(I&&I.contentWindow.setVisibleWidth){I.contentWindow.setVisibleWidth(F.wd.clientWidth)}})},editProj:function(D,K){if(D=="blog"){this.data.frameReady=false;this.data.isTemplate=false;this.update()}else{if(D=="sshow"){this.data.isTemplate=true;this.update();var M=this.wd.querySelector("div.preview-ss");var G=this.wd.querySelector("div.preview-inst");if(M&&G){this.data.frameReady=false;this.data.pages=[];var H=Math.max(window.innerHeight-38-480-10,100);var J=Math.max(window.innerHeight-38-480-8,100);M.style.height=H+"px";G.style.height=J+"px";var L=G.querySelector("iframe");console.log("here2",L);if(!L){L=document.createElement("iframe");L.setAttribute("frameborder","0");L.setAttribute("width",window.innerWidth+"");L.setAttribute("height",J+"");G.appendChild(L);var O=this;L.onload=function(P){if(L.contentWindow.setVisibleWidth){L.contentWindow.setVisibleWidth(O.wd.clientWidth)}}}var I=M.querySelector("iframe");console.log("here3",I);if(!I){I=document.createElement("iframe");I.setAttribute("id","frm-preview");I.setAttribute("frameborder","0");I.setAttribute("width",window.innerWidth+"");I.setAttribute("height",H+"");M.appendChild(I);var O=this;I.onload=function(P){console.log("here4",O.data.pages.length);O.data.frameReady=true;if(O.data.pages.length){O.initPreviewPg()}}}var E=(new Date()).valueOf();var F="/"+K+"/?editing=1&preview=1&_="+E;I.setAttribute("src",F);var N="/"+K+"/?editing=1&inline=1&_="+E;L.setAttribute("src",N)}}}},initPreviewPg:function(){this.wdMarkdown.r.postSlideMsg("notiGetPlugLib",[]);var D=this;setTimeout(function(){for(var E=0,F;F=D.data.pages[E];E++){D.wdMarkdown.r.postSlideMsg("notiGetPageHtml",[F])}},1000)}};var m={__base__:l.IFrame,__widget__:["wdInfoMask","wdToolbar","wdProjList","wdMarkdown","wdResPanel","wdPreviewArea"],init:function(F){this._super(F);var L=this;var D=(L.get("__debug__")||0)&1;if(D){return}L.wd.style.display="none";L.wdInfoMask.style.display="none";L.wdInfoMask.onclick=function(M){if(M.target===L.wdInfoMask&&L.wd.style.display=="block"){if(L.data.finished&&L.tryHideDlg()){M.stopPropagation()}}};var J=null,K=0;var E=l.getDCF();E.regist("onResetLogin",function(M){L.data.login.hasLogin=false});var G=function(P,O){for(var M=0,N;N=P[M];M++){if(O.indexOf(N)>=0){return true}}return false};E.regist("closeForm",function(M){L.data.retData=M;L.data.finished=true;L.wdInfoMask.style.display="none";L.wd.style.display="none"});E.regist("shareProject",function(af){var an=af[0],Y=af[1],ae=af[2];var T=af[3],am=af[4],ai=af[5],N=af[6];var U=af[7]||"",ag=af[8]||"";var R=(x?[]:L.wdProjList.r.data.friendGroup);var W=(an==0?"public":(an==1?"protected":"private"));var ab="";if(W=="private"){if(Y>0&&Y<=R.length){ab=R[Y-1]||""}}var Q=ae.indexOf("/");if(Q<=0){return}var al=ae.slice(0,Q),X=ae.slice(Q+1);var ak=false;var S=L.wdToolbar.querySelector('img[name="SharePrj"]');S.src="loading.gif";setTimeout(function(){if(!ak){ak=true;S.src="prj_share.png"}},20000);var O=function(){if(!ak){ak=true;S.src="prj_share.png"}alert("Share project successful!");L.hideDlg();if(!x){L.wdMarkdown.r.tryResetAcl(ae,W);L.wdResPanel.r.tryResetAcl(ae,W)}L.wdProjList.r.afterSharePrj(al,X,!!N)};var Z=function(ao){if(!ak){ak=true;S.src="prj_share.png"}alert(ao);if(x){L.hideDlg()}};if(x){var ac=X+"/$abstract.txt";if(N.slice(0,2)=="$$"){N="/"+al+"/"+N}var ad=null,ah=j(al);if(!ah){Z("System error: can not find repository");return}ad=_.find(ah.doc_list,function(ao){return ao.path==X});if(!ad){Z("System error: can not find document: "+X);return}var M=(new Date()).toLocaleDateString();var V=c["/"+al+"/config.json"];var P=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+al+"/contents/config.json?access_token="+u,data:JSON.stringify({path:"config.json",message:M,content:Gh3.Base64.encode(JSON.stringify(ah)),sha:V,branch:"gh-pages"}),success:function(ao){c["/"+al+"/config.json"]=ao.content.sha;O()},error:function(ao){c["/"+al+"/config.json"]="";Z("Save config.json failed: "+g(ao,"message"))}})};var aa=function(){var ao=T+"\r\n"+am+"\r\n"+(ai?"<"+ai+">":"")+"\r\n";if(ag){ao+=ag}var ap={path:ac,message:M,content:Gh3.Base64.encode(ao),branch:"gh-pages"};if(U){ap.sha=U}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+al+"/contents/"+ac+"?access_token="+u,data:JSON.stringify(ap),success:function(aq){ad.title=T;ad.desc=am;ad.keyword=ai;ad.thumb=N;ad.modify_at=parseInt((new Date()).valueOf()/1000);ad.flag=(ad.flag&255);P()},error:function(aq){Z("Save $abstract.txt failed: "+g(aq,"message"))}})};if(!V){var aj=new Gh3.File({path:"config.json"},B,al,"gh-pages");aj.fetchContent(function(ap,ao){if(ap){Z("Read config.json failed: "+g(ao,"message"));return}V=aj.sha;c["/"+al+"/config.json"]=V;aa()})}else{aa()}return}});var I=function(P,af,U,Q,R){var O=new Date();var N=O.toLocaleDateString();O=Math.floor(O.valueOf()/1000);var W="",Y=U.split("/");var S=Y.pop();if(Q){Y.pop();W=Y.join("/")}var T=c["/"+af+"/config.json"];var ac=U+"/$index.md";var aa=U+"/index.html";var Z=function(ah){if(typeof R=="function"){R(ah)}};var ab=function(){if(Q){L.wdProjList.r.addSubPrjNode(af,[W,[S,false]]);L.hideDlg();Z()}else{var ai=P.doc_list;var al={path:U,title:S,keyword:"",desc:"",thumb:"",flag:256+3,create_at:O,modify_at:O};for(var ak=0,ah;ah=ai[ak];ak++){if(U<ah.path){ai.splice(ak,0,al);al=null;break}}if(al){ai.push(al)}var am=3,aj=1;L.wdProjList.r.addPrjNode([af,U,O,am,0,aj,"public",0,0]);L.hideDlg();$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+af+"/contents/config.json?access_token="+u,data:JSON.stringify({path:"config.json",message:N,sha:T,content:Gh3.Base64.encode(JSON.stringify(P)),branch:"gh-pages"}),success:function(an){c["/"+af+"/config.json"]=an.content.sha;Z()},error:function(an){c["/"+af+"/config.json"]="";Z("Create project successful, but regist it failed, you can publish it later")}})}};var V=function(al,aj){var ah="";if(aj){var ai=aj.getFileByName("index.html");if(ai){if(!confirm(aa+" already exists, do you want overwrite it?")){ab();return}ah=ai.sha}}var ak={path:aa,message:N,content:Gh3.Base64.encode(al),branch:"gh-pages"};if(ah){ak.sha=ah}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+af+"/contents/"+aa+"?access_token="+u,data:JSON.stringify(ak),success:function(am){ab()},error:function(am){Z("Write ("+aa+") failed: "+g(am,"message"))}})};var ad=function(ak,am,aj){var ah="";if(aj){var ai=aj.getFileByName("$index.md");if(ai){if(!confirm(ac+" already exists, do you want overwrite it?")){V(am,aj);return}ah=ai.sha}}var al={path:ac,message:N,content:Gh3.Base64.encode(ak),branch:"gh-pages"};if(ah){al.sha=ah}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+af+"/contents/"+ac+"?access_token="+u,data:JSON.stringify(al),success:function(an){V(am,aj)},error:function(an){Z("Write ("+ac+") failed: "+g(an,"message"))}})};var X=function(ai,aj){var ah=new Gh3.Dir({path:U},B,af,"gh-pages");ah.fetchContents(function(al,ak){if(al){if(ak.status==404){ad(ai,aj,null);return}Z("List directory ("+U+") failed: "+g(ak,"message"));return}ad(ai,aj,ah)})};var ag=function(ah){$.ajax({type:"GET",url:"//"+B.login+".github.io/software/blogger10/blog.tmpl",dataType:"html",success:function(ai){X(ah,ai)},error:function(ai){Z("Read file failed: /software/blogger10/blog.tmpl")}})};var M=function(){$.ajax({type:"GET",url:"//"+B.login+".github.io/software/blogger10/markdown.md",dataType:"text",success:function(ah){ag(ah)},error:function(ah){Z("Read file failed: /software/blogger10/markdown.md")}})};if(!T){var ae=new Gh3.File({path:"config.json"},B,af,"gh-pages");ae.fetchContent(function(ai,ah){if(ai){Z("Read config.json failed: "+g(ah,"message"));return}T=ae.sha;c["/"+af+"/config.json"]=T;M()})}else{M()}};var H=function(O,ae,T,P,Q){var N=new Date();var M=N.toLocaleDateString();N=Math.floor(N.valueOf()/1000);var V="",Y=T.split("/");var R=Y.pop();if(P){Y.pop();V=Y.join("/")}var S=c["/"+ae+"/config.json"];var W=T+"/$index.txt";var aa=T+"/index.html";var Z=function(ag){if(typeof Q=="function"){Q(ag)}};var ab=function(){if(P){L.wdProjList.r.addSubPrjNode(ae,[V,[R,false]]);L.hideDlg();Z()}else{var ah=O.doc_list;var ak={path:T,title:R,keyword:"",desc:"",thumb:"",flag:256+3,create_at:N,modify_at:N};for(var aj=0,ag;ag=ah[aj];aj++){if(T<ag.path){ah.splice(aj,0,ak);ak=null;break}}if(ak){ah.push(ak)}var al=3,ai=1;L.wdProjList.r.addPrjNode([ae,T,N,al,0,ai,"public",0,0]);L.hideDlg();$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+ae+"/contents/config.json?access_token="+u,data:JSON.stringify({path:"config.json",message:M,sha:S,content:Gh3.Base64.encode(JSON.stringify(O)),branch:"gh-pages"}),success:function(am){c["/"+ae+"/config.json"]=am.content.sha;Z()},error:function(am){c["/"+ae+"/config.json"]="";Z("Create project successful, but regist it failed, you can publish it later")}})}};var U=function(ak,ai){var ag="";if(ai){var ah=ai.getFileByName("index.html");if(ah){if(!confirm(aa+" already exists, do you want overwrite it?")){ab();return}ag=ah.sha}}var aj={path:aa,message:M,content:Gh3.Base64.encode(ak),branch:"gh-pages"};if(ag){aj.sha=ag}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+ae+"/contents/"+aa+"?access_token="+u,data:JSON.stringify(aj),success:function(al){ab()},error:function(al){Z("Write ("+aa+") failed: "+g(al,"message"))}})};var ac=function(al,aj){var ah="";if(aj){var ai=aj.getFileByName("$index.txt");if(ai){if(!confirm(W+" already exists, do you want overwrite it?")){U(al,aj);return}ah=ai.sha}}var ag='COMPONENT_OF_PINP_SLIDE,2,<page/>\nCOMPONENT_OF_PINP_SLIDE,1,<div class="ebook-title" _zindex="1000" _config="default-large-small default-looser-impacted default-hidden" _left="-348" _top="-144" _width="680"><h1>Title Goes Here Up<br>To Two Lines</h1></div>\n<div class="p1-p2-p3-p0" _zindex="1000" _config="default-large-small default-looser-impacted p1-p2-p3-p0" _left="-344" _top="2" _width="500"><p>Your name<br>May 1, 2015</p></div>';var ak={path:W,message:M,content:Gh3.Base64.encode(ag),branch:"gh-pages"};if(ah){ak.sha=ah}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+ae+"/contents/"+W+"?access_token="+u,data:JSON.stringify(ak),success:function(am){U(al,aj)},error:function(am){Z("Write ("+W+") failed: "+g(am,"message"))}})};var X=function(ah){var ag=new Gh3.Dir({path:T},B,ae,"gh-pages");ag.fetchContents(function(aj,ai){if(aj){if(ai.status==404){ac(ah,null);return}Z("List directory ("+T+") failed: "+g(ai,"message"));return}ac(ah,ag)})};var af=function(){$.ajax({type:"GET",url:"//"+B.login+".github.io/software/blogger10/slideshow.tmpl",dataType:"html",success:function(ag){X(ag)},error:function(ag){Z("Read file failed: /software/blogger10/slideshow.tmpl")}})};if(!S){var ad=new Gh3.File({path:"config.json"},B,ae,"gh-pages");ad.fetchContent(function(ah,ag){if(ah){Z("Read config.json failed: "+g(ag,"message"));return}S=ad.sha;c["/"+ae+"/config.json"]=S;af()})}else{af()}};E.regist("createProject",function(Z){var Q=(Z[0]||"").trim();var ab=(Z[1]||"").trim();var W=(Z[2]?1:2);var Y=Z[4]||0;var R=(Z[3]||"").trim();if(!R){alert("Project name can not empty!");return}else{if(G('?*|:"<>\\/',R)){alert('Project name can not contains: ? * | : " < > \\ /');return}}if(W==1&&R.slice(-5)!=".blog"){R+=".blog"}else{if(W==2&&R.slice(-6)!=".sshow"){R+=".sshow"}}if(ab&&ab[ab.length-1]=="/"){ab=ab.slice(0,-1)}if(Q&&Q[Q.length-1]=="/"){Q=Q.slice(0,-1)}var O=Q;if(ab){if(O){O+="/"+ab}else{O=ab}}var T=O.split("/");if(T.length<2){if(x){alert("Invalid 'repository/category' name")}else{alert("Category name lost")}return}var M=null,ad=T.shift();if(x){M=j(ad);if(!M){alert("Invalid repository name: "+ad);return}}else{if(ad!=L.data.login.alias){alert("Invalid alias name");return}}for(var X=T.length-1;X>=0;X--){var aa=T[X];if(!aa){alert("Invalid category name");return}if(G('?*|:"<>\\',aa)){alert('Category name can not contains: ? * | : " < > \\');return}var O=aa.slice(0,2);if(O!="$$"){if(O[0]=="$"){T[X]="$"+aa}else{T[X]="$$"+aa}}}ab=T.join("/");var U=ab+"/"+R;if(x){var S=_.find(M.doc_list,function(ae){return ae.path==U});if(S){alert("Error: project ("+U+") already exists");return}}var ac=false;var P=L.wdToolbar.querySelector('img[name="CreatePrj"]');P.src="loading.gif";setTimeout(function(){if(!ac){ac=true;P.src="prj_add.png"}},20000);var N=function(){if(!ac){ac=true;P.src="prj_add.png"}alert("Add project successful")};var V=function(ae){if(!ac){ac=true;P.src="prj_add.png"}alert(ae)};if(x){if(W==1){I(M,ad,U,false,function(ae){if(ae){V(ae)}else{N()}})}else{H(M,ad,U,false,function(ae){if(ae){V(ae)}else{N()}})}return}});E.regist("createSubProject",function(R){var O=(R[0]||"").trim();var N=(R[1]?1:2);var X=(R[2]||"").trim();if(!X){alert("Project name can not empty!");return}else{if(G('?*|:"<>\\/',X)){alert('Project name can not contains: ? * | : " < > \\ /');return}}if(N==1&&X.slice(-5)!=".blog"){X+=".blog"}else{if(N==2&&X.slice(-6)!=".sshow"){X+=".sshow"}}var Q=O.indexOf("/");if(Q<=0){alert("Invalid project owner name");return}var S=O.slice(0,Q),Z=O.slice(Q+1);var T=null;if(x){T=j(S);if(!T){alert("Invalid repository name: "+S);return}var Y=_.find(T.doc_list,function(aa){return aa.path==Z});if(!Y){alert("Error: project ("+Z+") inexistent");return}}var U=false;var P=L.wdToolbar.querySelector('img[name="CreateSubPrj"]');P.src="loading.gif";setTimeout(function(){if(!U){U=true;P.src="prj_addsub.png"}},20000);var M=function(){if(!U){U=true;P.src="prj_addsub.png"}alert("Add sub-project successful")};var W=function(aa){if(!U){U=true;P.src="prj_addsub.png"}alert(aa)};if(x){if(N==1){var V=Z+"/$$/"+X;I(T,S,V,true,function(aa){if(aa){W(aa)}else{M()}})}else{var V=Z+"/$$/"+X;H(T,S,V,true,function(aa){if(aa){W(aa)}else{M()}})}return}});E.regist("removeProject",function(ae){var aa=ae.shift(),ah=false;var ad=(ae[0]||"").trim(),U=[],Y=ae.length;if(!ad){return}for(var ab=1;ab<Y;ab++){var ag=ae[ab];U.push(ag);if(ab==1&&ag){if(aa){ah=true}break}if(ab>1&&ag==aa){ah=true}}if(U.length==1&&!U[0]){alert("No project selected, nothing removed!");L.hideDlg();return}else{if(!confirm("Do you want remove selected project?")){return}}var Q=ad.indexOf("/");if(Q<=0){return}var ak=ad.slice(0,Q),V=ad.slice(Q+1);var aj=false;var R=L.wdToolbar.querySelector('img[name="RemovePrj"]');R.src="loading.gif";setTimeout(function(){if(!aj){aj=true;R.src="prj_rmv.png"}},20000);var P=function(){if(!aj){aj=true;R.src="prj_rmv.png"}alert("Remove project successful");if(ah){L.wdMarkdown.r.cancelEditing()}};var W=function(al){if(!aj){aj=true;R.src="prj_rmv.png"}alert(al)};if(x){var ac=null,af=j(ak);if(!af){alert("System error: can not find repository");return}ac=_.find(af.doc_list,function(al){return al.path==V});if(!ac){alert("System error: can not find document: "+V);return}var N=new Date();var M=N.toLocaleDateString();N=Math.floor(N.valueOf()/1000);var T=c["/"+ak+"/config.json"];var X=!!U[0],S=[];if(X){S.push(V)}else{for(var ab=1,ag;ag=U[ab];ab++){S.push(V+"/$$/"+ag)}}var Z=null;var O=function(al){Z=null;if(al){W(al);return}L.wdProjList.r.rmvPrjNode(ad,U,[]);L.hideDlg();if(!X){P()}else{var am=af.doc_list.indexOf(ac);if(am<0){P();return}af.doc_list.splice(am,1);$.ajax({type:"PUT",url:"https://api.github.com/repos/"+B.login+"/"+ak+"/contents/config.json?access_token="+u,data:JSON.stringify({path:"config.json",message:M,content:Gh3.Base64.encode(JSON.stringify(af)),sha:T,branch:"gh-pages"}),success:function(an){c["/"+ak+"/config.json"]=an.content.sha;P()},error:function(an){c["/"+ak+"/config.json"]="";W("Save config.json failed: "+g(an,"message"))}})}};Z=function(){var al=false,ap=0,at=0,ar=0,av=0;var an=false;var ao=function(){if(an){return}an=true;if(al||av){O("Delete project failed (some files not removed), please try again!")}else{O("")}};var aq=function(aw,ax){$.ajax({type:"DELETE",url:"https://api.github.com/repos/"+B.login+"/"+ak+"/contents/"+aw+"?access_token="+u,data:JSON.stringify({path:aw,message:M,sha:ax,branch:"gh-pages"}),success:function(ay){ar+=1;if(ar+av>=ap){ao()}},error:function(ay){av+=1;if(ar+av>=ap){ao()}}})};var am=function(aw,ax){at+=1;aw.fetchContents(function(aB,az){if(aB){if(az.status!=404){al=true}ax();return}var ay=[],aC=[],aD=0;aw.eachContent(function(aE){if(aE.type=="file"){aD+=1;ay.push([aE.path,aE.sha])}else{if(aE.type=="dir"){aD+=1;aC.push(aE)}}});if(aD){ap+=ay.length;var aA=function(){var aE=aC.pop();if(aE){am(aE,aA)}else{aE=ay.pop();if(aE){setTimeout(function(){aq(aE[0],aE[1]);aA()},500)}else{ax()}}};aA()}else{ax()}})};var au=function(){var aw=S.shift();if(aw){am(new Gh3.Dir({path:aw},B,ak,"gh-pages"),au)}else{if(ap==0){ao()}}};au()};if(!T){var ai=new Gh3.File({path:"config.json"},B,ak,"gh-pages");ai.fetchContent(function(am,al){if(am){W("Read config.json failed: "+g(al,"message"));return}T=ai.sha;c["/"+ak+"/config.json"]=T;Z()})}else{Z()}return}});E.regist("editPrepost",function(M){L.editPrepost(M[0],M[1],M[2])});E.regist("savePrepost",function(M){L.wdMarkdown.r.postSlideMsg("savePrepost",M);L.hideDlg()});E.regist("editSlideTxt",function(M){if(!L.data.finished){alert("System error: previous task not finished yet!");L.hideDlg();return}L.editSlideTxt(M[0],M[1])});E.regist("saveSlideTxt",function(M){L.wdMarkdown.r.postSlideMsg("saveSlideTxt",M);L.hideDlg()});E.regist("editTableData",function(M){L.editTableData(M[0],M[1],M[2],M[3],M[4],M[5])});E.regist("saveTableData",function(M){L.wdMarkdown.r.postSlideMsg("saveTableData",M);L.hideDlg()});E.regist("editShapeData",function(M){L.editShapeData(M[0],M[1],M[2],M[3],M[4],M[5])});E.regist("saveShapeData",function(M){L.wdMarkdown.r.postSlideMsg("saveShapeData",M);L.hideDlg()});E.regist("editPaperData",function(M){L.editPaperData(M[0],[M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8]])});window.updatePaperContent=function(M,O,N){L.wdResPanel.style.height="100%";L.wdPreviewArea.style.display="block";L.hideDlg();if(M){L.wdMarkdown.r.postSlideMsg("savePaperData",[O,N])}};window.copyToClipboard_=function(N,M,P){var O=L.wdMarkdown.querySelector("iframe");if(O&&O.contentWindow.apiNode){O.contentWindow.apiNode.copyToClipboard(N,M,P)}};window.textOfClipboard_=function(){var M=L.wdMarkdown.querySelector("iframe");if(M&&M.contentWindow.apiNode){return M.contentWindow.apiNode.textOfClipboard()}else{return""}};L.on("afterLogin",function(M){L.wdProjList.r.fire("refresh");setTimeout(function(){L.hideDlg();if(L.data.taskAtLogin){if(L.data.taskAtLogin=="submit"&&L.wdMarkdown.r.data.currProj){L.wdMarkdown.r.startSubmitDoc()}L.data.taskAtLogin=""}},1500)})},showDlg:function(F){var I=function(P,O){if(P<1){if(P<0){return 0}else{if(P<0.9999){return Math.floor(P*O+0.5)}else{return O}}}else{return Math.floor(P+0.5)}};var E=F.url;if(!E&&(F.bodyHtml||F.jsScript)){E="/software/pages/simple_dialog.html"}if(!E){return}var K=I(F.left||0,window.innerWidth);var J=I(F.top||0,window.innerHeight);var L=I(F.width||0.9999,window.innerWidth);var H=I(F.height||0.9999,window.innerHeight);var G=this.wdToolbar.parentNode.clientHeight+Math.max(this.wdProjList.clientHeight,this.wdMarkdown.parentNode.clientHeight+this.wdPreviewArea.clientHeight);this.wdInfoMask.style.width=window.innerWidth+"px";this.wdInfoMask.style.height=Math.max(window.innerHeight,G)+"px";this.wdInfoMask.style.display="block";this.wd.style.left=K+"px";this.wd.style.top=J+"px";this.wd.style.width=L+"px";this.wd.style.height=H+"px";this.wd.style.display="block";var D=this.wd.querySelector("div.dlg-loading");D.style.display="block";var N=this,M=this.wd.querySelector("iframe");M.onload=function(P){D.style.display="none";if(F.closable){N.data.finished=true}var O=function(){l.getDCF().call("wdPopDlgForm","initGui",[F.bodyHtml||"",F.jsScript||""],3000,function(Q){if(F.onReady){F.onReady()}},function(Q){alert("System error")})};if(F.peerName||F.bodyHtml||F.jsScript){if(F.peerName){l.getDCF().setPeerName("wdPopDlgForm",F.peerName,3000,function(Q){if(Q.state=="OK"){if(F.bodyHtml||F.jsScript){O()}else{if(F.onReady){F.onReady()}}}else{alert("System error")}})}else{if(F.bodyHtml||F.jsScript){O()}else{if(F.onReady){F.onReady()}}}}else{if(F.onReady){F.onReady()}}};this.data.finished=false;this.refreshUrl(E)},hideDlg:function(){this.wdInfoMask.style.display="none";this.wd.style.display="none"},tryHideDlg:function(){if(this.data.finished){this.wdInfoMask.style.display="none";this.wd.style.display="none";return true}return false},checkLogin:function(E,D){if(!E&&this.data.login.hasLogin&&this.data.login.failCount==0){return}if(D){this.data.taskAtLogin=D}this.showDlg({left:Math.floor(window.innerWidth/2-310),top:Math.floor(window.innerHeight/2-180),width:620,height:360,url:"//"+PINP_HOST_DOMAIN+"/admin/writer/relay?check=1",closable:false})},startShareDoc:function(){var I="",F=true,G=this.wdProjList.querySelector(".prj-item.prj-selected2");if(G&&(G.classList.contains("prj-sub-item")||G.classList.contains("prj-curr-item"))){I=G.getAttribute("title");var K=G.getAttribute("name");if(K&&K.indexOf("prj-")==0){var M=this.wdProjList.r.data.items[parseInt(K.slice(4))];if(M){F=M.canWrite}}}if(!I){alert("Please select a project first!");return false}if(!F){alert("Can not share this project: not online document");return false}if(I==this.wdMarkdown.r.data.currProj&&this.wdMarkdown.r.data.changed){if(!confirm("The project still in editing, do you want continue?")){return false}}var J=I.indexOf("/");if(J<=0){return}var L=I.slice(0,J),O=I.slice(J+1);var D=G.getAttribute("allow")||"private";var N=x?[]:this.wdProjList.r.data.friendGroup;var P=this;var H=function(Y,Z,V,Q,W,S){var U='var gitSha = "'+(W||"")+"\";\nvar gitCfgLine = '"+S.replace(/'/gm,"\\'")+"';\nvar initAclIndex = "+(D=="public"?"0":(D=="protected"?"1":"2"))+';\nvar inputTitle = "'+Y+'";\nvar inputDesc = "'+Z+'";\nvar inputKeyword = "'+V+'";\nfunction location__(href) {\n  var location = document.createElement("a");\n  location.href = href;\n  if (location.host == "")\n    location.href = location.href;\n  return location;\n}\nfunction applySharePrj() {\n  var sPath = "'+I+'";\n  var frm = document.querySelector("form");\n  var iAcl=0, iGroup=0;\n  if (frm.prjAcl) {\n    iAcl = frm.prjAcl[0].checked?0:(frm.prjAcl[1].checked?1:2);\n    var iGroup = 0; for (var i=0,item; item=frm.aclGroup[i]; i++) {\n      if (item.checked) {iGroup = i; break;}\n    }\n  }\n  var sTitle = frm.prjTitle.value.trim().slice(0,160);\n  var sDesc = frm.prjDesc.value.trim().slice(0,256);\n  var sKeyword = frm.prjKeyword.value.trim().slice(0,160);\n  sTitle = sTitle.replace(/"/gm,""); sDesc = sDesc.replace(/"/gm,""); sKeyword = sKeyword.replace(/"/gm,"");\n  var sThumb = frm.prjThumb.value.trim();\n  if (sThumb && frm.prjAcl) sThumb = location__(sThumb).href;\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","shareProject",[iAcl,iGroup,sPath,sTitle,sDesc,sKeyword,sThumb,gitSha,gitCfgLine]);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}\nfunction checkAcl() {\n  document.getElementById("btn-apy").disabled = false;\n  var frm = document.querySelector("form");\n  var isReadonly = !frm.prjAcl[2].checked;\n  document.getElementById("acl-group").style.color = isReadonly?"#ccc":"black";\n  for (var i=0,item; item=frm.aclGroup[i]; i++) {\n    item.disabled = isReadonly;\n  }\n}\nfunction initInputData(i) {\n  var frm = document.querySelector("form");\n  frm.prjTitle.value = inputTitle;\n  frm.prjDesc.value = inputDesc;\n  frm.prjKeyword.value = inputKeyword;\n  if (frm.prjAcl) {\n    frm.prjAcl[i].setAttribute("checked","checked");\n    checkAcl();\n  }\n}\ninitInputData(initAclIndex);';var X='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Share project</div><div style="width:100; height:28px"></div>\n';X+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(I)+"</p>\n<form>\n";if(!x){X+='<p>Project type<br><input type="radio" name="prjAcl" onclick="checkAcl()" checked>public&nbsp;&nbsp;&nbsp;<input type="radio" name="prjAcl" onclick="checkAcl()">protected&nbsp;&nbsp;&nbsp;<input type="radio" name="prjAcl" onclick="checkAcl()">private</p>\n';X+='<div id="acl-group">&nbsp;&nbsp;&nbsp;<input type="radio" name="aclGroup" onclick="cfgModified(event)" checked>Only for myself\n';for(var T=0,aa;aa=N[T];T++){X+='<br>&nbsp;&nbsp;&nbsp;<input type="radio" name="aclGroup" onclick="cfgModified(event)">'+a(aa)+"\n"}X+="</div>\n"}X+='<p>Document title<br><input name="prjTitle" type="text" style="width:340px" onchange="cfgModified(event)"><br>\n';X+='Description <span style="font-size:14px; color:gray">(within 140 characters)</span><br><textarea name="prjDesc" style="width:340px; height:70px" onchange="cfgModified(event)"></textarea><br>\n';X+='Document Keyword<br><input name="prjKeyword" type="text" placeholder="keyword1,keyword2,..." style="width:340px" onchange="cfgModified(event)"><br>';X+='Thumbnail picture <span style="font-size:14px; color:gray">(input image URL)</span><br><input name="prjThumb" type="text" style="width:340px" value="'+Q+'" onchange="cfgModified(event)"></p>\n';X+='</form>\n<p><button id="btn-apy" onclick="applySharePrj()">Apply</button></p>';var R=N.length<=4?540:(N.length<=8?580:620);if(x){R-=80}P.showDlg({left:Math.floor((window.innerWidth-400)/2),top:Math.floor((window.innerHeight-R)/2),width:400,height:R,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:X,jsScript:U})};if(x){var E=new Gh3.File({path:O+"/$abstract.txt"},B,L,"gh-pages");E.fetchContent(function(R,X){var Z="",aa="",V="",W="",Q="",S="";var U=j(L);var ab=_.find(U.doc_list,function(ac){return ac.path==O});if(ab){Q=ab.thumb||""}if(Q.slice(0,2)=="$$"){Q="/"+L+"/"+Q}if(!R){W=E.sha;var T=E.getRawContent(),Y=T.split("\n");Z=(Y[0]||"").trim().replace(/"/gm,"");aa=(Y[1]||"").trim().replace(/"/gm,"");V=(Y[2]||"").trim().replace(/"/gm,"");S=(Y[3]||"").trim();if(V&&V[0]=="<"&&V[V.length-1]==">"){V=V.slice(1,-1)}}H(Z,aa,V,Q,W,S)});return}},createPrj:function(){var G="",F=this.wdProjList.querySelector(".prj-item.prj-selected2");if(F&&(F.classList.contains("prj-sub-item")||F.classList.contains("prj-curr-item"))){G=F.getAttribute("title")||""}else{F=this.wdProjList.querySelector(".prj-item.prj-selected");if(F&&F.classList.contains("prj-cate-folder")){G=F.getAttribute("title")||""}else{if(x){G=""}else{G=this.data.login.alias+"/"+this.wdProjList.r.data.currCate}}}if(!x&&!G){return false}var K=G.split("/");if(K.length>1){K.pop()}var D=false,I=true;if(x){if(!G){D=true}else{if(K.length>=2){I=false}}}else{if(K.length>=2){I=false}}var J=K.join("/");var H='function applyCreatePrj() {\n  var sOwner = "'+J+'";\n  var frm = document.querySelector("form");\n  var sCate = frm.prjPath.value.trim();\n  var iFlag = 0; if (frm.prjShare) iFlag = frm.prjShare[0].checked?0:(frm.prjShare[1].checked?1:2);\n  var bArgs = [sOwner,sCate,frm.prjType[0].checked,frm.prjName.value,iFlag];\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","createProject",bArgs);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var L='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Create project</div><div style="width:100; height:28px"></div>\n';if(J){L+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(J+"/")+"</p>\n"}L+='<form><p>Project type<br><input type="radio" name="prjType" onclick="cfgModified(event)" checked>blog&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="prjType" onclick="cfgModified(event)">slideshow</p>\n';if(!x){L+='<p>Sharing<br><input type="radio" name="prjShare" onclick="cfgModified(event)"><span title="for all visitor">public</span>&nbsp;&nbsp;<input type="radio" name="prjShare" onclick="cfgModified(event)"><span title="for all logined visitor">protected</span>&nbsp;&nbsp;<input type="radio" name="prjShare" onclick="cfgModified(event)" checked><span title="only for yourself">private</span></p>\n'}L+='<p>Category <span style="font-size:14px; color:gray">(';if(D){L+="repository/category"}else{if(I){L+="category"}else{L+="category or leave it empty"}}L+=')</span><br><input name="prjPath" type="text" style="width:340px" value="" onchange="cfgModified(event)"></p>\n';L+='<p>Project name<br><input type="text" name="prjName" style="width:340px" value="" onchanged="cfgModified(event)"></p></form>\n';L+='<p><button id="btn-apy" onclick="applyCreatePrj()">Apply</button></p>';var E=380;if(x){E-=36}this.showDlg({left:Math.floor((window.innerWidth-420)/2),top:Math.floor((window.innerHeight-E)/2),width:420,height:E,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:L,jsScript:H});return true},createSubPrj:function(){var D="",E=this.wdProjList.querySelector(".prj-item.prj-selected2");if(E&&(E.classList.contains("prj-sub-item")||E.classList.contains("prj-curr-item"))){D=E.getAttribute("title")}if(!D){alert("Please select a project first!");return false}var G='function applyCreatePrj() {\n  var frm = document.querySelector("form");\n  var bArgs = ["'+D+'",frm.prjType[0].checked,frm.prjName.value];\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","createSubProject",bArgs);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var F='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Create sub-project</div><div style="width:100; height:28px"></div>\n';F+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(D)+"</p>\n";F+='<form><p>Project type<br><input type="radio" name="prjType" onclick="cfgModified(event)" checked>blog&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="prjType" onclick="cfgModified(event)">slideshow</p>\n';F+='<p>Project name<br><input type="text" name="prjName" style="width:340px" value="" onchange="cfgModified(event)"></p></form>\n';F+='<p><button id="btn-apy" onclick="applyCreatePrj()">Apply</button></p>';this.showDlg({left:Math.floor((window.innerWidth-420)/2),top:Math.floor((window.innerHeight-290)/2),width:420,height:290,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:F,jsScript:G});return true},removePrj:function(){var G="",K=[],F=this.wdProjList.querySelector(".prj-item.prj-selected2");if(F&&(F.classList.contains("prj-sub-item")||F.classList.contains("prj-curr-item"))){G=F.getAttribute("title");if(G){var H=F.nextElementSibling;while(H&&H.classList.contains("prj-sub2-item")){var O=H.getAttribute("title");if(O&&O.indexOf(G)==0){var L=O.split("/");K.push(L[L.length-1])}H=H.nextElementSibling}}}if(!G){return false}var D=this.wdMarkdown.r.prjInEditing(G);if(D){var P=D=="*"?"Selected project current in editing,":"One of sub-project in editing,";if(!confirm(P+" continue to remove?")){return false}}var J='var editingFlag = "'+D+'";\nfunction applyRemovePrj() {\n  var bArgs=[editingFlag], nodes=document.querySelectorAll("input[_name]");\n  for (var i=0,node; node=nodes[i]; i++) {\n    var sName = node.getAttribute("_name");\n    if (i == 0) {\n      bArgs.push(sName);\n      if (node.checked) { bArgs.push("*"); break; }\n      else bArgs.push("");\n    } else {\n      if (node.checked) bArgs.push(sName);\n    }\n  }\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","removeProject",bArgs);\n}\nfunction rootChanged(event,rootNode) {\n  var bRet=[], nodes = document.querySelectorAll("input[_sub]");\n  for (var i=0,item; item=nodes[i]; i++) {\n    if (rootNode.checked && !item.checked) item.checked = true;\n    item.disabled = rootNode.checked? true: false;\n  }\n  document.getElementById("btn-apy").disabled = false;\n}\nfunction subChanged(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var M='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Remove project</div><div style="width:100; height:28px"></div>\n';M+='<p style="font-size:14px; word-break:break-all; color:gray">Project: '+a(G)+"</p>\n";M+='<p><input _name="'+G+'" type="checkbox" onclick="rootChanged(event,this)">Whole project<br>\n';for(var I=0,N;N=K[I];I++){M+='&nbsp;&nbsp;<input _sub="true" _name="'+N+'" type="checkbox" onclick="subChanged(event)">'+a(N)+"<br>\n"}M+="</p>";M+='<p><button id="btn-apy" onclick="applyRemovePrj()">Apply</button></p>';var E=(K.length>=10?400:(K.length>=2?320:250));this.showDlg({left:Math.floor((window.innerWidth-400)/2),top:Math.floor((window.innerHeight-E)/2),width:400,height:E,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:M,jsScript:J});return true},addDropPrjFrame:function(E,N,G){var J=G.split("/"),L=J[J.length-1];var F,I=this.wdMarkdown.r.data.currProj;if(I&&G.indexOf(I+"/")==0){F=G.slice(I.length+1)+"/"}else{if(x){F=B.login+".github.io"}else{F=PINP_HOST_DOMAIN}F=location.protocol+"//"+F+"/"+G+"/"}var H='var sPrjUrl = "'+F+'";\nvar sBareName = "'+L+'";\nvar sThumb = "'+E+'";\nvar sPrjFlag = "'+N+'";\nfunction lnkTypeChanged() {\n  var frm = document.querySelector("form");\n  var nd = document.getElementById("prj-wdhi");\n  var nodes = nd.querySelectorAll("input");\n  if (!frm.lnkType[0].checked) {\n    nd.style.color = "#222";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.removeAttribute("readonly");\n      item.style.backgroundColor = "#fff";\n    }\n  } else {\n    nd.style.color = "#ccc";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.setAttribute("readonly","readonly");\n      item.style.backgroundColor = "#ccc";\n    }\n  }\n}\nfunction applyInsertLnk(event) {\n  event.preventDefault(); event.stopPropagation();\n  var sOut="", frm=document.querySelector("form");\n  if (frm.lnkType[0].checked) {\n    if (sThumb)\n      sOut = \'<a target="_blank" href="\' + sPrjUrl + \'">\' + \'<img alt="\' + sBareName + \'" src="\' + sThumb + \'"></a>\';\n    else sOut = "[" + sBareName + "](" + sPrjUrl + ")";\n  } else {\n    var sWd = document.getElementById("input-wd").value.trim().replace(/px/gi,"") || "100%";\n    var sHi = document.getElementById("input-hi").value.trim().replace(/px/gi,"") || "300";\n    var pgNode = document.getElementById("input-pg");\n    var sPage = (pgNode? pgNode.value.trim(): "");\n    if (pgNode) sPrjUrl += "?size=0x0";\n    if (sPage) sPrjUrl += "#" + sPage;\n    sOut = \'<iframe frameborder="0" width="\' + sWd + \'" height="\' + sHi + \'" src="\' + sPrjUrl + \'"></iframe>\';\n  }\n  DCF.call("parent","dropTextInfo",[sOut]);\n}\n';var D=false;var K='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Insert project linker</div><div style="width:100; height:28px"></div>\n';K+='<p style="font-size:14px; word-break:break-all; color:gray">Project: '+a(G)+"</p>\n";K+='<form><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()" checked>insert a linker</p><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()">embed a frame</p>\n';K+='<div id="prj-wdhi" style="color:#ccc; margin-left:20px; margin-top:-8px">Width <span style="font-size:14px; color:gray">(percent or pixes)</span><br><input id="input-wd" type="text" style="background-color:#ccc; width:220px" value="100%" readonly>\n';K+='<br>Height <span style="font-size:14px; color:gray">(percent or pixes)</span><br><input id="input-hi" type="text" style="background-color:#ccc; width:220px" value="300" readonly>\n';if(N=="1"||N=="2"||G.slice(G.length-6)==".sshow"){D=true;K+='<br>Show page <span style="font-size:14px; color:gray">(page number)</span><br><input id="input-pg" type="text" style="background-color:#ccc; width:220px" value="1" readonly>\n'}K+='</div></form><p>&nbsp;<button onclick="applyInsertLnk(event)">Apply</button></p>\n';var M=(D?356:310);this.showDlg({left:Math.floor((window.innerWidth-340)/2),top:Math.floor((window.innerHeight-M)/2),width:340,height:M,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:K,jsScript:H})},addDropImgFrame:function(F,E,G){var D=G.split("/"),J=D[D.length-1];var I='var sImgUrl = "'+G+'";\nvar sImgBare = "'+J+'";\nvar sNatureWd = "'+F+'";\nvar sNatureHi = "'+E+'";\nfunction lnkTypeChanged() {\n  var frm = document.querySelector("form");\n  var nd = document.getElementById("img-wdhi");\n  var nodes = nd.querySelectorAll("input");\n  if (!frm.lnkType[0].checked) {\n    nd.style.color = "#222";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.removeAttribute("readonly");\n      item.style.backgroundColor = "#fff";\n    }\n  } else {\n    nd.style.color = "#ccc";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.setAttribute("readonly","readonly");\n      item.style.backgroundColor = "#ccc";\n    }\n  }\n}\nfunction applyInsertLnk(event) {\n  event.preventDefault(); event.stopPropagation();\n  var sOut="", frm=document.querySelector("form");\n  if (frm.lnkType[0].checked) {\n    sOut = \'<a target="_blank" href="\' + sImgUrl + \'">\' + sImgBare + \'</a>\';\n  } else {\n    var sWd = document.getElementById("input-wd").value.trim().replace(/px/gi,"");\n    var sHi = document.getElementById("input-hi").value.trim().replace(/px/gi,"");\n    if (!sWd || sWd == sNatureWd) {\n      if (!sHi || sHi == sNatureHi)\n        sOut = "![" + sImgBare + "](" + sImgUrl + ")";\n      else {\n        sHi += (sHi.indexOf("%") > 0? "": "px");\n        sOut = \'<img style="width:\' + sNatureWd + \'px; height:\' + sHi + \'" src="\' + sImgUrl + \'">\';\n      }\n    } else {\n      sWd += (sWd.indexOf("%") > 0? "": "px");\n      if (!sHi)\n        sOut = \'<img style="width:\' + sWd + \'" src="\' + sImgUrl + \'">\';\n      else {\n        sHi += (sHi.indexOf("%") > 0? "": "px");\n        sOut = \'<img style="width:\' + sWd + \'; height:\' + sHi + \'" src="\' + sImgUrl + \'">\';\n      }\n    }\n  }\n  DCF.call("parent","dropTextInfo",[sOut]);\n}\n';var H='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Insert image</div><div style="width:100; height:28px"></div>\n';H+='<p style="font-size:14px; word-break:break-all; color:gray">File: '+a(J)+"</p>\n";H+='<form><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()">insert a linker</p><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()" checked>embed an image</p>\n';H+='<div id="img-wdhi" style="color:#222; margin-left:20px; margin-top:-8px">Width <span style="font-size:14px; color:gray">(percent, pixes or leave it blank)</span><br><input id="input-wd" type="text" style="background-color:#fff; width:270px" value="'+F+'"><br>\n';H+='Height <span style="font-size:14px; color:gray">(percent, pixes or leave it blank)</span><br><input id="input-hi" type="text" style="background-color:#fff; width:270px" value="'+E+'"></div>\n';H+='</form><p>&nbsp;<button onclick="applyInsertLnk(event)">Apply</button></p>\n';this.showDlg({left:Math.floor((window.innerWidth-360)/2),top:Math.floor((window.innerHeight-320)/2),width:360,height:320,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:H,jsScript:I})},editPrepost:function(G,F,E){var D=Math.floor(window.innerHeight*0.99);this.showDlg({left:Math.floor((window.innerWidth-700)/2),top:Math.floor((window.innerHeight-D)/2),width:700,height:D,url:"prepost_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){l.getDCF().call("wdPopDlgForm","initPrePost",[G,F,E])}})},editSlideTxt:function(H,E){var F=Math.floor(window.innerWidth*0.8);var D=Math.floor(window.innerHeight*0.8);var I="var iEditNodeId = "+H+';\nfunction finishEditing() {\n  var txtNode = document.querySelector("textarea");\n  var bArgs = [iEditNodeId,txtNode.value];\n  DCF.call("parent","saveSlideTxt",bArgs);\n}\ndocument.querySelector("textarea").value = '+JSON.stringify(E)+";";var G='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Plain text editor</div><div style="width:100; height:28px"></div>\n';G+='<textarea style="width:'+(F-24)+"px; height:"+(D-110)+'px; resize:none"></textarea>\n';G+='<p><button onclick="finishEditing()">Apply</button></p>';this.showDlg({left:Math.floor((window.innerWidth-F)/2),top:Math.floor((window.innerHeight-D)/2),width:F,height:D,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:G,jsScript:I})},editTableData:function(K,D,J,G,I,F){var H=Math.floor(window.innerWidth*0.9);var E=Math.floor(window.innerHeight*0.9);this.showDlg({left:Math.floor((window.innerWidth-H)/2),top:Math.floor((window.innerHeight-E)/2),width:H,height:E,url:"table_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){l.getDCF().call("wdPopDlgForm","initTableData",[K,D,J,G,I,F])}})},editShapeData:function(K,F,H,D,I,J){var G=Math.floor(window.innerWidth*0.8);var E=Math.floor(window.innerHeight*0.9);this.showDlg({left:Math.floor((window.innerWidth-G)/2),top:Math.floor((window.innerHeight-E)/2),width:G,height:E,url:"pinp_shape_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){l.getDCF().call("wdPopDlgForm","initMask",[K,F,H,D,I,J])}})},setPopupRightWd:function(D){if(this.wdInfoMask.style.display!="none"){var E=(window.innerWidth-D)+"px";this.wdInfoMask.style.width=E;this.wd.style.width=E}},editPaperData:function(I,H){var J=this.wdMarkdown.r.data.currProj;if(!J){return}var E="/"+J+"/";var G=window.innerWidth-300;var F=window.innerHeight;var D=this;this.showDlg({left:0,top:0,width:G,height:F,url:E+"?editing=1&paper=1",closable:false,peerName:"",bodyHtml:"",jsScript:"",onReady:function(){var K=D.wd.querySelector("iframe");if(K){K.contentWindow.setEditingNode(I,E);K.contentWindow.initPaper(H);D.wdPreviewArea.style.display="none";D.wdResPanel.style.height=(window.innerHeight-D.wdToolbar.clientHeight-8)+"px";D.setPopupRightWd(300)}}})}};return{Toolbar:d,ProjList:y,SplitterA:p,Markdown:w,ResPanel:n,PreviewArea:z,PopDlgForm:m}});