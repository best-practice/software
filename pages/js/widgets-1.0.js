var PINP_HOST_DOMAIN="www.pinp.me";require.config({paths:{basic10:"/software/pages/js/basic10"}});define(["basic10"],function(m){function k(G){if(document.cookie.length>0){var F,E=document.cookie.indexOf(G+"=");if(E!=-1){E=E+G.length+1;F=document.cookie.indexOf(";",E);if(F==-1){F=document.cookie.length}return unescape(document.cookie.substring(E,F))}}return""}function s(E,G,I,H){I=I||1;var F=new Date();F.setTime(F.getTime()+I*24*60*60*1000);H=H||"/";document.cookie=E+"="+escape(G)+";expires="+F.toGMTString()+";path="+H+";"}function B(F,G){if(document.cookie.length>0){var E=document.cookie.indexOf(F+"=");if(E!=-1){var H=new Date();H.setTime(H.getTime()-1);G=G||"/";document.cookie=F+"=;expires="+H.toGMTString()+";path="+G+";"}}}function r(G){if(G){G=G.slice(1)}var K={},E=G.split("&");for(var I=E.length-1;I>=0;I--){var J=E[I],F=J.split("="),H=(F[0]||"").trim();if(H){K[H]=F[1]||""}}return K}function p(F,G,H){var E=null;if(window.XMLHttpRequest){E=new XMLHttpRequest()}else{if(window.ActiveXObject){E=new ActiveXObject("Microsoft.XMLHTTP")}}if(E!=null){E.onreadystatechange=function(){if(E.readyState==4){var I=E.responseText;if(E.status==200){E=null;if(G){G(I)}}else{E=null;if(H){H.push(I);if(G){G("")}}}}};E.open("GET",F,true);E.send(null)}}function a(E){return E.replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function D(F){var E=document.createElement("a");E.href=F;if(E.host==""){E.href=E.href}return E}var d={__base__:m.BaseWidget,__widget__:["wdProjList","wdPopDlgForm","wdMarkdown","wdResPanel"],init:function(E){this._super(E);var G=this;var K=(G.get("__debug__")||0)&1;if(K){return}var F=G.wd.querySelectorAll(".head-toolbar > img");for(var H=0,J;J=F[H];H++){if(J.name=="refresh"){J.onclick=function(L){if(y){G.wdProjList.r.gotoHome()}else{G.wdProjList.r.fire("refresh")}}}else{if(J.name=="CreatePrj"){J.onclick=function(L){G.wdPopDlgForm.r.createPrj()}}else{if(J.name=="RemovePrj"){J.onclick=function(L){G.wdPopDlgForm.r.removePrj()}}else{if(J.name=="CreateSubPrj"){J.onclick=function(L){G.wdPopDlgForm.r.createSubPrj()}}else{if(J.name=="EditPrj"){J.onclick=function(M){var L=G.wdProjList.r.getCurrProj();if(L){G.wdMarkdown.r.startEditDoc(L)}else{alert("Please select a project node first")}}}else{if(J.name=="SharePrj"){J.onclick=function(L){G.wdPopDlgForm.r.startShareDoc()}}else{if(J.name=="SubmitPrj"){J.onclick=function(L){G.wdMarkdown.r.startSubmitDoc()}}else{if(J.name=="TransPrj"){J.onclick=function(L){G.wdMarkdown.r.startTransDoc()}}else{if(J.name=="PageGrid"){J.onclick=function(L){G.wdMarkdown.r.showPageGrid()}}}}}}}}}}}var I=G.wd.querySelector("img.head-nohover");I.classList.add("head-rotate");G.on("ssHeadbarClick",function(M){var L=M.original.target;if(L&&L.nodeName=="DIV"&&L.classList.contains("head-toolbar")){G.wdMarkdown.r.tryUnselectSS()}});G.on("ssResToolClick",function(M){var L=M.original.target;if(!L){return}var N=L.getAttribute("name");if(N=="collapse"){if(L.classList.contains("head-rotate")){L.classList.remove("head-rotate");G.wdResPanel.r.switch2Narrow();G.wdPopDlgForm.r.setPopupRightWd(28)}else{L.classList.add("head-rotate");G.wdResPanel.r.switch2Wide();G.wdPopDlgForm.r.setPopupRightWd(300)}}else{if(!I.classList.contains("head-rotate")){I.classList.add("head-rotate");G.wdResPanel.r.switch2Wide()}if(N=="syntax"){G.wdResPanel.r.fire("showSyntax")}else{if(N=="files"){G.wdResPanel.r.fire("showFolder")}}}})},selectProj:function(J,E){var I="/"+J+"/";if(I==this.data.infoUrl){return}this.data.infoUrl=I;var G=E+': <a target="_blank" href="'+I+"?_="+(new Date()).valueOf()+'">'+J+"</a>";var H=this.data.infoId+1;this.data.infoId=H;this.data.infoTitle=G;this.update();var F=this;setTimeout(function(){if(H==F.data.infoId){F.data.infoTitle=F.data.editingTitle;F.update()}},8000)},editProj:function(H,G,E){if(H=="blog"){this.data.submitWd="32px";this.data.transWd="32px";this.data.gridWd="0px"}else{if(H=="sshow"){this.data.submitWd="32px";this.data.transWd="0px";this.data.gridWd="32px"}}var F=E+": "+G;this.data.editingTitle=F;this.data.infoTitle=F;this.update()},clearInfo:function(){this.data.editingTitle="";this.data.infoTitle="";this.update()}};var f=[];var h={};var v="";var y=r(location.search).info||"";var C={};var c={};var t={};var i={};var e=[];var l={};window.pluginOf=function(E,G){if(!E){return null}var F=l[E];if(F){if(!F.title){return null}}else{F={};if(!G){l[E]=F}}return F};(function(E){E.title="PINP";E.version="1.0.0";E.templateDir=[];E.getGitUser=function(){return C};E.setGitUser=function(F){C=F};E.getGitToken=function(){return v};E.setGitToken=function(F){v=F;if(typeof Gh3=="object"){Gh3.access_token=F}};E.getDCF=function(){return m.getDCF()};E.getRootCfg=function(){return t};E.getHomeCfg=function(){return i};E.getCfgSha=function(){return c};E.hasModified=function(){var F=m.widgetByName("wdMarkdown");if(F&&F.r){return F.r.data.changed}else{return false}}})(pluginOf("pinp"));window.onbeforeunload=function(){var E=m.widgetByName("wdMarkdown");if(E&&E.r&&E.r.data.changed){return"You have unsaved changes on this page!"}else{return null}};function w(F,E){if(E.readyState<4){return E.statusText||"request abort"}else{return F.message||E.statusText||"error code:"+E.status}}function g(E,G){if(E.readyState<4){return E.statusText||"request abort"}else{var F="";if(G&&E.responseJSON){F=E.responseJSON[G]}return F||E.statusText||"error code:"+E.status}}function j(E){if(i.repos_name===E){return i}else{return _.find(e,function(F){return F.repos_name===E})}}function b(){this.succ=0;this.bErr=[];this.bOut=[]}b.prototype={checkRet:function(){if(this.succ+this.bErr.length>=this.bOut.length){this.callback(this.bErr,this.bOut)}},start:function(I,J){this.callback=J;var H=0;var E=this;var F=function(K,L,M){return function(){var N=new Gh3.File({path:"config.json"},C,L,"gh-pages");N.fetchContent(function(Q,O){if(!E){return}if(Q){E.bErr.push(L);E.checkRet();return}var R=null;try{var P=N.getRawContent();if(P&&P.charCodeAt(0)==65279){P=P.slice(1)}R=JSON.parse(P)}catch(S){alert("JSON format error: "+L+"/config.json");E.bErr.push(L);E.checkRet();return}c["/"+L+"/config.json"]=N.sha;E.bOut[K]=[L,M,R];E.succ+=1;E.checkRet()})}};var G=[];_.each(I,function(L){var M="",K="";if(L instanceof Array&&L.length==2){M=L[0];K=L[1]}else{if(typeof L=="string"){M=L}}if(M){E.bOut.push(M);G.push(E.getAjaxFunc(H,M,K));H+=1}});setTimeout(function(){if(E.succ+E.bErr.length<E.bOut.length){J(E.bErr,E.bOut)}E=null},60000);_.each(G,function(K){K()})}};var z={__base__:m.BaseWidget,__widget__:["wdPopDlgForm","wdSplitterA","wdMarkdown","wdResPanel","wdToolbar","wdPreviewArea"],init:function(L){this._super(L);var S=this;var F=(S.get("__debug__")||0)&1;if(F){return}var M=navigator.userAgent.toLowerCase();if(M.match(/trident.*rv[ :]*([\d.]+)/)||M.match(/msie ([\d.]+)/)){window.WEB_IE_BROWSER=true}else{window.WEB_IE_BROWSER=false}var I="";var P="";var N=function(T){$.ajax({type:"GET",url:"//"+PINP_HOST_DOMAIN+"/software/pages/blogger/has_login.action",data:{info:T,login:C.login,uid:C.id,type:C.type=="User"?"user":"orgn"},success:function(U){},error:function(U){}})};var J=function(U,V,T){$.ajax({type:"GET",url:"https://api.github.com/user?access_token="+U,success:function(W){C=new Gh3.User(W.login,W);$.ajax({type:"GET",url:"//"+C.login+".github.io/software/blogger10.json",success:function(X){t=X;N(V);T()},error:function(X){if(X.status=="404"){$.ajax({type:"GET",url:"https://api.github.com/user/orgs?access_token="+U,success:function(Z){if(!(Z instanceof Array)||Z.length!=1){I="REPO_NOT_READY";P="no proper organization found";T()}else{var Y=Z[0];C=new Gh3.User(Y.login);C.fetch(function(ab,aa){if(ab){I="REPO_NOT_READY";P="unrecognized user: "+Y.login;T()}else{$.ajax({type:"GET",url:"//"+C.login+".github.io/software/blogger10.json",success:function(ac){t=ac;N(V);T()},error:function(ac){I="GET_USER_ERR";P="read /software/blogger10.json failed ("+g(ac)+")";T()}})}})}},error:function(Y){I="GET_USER_ERR";P="get organization failed ("+g(Y,"message")+")";T()}})}else{I="GET_USER_ERR";P="read /software/blogger10.json failed ("+g(X)+")";T()}}})},error:function(W){I="GET_USER_ERR";P="get github user failed ("+g(W,"message")+")";T()}})};if(y){v=k("git_tok")||"";if(v){var R=location.pathname.split("/");R.pop();B("git_tok",R.join("/"));Gh3.access_token=v;J(v,y,function(){if(I){S.data.errMsg="load config failed";S.update();alert(I+": "+P)}else{S.initGitLogin()}})}else{$.ajax({type:"GET",url:"//"+PINP_HOST_DOMAIN+"/software/pages/blogger/get_token.action?info="+y,success:function(T){if(T instanceof Array&&T.length){v=T[0];J(v,y,function(){if(I){S.data.errMsg="load config failed";S.update();alert(I+": "+P)}else{S.initGitLogin()}})}else{alert("Query authorization failed!")}},error:function(T){alert("Query authorization failed: "+g(T))}})}}var Q=function(Y,ac){var T=S.wd.querySelectorAll(".prj-item.prj-sub2-item");for(var Z=0,ah;ah=T[Z];Z++){ah.parentNode.removeChild(ah)}T=S.wd.querySelectorAll(".prj-item.prj-show");for(var Z=0,ah;ah=T[Z];Z++){ah.classList.remove("prj-show")}T=S.wd.querySelectorAll(".prj-item.prj-selected");for(var Z=0,ah;ah=T[Z];Z++){ah.classList.remove("prj-selected")}T=S.wd.querySelectorAll(".prj-item.prj-selected2");for(var Z=0,ah;ah=T[Z];Z++){ah.classList.remove("prj-selected2")}var aa={};for(var Z=0,ah;ah=f[Z];Z++){var ad=ah.title;if(ac&&ad.indexOf(ac)!=0){continue}var ag=ad.split("/");var X=ad.indexOf("$$",ac.length);var W=ad.indexOf("/",ac.length);if(X==ac.length&&W>X){var V=ad.indexOf("/$$",ac.length);var ab=ac+ad.slice(X,W+1);if(!aa[ab]){var af="folder.png",U=Z,ae=ad;while(true){if(ae.indexOf("$$",ab.length)==ab.length){af="folder_sub.png";break}U+=1;if(U>=f.length){break}ae=f[U].title;if(!ae||ae.indexOf(ab)!=0){break}}aa[ab]=true;Y.push({isFolder:true,hasThumb:false,logoUrl:af,itemCls:"prj-cate-folder",title:ad.slice(X+2,W),alias:ah.alias,cateProj:ah.alias+"/"+ab})}if(V!=W){var af=ah.hidden?"prj_unrelease.png":(ah.hasThumb?"prj_item.png":"prj_item_web.png");Y.push({isFolder:false,hasThumb:ah.hasThumb,hasSub:ah.hasSub,logoUrl:af,itemCls:"prj-sub-item",title:ag[ag.length-1],alias:ah.alias,cateProj:ah.alias+"/"+ad,canWrite:ah.canWrite,prjType:ah.type,prjSize:ah.size,prjAcl:ah.acl})}}else{if(X<0&&W<0&&ad.length>ac.length){var af=ah.hidden?"prj_unrelease.png":(ah.hasThumb?"prj_item.png":"prj_item_web.png");var ae=ad.slice(ac.length);Y.push({isFolder:false,hasThumb:ah.hasThumb,hasSub:ah.hasSub,logoUrl:af,itemCls:"prj-curr-item",title:ae,alias:ah.alias,cateProj:ah.alias+"/"+ad,canWrite:ah.canWrite,prjType:ah.type,prjSize:ah.size,prjAcl:ah.acl})}}}};var E=function(Y){var X=S.wd.querySelector(".prj-item.prj-selected");if(X){X.classList.remove("prj-selected")}var U=S.wd.querySelectorAll(".prj-item.prj-show");for(var V=0,W;W=U[V];V++){W.classList.remove("prj-show")}U=S.wd.querySelectorAll(".prj-item.prj-selected2");for(var V=0,W;W=U[V];V++){W.classList.remove("prj-selected2")}U=S.wd.querySelectorAll(".prj-item.prj-sub2-item");for(var V=0,W;W=U[V];V++){W.parentNode.removeChild(W)}if(X===Y){return}Y.classList.add("prj-selected");var T=Y.getAttribute("title");if(!T){return}Y=Y.nextElementSibling;while(Y&&Y.classList.contains("prj-sub-item")){if(Y.getAttribute("title").indexOf(T)!=0){break}Y.classList.add("prj-show");Y=Y.nextElementSibling}};var K=function(W,ae){var ac=S.data.items[ae];if(!ac){return}var Z=ac.cateProj;if(!Z){return}var aa=Z.indexOf("/");if(aa<=0){return}var U=Z;var ab=Z.slice(0,aa);Z=Z.slice(aa+1);var T=S.wd.querySelectorAll(".prj-item.prj-selected2");for(var aa=0,ag;ag=T[aa];aa++){ag.classList.remove("prj-selected2")}if(!ac.hasSub){W.classList.add("prj-selected2");return}var ad=function(al){if(!W.parentNode){return}if(ac!==S.data.items[ae]){return}if(al.length<=0){return}var aq=ac.prjAcl||"private";var aj=W.nextElementSibling;for(var ak=0,ap;ap=al[ak];ak++){var ao=U+"/$$/"+ap[0];if(S.wd.querySelector('.prj-item[title="'+ao+'"]')){continue}var ai=ap[1];var an=ai?"prj_item.png":"prj_item_web.png";var am=document.createElement("div");am.setAttribute("title",ao);am.setAttribute("allow",aq);am.setAttribute("alias",ab);am.setAttribute("thumb",ai?"1":"0");am.className="prj-item prj-sub2-item";am.innerHTML='<img class="noselect-txt" draggable="true" src="'+an+'"><span draggable="true">'+a(ap[0])+"</span>";if(aj){W.parentNode.insertBefore(am,aj)}else{W.parentNode.appendChild(am)}}};W.classList.add("prj-selected2");var Y=W.nextElementSibling;if(Y&&Y.classList.contains("prj-sub2-item")){return}var af=h[U];if(af instanceof Array){ad(af)}else{if(y){var V=[];var X=function(){if(V.length==0){ac.hasSub=false;h[U]=[]}else{var ai=[];_.each(V,function(aj){ai.push([aj,false])});h[U]=ai;ad(ai)}};var ah=new Gh3.Dir({path:Z+"/$$"},C,ab,"gh-pages");ah.fetchContents(function(aj,ai){if(aj){if(ai.status!=404){alert("List files ("+Z+"/$$/) failed: "+aj.message);return}X();return}ah.eachContent(function(ak){if(ak.type=="dir"){var al=ak.name;if(al[0]!="."&&al[0]!="$"){V.push(al)}}});X()});return}}};S.on("ssPrjClick",function(T){var aa=T.original.target,X=null;while(aa){if(aa.nodeName=="DIV"){if(aa.classList.contains("web-item")){break}if(aa.classList.contains("prj-item")){X=aa;break}}aa=aa.parentNode}if(X){var U=S.wd.querySelectorAll(".prj-item.prj-selected3");for(var Z=0,ad;ad=U[Z];Z++){ad.classList.remove("prj-selected3")}if(X.classList.contains("prj-cate-folder")){E(X)}else{if(X.classList.contains("prj-sub-item")||X.classList.contains("prj-curr-item")){var ac=X.getAttribute("title");if(ac){var W=X.getAttribute("allow")||"private";S.wdToolbar.r.selectProj(ac,W)}if(X.classList.contains("prj-selected2")){return}var Y=X.getAttribute("name");if(Y&&Y.indexOf("prj-")==0){var ab=parseInt(Y.slice(4));K(X,ab)}}else{if(X.classList.contains("prj-sub2-item")){X.classList.add("prj-selected3");var ac=X.getAttribute("title");if(ac){var U=S.wd.querySelectorAll(".prj-item.prj-selected2");for(var Z=0,ad;ad=U[Z];Z++){ad.classList.remove("prj-selected2")}var V=X.previousElementSibling;while(V){if(V.classList.contains("prj-sub-item")||V.classList.contains("prj-curr-item")){V.classList.add("prj-selected2");break}else{if(!V.classList.contains("prj-sub2-item")){break}}V=V.previousElementSibling}var W=X.getAttribute("allow")||"private";S.wdToolbar.r.selectProj(ac,W)}}}}}});S.on("ssPrjDblclick",function(U){var T=U.original.target;setTimeout(function(){var W=null,ab=T;while(ab){if(ab.nodeName=="DIV"){if(ab.classList.contains("web-item")){break}if(ab.classList.contains("prj-item")){W=ab;break}}ab=ab.parentNode}if(!W){return}var X=[],af="",Y=false,aa="";var Z=W.getAttribute("alias");if(!Z){return}if(W.classList.contains("prj-cate-folder")){if(!W.classList.contains("prj-selected")){return}af=W.getAttribute("title");if(af.indexOf(Z+"/")==0){af=af.slice(Z.length+1)}else{af=""}Y=true}else{if(W.classList.contains("prj-up-folder")){aa=S.data.currCate;var ad=aa.split("/$$");if(y&&ad.length<=2){af=""}else{if(ad.length<=1){af=""}else{ad.pop();af=ad.join("/$$")+"/"}}Y=true}else{if(W.classList.contains("prj-sub-item")||W.classList.contains("prj-curr-item")||W.classList.contains("prj-sub2-item")){var ae=W.getAttribute("title");if(ae){var V=W.getAttribute("allow")||"private";S.wdResPanel.r.selectProj(ae,V)}}}}if(Y){S.data.items=X;S.data.currCate=af;Q(X,af);S.update();if(af){var ac=S.wd.querySelector(".prj-item.prj-up-folder");if(ac){ac.setAttribute("title",Z+"/"+af);ac.setAttribute("alias",Z)}}if(aa){setTimeout(function(){var ag=S.wd.querySelector('.prj-cate-folder[title="'+Z+"/"+aa+'"]');if(ag){E(ag)}},0)}}},0)});var H=function(T){var Z=T.target;while(Z){if(Z.nodeName=="DIV"){if(Z.classList.contains("prj-item")){break}else{if(Z.classList.contains("prj-root-node")){return}}}Z=Z.parentNode}var ac=0,aa="",U=false,W=1;if(Z.classList.contains("prj-sub-item")){ac=1;aa=Z.getAttribute("title")||"";W=(aa.slice(aa.length-5)==".blog"?3:1);var X=Z.getAttribute("name");if(X&&X.indexOf("prj-")==0){var ab=parseInt(X.slice(4));var Y=S.data.items[ab];if(Y){U=Y.hasThumb;W=Y.prjType}}}else{if(Z.classList.contains("prj-sub2-item")){ac=2;aa=Z.getAttribute("title")||"";U=parseInt(Z.getAttribute("thumb")||"0");W=(aa.slice(aa.length-5)==".blog"?3:1)}}var ad=(ac?Z.querySelector("img"):null);if(ac&&aa&&ad){s("drag_task","put_prj");var V="project,"+(U?"1":"0")+","+W;T.dataTransfer.effectAllowed="copy";T.dataTransfer.setData(window.WEB_IE_BROWSER?"text":"text/args",V+","+aa);if(T.dataTransfer.setDragImage){T.dataTransfer.setDragImage(ad,0,0)}}};S.on("ssDragStart",function(T){S.wdMarkdown.r.saveCaretPos();H(T.original)});S.on("ssDragEnd",function(T){B("drag_task")});S.on("refreshShow",function(V){var X="";var U=S.wd.querySelector(".prj-cate-folder.prj-selected");if(U){X=U.getAttribute("title")}var Y=[],T=S.data.currCate;S.data.items=Y;Q(Y,T);S.update();if(T&&U){var W=U.getAttribute("alias");var Z=S.wd.querySelector(".prj-item.prj-up-folder");if(Z){Z.setAttribute("title",W+"/"+T);Z.setAttribute("alias",W)}}if(X){setTimeout(function(){var aa=S.wd.querySelector('.prj-cate-folder[title="'+X+'"]');if(aa){E(aa)}},0)}});S.on("refresh",function(T){});var O=S.wdMarkdown.parentNode.parentNode.parentNode;var G=function(Y,X){var W=Math.max(S.wd.clientHeight,S.wdMarkdown.parentNode.clientHeight+S.wdPreviewArea.clientHeight);W=Math.max(window.innerHeight-S.wdToolbar.parentNode.clientHeight,W);S.wdSplitterA.style.height=W+"px";var U=O.parentNode.clientWidth-4-60-S.wdResPanel.clientWidth;var T=Math.max(1,Math.min(U,Y+X));var V=O.parentNode.clientWidth-S.wdSplitterA.clientWidth-T;S.wd.parentNode.style.width=T+"px";O.style.width=V+"px";if(S.wdMarkdown.r){S.wdMarkdown.r.fire("resized")}if(S.wdPreviewArea.r){S.wdPreviewArea.r.fire("resized")}};document.body.addEventListener("mousemove",function(V){var W=S.wdSplitterA.r.data;if(W.inMoving){var T=V.clientX,U=T-W.moveFromX;if(!W.moved&&Math.abs(U)>=4){W.moved=true}if(W.moved){G(W.leftWidth,U)}}},false);document.body.addEventListener("mouseup",function(U){var V=S.wdSplitterA.r.data;if(V.inMoving){var T=U.clientX-V.moveFromX;if(V.moved){G(V.leftWidth,T)}V.inMoving=false}},false);document.getElementById("web-body")["on-resize"]=function(T,U){G(S.wd.parentNode.clientWidth,0)};S.on("resized",function(T){G(S.wd.parentNode.clientWidth,0)});S.on("resized2",function(T){G(S.wd.parentNode.clientWidth,S.data.resizeGap||0)})},initGitLogin:function(){if(!C.login){return}var H=this;H.data.errMsg="loading...";H.update();c={};e=[];f=[];h={};var G="";var K="";var F=function(M){for(var P=-1;P<M.length;P++){var Q=i,R="",O="";if(P>=0){var N=M[P];R=N[0];Q=N[2];if(R!==Q.repos_name){Q.repos_name=R}O=N[1]||R;e.push(Q)}else{R=Q.repos_name;O=Q.repos_desc||""}var L=Q.doc_list;L.sort(function(T,S){if(T.path>S.path){return 1}else{if(T.path===S.path){return 0}else{return -1}}});_.each(L,function(U){var T=U.path,W=T.slice(-5);var S=U.flag||3,Y=(S&255)!=3,V=(S&256)!=0;var X={title:T,alias:R,time:U.modify_at,hidden:V?1:0,type:W==".blog"?3:1,size:0,acl:"public",canWrite:Y?0:1};X.hasSub=true;X.hasThumb=!!U.thumb;f.push(X)})}H.data.currCate="";H.data.friendGroup=[];if(f.length==0){H.data.errMsg="No project exists";H.update()}else{H.data.errMsg="";H.data.currCate="";H.fire("refreshShow")}};var I=function(){if(G){H.data.errMsg="loading config failed";H.update();alert(G+": "+K)}else{var M=i.builtin_repos||[],L=new b();if(M.length==0){H.data.errMsg="";H.update();F([]);return}L.start(M,function(P,N){if(P.length){var R="load failed";_.each(P,function(S){R+=", "+S+"/config.json"});H.data.errMsg="loading config failed";H.update();alert(R);return}for(var O=0,Q;Q=N[O];O++){if(typeof Q=="string"){H.data.errMsg="loading config failed";H.update();alert("load file failed: "+Q+"/config.json");return}}H.data.errMsg="";H.update();F(N)})}};var J=t.home_repository;var E=new Gh3.File({path:"config.json"},C,J,"gh-pages");E.fetchContent(function(N,L){if(N){G="LOAD_FAILED";K="load config.json failed";I();return}var O=null;try{var M=E.getRawContent();if(M&&M.charCodeAt(0)==65279){M=M.slice(1)}O=JSON.parse(M)}catch(P){alert("JSON format error: "+J+"/config.json");G="LOAD_FAILED";K="load config.json failed";I();return}c["/"+J+"/config.json"]=E.sha;i=O;I()})},addPrjNode:function(F){if(F.length<9){return}var I=F[0],E=F[1];var J={title:E,alias:I,time:F[2],type:F[3],size:F[4],hidden:F[5],acl:F[6],canWrite:1,hasThumb:F[7],hasSub:F[8]};for(var G=0,H;H=f[G];G++){if(I==H.alias&&E<H.title){f.splice(G,0,J);J=null;break}}if(J){f.push(J)}this.data.errMsg="";this.fire("refreshShow")},afterSharePrj:function(H,E,I){for(var F=0,G;G=f[F];F++){if(H==G.alias&&E==G.title){G.hidden=0;G.hasThumb=I;break}}this.data.errMsg="";this.fire("refreshShow")},addSubPrjNode:function(K,F){if(F.length<2){return}var G=F.shift();if(!G){return}for(var H=0,I;I=f[H];H++){if(K==I.alias&&G==I.title){I.hasSub=true;break}}var J=K+"/"+G;if(y){var E=h[J];if(!E){E=[];h[J]=E}for(var H=0,I;I=F[H];H++){E.push(I)}}else{h[J]=F}this.data.errMsg="";this.fire("refreshShow")},rmvPrjNode:function(J,F,H){var K=J.indexOf("/");if(K<=0){return}var O=J.slice(0,K),N=J.slice(K+1);var I=this.wdResPanel.r.data.currProj;var P=!!F[0];if(P){for(var L=0,R;R=f[L];L++){if(O==R.alias&&N==R.title){f.splice(L,1);if(J==I||(I&&I.indexOf(J+"/")==0)){this.wdResPanel.r.resetFolder()}break}}delete h[J]}else{if(y){H=[];var Q=h[J]||[];for(var L=0,R;R=Q[L];L++){var S=false,E=false;for(var G=1,M;M=F[G];G++){if(M==R[0]){S=true;break}}if(!S){H.push([R[0],R[1]])}}}h[J]=H;if(I&&I.indexOf(J+"/")==0){this.wdResPanel.r.resetFolder()}}this.data.errMsg="";this.fire("refreshShow")},getCurrProj:function(){var I=[],H="",J=null;var K=this.wd.querySelector(".prj-item.prj-selected2");if(K){H=K.getAttribute("title");var L=K.getAttribute("name");if(L&&L.indexOf("prj-")==0){var E=parseInt(L.slice(4));J=this.data.items[E]}}if(H&&J){I.push([K.getAttribute("allow")||"private",H,J.canWrite]);var G=this.wd.querySelector(".prj-item.prj-selected3");var F=G?G.getAttribute("title"):"";if(F){I.push([G.getAttribute("allow")||"private",F,J.canWrite])}}if(I.length){return I}else{return null}},resize2Width:function(E,G){if(E<8){return}var F=this.wd.parentNode.clientWidth;if(G&&F<E){return}this.data.resizeGap=E-F;this.fire("resized2")},gotoHome:function(){location.replace("//www.pinp.me/software/pages/blogger/editor.action")}};var q={__base__:m.BaseWidget,__widget__:["wdProjList"],init:function(E){this._super(E);var F=this;var G=(F.get("__debug__")||0)&1;if(G){return}F.wd.addEventListener("mousedown",function(H){F.data.inMoving=true;F.data.moved=false;F.data.moveFromX=H.clientX;F.data.leftWidth=F.wdProjList.parentNode.clientWidth},false)}};var x={__base__:m.BaseWidget,__widget__:["wdToolbar","wdProjList","wdResPanel","wdPopDlgForm","wdPreviewArea"],init:function(F){this._super(F);var H=this;var I=(H.get("__debug__")||0)&1;if(I){return}H.on("resized",function(K){var J=H.wd.parentNode.parentNode.clientWidth-H.wdResPanel.clientWidth-1;H.wd.parentNode.style.width=J+"px"});H.on("ssChanged",function(J){H.data.changed=true});var G=function(J){var K=H.wd.querySelector("textarea.markdown-editor");if(!K){return}K.focus();setTimeout(function(){var N=H.data.caretPos;if(N>=0){var L=K.value;if(N>L.length){N=L.length}K.value=L.substring(0,N)+J+L.substring(N)}else{if(document.selection){var M=document.selection.createRange();if(M){M.text=J}}else{if("selectionStart" in K){N=K.selectionStart;var L=K.value;if(N>L.length){N=L.length}K.value=L.substring(0,N)+J+L.substring(N)}else{K.value=J+"\n"+K.value}}}},0)};var E=m.getDCF();E.regist("dropTextInfo",function(J){H.wdPopDlgForm.r.hideDlg();var K=J[0];if(K){G(K)}});E.regist("saveSlideShow",function(P){var S=P[0],U=P[1];if(!S||!U){return}var N=S.indexOf("/");if(N<=0){return}var Q=S.slice(0,N),V=S.slice(N+1);var T=false;var O=H.wdToolbar.querySelector('img[name="SubmitPrj"]');O.src="loading.gif";setTimeout(function(){if(!T){T=true;O.src="prj_submit.png"}},20000);var K=function(X){if(!T){T=true;O.src="prj_submit.png"}if(X){alert(X)}};if(y){var L=V+"/$index.txt";var J=(new Date()).toLocaleDateString();var R=c["/"+Q+"/"+L];var M=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+Q+"/contents/"+L+"?access_token="+v,data:JSON.stringify({path:L,message:J,content:Gh3.Base64.encode(U),sha:R,branch:"gh-pages"}),success:function(X){c["/"+Q+"/"+L]=X.content.sha;H.data.changed=false;K("Submit project successful")},error:function(X){c["/"+Q+"/"+L]="";K("Upload failed: "+g(X,"message"))}})};if(!R){var W=new Gh3.Dir({path:V},C,Q,"gh-pages");W.fetchContents(function(Z,Y){if(Z){K("List files ("+V+") failed: "+Z.message);return}var X=W.getFileByName("$index.txt");if(!X){K("Read file failed: "+L);return}R=X.sha;c["/"+Q+"/"+L]=R;M()})}else{M()}return}});H.on("ssDragOver",function(J){var K=k("drag_task");if(K=="put_prj"||K=="put_img"){J.original.preventDefault();J.original.dataTransfer.dropEffect="copy"}});H.on("ssDragDrop",function(J){var W;if(window.WEB_IE_BROWSER){W=J.original.dataTransfer.getData("text")||""}else{W=J.original.dataTransfer.getData("text/args")||""}var S=W.split(",");if(S.length<=3){return}var O=S.slice(3).join(",");if(!O){return}if(S[0]=="project"){J.original.preventDefault();var Q="",K=parseInt(S[1]||"0"),V=S[2]||"3";if(K){if(y){var N=O.indexOf("/");if(N>0){var P=O.slice(0,N),T=O.slice(N+1);var R=j(P);if(R){var U=_.find(R.doc_list,function(X){return X.path==T});if(U){Q=U.thumb||"";if(Q[0]=="$"&&Q[1]=="$"){Q="/"+P+"/"+R.repos_name+"/"+Q}}}}}else{Q="/"+O+"/$thumbnail.png"}}H.wdPopDlgForm.r.addDropPrjFrame(Q,V,O)}else{if(S[0]=="image"){var M=parseInt(S[1]||"0"),L=parseInt(S[2]||"0");if(M&&L){J.original.preventDefault();H.wdPopDlgForm.r.addDropImgFrame(M,L,O)}}}})},saveCaretPos:function(){this.data.caretPos=-1;if(this.data.isMarkdown){var E=this.wd.querySelector("textarea.markdown-editor");if(E&&("selectionStart" in E)){this.data.caretPos=E.selectionStart}}},tryResetAcl:function(F,E){if(this.data.currProj==F){this.data.currAcl=E;if(this.data.editingCss=="block"){this.update()}}},startEditDoc:function(E){if(!E||E.length<=0){return}var O=E[E.length-1],S=O[0],N=O[1],I=O[2];if(!I){alert("Project is not blog or slideshow, online editing is not supported!");return}if(this.data.editingCss!="none"&&this.data.currProj){if(N&&this.data.currProj==N){if(!confirm("The project already in editing, do you want reload it?")){return}}if(this.data.changed&&!confirm("A project already in editing, do you want to contine (without submit previous one)?")){return}}if(typeof N!="string"){return}var L=N.indexOf("/");if(L<=0){return}var M=N.slice(0,L),P=N.slice(L+1);if(N.slice(N.length-5)==".blog"){this.el.style.background="url(loading2.gif) no-repeat center";this.data.isMarkdown=true;this.data.editingCss="none";this.update();var Q=this;var F=function(T){Q.el.style.background="";if(T){alert(T)}};var J=function(U){Q.wdToolbar.r.editProj("blog",N,S);Q.wdResPanel.r.editProj("blog",N);Q.wdPreviewArea.r.editProj("blog",N);var W=Q.data.hasPreview;var T=Q.wdPreviewArea.querySelector(".preview-md");if(T){T.innerHTML="";T.style.height=""}Q.data.hasPreview=false;var V=Q.wd.querySelector("textarea.markdown-editor");V.onkeydown=function(X){if(X.ctrlKey&&!X.shiftKey&&!X.altKey&&X.keyCode==77){var Y=Q.data.currProj;if(Q.data.editingCss=="none"||!Y){return}if(Y.slice(Y.length-5)!=".blog"){return}X.stopPropagation();X.preventDefault();Q.startTransDoc()}};V.value=U;Q.data.changed=false;Q.data.currAcl=S;Q.data.currProj=N;Q.data.editingCss="block";Q.update();if(W){Q.wdProjList.r.fire("resized")}};if(y){var H=new Gh3.File({path:P+"/$index.md"},C,M,"gh-pages");H.fetchContent(function(V,U){if(V){F("Load file failed: $index.md");return}c["/"+M+"/"+P+"/$index.md"]=H.sha;var T=H.getRawContent();if(T&&T.charCodeAt(0)==65279){T=T.slice(1)}J(T)});return}}else{if(N.slice(N.length-6)==".sshow"){this.el.style.background="url(loading2.gif) no-repeat center";this.data.isMarkdown=false;this.data.editingCss="none";this.update();var K=this.wd.querySelector("iframe.markdown-frame");if(!K){return}var Q=this;var F=function(T){Q.el.style.background="";if(T){alert(T)}};var G="/"+N+"/?editing=1";var J=function(){Q.wdPreviewArea.r.data.frameReady=false;Q.wdPreviewArea.r.data.pages=[];K.onerror=function(T){F(T+"")};K.onload=function(U){F("");Q.wdToolbar.r.editProj("sshow",N,S);Q.wdResPanel.r.editProj("sshow",N);Q.wdPreviewArea.r.editProj("sshow",N);Q.data.hasPreview=false;Q.data.changed=false;Q.data.currAcl=S;Q.data.currProj=N;Q.data.editingCss="block";Q.update();var T=window.innerWidth-300-616-4;Q.wdProjList.r.resize2Width(T,true)};K.src=G};if(y){var R=new Gh3.Dir({path:P},C,M,"gh-pages");R.fetchContents(function(V,U){if(V){F("List files ("+P+") failed: "+V.message);return}var T=R.getFileByName("$index.txt");if(!T){F("Read file failed: "+P+"/$index.txt");return}c["/"+M+"/"+P+"/$index.txt"]=T.sha;J()});return}}}},startSubmitDoc:function(){var M=this.data.currProj;if(this.data.editingCss=="none"||!M){alert("No project in editing");return}if(!this.data.changed){alert("no changes, submition canceled");return}if(M.slice(-5)==".blog"){var I=M.indexOf("/");if(I<=0){return}var K=M.slice(0,I),Q=M.slice(I+1);var G=this.wd.querySelector("textarea.markdown-editor");var O=G.value;var N=false;var J=this.wdToolbar.querySelector('img[name="SubmitPrj"]');J.src="loading.gif";setTimeout(function(){if(!N){N=true;J.src="prj_submit.png"}},20000);var R=this;var F=function(U){if(!N){N=true;J.src="prj_submit.png"}if(U){alert(U)}};var H=function(U){F();if(typeof U=="string"&&U){U=JSON.parse(U);if(typeof U=="string"){if(U=="OK"){R.data.changed=false;alert("Submit project successful")}else{if(U=="NOT_LOGIN"){R.wdPopDlgForm.r.checkLogin(true,"submit")}else{alert(U)}}}}};if(y){var P=Q+"/$index.md";var E=(new Date()).toLocaleDateString();var L=c["/"+K+"/"+P];var T=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+K+"/contents/"+P+"?access_token="+v,data:JSON.stringify({path:P,message:E,content:Gh3.Base64.encode(O),sha:L,branch:"gh-pages"}),success:function(U){c["/"+K+"/"+P]=U.content.sha;H('"OK"')},error:function(U){c["/"+K+"/"+P]="";F("Upload failed: "+g(U,"message"))}})};if(!L){var S=new Gh3.Dir({path:Q},C,K,"gh-pages");S.fetchContents(function(W,V){if(W){F("List files ("+Q+") failed: "+W.message);return}var U=S.getFileByName("$index.md");if(!U){F("Read file failed: "+P);return}L=U.sha;c["/"+K+"/"+P]=L;T()})}else{T()}return}}else{if(M.slice(M.length-6)==".sshow"){this.postSlideMsg("startSave",[M])}}},showPageGrid:function(){var G=this.wd.querySelector("iframe.markdown-frame");if(!G){return}var F=G.contentDocument;if(F){var E=F.querySelector("section.slides");if(E){if(E.style.backgroundImage&&E.style.backgroundImage!="none"){E.style.backgroundImage="none";E.classList.remove("no-ground")}else{E.classList.add("no-ground");E.style.backgroundImage="url(/software/pages/page_grid.svg)";E.style.backgroundPosition="center center";E.style.backgroundSize="900px 700px";E.style.backgroundRepeat="no-repeat"}}}},startTransDoc:function(){var H=this.data.currProj;if(this.data.editingCss=="none"||!H){alert("No project in editing");return}if(H.slice(H.length-5)==".blog"){var E=this;var F=E.wd.querySelector("textarea.markdown-editor");var G=E.wdPreviewArea.querySelector(".preview-md");if(G){require(["js/marked.min"],function(J){var M=false,O=true,L=0,I=false;var N=J(F.value);G.style.height="540px";var K=G.querySelector("iframe");if(!K){O=false;K=document.createElement("iframe");K.setAttribute("frameborder","0");K.setAttribute("border","0");G.appendChild(K)}else{if(E.data.hasPreview){M=true;L=K.contentDocument.documentElement.scrollTop;I=L>0&&(L+G.clientHeight>K.contentDocument.documentElement.scrollHeight-30)}}K.onload=function(P){K.contentWindow.document.body.style.overflowX="hidden";K.contentWindow.document.body.innerHTML=N;E.data.hasPreview=true;E.wdProjList.r.fire("resized");if(M){setTimeout(function(){if(I){K.contentDocument.documentElement.scrollTop=K.contentDocument.documentElement.scrollHeight}else{K.contentDocument.documentElement.scrollTop=L}},500)}};if(O){K.contentDocument.location.reload()}else{K.src="/"+H+"/?__EMPTY__"}})}}},prjInEditing:function(E){var F=this.data.currProj;if(this.data.editingCss=="none"||!F){return""}if(!this.data.changed){return""}if(F==E){return"*"}else{if(F.indexOf(E+"/$$/")==0){return F.slice(E.length+4)}else{return""}}},cancelEditing:function(){var H=this.data.currProj;if(this.data.editingCss=="none"||!H){return}var G=this.data.hasPreview;var E=this.wdPreviewArea.querySelector(".preview-md");if(E){E.innerHTML="";E.style.height=""}this.data.hasPreview=false;var F=this.wd.querySelector("textarea.markdown-editor");if(F){F.value=""}this.data.changed=false;this.data.currProj="";this.data.editingCss="none";this.update();this.wdToolbar.r.clearInfo();if(G){this.wdProjList.r.fire("resized")}},projState:function(){var F=this.data.currProj;if(this.data.editingCss=="none"||!F){return""}var E=F.length;if(E>5&&F.slice(E-5)==".blog"){return"blog"}else{if(E>6&&F.slice(E-6)==".sshow"){return"sshow"}else{return""}}},postSlideMsg:function(E,G){var H=this.wd.querySelector("iframe.markdown-frame");if(H){var F="[PINPSLIDE_11]"+JSON.stringify({method:E,param:G});H.contentWindow.postMessage(F,"*")}},tryUnselectSS:function(){var F=this.wd.querySelector("iframe.markdown-frame");if(F){var E="[PINPSLIDE_11]"+JSON.stringify({method:"tryUnselect",param:[]});F.contentWindow.postMessage(E,"*")}}};var u=[];var o={__base__:m.BaseWidget,__widget__:["wdProjList","wdMarkdown","wdPopDlgForm"],init:function(L){this._super(L);var R=this;var F=(R.get("__debug__")||0)&1;if(F){return}R.on("rewidth",function(V){var U=R.data.sWidth=="100%"?300:1;var T=R.wdMarkdown.parentNode;T.style.width=(T.parentNode.clientWidth-U-1)+"px";R.wd.parentNode.style.width=U+"px"});R.on("showSyntax",function(T){if(R.data.pages[0].show!="block"){R.data.pages[0].show="block";R.data.pages[1].show="none";R.update()}});R.on("showFolder",function(T){if(R.data.pages[1].show!="block"){R.data.pages[1].show="block";R.data.pages[0].show="none";R.update()}});R.on("ssDropClick",function(U){var T=R.wd.querySelector("div.res-dropholder > input");T.click()});R.on("ssFileChange",function(U){var T=U.original.target;if(T&&T.files&&T.files.length){S(T.files)}});R.on("ssDragStart",function(T){R.wdMarkdown.r.saveCaretPos();var ab=T.original.target,V=null;while(ab){if(ab.nodeName=="DIV"){if(ab.classList.contains("res-imgitem")){V=ab;break}else{if(ab.classList.contains("res-files")){return}}}ab=ab.parentNode}if(!V){return}var ae=V.querySelector("img");if(ae&&ae.complete){var aa=null;var ac=parseInt(V.getAttribute("idx")||"0");for(var Z=0,af;af=u[Z];Z++){if(af.id===ac){aa=af;break}}if(!aa||!aa.realUrl){return}var Y,X,W=ae.getAttribute("_size");if(W){var ad=W.split("x");if(ad.length!=2){return}Y=ad[0];X=ad[1]}else{Y=ae.naturalWidth+"";X=ae.naturalHeight+""}s("drag_task","put_img");var U=T.original.dataTransfer;U.effectAllowed="copy";U.setData(window.WEB_IE_BROWSER?"text":"text/args","image,"+Y+","+X+","+aa.realUrl);if(U.setDragImage){U.setDragImage(ae,0,0)}}});R.on("ssDragEnd",function(T){B("drag_task")});R.on("ssTempDragStart",function(W){var V=W.original.target;if(V&&V.nodeName=="IMG"){var U=V.getAttribute("src");s("drag_task","run_js");var T=W.original.dataTransfer;T.effectAllowed="copy";T.setData(window.WEB_IE_BROWSER?"text":"text/args","image,0,0,"+U);if(T.setDragImage){T.setDragImage(V,0,0)}}});R.on("ssTempDragEnd",function(T){B("drag_task")});var O=0;var K=".jpg.jpeg.png.gif.ico.tiff.bmp.svg.svgz.";var P=".jpg.jpeg.png.gif.ico.tiff.bmp.";var G=function(T,V,U){};var H=function(X){var U="res-imgitem";if(X.cls){U+=" "+X.cls}var W=document.createElement("div");W.className=U;W.setAttribute("idx",X.id+"");var T=document.createElement("img");T.setAttribute("draggable","true");T.setAttribute("title",X.title);T.onload=function(Y){var ag=Y.target;if(ag.nodeName!="IMG"||!ag.naturalHeight){return}var ae=ag.parentNode.classList.contains("res-uploading");if(ae){return}var Z=ag.getAttribute("src");if(Z=="warning.jpg"||Z=="uploading.gif"){return}var af=ag.getAttribute("_size");if(af){var aa=ag.naturalWidth,ab=ag.naturalHeight;ag.style.marginLeft=Math.floor((90-aa)/2+0.5)+"px";ag.style.marginTop=Math.floor((80-ab)/2+0.5)+"px";ag.style.width=aa+"px";ag.style.height=ab+"px";return}var ad=ag.naturalWidth/ag.naturalHeight;if(ad<1.125){var aa=Math.floor(80*ad+0.5);ag.style.width=aa+"px";ag.style.marginLeft=Math.floor((90-aa)/2+0.5)+"px"}else{var ab=Math.floor(90/ad+0.5);ag.style.height=ab+"px";ag.style.marginTop=Math.floor((80-ab)/2+0.5)+"px"}var ac=ag.getAttribute("_error");if(ac){ag.title=ac}else{ag.title=ag.naturalWidth+"x"+ag.naturalHeight}};T.src=X.url;W.appendChild(T);var V=document.createElement("div");V.className="res-rmvimg";V.onclick=function(Z){var aj=Z.target,aa=null;while(aj){if(aj.nodeName=="DIV"){if(aj.classList.contains("res-imgitem")){aa=aj;break}else{if(aj.classList.contains("res-files")){break}}}aj=aj.parentNode}if(!aa){return}var ag=null,al=parseInt(aa.getAttribute("idx")||"0");if(al>0){for(var ae=0,an;an=u[ae];ae++){if(an.id==al){ag=an;break}}}if(!ag||!ag.realUrl){return}var ah=D(ag.realUrl);var ad=ah.pathname,af=ag.alias;if(ad[0]!="/"){ad="/"+ad}if(ad.indexOf("/"+af+"/")==0){ad=ad.slice(1);var ak=ad.split("/").pop();if(!confirm("Do you want remove file ("+ak+")?")){return}var Y=function(){if(!aa.parentNode){return}aa.parentNode.removeChild(aa);for(var ap=0,aq;aq=u[ap];ap++){if(aq.id==al){u.splice(ap,1);break}}};if(y){var am=ad.slice(af.length+1);var ac=am.slice(0,am.length-ak.length-1);var ai=ag.sha||"";var ab=function(){$.ajax({type:"DELETE",url:"https://api.github.com/repos/"+C.login+"/"+ag.alias+"/contents/"+am+"?access_token="+v,data:JSON.stringify({path:am,message:(new Date()).toLocaleDateString(),sha:ai,branch:"gh-pages"}),success:function(ap){Y()},error:function(ap){alert("Remove file failed: "+ak)}})};if(!ai){var ao=new Gh3.Dir({path:ac},C,af,"gh-pages");ao.fetchContent(function(ar,aq){var ap=null;if(!ar){ap=ao.getFileByName(ak)}if(!ap){alert("Remove file failed: "+ak);return}ai=ap.sha;ab()})}else{ab()}return}}};W.appendChild(V);return W};var M=function(){var V=R.wd.querySelector("div.res-btm-line");if(!V){return}var U=R.wd.querySelectorAll("div.res-imgitem");for(var W=0,Y;Y=U[W];W++){Y.parentNode.removeChild(Y)}if(!u.length){return}var T=V.parentNode;for(var W=0,Z;Z=u[W];W++){var X=H(Z);T.insertBefore(X,V)}};var Q=function(V){var T=R.wd.querySelector("div.res-btm-line");if(!T){return}var U=H(V);T.parentNode.insertBefore(U,T)};R.on("loadRes",function(X){var aa=R.data.currProj;if(!aa){return}var Z=aa.indexOf("/");if(Z<=0){return}var Y=aa.slice(0,Z),U=aa.slice(Z+1);if(y){var W=[];var T=function(){u=[];var ab=R.data.pages[1].canModifyCss=="block"?"res-canrmv":"";_.each(W,function(ac){var ad=ac[0];O+=1;var ae={realUrl:"//"+C.login+".github.io/"+aa+"/"+ad,cls:ab,alias:Y,title:ad,id:O,sha:ac[1]};ae.url=ae.realUrl;u.push(ae)});M()};var V=new Gh3.Dir({path:U},C,Y,"gh-pages");V.fetchContents(function(ac,ab){if(ac){R.showMsg("load image resource failed");return}V.eachContent(function(ad){if(ad.type=="file"){var af=ad.name,ae=af.split(".").pop();if(K.indexOf("."+ae+".")>=0){W.push([af,ad.sha])}}});T()});return}});var N=function(ao,ac,ad,ai,ab){var U=R.data.currProj,af=R.data.currAllow;if(!U){return false}var Y=U.indexOf("/");if(Y<=0){return false}var aq=U.slice(0,Y),an=U.slice(Y+1);var ae="",ak="",Z="bin",al=false;if(ao){var am=ao.name.split(".");ac=ao.type;ak=am.pop();ae=am.join(".");if(y){al=true}}else{if(!ab){return false}ae=ad;ak=ai;Z="base64"}if(!ac||!ae||!ak){return false}var aa=ae+"."+ak;var ap=1,X=_.find(u,function(ar){return aa==(ar.realUrl||"").split("/").pop()});while(X){ap+=1;aa=ae+ap+"."+ak;X=_.find(u,function(ar){return aa==(ar.realUrl||"").split("/").pop()})}O+=1;var ah=O;var ag={id:ah,url:"uploading.gif",cls:"res-uploading",title:aa,alias:aq};u.push(ag);Q(ag);var W=function(at,ar,av){if(ar!="warning.jpg"){ag.realUrl=ar}ag.url=ar;ag.cls="";at.classList.remove("res-uploading");var au=at.querySelector("img");if(au){if(av){au.setAttribute("_error",av)}else{if(R.data.pages[1].canModifyCss=="block"){at.classList.add("res-canrmv")}}au.setAttribute("src",ar)}};if(y){var aj=function(av,ar,au,at){ag.realUrl=ar;ag.url=ar;ag.cls="";av.classList.remove("res-uploading");var aw=av.querySelector("img");if(aw){if(R.data.pages[1].canModifyCss=="block"){av.classList.add("res-canrmv")}aw.src=au+at}};var V=function(au){var at=au.indexOf(";base64,"),ar="";if(at>0&&at<64){ar=au.slice(0,at+8);au=au.slice(at+8)}var av=an+"/"+aa;$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+aq+"/contents/"+av+"?access_token="+v,data:JSON.stringify({path:av,message:(new Date()).toLocaleDateString(),content:au,branch:"gh-pages"}),success:function(aw){var ax=R.wd.querySelector('div.res-uploading[idx="'+ah+'"]');if(!ax){return}ag.sha=aw.content.sha;ax.style.backgroundSize="40px 2px";setTimeout(function(){ax.style.backgroundSize="70px 2px";setTimeout(function(){var ay="//"+C.login+".github.io/"+aq+"/"+av;aj(ax,ay,ar,au)},500)},500)},error:function(aw){var ax=R.wd.querySelector('div.res-uploading[idx="'+ah+'"]');if(!ax){return}ax.style.backgroundSize="70px 2px";W(ax,"warning.jpg","upload failed: "+aa)}})};if(al){var T=new FileReader();T.onload=function(ar){V(T.result)};T.readAsDataURL(ao)}else{if(!ab||Z!="base64"){return false}V(ab)}return true}};var J=function(V){var T;if(window.WEB_IE_BROWSER){T=V.dataTransfer.getData("text")||""}else{T=V.dataTransfer.getData("text/args")||""}if(T.indexOf("project,")==0){return}V.stopPropagation();V.preventDefault();var U=V.target;if(U&&U.classList.contains("res-dropholder")){if(V.type=="dragover"){U.classList.add("res-draghover")}else{U.classList.remove("res-draghover")}}};var S=function(W){var Z=[],Y=0;for(var U=0,X;X=W[U];U++){var T=X.name.split("."),V=T[T.length-1];if(T.length>1&&V&&K.indexOf("."+V+".")>=0){if(N(X)){Y+=1;if(Y>=64){break}}}else{Z.push(X.name)}}if(Z.length){alert("Only image file can upload, following ignored: "+Z.join(","))}if(Y){R.update()}};var I=function(U,W,V){var T=new Image();T.onload=function(){var Y=document.createElement("canvas");var X=Y.getContext("2d");Y.width=this.width;Y.height=this.height;X.drawImage(this,0,0);var Z=Y.toDataURL(V);W(Z);Y=null};T.crossOrigin="Anonymous";T.src=U};var E=function(T){J(T);var U=T.target.files||T.dataTransfer.files;if(U.length){S(U)}else{var Z="",Y="",W="",ab=T.dataTransfer.getData("url")||"";if(ab){var X=ab.indexOf(";base64,");if(X>0&&X<64){return}Z=ab.split("?")[0].split("/").pop()}if(Z){var aa=Z.split(".");if(aa.length>=2){W=aa.pop();Y=aa.join(".")}}if(Y&&W&&K.indexOf("."+W+".")>=0){var V="image/"+W;I(ab,function(ac){N(null,V,Y,W,ac)},V)}}};if(window.File&&window.FileList&&window.FileReader&&window.XMLHttpRequest&&(new XMLHttpRequest()).upload){R.set("pages[1].canUpload",true);setTimeout(function(){var T=document.getElementById("dragndropimage");if(T){T.addEventListener("dragover",J,false);T.addEventListener("dragleave",J,false);T.addEventListener("drop",E,false)}},0)}R.on("ssTempDbclick",function(W){var U=W.original.target,V=null;while(U){if(U.nodeName=="DIV"){if(U.classList.contains("res-temp-folder")){V=U;break}else{if(U.classList.contains("res-template")){break}}}U=U.parentNode}if(!V){return}var T=V.getAttribute("_url");if(T){R.loadTemplate(T,V.querySelector("img.res-temp-loading"))}});R.on("ssTempRefresh",function(V){var U=V.original.target,T=null;if(U.nodeName=="IMG"){U=U.parentNode}if(U.nodeName=="DIV"&&U.classList.contains("res-temp-refresh")){T=U.querySelector("img.res-temp-loading")}R.loadTemplate("software/pages/template",T)})},switch2Wide:function(){if(this.data.sWidth=="100%"){return}this.data.showPage="block";this.data.sWidth="100%";this.update();this.fire("rewidth")},switch2Narrow:function(){if(this.data.sWidth!="100%"){return}this.data.showPage="none";this.data.sWidth="1px";this.update();this.fire("rewidth")},pageState:function(){if(this.data.sWidth=="100%"){if(this.data.pages[0].show=="block"){return"syntax"}else{return"files"}}else{return""}},showMsg:function(E){var F=this.wd.querySelector(".res-show-info");if(F){F.innerHTML=a(E);F.style.display="block";setTimeout(function(){F.style.display="none"},5000)}},tryResetAcl:function(G,F){if(this.data.currProj!=G){return}this.data.currAllow=F;var I=this.wd.querySelector(".res-proj-info");if(I){var E=I.getAttribute("title")||"";var J=E.indexOf(":");if(J>0){var H=E.slice(0,J).trim();if(H=="public"||H=="protected"||H=="private"){I.setAttribute(F+E.slice(J))}}}},selectProj:function(L,G){if(this.pageState()!="files"){return}var K="none",F=this.wdMarkdown.r.data.currProj;if(F==L||(F&&L.indexOf(F+"/")==0)){K="block"}if(this.data.currProj==L&&this.data.pages[1].canModifyCss==K){if(!confirm("Do you want reload image resource?")){return}}var J=this.wd.querySelector(".res-proj-info");if(J){var H,I=L.indexOf("/");if(I>0){H=L.slice(I+1)}else{H=L}var E=H.split("/");J.innerHTML="<p> "+a(H)+"</p>";J.setAttribute("title",G+": "+E[E.length-1])}u=[];this.data.pages[1].canModifyCss=K;this.data.currProj=L;this.data.currAllow=G;this.update();this.fire("loadRes")},resetFolder:function(){var E=this.wd.querySelector(".res-proj-info");if(E){E.innerHTML="";E.removeAttribute("title")}u=[];this.data.pages[1].canModifyCss="none";this.data.currProj="";this.update()},editProj:function(I,H){var G="none",E=this.wdMarkdown.r.data.currProj;if(E==H||(E&&H.indexOf(E+"/")==0)){G="block"}this.data.pages[1].canModifyCss=G;if(I=="blog"){this.data.pages[0].isTemplate=false;this.update()}else{if(I=="sshow"){this.data.pages[0].isTemplate=true;this.update();var F=this.wd.querySelector("div.res-temp-refresh");if(F){this.loadTemplate("software/pages/template")}}}},loadTemplate:function(G,F){if(!this.data.pages[0].isTemplate){return}if(!G){return}if(G[G.length-1]=="/"){G=G.slice(0,-1)}var H,K="",N="",J=false;if(G.indexOf("http://")==0||G.indexOf("https://")==0){if(!C){return}H=G.indexOf("/",8);if(H<0){return}K=G.slice(0,H);if(K.slice(-10)!=".github.io"){return}N=K.split("//")[1].split(".")[0];K+="/";G=G.slice(H+1);J=true}else{if(G=="software/pages/template"){J=true}}H=G.indexOf("/");if(H<=0){return}var M=function(V,R){if(!J){return}var T=window.pluginOf("pinp");if(T.templateDir){for(var S=0,U;U=T.templateDir[S];S++){V.splice(R,0,U)}}};if(F){F.style.visibility="visible"}var E=function(R){if(R){alert(R)}if(F){F.style.visibility="hidden"}};var P=this,I=G.slice(0,H),O=G.slice(H+1);if(y||K){var L=K?{login:N}:C;var Q=new Gh3.Dir({path:O},L,I,"gh-pages");Q.fetchContents(function(T,W){if(T){E("load template ("+O+") failed: "+T.message);return}var X=[],Y={};Q.eachContent(function(ab){if(ab.type=="dir"){X.push([ab.name,ab.path])}else{if(ab.type=="file"){var ad=ab.path,ac=ad.slice(-7);if(ac==".png.js"||ac==".gif.js"){var ae=ad.slice(0,-3);var aa=Y[ae]||0;if(aa){Y[ae]=aa+2}else{Y[ae]=2}}else{ac=ad.slice(-4);if(ac==".png"||ac==".gif"){var aa=Y[ad]||0;if(aa){Y[ad]=aa+1}else{Y[ad]=1}}}}}});var R=[];_.each(Y,function(ab,aa){if(ab==3){R.push(aa)}});R.sort();X.sort(function(ab,aa){ab=ab[0];aa=aa[0];if(ab>aa){return 1}else{if(ab===aa){return 0}else{return -1}}});var U=[];var S="pages/template";if(O.length>S.length){var Z=O.split("/");Z.pop();U.push({isDir:true,name:"..",img:"file_up.png",url:K+I+"/"+Z.join("/")})}_.each(X,function(aa){U.push({isDir:true,name:aa[0],img:"file_folder.png",url:K+I+"/"+aa[1]})});if(J){M(U,U.length)}var V=K?K+I+"/":"/"+I+"/";_.each(R,function(ab){var aa=ab.split("/").pop();U.push({isDir:false,name:aa,img:V+ab})});E();if(U.length==0){P.data.pages[0].res=[{isDir:true,name:"",img:"file_refresh.png",url:"software/pages/template"}]}else{P.data.pages[0].res=U}P.update()});return}}};var A={__base__:m.IFrame,__widget__:["wdMarkdown"],init:function(F){this._super(F);var G=this;var H=(G.get("__debug__")||0)&1;if(H){return}window.setPopContent=function(N,M,O,L,I){var J=G.wd.querySelector("div.preview-ss");var K=G.wd.querySelector("div.preview-inst > iframe");if(J&&K&&K.contentWindow.setContent){J.style.display="none";K.parentNode.style.display="block";K.contentWindow.setContent(N,M,O,L,I)}};window.getPopContent=function(J){var I=G.wd.querySelector("div.preview-inst > iframe");if(I&&I.contentWindow.getContent){return I.contentWindow.getContent(J)}};window.hidePopContent=function(){var I=G.wd.querySelector("div.preview-ss");var J=G.wd.querySelector("div.preview-inst > iframe");if(I&&J&&J.contentWindow.hideContent){J.contentWindow.hideContent();I.style.display="block";J.parentNode.style.display="none"}};var E=m.getDCF();E.regist("previewPlugLib",function(I){if(G.data.frameReady){I.unshift(G.data.pages);I.push(G.wd.clientWidth);E.call("frm-preview","setPlugLib",I)}});E.regist("previewPageHtml",function(I){if(G.data.frameReady){I.unshift(G.data.pages);E.call("frm-preview","setPageHtml",I)}});E.regist("previewPageModi",function(I){G.wdMarkdown.r.data.changed=true;if(G.data.frameReady){I.unshift(null);E.call("frm-preview","setPageHtml",I)}});E.regist("onSlideLoad",function(I){G.data.pages=I;if(I.length&&G.data.frameReady){G.initPreviewPg()}});E.regist("slideDelPage",function(J){var I=J.shift();G.data.pages=J;G.wdMarkdown.r.data.changed=true;if(G.data.frameReady){E.call("frm-preview","setPageHtml",[J,I])}});E.regist("slideAddPage",function(J){var I=J.shift();G.data.pages=J;G.wdMarkdown.r.data.changed=true;if(G.data.frameReady){E.call("frm-preview","setPageHtml",[J,I])}});E.regist("slideChangeOrder",function(J){var I=J.shift();G.data.pages=J;G.wdMarkdown.r.data.changed=true;if(G.data.frameReady){E.call("frm-preview","setPageHtml",[J,I])}});E.regist("nav_shift",function(I){if(G.data.frameReady){E.call("frm-preview","nav_shift",I)}});E.regist("turnSlideTo",function(I){G.wdMarkdown.r.postSlideMsg("turnSlideTo",I)});E.regist("delSlidePage",function(I){G.wdMarkdown.r.postSlideMsg("delSlidePage",I)});E.regist("addSlidePage",function(I){G.wdMarkdown.r.postSlideMsg("addSlidePage",I)});G.on("resized",function(I){var K=G.wd.querySelector("div.preview-ss > iframe");if(K){E.call("frm-preview","setVisibleWidth",[G.wd.clientWidth])}var J=G.wd.querySelector("div.preview-inst > iframe");if(J&&J.contentWindow.setVisibleWidth){J.contentWindow.setVisibleWidth(G.wd.clientWidth)}})},editProj:function(E,K){if(E=="blog"){this.data.frameReady=false;this.data.isTemplate=false;this.update()}else{if(E=="sshow"){this.data.isTemplate=true;this.update();var M=this.wd.querySelector("div.preview-ss");var G=this.wd.querySelector("div.preview-inst");if(M&&G){var H=Math.max(window.innerHeight-38-480-10,100);var J=Math.max(window.innerHeight-38-480-8,100);M.style.height=H+"px";G.style.height=J+"px";var L=G.querySelector("iframe");if(!L){L=document.createElement("iframe");L.setAttribute("frameborder","0");L.setAttribute("border","0");L.setAttribute("width",window.innerWidth+"");L.setAttribute("height",J+"");G.appendChild(L);var O=this;L.onload=function(P){if(L.contentWindow.setVisibleWidth){L.contentWindow.setVisibleWidth(O.wd.clientWidth)}}}var I=M.querySelector("iframe");if(!I){m.getDCF().removeTarget("frm-preview");I=document.createElement("iframe");I.setAttribute("id","frm-preview");I.setAttribute("frameborder","0");I.setAttribute("border","0");I.setAttribute("width",window.innerWidth+"");I.setAttribute("height",H+"");M.appendChild(I);var O=this;I.onload=function(P){O.data.frameReady=true;if(O.data.pages.length){O.initPreviewPg()}}}var F="/"+K+"/?editing=1&preview=1";I.setAttribute("src",F);var N="/"+K+"/?editing=1&inline=1";L.setAttribute("src",N)}}}},initPreviewPg:function(){this.wdMarkdown.r.postSlideMsg("notiGetPlugLib",[]);var E=this;setTimeout(function(){for(var F=0,G;G=E.data.pages[F];F++){E.wdMarkdown.r.postSlideMsg("notiGetPageHtml",[G])}},1000)}};var n={__base__:m.IFrame,__widget__:["wdInfoMask","wdToolbar","wdProjList","wdMarkdown","wdResPanel","wdPreviewArea"],init:function(G){this._super(G);var M=this;var E=(M.get("__debug__")||0)&1;if(E){return}M.wd.style.display="none";M.wdInfoMask.style.display="none";M.wdInfoMask.onclick=function(N){if(N.target===M.wdInfoMask&&M.wd.style.display=="block"){if(M.data.finished&&M.tryHideDlg()){N.stopPropagation()}}};var K=null,L=0;var F=m.getDCF();F.regist("onResetLogin",function(N){M.data.login.hasLogin=false});var H=function(Q,P){for(var N=0,O;O=Q[N];N++){if(P.indexOf(O)>=0){return true}}return false};F.regist("onLogin",function(N){});F.regist("closeForm",function(N){M.data.retData=N;M.data.finished=true;M.wdInfoMask.style.display="none";M.wd.style.display="none"});F.regist("shareProject",function(ah){var ap=ah[0],aa=ah[1],ag=ah[2];var U=ah[3],ao=ah[4],ak=ah[5],O=ah[6];var V=ah[7]||"",ai=ah[8]||"";var S=(y?[]:M.wdProjList.r.data.friendGroup);var Y=(ap==0?"public":(ap==1?"protected":"private"));var ad="";if(Y=="private"){if(aa>0&&aa<=S.length){ad=S[aa-1]||""}}var R=ag.indexOf("/");if(R<=0){return}var an=ag.slice(0,R),Z=ag.slice(R+1);var am=false;var T=M.wdToolbar.querySelector('img[name="SharePrj"]');T.src="loading.gif";setTimeout(function(){if(!am){am=true;T.src="prj_share.png"}},20000);var P=function(){if(!am){am=true;T.src="prj_share.png"}alert("Share project successful!");M.hideDlg();if(!y){M.wdMarkdown.r.tryResetAcl(ag,Y);M.wdResPanel.r.tryResetAcl(ag,Y)}M.wdProjList.r.afterSharePrj(an,Z,!!O)};var ab=function(aq){if(!am){am=true;T.src="prj_share.png"}alert(aq);if(y){M.hideDlg()}};if(y){var ae=Z+"/$abstract.txt";if(O.slice(0,2)=="$$"){O="/"+an+"/"+O}var af=null,aj=j(an);if(!aj){ab("System error: can not find repository");return}af=_.find(aj.doc_list,function(aq){return aq.path==Z});if(!af){ab("System error: can not find document: "+Z);return}var N=(new Date()).toLocaleDateString();var W=c["/"+an+"/config.json"];var Q=function(){$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+an+"/contents/config.json?access_token="+v,data:JSON.stringify({path:"config.json",message:N,content:Gh3.Base64.encode(JSON.stringify(aj)),sha:W,branch:"gh-pages"}),success:function(aq){c["/"+an+"/config.json"]=aq.content.sha;P()},error:function(aq){c["/"+an+"/config.json"]="";ab("Save config.json failed: "+g(aq,"message"))}})};var ac=function(){var aq=U+"\r\n"+ao+"\r\n"+(ak?"<"+ak+">":"")+"\r\n";if(ai){aq+=ai}var ar={path:ae,message:N,content:Gh3.Base64.encode(aq),branch:"gh-pages"};if(V){ar.sha=V}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+an+"/contents/"+ae+"?access_token="+v,data:JSON.stringify(ar),success:function(at){af.title=U;af.desc=ao;af.keyword=ak;af.thumb=O;af.modify_at=parseInt((new Date()).valueOf()/1000);af.flag=(af.flag&255);Q()},error:function(at){ab("Save $abstract.txt failed: "+g(at,"message"))}})};var X=function(){if(O){ac()}else{var aq=new Gh3.Dir({path:Z},C,an,"gh-pages");aq.fetchContents(function(at,ar){if(at){ab("List project files failed: "+g(ar,"message"));return}if(aq.getFileByName("$thumbnail.png")){O="/"+an+"/"+Z+"/$thumbnail.png"}ac()})}};if(!W){var al=new Gh3.File({path:"config.json"},C,an,"gh-pages");al.fetchContent(function(ar,aq){if(ar){ab("Read config.json failed: "+g(aq,"message"));return}W=al.sha;c["/"+an+"/config.json"]=W;X()})}else{X()}return}});var J=function(Q,ag,V,R,S){var P=new Date();var O=P.toLocaleDateString();P=Math.floor(P.valueOf()/1000);var X="",Z=V.split("/");var T=Z.pop();if(R){Z.pop();X=Z.join("/")}var U=c["/"+ag+"/config.json"];var ad=V+"/$index.md";var ab=V+"/index.html";var aa=function(ai){if(typeof S=="function"){S(ai)}};var ac=function(){if(R){M.wdProjList.r.addSubPrjNode(ag,[X,[T,false]]);M.hideDlg();aa()}else{var aj=Q.doc_list;var am={path:V,title:T,keyword:"",desc:"",thumb:"",flag:256+3,create_at:P,modify_at:P};for(var al=0,ai;ai=aj[al];al++){if(V<ai.path){aj.splice(al,0,am);am=null;break}}if(am){aj.push(am)}var an=3,ak=1;M.wdProjList.r.addPrjNode([ag,V,P,an,0,ak,"public",0,0]);M.hideDlg();$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ag+"/contents/config.json?access_token="+v,data:JSON.stringify({path:"config.json",message:O,sha:U,content:Gh3.Base64.encode(JSON.stringify(Q)),branch:"gh-pages"}),success:function(ao){c["/"+ag+"/config.json"]=ao.content.sha;aa()},error:function(ao){c["/"+ag+"/config.json"]="";aa("Create project successful, but regist it failed, you can publish it later")}})}};var W=function(am,ak){var ai="";if(ak){var aj=ak.getFileByName("index.html");if(aj){if(!confirm(ab+" already exists, do you want overwrite it?")){ac();return}ai=aj.sha}}var al={path:ab,message:O,content:Gh3.Base64.encode(am),branch:"gh-pages"};if(ai){al.sha=ai}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ag+"/contents/"+ab+"?access_token="+v,data:JSON.stringify(al),success:function(an){setTimeout(function(){ac()},500)},error:function(an){aa("Write ("+ab+") failed: "+g(an,"message"))}})};var ae=function(al,an,ak){var ai="";if(ak){var aj=ak.getFileByName("$index.md");if(aj){if(!confirm(ad+" already exists, do you want overwrite it?")){W(an,ak);return}ai=aj.sha}}var am={path:ad,message:O,content:Gh3.Base64.encode(al),branch:"gh-pages"};if(ai){am.sha=ai}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ag+"/contents/"+ad+"?access_token="+v,data:JSON.stringify(am),success:function(ao){setTimeout(function(){W(an,ak)},500)},error:function(ao){aa("Write ("+ad+") failed: "+g(ao,"message"))}})};var Y=function(aj,ak){var ai=new Gh3.Dir({path:V},C,ag,"gh-pages");ai.fetchContents(function(am,al){if(am){if(al.status==404){ae(aj,ak,null);return}aa("List directory ("+V+") failed: "+g(al,"message"));return}ae(aj,ak,ai)})};var ah=function(ai){$.ajax({type:"GET",url:"//"+C.login+".github.io/software/blogger10/blog.tmpl",dataType:"html",success:function(aj){Y(ai,aj)},error:function(aj){aa("Read file failed: /software/blogger10/blog.tmpl")}})};var N=function(){$.ajax({type:"GET",url:"//"+C.login+".github.io/software/blogger10/markdown.md",dataType:"text",success:function(ai){if(ai&&ai.charCodeAt(0)==65279){ai=ai.slice(1)}ah(ai)},error:function(ai){aa("Read file failed: /software/blogger10/markdown.md")}})};if(!U){var af=new Gh3.File({path:"config.json"},C,ag,"gh-pages");af.fetchContent(function(aj,ai){if(aj){aa("Read config.json failed: "+g(ai,"message"));return}U=af.sha;c["/"+ag+"/config.json"]=U;N()})}else{N()}};var I=function(P,ah,U,Q,R){var O=new Date();var N=O.toLocaleDateString();O=Math.floor(O.valueOf()/1000);var X="",ab=U.split("/");var S=ab.pop();if(Q){ab.pop();X=ab.join("/")}var T=c["/"+ah+"/config.json"];var Y=U+"/$index.txt";var V=U+"/$abstract.txt";var ad=U+"/index.html";var ac=function(aj){if(typeof R=="function"){R(aj)}};var ae=function(){if(Q){M.wdProjList.r.addSubPrjNode(ah,[X,[S,false]]);M.hideDlg();ac()}else{var ak=P.doc_list;var an={path:U,title:S,keyword:"",desc:"",thumb:"",flag:256+3,create_at:O,modify_at:O};for(var am=0,aj;aj=ak[am];am++){if(U<aj.path){ak.splice(am,0,an);an=null;break}}if(an){ak.push(an)}var ao=3,al=1;M.wdProjList.r.addPrjNode([ah,U,O,ao,0,al,"public",0,0]);M.hideDlg();$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ah+"/contents/config.json?access_token="+v,data:JSON.stringify({path:"config.json",message:N,sha:T,content:Gh3.Base64.encode(JSON.stringify(P)),branch:"gh-pages"}),success:function(ap){c["/"+ah+"/config.json"]=ap.content.sha;ac()},error:function(ap){c["/"+ah+"/config.json"]="";ac("Create project successful, but regist it failed, you can publish it later")}})}};var W=function(an,al){var aj="";if(al){var ak=al.getFileByName("index.html");if(ak){if(!confirm(ad+" already exists, do you want overwrite it?")){ae();return}aj=ak.sha}}var am={path:ad,message:N,content:Gh3.Base64.encode(an),branch:"gh-pages"};if(aj){am.sha=aj}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ah+"/contents/"+ad+"?access_token="+v,data:JSON.stringify(am),success:function(ao){setTimeout(function(){ae()},500)},error:function(ao){ac("Write ("+ad+") failed: "+g(ao,"message"))}})};var af=function(ao,am){var ak="";if(am){var al=am.getFileByName("$index.txt");if(al){if(!confirm(Y+" already exists, do you want overwrite it?")){W(ao,am);return}ak=al.sha}}var aj='COMPONENT_OF_PINP_SLIDE,2,<page/>\nCOMPONENT_OF_PINP_SLIDE,1,<div class="ebook-title" _zindex="1000" _config="default-large-small default-looser-impacted default-hidden" _left="-348" _top="-144" _width="680"><h1>Title Goes Here Up<br>To Two Lines</h1></div>\n<div class="p1-p2-p3-p0" _zindex="1000" _config="default-large-small default-looser-impacted p1-p2-p3-p0" _left="-344" _top="2" _width="500"><p>Your name<br>May 1, 2015</p></div>';var an={path:Y,message:N,content:Gh3.Base64.encode(aj),branch:"gh-pages"};if(ak){an.sha=ak}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ah+"/contents/"+Y+"?access_token="+v,data:JSON.stringify(an),success:function(ap){setTimeout(function(){W(ao,am)},500)},error:function(ap){ac("Write ("+Y+") failed: "+g(ap,"message"))}})};var aa=function(ao,am){var ak="";if(am){var al=am.getFileByName("$abstract.txt");if(al){af(ao,am);return;ak=al.sha}}var aj=S;if(aj.slice(-6)==".sshow"){aj=aj.slice(0,-6)}var an={path:V,message:N,content:Gh3.Base64.encode(aj),branch:"gh-pages"};if(ak){an.sha=ak}$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+ah+"/contents/"+V+"?access_token="+v,data:JSON.stringify(an),success:function(ap){setTimeout(function(){af(ao,am)},500)},error:function(ap){ac("Write ("+V+") failed: "+g(ap,"message"))}})};var Z=function(ak){var aj=new Gh3.Dir({path:U},C,ah,"gh-pages");aj.fetchContents(function(am,al){if(am){if(al.status==404){aa(ak,null);return}ac("List directory ("+U+") failed: "+g(al,"message"));return}aa(ak,aj)})};var ai=function(){$.ajax({type:"GET",url:"//"+C.login+".github.io/software/blogger10/slideshow.tmpl",dataType:"html",success:function(aj){Z(aj)},error:function(aj){ac("Read file failed: /software/blogger10/slideshow.tmpl")}})};if(!T){var ag=new Gh3.File({path:"config.json"},C,ah,"gh-pages");ag.fetchContent(function(ak,aj){if(ak){ac("Read config.json failed: "+g(aj,"message"));return}T=ag.sha;c["/"+ah+"/config.json"]=T;ai()})}else{ai()}};F.regist("createProject",function(aa){var R=(aa[0]||"").trim();var ac=(aa[1]||"").trim();var X=(aa[2]?1:2);var Z=aa[4]||0;var S=(aa[3]||"").trim();if(!S){alert("Project name can not empty!");return}else{if(H('?*|:"<>\\/',S)){alert('Project name can not contains: ? * | : " < > \\ /');return}}if(X==1&&S.slice(-5)!=".blog"){S+=".blog"}else{if(X==2&&S.slice(-6)!=".sshow"){S+=".sshow"}}if(ac&&ac[ac.length-1]=="/"){ac=ac.slice(0,-1)}if(R&&R[R.length-1]=="/"){R=R.slice(0,-1)}var P=R;if(ac){if(P){P+="/"+ac}else{P=ac}}var U=P.split("/");if(U.length<2){if(y){alert("Invalid 'repository/category' name")}else{alert("Category name lost")}return}var N=null,ae=U.shift();if(y){N=j(ae);if(!N){alert("Invalid repository name: "+ae);return}}else{if(ae!=M.data.login.alias){alert("Invalid alias name");return}}for(var Y=U.length-1;Y>=0;Y--){var ab=U[Y];if(!ab){alert("Invalid category name");return}if(H('?*|:"<>\\',ab)){alert('Category name can not contains: ? * | : " < > \\');return}var P=ab.slice(0,2);if(P!="$$"){if(P[0]=="$"){U[Y]="$"+ab}else{U[Y]="$$"+ab}}}ac=U.join("/");var V=ac+"/"+S;if(y){var T=_.find(N.doc_list,function(af){return af.path==V});if(T){alert("Error: project ("+V+") already exists");return}}var ad=false;var Q=M.wdToolbar.querySelector('img[name="CreatePrj"]');Q.src="loading.gif";setTimeout(function(){if(!ad){ad=true;Q.src="prj_add.png"}},20000);var O=function(){if(!ad){ad=true;Q.src="prj_add.png"}alert("Add project successful")};var W=function(af){if(!ad){ad=true;Q.src="prj_add.png"}alert(af)};if(y){if(X==1){J(N,ae,V,false,function(af){if(af){W(af)}else{O()}})}else{I(N,ae,V,false,function(af){if(af){W(af)}else{O()}})}return}});F.regist("createSubProject",function(S){var P=(S[0]||"").trim();var O=(S[1]?1:2);var Y=(S[2]||"").trim();if(!Y){alert("Project name can not empty!");return}else{if(H('?*|:"<>\\/',Y)){alert('Project name can not contains: ? * | : " < > \\ /');return}}if(O==1&&Y.slice(-5)!=".blog"){Y+=".blog"}else{if(O==2&&Y.slice(-6)!=".sshow"){Y+=".sshow"}}var R=P.indexOf("/");if(R<=0){alert("Invalid project owner name");return}var T=P.slice(0,R),aa=P.slice(R+1);var U=null;if(y){U=j(T);if(!U){alert("Invalid repository name: "+T);return}var Z=_.find(U.doc_list,function(ab){return ab.path==aa});if(!Z){alert("Error: project ("+aa+") inexistent");return}}var V=false;var Q=M.wdToolbar.querySelector('img[name="CreateSubPrj"]');Q.src="loading.gif";setTimeout(function(){if(!V){V=true;Q.src="prj_addsub.png"}},20000);var N=function(){if(!V){V=true;Q.src="prj_addsub.png"}alert("Add sub-project successful")};var X=function(ab){if(!V){V=true;Q.src="prj_addsub.png"}alert(ab)};if(y){if(O==1){var W=aa+"/$$/"+Y;J(U,T,W,true,function(ab){if(ab){X(ab)}else{N()}})}else{var W=aa+"/$$/"+Y;I(U,T,W,true,function(ab){if(ab){X(ab)}else{N()}})}return}});F.regist("removeProject",function(af){var ab=af.shift(),ai=false;var ae=(af[0]||"").trim(),V=[],Z=af.length;if(!ae){return}for(var ac=1;ac<Z;ac++){var ah=af[ac];V.push(ah);if(ac==1&&ah){if(ab){ai=true}break}if(ac>1&&ah==ab){ai=true}}if(V.length==1&&!V[0]){alert("No project selected, nothing removed!");M.hideDlg();return}else{if(!confirm("Do you want remove selected project?")){return}}var R=ae.indexOf("/");if(R<=0){return}var al=ae.slice(0,R),W=ae.slice(R+1);var ak=false;var S=M.wdToolbar.querySelector('img[name="RemovePrj"]');S.src="loading.gif";setTimeout(function(){if(!ak){ak=true;S.src="prj_rmv.png"}},20000);var Q=function(){if(!ak){ak=true;S.src="prj_rmv.png"}alert("Remove project successful");if(ai){M.wdMarkdown.r.cancelEditing()}};var X=function(am){if(!ak){ak=true;S.src="prj_rmv.png"}alert(am)};if(y){var ad=null,ag=j(al);if(!ag){alert("System error: can not find repository");return}ad=_.find(ag.doc_list,function(am){return am.path==W});if(!ad){alert("System error: can not find document: "+W);return}var O=new Date();var N=O.toLocaleDateString();O=Math.floor(O.valueOf()/1000);var U=c["/"+al+"/config.json"];var Y=!!V[0],T=[];if(Y){T.push(W)}else{for(var ac=1,ah;ah=V[ac];ac++){T.push(W+"/$$/"+ah)}}var aa=null;var P=function(am){aa=null;if(am){X(am);return}M.wdProjList.r.rmvPrjNode(ae,V,[]);M.hideDlg();if(!Y){Q()}else{var an=ag.doc_list.indexOf(ad);if(an<0){Q();return}ag.doc_list.splice(an,1);$.ajax({type:"PUT",url:"https://api.github.com/repos/"+C.login+"/"+al+"/contents/config.json?access_token="+v,data:JSON.stringify({path:"config.json",message:N,content:Gh3.Base64.encode(JSON.stringify(ag)),sha:U,branch:"gh-pages"}),success:function(ao){c["/"+al+"/config.json"]=ao.content.sha;Q()},error:function(ao){c["/"+al+"/config.json"]="";X("Save config.json failed: "+g(ao,"message"))}})}};aa=function(){var am=false,aq=0,au=0,at=0,aw=0;var ao=false;var ap=function(){if(ao){return}ao=true;if(am||aw){P("Delete project failed (some files not removed), please try again!")}else{P("")}};var ar=function(ax,ay){$.ajax({type:"DELETE",url:"https://api.github.com/repos/"+C.login+"/"+al+"/contents/"+ax+"?access_token="+v,data:JSON.stringify({path:ax,message:N,sha:ay,branch:"gh-pages"}),success:function(az){at+=1;if(at+aw>=aq){ap()}},error:function(az){aw+=1;if(at+aw>=aq){ap()}}})};var an=function(ax,ay){au+=1;ax.fetchContents(function(aC,aA){if(aC){if(aA.status!=404){am=true}ay();return}var az=[],aD=[],aE=0;ax.eachContent(function(aF){if(aF.type=="file"){aE+=1;az.push([aF.path,aF.sha])}else{if(aF.type=="dir"){aE+=1;aD.push(aF)}}});if(aE){aq+=az.length;var aB=function(){var aF=aD.pop();if(aF){an(aF,aB)}else{aF=az.pop();if(aF){setTimeout(function(){ar(aF[0],aF[1]);aB()},500)}else{ay()}}};aB()}else{ay()}})};var av=function(){var ax=T.shift();if(ax){an(new Gh3.Dir({path:ax},C,al,"gh-pages"),av)}else{if(aq==0){ap()}}};av()};if(!U){var aj=new Gh3.File({path:"config.json"},C,al,"gh-pages");aj.fetchContent(function(an,am){if(an){X("Read config.json failed: "+g(am,"message"));return}U=aj.sha;c["/"+al+"/config.json"]=U;aa()})}else{aa()}return}});F.regist("editPrepost",function(N){M.editPrepost(N[0],N[1],N[2])});F.regist("savePrepost",function(N){M.wdMarkdown.r.postSlideMsg("savePrepost",N);M.hideDlg()});F.regist("editSlideTxt",function(N){if(!M.data.finished){alert("System error: previous task not finished yet!");M.hideDlg();return}M.editSlideTxt(N[0],N[1])});F.regist("saveSlideTxt",function(N){M.wdMarkdown.r.postSlideMsg("saveSlideTxt",N);M.hideDlg()});F.regist("editTableData",function(N){M.editTableData(N[0],N[1],N[2],N[3],N[4],N[5])});F.regist("saveTableData",function(N){M.wdMarkdown.r.postSlideMsg("saveTableData",N);M.hideDlg()});F.regist("editShapeData",function(N){M.editShapeData(N[0],N[1],N[2],N[3],N[4],N[5])});F.regist("saveShapeData",function(N){M.wdMarkdown.r.postSlideMsg("saveShapeData",N);M.hideDlg()});F.regist("editPaperData",function(N){M.editPaperData(N[0],[N[1],N[2],N[3],N[4],N[5],N[6],N[7],N[8]])});window.updatePaperContent=function(N,P,O){M.wdResPanel.style.height="100%";M.wdPreviewArea.style.display="block";M.hideDlg();if(N){M.wdMarkdown.r.postSlideMsg("savePaperData",[P,O])}};window.copyToClipboard_=function(O,N,Q){var P=M.wdMarkdown.querySelector("iframe");if(P&&P.contentWindow.apiNode){P.contentWindow.apiNode.copyToClipboard(O,N,Q)}};window.textOfClipboard_=function(){var N=M.wdMarkdown.querySelector("iframe");if(N&&N.contentWindow.apiNode){return N.contentWindow.apiNode.textOfClipboard()}else{return""}};M.on("afterLogin",function(N){M.wdProjList.r.fire("refresh");setTimeout(function(){M.hideDlg();if(M.data.taskAtLogin){if(M.data.taskAtLogin=="submit"&&M.wdMarkdown.r.data.currProj){M.wdMarkdown.r.startSubmitDoc()}M.data.taskAtLogin=""}},1500)})},showDlg:function(G){var J=function(Q,P){if(Q<1){if(Q<0){return 0}else{if(Q<0.9999){return Math.floor(Q*P+0.5)}else{return P}}}else{return Math.floor(Q+0.5)}};var F=G.url;if(!F&&(G.bodyHtml||G.jsScript)){F="/software/pages/simple_dialog.html"}if(!F){return}var L=J(G.left||0,window.innerWidth);var K=J(G.top||0,window.innerHeight);var M=J(G.width||0.9999,window.innerWidth);var I=J(G.height||0.9999,window.innerHeight);var H=this.wdToolbar.parentNode.clientHeight+Math.max(this.wdProjList.clientHeight,this.wdMarkdown.parentNode.clientHeight+this.wdPreviewArea.clientHeight);this.wdInfoMask.style.width=window.innerWidth+"px";this.wdInfoMask.style.height=Math.max(window.innerHeight,H)+"px";this.wdInfoMask.style.display="block";this.wd.style.left=L+"px";this.wd.style.top=K+"px";this.wd.style.width=M+"px";this.wd.style.height=I+"px";this.wd.style.display="block";var E=this.wd.querySelector("div.dlg-loading");E.style.display="block";var O=this,N=this.wd.querySelector("iframe");N.onload=function(Q){E.style.display="none";if(G.closable){O.data.finished=true}var P=function(){m.getDCF().call("wdPopDlgForm","initGui",[G.bodyHtml||"",G.jsScript||""],3000,function(R){if(G.onReady){G.onReady()}},function(R){alert("System error")})};if(G.peerName||G.bodyHtml||G.jsScript){if(G.peerName){m.getDCF().setPeerName("wdPopDlgForm",G.peerName,3000,function(R){if(R.state=="OK"){if(G.bodyHtml||G.jsScript){P()}else{if(G.onReady){G.onReady()}}}else{alert("System error")}})}else{if(G.bodyHtml||G.jsScript){P()}else{if(G.onReady){G.onReady()}}}}else{if(G.onReady){G.onReady()}}};this.data.finished=false;this.refreshUrl(F)},hideDlg:function(){this.wdInfoMask.style.display="none";this.wd.style.display="none"},tryHideDlg:function(){if(this.data.finished){this.wdInfoMask.style.display="none";this.wd.style.display="none";return true}return false},checkLogin:function(F,E){if(!F&&this.data.login.hasLogin&&this.data.login.failCount==0){return}if(E){this.data.taskAtLogin=E}this.showDlg({left:Math.floor(window.innerWidth/2-310),top:Math.floor(window.innerHeight/2-180),width:620,height:360,url:"//"+PINP_HOST_DOMAIN+"/admin/writer/relay?check=1",closable:false})},startShareDoc:function(){var J="",G=true,H=this.wdProjList.querySelector(".prj-item.prj-selected2");if(H&&(H.classList.contains("prj-sub-item")||H.classList.contains("prj-curr-item"))){J=H.getAttribute("title");var L=H.getAttribute("name");if(L&&L.indexOf("prj-")==0){var N=this.wdProjList.r.data.items[parseInt(L.slice(4))];if(N){G=N.canWrite}}}if(!J){alert("Please select a project first!");return false}if(!G){alert("Can not share this project: not online document");return false}if(J==this.wdMarkdown.r.data.currProj&&this.wdMarkdown.r.data.changed){if(!confirm("The project still in editing, do you want continue?")){return false}}var K=J.indexOf("/");if(K<=0){return}var M=J.slice(0,K),P=J.slice(K+1);var E=H.getAttribute("allow")||"private";var O=y?[]:this.wdProjList.r.data.friendGroup;var Q=this;var I=function(Z,aa,W,R,X,T){var V='var gitSha = "'+(X||"")+"\";\nvar gitCfgLine = '"+T.replace(/'/gm,"\\'")+"';\nvar initAclIndex = "+(E=="public"?"0":(E=="protected"?"1":"2"))+';\nvar inputTitle = "'+Z+'";\nvar inputDesc = "'+aa+'";\nvar inputKeyword = "'+W+'";\nfunction location__(href) {\n  var location = document.createElement("a");\n  location.href = href;\n  if (location.host == "")\n    location.href = location.href;\n  return location;\n}\nfunction applySharePrj() {\n  var sPath = "'+J+'";\n  var frm = document.querySelector("form");\n  var iAcl=0, iGroup=0;\n  if (frm.prjAcl) {\n    iAcl = frm.prjAcl[0].checked?0:(frm.prjAcl[1].checked?1:2);\n    var iGroup = 0; for (var i=0,item; item=frm.aclGroup[i]; i++) {\n      if (item.checked) {iGroup = i; break;}\n    }\n  }\n  var sTitle = frm.prjTitle.value.trim().slice(0,160);\n  var sDesc = frm.prjDesc.value.trim().slice(0,256);\n  var sKeyword = frm.prjKeyword.value.trim().slice(0,160);\n  sTitle = sTitle.replace(/"/gm,""); sDesc = sDesc.replace(/"/gm,""); sKeyword = sKeyword.replace(/"/gm,"");\n  var sThumb = frm.prjThumb.value.trim();\n  if (sThumb && frm.prjAcl) sThumb = location__(sThumb).href;\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","shareProject",[iAcl,iGroup,sPath,sTitle,sDesc,sKeyword,sThumb,gitSha,gitCfgLine]);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}\nfunction checkAcl() {\n  document.getElementById("btn-apy").disabled = false;\n  var frm = document.querySelector("form");\n  var isReadonly = !frm.prjAcl[2].checked;\n  document.getElementById("acl-group").style.color = isReadonly?"#ccc":"black";\n  for (var i=0,item; item=frm.aclGroup[i]; i++) {\n    item.disabled = isReadonly;\n  }\n}\nfunction initInputData(i) {\n  var frm = document.querySelector("form");\n  frm.prjTitle.value = inputTitle;\n  frm.prjDesc.value = inputDesc;\n  frm.prjKeyword.value = inputKeyword;\n  if (frm.prjAcl) {\n    frm.prjAcl[i].setAttribute("checked","checked");\n    checkAcl();\n  }\n}\ninitInputData(initAclIndex);';var Y='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Share project</div><div style="width:100; height:28px"></div>\n';Y+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(J)+"</p>\n<form>\n";if(!y){Y+='<p>Project type<br><input type="radio" name="prjAcl" onclick="checkAcl()" checked>public&nbsp;&nbsp;&nbsp;<input type="radio" name="prjAcl" onclick="checkAcl()">protected&nbsp;&nbsp;&nbsp;<input type="radio" name="prjAcl" onclick="checkAcl()">private</p>\n';Y+='<div id="acl-group">&nbsp;&nbsp;&nbsp;<input type="radio" name="aclGroup" onclick="cfgModified(event)" checked>Only for myself\n';for(var U=0,ab;ab=O[U];U++){Y+='<br>&nbsp;&nbsp;&nbsp;<input type="radio" name="aclGroup" onclick="cfgModified(event)">'+a(ab)+"\n"}Y+="</div>\n"}Y+='<p>Document title<br><input name="prjTitle" type="text" style="width:340px" onchange="cfgModified(event)"><br>\n';Y+='Description <span style="font-size:14px; color:gray">(within 140 characters)</span><br><textarea name="prjDesc" style="width:340px; height:70px" onchange="cfgModified(event)"></textarea><br>\n';Y+='Document Keyword<br><input name="prjKeyword" type="text" placeholder="keyword1,keyword2,..." style="width:340px" onchange="cfgModified(event)"><br>';Y+='Thumbnail picture <span style="font-size:14px; color:gray">(input image URL)</span><br><input name="prjThumb" type="text" style="width:340px" value="'+R+'" onchange="cfgModified(event)"></p>\n';Y+='</form>\n<p><button id="btn-apy" onclick="applySharePrj()">Apply</button></p>';var S=O.length<=4?540:(O.length<=8?580:620);if(y){S-=80}Q.showDlg({left:Math.floor((window.innerWidth-400)/2),top:Math.floor((window.innerHeight-S)/2),width:400,height:S,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:Y,jsScript:V})};if(y){var F=new Gh3.File({path:P+"/$abstract.txt"},C,M,"gh-pages");F.fetchContent(function(S,Y){var aa="",ab="",W="",X="",R="",T="";var V=j(M);var ac=_.find(V.doc_list,function(ad){return ad.path==P});if(ac){R=ac.thumb||""}if(R.slice(0,2)=="$$"){R="/"+M+"/"+R}if(!S){X=F.sha;var U=F.getRawContent();if(U&&U.charCodeAt(0)==65279){U=U.slice(1)}var Z=U.split("\n");aa=(Z[0]||"").trim().replace(/"/gm,"");ab=(Z[1]||"").trim().replace(/"/gm,"");W=(Z[2]||"").trim().replace(/"/gm,"");T=(Z[3]||"").trim();if(W&&W[0]=="<"&&W[W.length-1]==">"){W=W.slice(1,-1)}}I(aa,ab,W,R,X,T)});return}},createPrj:function(){var H="",G=this.wdProjList.querySelector(".prj-item.prj-selected2");if(G&&(G.classList.contains("prj-sub-item")||G.classList.contains("prj-curr-item"))){H=G.getAttribute("title")||""}else{G=this.wdProjList.querySelector(".prj-item.prj-selected");if(G&&G.classList.contains("prj-cate-folder")){H=G.getAttribute("title")||""}else{if(y){H=""}else{H=this.data.login.alias+"/"+this.wdProjList.r.data.currCate}}}if(!y&&!H){return false}var L=H.split("/");if(L.length>1){L.pop()}var E=false,J=true;if(y){if(!H){E=true}else{if(L.length>=2){J=false}}}else{if(L.length>=2){J=false}}var K=L.join("/");var I='function applyCreatePrj() {\n  var sOwner = "'+K+'";\n  var frm = document.querySelector("form");\n  var sCate = frm.prjPath.value.trim();\n  var iFlag = 0; if (frm.prjShare) iFlag = frm.prjShare[0].checked?0:(frm.prjShare[1].checked?1:2);\n  var bArgs = [sOwner,sCate,frm.prjType[0].checked,frm.prjName.value,iFlag];\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","createProject",bArgs);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var M='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Create project</div><div style="width:100; height:28px"></div>\n';if(K){M+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(K+"/")+"</p>\n"}M+='<form><p>Project type<br><input type="radio" name="prjType" onclick="cfgModified(event)" checked>blog&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="prjType" onclick="cfgModified(event)">slideshow</p>\n';if(!y){M+='<p>Sharing<br><input type="radio" name="prjShare" onclick="cfgModified(event)"><span title="for all visitor">public</span>&nbsp;&nbsp;<input type="radio" name="prjShare" onclick="cfgModified(event)"><span title="for all logined visitor">protected</span>&nbsp;&nbsp;<input type="radio" name="prjShare" onclick="cfgModified(event)" checked><span title="only for yourself">private</span></p>\n'}M+='<p>Category <span style="font-size:14px; color:gray">(';if(E){M+="repository/category"}else{if(J){M+="category"}else{M+="category or leave it empty"}}M+=')</span><br><input name="prjPath" type="text" style="width:340px" value="" onchange="cfgModified(event)"></p>\n';M+='<p>Project name<br><input type="text" name="prjName" style="width:340px" value="" onchange="cfgModified(event)"></p></form>\n';M+='<p><button id="btn-apy" onclick="applyCreatePrj()">Apply</button></p>';var F=380;if(y){F-=36}this.showDlg({left:Math.floor((window.innerWidth-420)/2),top:Math.floor((window.innerHeight-F)/2),width:420,height:F,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:M,jsScript:I});return true},createSubPrj:function(){var E="",F=this.wdProjList.querySelector(".prj-item.prj-selected2");if(F&&(F.classList.contains("prj-sub-item")||F.classList.contains("prj-curr-item"))){E=F.getAttribute("title")}if(!E){alert("Please select a project first!");return false}var H='function applyCreatePrj() {\n  var frm = document.querySelector("form");\n  var bArgs = ["'+E+'",frm.prjType[0].checked,frm.prjName.value];\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","createSubProject",bArgs);\n}\nfunction cfgModified(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var G='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Create sub-project</div><div style="width:100; height:28px"></div>\n';G+='<p style="font-size:14px; word-break:break-all; color:gray">Owner: '+a(E)+"</p>\n";G+='<form><p>Project type<br><input type="radio" name="prjType" onclick="cfgModified(event)" checked>blog&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="prjType" onclick="cfgModified(event)">slideshow</p>\n';G+='<p>Project name<br><input type="text" name="prjName" style="width:340px" value="" onchange="cfgModified(event)"></p></form>\n';G+='<p><button id="btn-apy" onclick="applyCreatePrj()">Apply</button></p>';this.showDlg({left:Math.floor((window.innerWidth-420)/2),top:Math.floor((window.innerHeight-290)/2),width:420,height:290,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:G,jsScript:H});return true},removePrj:function(){var H="",L=[],G=this.wdProjList.querySelector(".prj-item.prj-selected2");if(G&&(G.classList.contains("prj-sub-item")||G.classList.contains("prj-curr-item"))){H=G.getAttribute("title");if(H){var I=G.nextElementSibling;while(I&&I.classList.contains("prj-sub2-item")){var P=I.getAttribute("title");if(P&&P.indexOf(H)==0){var M=P.split("/");L.push(M[M.length-1])}I=I.nextElementSibling}}}if(!H){return false}var E=this.wdMarkdown.r.prjInEditing(H);if(E){var Q=E=="*"?"Selected project current in editing,":"One of sub-project in editing,";if(!confirm(Q+" continue to remove?")){return false}}var K='var editingFlag = "'+E+'";\nfunction applyRemovePrj() {\n  var bArgs=[editingFlag], nodes=document.querySelectorAll("input[_name]");\n  for (var i=0,node; node=nodes[i]; i++) {\n    var sName = node.getAttribute("_name");\n    if (i == 0) {\n      bArgs.push(sName);\n      if (node.checked) { bArgs.push("*"); break; }\n      else bArgs.push("");\n    } else {\n      if (node.checked) bArgs.push(sName);\n    }\n  }\n  document.getElementById("btn-apy").disabled = true;\n  DCF.call("parent","removeProject",bArgs);\n}\nfunction rootChanged(event,rootNode) {\n  var bRet=[], nodes = document.querySelectorAll("input[_sub]");\n  for (var i=0,item; item=nodes[i]; i++) {\n    if (rootNode.checked && !item.checked) item.checked = true;\n    item.disabled = rootNode.checked? true: false;\n  }\n  document.getElementById("btn-apy").disabled = false;\n}\nfunction subChanged(event) {\n  document.getElementById("btn-apy").disabled = false;\n}';var N='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Remove project</div><div style="width:100; height:28px"></div>\n';N+='<p style="font-size:14px; word-break:break-all; color:gray">Project: '+a(H)+"</p>\n";N+='<p><input _name="'+H+'" type="checkbox" onclick="rootChanged(event,this)">Whole project<br>\n';for(var J=0,O;O=L[J];J++){N+='&nbsp;&nbsp;<input _sub="true" _name="'+O+'" type="checkbox" onclick="subChanged(event)">'+a(O)+"<br>\n"}N+="</p>";N+='<p><button id="btn-apy" onclick="applyRemovePrj()">Apply</button></p>';var F=(L.length>=10?400:(L.length>=2?320:250));this.showDlg({left:Math.floor((window.innerWidth-400)/2),top:Math.floor((window.innerHeight-F)/2),width:400,height:F,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:N,jsScript:K});return true},addDropPrjFrame:function(F,O,H){var K=H.split("/"),M=K[K.length-1];var G,J=this.wdMarkdown.r.data.currProj;if(J&&H.indexOf(J+"/")==0){G=H.slice(J.length+1)+"/"}else{G="/"+H+"/"}var I='var sPrjUrl = "'+G+'";\nvar sBareName = "'+M+'";\nvar sThumb = "'+F+'";\nvar sPrjFlag = "'+O+'";\nfunction lnkTypeChanged() {\n  var frm = document.querySelector("form");\n  var nd = document.getElementById("prj-wdhi");\n  var nodes = nd.querySelectorAll("input");\n  if (!frm.lnkType[0].checked) {\n    nd.style.color = "#222";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.removeAttribute("readonly");\n      item.style.backgroundColor = "#fff";\n    }\n  } else {\n    nd.style.color = "#ccc";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.setAttribute("readonly","readonly");\n      item.style.backgroundColor = "#ccc";\n    }\n  }\n}\nfunction applyInsertLnk(event) {\n  event.preventDefault(); event.stopPropagation();\n  var sOut="", frm=document.querySelector("form");\n  if (frm.lnkType[0].checked) {\n    if (sThumb)\n      sOut = \'<a target="_blank" href="\' + sPrjUrl + \'">\' + \'<img alt="\' + sBareName + \'" src="\' + sThumb + \'"></a>\';\n    else sOut = "[" + sBareName + "](" + sPrjUrl + ")";\n  } else {\n    var sWd = document.getElementById("input-wd").value.trim().replace(/px/gi,"") || "100%";\n    var sHi = document.getElementById("input-hi").value.trim().replace(/px/gi,"") || "300";\n    var pgNode = document.getElementById("input-pg");\n    var sPage = (pgNode? pgNode.value.trim(): "");\n    if (pgNode) sPrjUrl += "?size=0x0";\n    if (sPage) sPrjUrl += "#" + sPage;\n    sOut = \'<iframe frameborder="0" border="0" width="\' + sWd + \'" height="\' + sHi + \'" src="\' + sPrjUrl + \'"></iframe>\';\n  }\n  DCF.call("parent","dropTextInfo",[sOut]);\n}\n';var E=false;var L='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Insert project linker</div><div style="width:100; height:28px"></div>\n';L+='<p style="font-size:14px; word-break:break-all; color:gray">Project: '+a(H)+"</p>\n";L+='<form><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()" checked>insert a linker</p><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()">embed a frame</p>\n';L+='<div id="prj-wdhi" style="color:#ccc; margin-left:20px; margin-top:-8px">Width <span style="font-size:14px; color:gray">(percent or pixes)</span><br><input id="input-wd" type="text" style="background-color:#ccc; width:220px" value="100%" readonly>\n';L+='<br>Height <span style="font-size:14px; color:gray">(percent or pixes)</span><br><input id="input-hi" type="text" style="background-color:#ccc; width:220px" value="300" readonly>\n';if(O=="1"||O=="2"||H.slice(H.length-6)==".sshow"){E=true;L+='<br>Show page <span style="font-size:14px; color:gray">(page number)</span><br><input id="input-pg" type="text" style="background-color:#ccc; width:220px" value="1" readonly>\n'}L+='</div></form><p>&nbsp;<button onclick="applyInsertLnk(event)">Apply</button></p>\n';var N=(E?356:310);this.showDlg({left:Math.floor((window.innerWidth-340)/2),top:Math.floor((window.innerHeight-N)/2),width:340,height:N,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:L,jsScript:I})},addDropImgFrame:function(H,G,I){I=D(I).pathname;if(I[0]!="/"){I="/"+I}var E=I.split("/"),L=E[E.length-1];var F=this.wdMarkdown.r.data.currProj;if(F&&I.indexOf("/"+F+"/")==0){I=I.slice(F.length+2)}var K='var sImgUrl = "'+I+'";\nvar sImgBare = "'+L+'";\nvar sNatureWd = "'+H+'";\nvar sNatureHi = "'+G+'";\nfunction lnkTypeChanged() {\n  var frm = document.querySelector("form");\n  var nd = document.getElementById("img-wdhi");\n  var nodes = nd.querySelectorAll("input");\n  if (!frm.lnkType[0].checked) {\n    nd.style.color = "#222";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.removeAttribute("readonly");\n      item.style.backgroundColor = "#fff";\n    }\n  } else {\n    nd.style.color = "#ccc";\n    for (var i=0,item; item=nodes[i]; i++) {\n      item.setAttribute("readonly","readonly");\n      item.style.backgroundColor = "#ccc";\n    }\n  }\n}\nfunction applyInsertLnk(event) {\n  event.preventDefault(); event.stopPropagation();\n  var sOut="", frm=document.querySelector("form");\n  if (frm.lnkType[0].checked) {\n    sOut = \'<a target="_blank" href="\' + sImgUrl + \'">\' + sImgBare + \'</a>\';\n  } else {\n    var sWd = document.getElementById("input-wd").value.trim().replace(/px/gi,"");\n    var sHi = document.getElementById("input-hi").value.trim().replace(/px/gi,"");\n    if (!sWd || sWd == sNatureWd) {\n      if (!sHi || sHi == sNatureHi)\n        sOut = "![" + sImgBare + "](" + sImgUrl + ")";\n      else {\n        sHi += (sHi.indexOf("%") > 0? "": "px");\n        sOut = \'<img style="width:\' + sNatureWd + \'px; height:\' + sHi + \'" src="\' + sImgUrl + \'">\';\n      }\n    } else {\n      sWd += (sWd.indexOf("%") > 0? "": "px");\n      if (!sHi)\n        sOut = \'<img style="width:\' + sWd + \'" src="\' + sImgUrl + \'">\';\n      else {\n        sHi += (sHi.indexOf("%") > 0? "": "px");\n        sOut = \'<img style="width:\' + sWd + \'; height:\' + sHi + \'" src="\' + sImgUrl + \'">\';\n      }\n    }\n  }\n  DCF.call("parent","dropTextInfo",[sOut]);\n}\n';var J='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Insert image</div><div style="width:100; height:28px"></div>\n';J+='<p style="font-size:14px; word-break:break-all; color:gray">File: '+a(L)+"</p>\n";J+='<form><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()">insert a linker</p><p><input type="radio" name="lnkType" onclick="lnkTypeChanged()" checked>embed an image</p>\n';J+='<div id="img-wdhi" style="color:#222; margin-left:20px; margin-top:-8px">Width <span style="font-size:14px; color:gray">(percent, pixes or leave it blank)</span><br><input id="input-wd" type="text" style="background-color:#fff; width:270px" value="'+H+'"><br>\n';J+='Height <span style="font-size:14px; color:gray">(percent, pixes or leave it blank)</span><br><input id="input-hi" type="text" style="background-color:#fff; width:270px" value="'+G+'"></div>\n';J+='</form><p>&nbsp;<button onclick="applyInsertLnk(event)">Apply</button></p>\n';this.showDlg({left:Math.floor((window.innerWidth-360)/2),top:Math.floor((window.innerHeight-320)/2),width:360,height:320,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:J,jsScript:K})},editPrepost:function(H,G,F){var E=Math.floor(window.innerHeight*0.99);this.showDlg({left:Math.floor((window.innerWidth-700)/2),top:Math.floor((window.innerHeight-E)/2),width:700,height:E,url:"prepost_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){m.getDCF().call("wdPopDlgForm","initPrePost",[H,G,F])}})},editSlideTxt:function(I,F){var G=Math.floor(window.innerWidth*0.8);var E=Math.floor(window.innerHeight*0.8);var J="var iEditNodeId = "+I+';\nfunction finishEditing() {\n  var txtNode = document.querySelector("textarea");\n  var bArgs = [iEditNodeId,txtNode.value];\n  DCF.call("parent","saveSlideTxt",bArgs);\n}\ndocument.querySelector("textarea").value = '+JSON.stringify(F)+";";var H='<div style="position:absolute; left:0px; top:0px; width:100%; height:28px; font-size:16px; background-color:#408080; color:white; text-align:center; line-height:28px; font-weight:600; cursor:default">Plain text editor</div><div style="width:100; height:28px"></div>\n';H+='<textarea style="width:'+(G-24)+"px; height:"+(E-110)+'px; resize:none"></textarea>\n';H+='<p><button onclick="finishEditing()">Apply</button></p>';this.showDlg({left:Math.floor((window.innerWidth-G)/2),top:Math.floor((window.innerHeight-E)/2),width:G,height:E,url:"/software/pages/simple_dialog.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:H,jsScript:J})},editTableData:function(L,E,K,H,J,G){var I=Math.floor(window.innerWidth*0.9);var F=Math.floor(window.innerHeight*0.9);this.showDlg({left:Math.floor((window.innerWidth-I)/2),top:Math.floor((window.innerHeight-F)/2),width:I,height:F,url:"table_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){m.getDCF().call("wdPopDlgForm","initTableData",[L,E,K,H,J,G])}})},editShapeData:function(L,G,I,E,J,K){var H=Math.floor(window.innerWidth*0.8);var F=Math.floor(window.innerHeight*0.9);this.showDlg({left:Math.floor((window.innerWidth-H)/2),top:Math.floor((window.innerHeight-F)/2),width:H,height:F,url:"pinp_shape_editor.html",closable:true,peerName:"wdPopDlgForm",bodyHtml:"",jsScript:"",onReady:function(){m.getDCF().call("wdPopDlgForm","initMask",[L,G,I,E,J,K])}})},setPopupRightWd:function(E){if(this.wdInfoMask.style.display!="none"){var F=(window.innerWidth-E)+"px";this.wdInfoMask.style.width=F;this.wd.style.width=F}},editPaperData:function(J,I){var K=this.wdMarkdown.r.data.currProj;if(!K){return}var F="/"+K+"/";var H=window.innerWidth-300;var G=window.innerHeight;var E=this;this.showDlg({left:0,top:0,width:H,height:G,url:F+"?editing=1&paper=1",closable:false,peerName:"",bodyHtml:"",jsScript:"",onReady:function(){var L=E.wd.querySelector("iframe");if(L){L.contentWindow.setEditingNode(J,F);L.contentWindow.initPaper(I);E.wdPreviewArea.style.display="none";E.wdResPanel.style.height=(window.innerHeight-E.wdToolbar.clientHeight-8)+"px";E.setPopupRightWd(300)}}})}};return{Toolbar:d,ProjList:z,SplitterA:q,Markdown:x,ResPanel:o,PreviewArea:A,PopDlgForm:n}});