(function(){if(typeof window.HTMLElement!=="undefined"){HTMLElement.prototype.toId=function(){return this}}else{if(typeof window.Element!=="undefined"){Element.prototype.toId=function(){return this}}}function getCookie__(name){if(document.cookie.length>0){var iEnd,iStart=document.cookie.indexOf(name+"=");if(iStart!=-1){iStart=iStart+name.length+1;iEnd=document.cookie.indexOf(";",iStart);if(iEnd==-1){iEnd=document.cookie.length}return unescape(document.cookie.substring(iStart,iEnd))}}return""}function setCookie__(name,value,expireDays,path){expireDays=expireDays||1;var exDate=new Date();exDate.setTime(exDate.getTime()+expireDays*24*60*60*1000);path=path||"/";document.cookie=name+"="+escape(value)+";expires="+exDate.toGMTString()+";path="+path+";"}function delCookie__(name,path){if(document.cookie.length>0){var iStart=document.cookie.indexOf(name+"=");if(iStart!=-1){var exp=new Date();exp.setTime(exp.getTime()-1);path=path||"/";document.cookie=name+"=;expires="+exp.toGMTString()+";path="+path+";"}}}function location__(href){var location=document.createElement("a");location.href=href;if(location.host==""){location.href=location.href}return location}var WEBMAKER_RELEASED=false;var WEBMAKER_GROUP_ID="0";var SOFTWARE_PRJ_NAME="webmaker10";var WEB_BODY_LEFT=0;var WEB_BODY_TOP=0;var beenReadonly_=true;var holderNode_=null;var resizerNode_=null;var bodyNode_=null;var sWebPageId_="0";var bWebPageId_=[];var lastModifyPageId="";var lastModifyTime=new Date();function preNewPageId(){var id=0;for(var i=bWebPageId_.length-1;i>=0;i--){var n=parseInt(bWebPageId_[i]||"0");if(n>id){id=n}}return(id+1)+""}function isWebMakerReadonly(){if(window.WEBMAKER_RELEASED||window.inPreview__){return true}if(window.location.search){var cfg={},sSearch=window.location.search.slice(1);var b=sSearch.split("&");for(var i=b.length-1;i>=0;i--){var item=b[i];if(!item){continue}var b2=item.split("="),key=b2[0].trim();if(key){cfg[key]=b2[1]}}var isPreview=parseInt(cfg.preview||"1");if(!isPreview){window.sharedPipe__=decodeURIComponent(cfg.pipe||"");window.sharedHash__=decodeURIComponent(cfg.hash||"");window.inPreview__=0}}if(!window.sharedPipe__||!window.sharedHash__){return true}return false}function setPageModified_(){lastModifyPageId=sWebPageId_;lastModifyTime=new Date()}function getSelectedPanel(auto){if(auto){var node=document.querySelector("div.web-panel > div.curr-design");if(node){if(node.classList.contains("web-panel")){return node}else{return node.parentNode}}}return document.querySelector("div.web-panel.curr-design")}function getCurrSelected(flag){if(flag==1){return document.querySelector("div.web-item.curr-design")}else{if(flag==2){return document.querySelector("div.web-panel.curr-design")}else{return document.querySelector("div.curr-design")}}}function GetOffset_(object,off){if(!object){return}off.x+=object.offsetLeft;off.y+=object.offsetTop;GetOffset_(object.offsetParent,off)}function GetScrolled_(object,scrolled){if(!object){return}scrolled.x+=object.scrollLeft;scrolled.y+=object.scrollTop;if(object.nodeName!="HTML"){GetScrolled_(object.parentNode,scrolled)}}var showHintCount_=0;function hideWidgetHint(){var node=document.getElementById("position-hint");if(node){node.style.display="none";node.innerHTML=""}}function hideWidgetHint_(){if(showHintCount_>1){showHintCount_-=1;return}showHintCount_=0;hideWidgetHint()}function getIntAttr_(node,sAttr,iDefault){var s=node.getAttribute(sAttr);if(s){var f=parseFloat(s);if(f>=1){return Math.floor(f)}}return iDefault}function showWidgetHint(wdNode,iTime){if(!wdNode){wdNode=getCurrSelected(0);if(!wdNode){return}}if(!wdNode.classList.contains("in-design")){return}var node=document.getElementById("position-hint");if(node){var x=getIntAttr_(wdNode,"_left",0)||Math.floor(wdNode.offsetLeft+0.5);var y=getIntAttr_(wdNode,"_top",0)||Math.floor(wdNode.offsetTop+0.5);var w=getIntAttr_(wdNode,"_width",0)||Math.floor(wdNode.clientWidth+0.5);var h=getIntAttr_(wdNode,"_height",0)||Math.floor(wdNode.clientHeight+0.5);var sWidget="";if(wdNode.classList.contains("web-item")){sWidget="web-item";var scpt=wdNode.querySelector('script[type="text/ractive"]');if(scpt){sWidget=scpt.getAttribute("_widget")||"";if(sWidget){var b=sWidget.split(".");sWidget=b[b.length-1]}}}else{if(wdNode.classList.contains("row-panel")){sWidget="row-panel"}else{if(wdNode.classList.contains("col-panel")){sWidget="col-panel"}else{if(wdNode.classList.contains("web-panel")){sWidget="web-panel"}}}}node.style.display="block";node.innerHTML=sWidget+" ("+x+", "+y+", "+w+", "+h+")"}if(iTime){showHintCount_+=1;setTimeout(hideWidgetHint_,iTime)}}function selectOneItem(node,byClick){if(beenReadonly_||!node){return}var nodes=document.querySelectorAll("div.curr-design");for(var i=0,item;item=nodes[i];i++){item.classList.remove("curr-design");var currLayer=item.style.zIndex;if(currLayer){currLayer=parseInt(currLayer);if(currLayer>=10000){item.style.zIndex=(currLayer-10000)+""}}}var off={x:0,y:0};GetOffset_(node,off);var x=off.x-WEB_BODY_LEFT,y=off.y-WEB_BODY_TOP;var isPanel=false,isRow=false,isCol=false;var iTop=y+node.clientHeight-10;if(node.classList.contains("web-panel")){isPanel=true;var owner=node.parentNode;if(owner.classList.contains("row-panel")){isRow=true}else{if(owner.classList.contains("col-panel")){isCol=true}}}else{if(!node.hasAttribute("_height")){iTop=y}}if(isPanel&&!isCol&&!isRow){holderNode_._current=null;holderNode_.style.display="none";resizerNode_.style.display="none"}else{holderNode_.style.left=x+"px";holderNode_.style.top=y+"px";resizerNode_.style.left=Math.floor(x+node.clientWidth-10+0.5)+"px";resizerNode_.style.top=Math.floor(iTop+0.5)+"px";if(iTop==y){resizerNode_.style.cursor="e-resize"}else{if(isPanel){if(isCol){resizerNode_.style.cursor="e-resize"}else{resizerNode_.style.cursor="n-resize"}}else{resizerNode_.style.cursor="se-resize"}}holderNode_.style.display="block";holderNode_._current=node;resizerNode_.style.display="block"}node.classList.add("curr-design");var currLayer=node.style.zIndex;if(currLayer){currLayer=parseInt(currLayer);if(currLayer>0&&currLayer<10000){node.style.zIndex=(10000+currLayer)+""}}if(byClick){showWidgetHint(node)}}function editContent_(node,ctrlKey,altKey){var hasEdit=false;if(!selectJustMoved_){var isItem=node.classList.contains("web-item");var scriptNode=null,commentNode=null;if(isItem){for(var i=0,item;item=node.childNodes[i];i++){if(item.nodeType==1&&item.nodeName=="SCRIPT"&&(item.getAttribute("type")||"").toLowerCase()=="text/ractive"){scriptNode=item}else{if(item.nodeType==8){commentNode=item}}}}if(isItem&&ctrlKey){if(scriptNode){var s=scriptNode.outerHTML;if(commentNode){s+="\n<!--"+commentNode.nodeValue+"-->"}apiNode.editContent(node.toId(),true,s,"","","")}else{apiNode.editContent(node.toId(),true,"","","","");hasEdit=true}}else{if(altKey){var sContent="",sWidget="",sSrc="";if(isItem&&commentNode){sContent=commentNode.nodeValue}if(isItem&&scriptNode){sWidget=scriptNode.getAttribute("_widget")||"";sSrc=scriptNode.getAttribute("_src")||""}var sCls=" "+node.className+" ";sCls=sCls.replace(" web-item "," ").replace(" web-panel "," ").replace(" row-panel "," ").replace(" col-panel "," ").replace(" absolute-pos "," ");sCls=sCls.replace(" in-design "," ").replace(" curr-design "," ").trim();apiNode.editContent(node.toId(),false,sContent,sWidget,sSrc,sCls);hasEdit=true}}}return hasEdit}function itemDivOnclick(event){var node=event._target||event.target;var waitEdit=event.ctrlKey||event.altKey;while(node){if(node.nodeName=="DIV"&&node.classList.contains("in-design")){break}else{node=node.parentNode}}if(!node){return}event.stopPropagation();if(!selectJustMoved_){var hasEdit=false;if(!beenReadonly_&&waitEdit&&!node.classList.contains("read-only")){hasEdit=editContent_(node,event.ctrlKey,event.altKey)}if(!hasEdit){selectOneItem(node,true)}apiNode.hideMenubar()}}function holderNodeOnclick(event){var node=getCurrSelected(0);if(node&&node.classList.contains("in-design")&&!beenReadonly_){event.stopPropagation();if(event.ctrlKey||event.altKey){editContent_(node,event.ctrlKey,event.altKey)}}apiNode.hideMenubar()}function itemDivOnMouseOn(event){if(!itemInMoving_&&!itemInResizing_){if(this.classList.contains("curr-design")){showWidgetHint(this)}}}function itemDivOnMouseOut(event){if(this.classList.contains("in-design")){if(showHintCount_>=1){showHintCount_-=1}hideWidgetHint()}}function renewDesignPos(node){}function GetParentNum_(node){var owner=node.parentNode;return(owner?1+GetParentNum_(owner):0)}function sideAreaDragOver(event){if(beenReadonly_){return}var sTask=getCookie__("drag_task");if(sTask=="load_wdgt"||sTask=="exchange_page"){event.preventDefault()}}function sideAreaDragDrop(event){if(beenReadonly_){return}var targId=event.target.id;if(targId!="left-side-area"&&targId!="right-side-area"){return}var sArg=event.dataTransfer.getData("text/args");if(typeof sArg=="string"){if(sArg.indexOf("image,")==0){sArg=sArg.slice(6);var bArgs=sArg.split(",");if(bArgs.length==2){var sPath=location__(bArgs[1]).pathname;var sTask=getCookie__("drag_task");var iTag=parseInt(bArgs[0]);if(iTag==5&&sTask=="load_wdgt"){event.preventDefault();apiNode.addNewPage(window.decodeURI(sPath)+".wdgt",preNewPageId(),targId)}}}else{if(sArg.indexOf("pageindex,")==0){sArg=sArg.slice(10);var iSour=parseInt(sArg);var currIndex=bWebPageId_.indexOf(sWebPageId_);var sTask=getCookie__("drag_task");if(sTask=="exchange_page"&&iSour>0&&currIndex>=0){if(currIndex!=0||targId!="left-side-area"){var iTarg=currIndex==0?1:(targId=="left-side-area"?currIndex:currIndex+1);if(iSour!=iTarg){event.preventDefault();apiNode.exchangePage(iTarg,iSour)}}}}}}}function webPageDragOver(event){if(beenReadonly_){return}var sTask=getCookie__("drag_task");if(sTask=="load_wdgt"||sTask=="put_img"){event.preventDefault()}}function webPageDragDrop(event){if(beenReadonly_){return}var sArg=event.dataTransfer.getData("text/args");if(typeof sArg=="string"&&sArg.indexOf("image,")==0){sArg=sArg.slice(6);var bArgs=sArg.split(",");if(bArgs.length==2){var sPath=location__(bArgs[1]).pathname;var sTask=getCookie__("drag_task");var iTag=parseInt(bArgs[0]);if(iTag==5&&sTask=="load_wdgt"){var currNode=document.querySelector("div.curr-design");if(currNode&&!currNode.classList.contains("web-panel")&&!currNode.classList.contains("web-item")){return}event.preventDefault();var iX=event._clientX||event.clientX;var iY=event._clientY||event.clientY;var isShift=1,targNode=bodyNode_;if(currNode){isShift=0;targNode=currNode}apiNode.loadWidget(window.decodeURI(sPath)+".wdgt",targNode.toId(),iX,iY,isShift)}else{if(iTag==0&&sTask=="put_img"){}}}}}function moveDesignItem_(iX,iY){if(beenReadonly_){return}iX=iX||0;iY=iY||0;var node=getCurrSelected(1);if(node&&node.classList.contains("absolute-pos")&&(iX||iY)){var x=parseInt(node.getAttribute("_left")||"0")+iX;var y=parseInt(node.getAttribute("_top")||"0")+iY;node.setAttribute("_left",x+"");node.style.left=x+"px";node.setAttribute("_top",y+"");node.style.top=y+"px";setPageModified_();selectOneItem(node)}}function tryResizePanel_(node,noParent){try{if(!noParent&&node.parentNode.classList.contains("web-panel")){resizeWebPanel(node.parentNode)}else{resizeWebPanel(node)}}catch(e){console.log(e)}}function resizeDesignItem_(iX,iY){iX=iX||0;iY=iY||0;if(!beenReadonly_&&(iX||iY)){var node=getCurrSelected(0);if(node){var isItem=false,canResizeX=false,canResizeY=false;if(node.classList.contains("web-panel")){var owner=node.parentNode;if(owner){if(owner.classList.contains("col-panel")){canResizeX=true}else{if(owner.classList.contains("row-panel")){canResizeY=true}}}}else{isItem=node.classList.contains("web-item");canResizeX=true;canResizeY=true}var zeroWidth=false,zeroHeight=false;if(canResizeX){if(iX==0){canResizeX=false}else{var s=node.getAttribute("_width");if(!s){canResizeX=false}else{var f=parseFloat(s);if(f<1){if(f==0){zeroWidth=true;if(isItem&&!node.classList.contains("resizable")){zeroWidth=false}}canResizeX=false}}}}if(canResizeY){if(iY==0){canResizeY=false}else{var s=node.getAttribute("_height");if(!s){canResizeY=false}else{var f=parseFloat(s);if(f<1){if(f==0){zeroHeight=true;if(isItem&&!node.classList.contains("resizable")){zeroHeight=false}}canResizeY=false}}}}if(zeroWidth){var iWd=Math.max(Math.floor(parseFloat(window.getComputedStyle(node).width)+iX+0.5),1);node.style.width=iWd+"px";node.setAttribute("_dsWidth",iWd+"")}else{if(canResizeX){var iWd=Math.max(Math.floor(parseFloat(window.getComputedStyle(node).width)+iX+0.5),1);node.style.width=iWd+"px";node.setAttribute("_width",iWd+"")}}if(zeroHeight){var iHi=Math.max(Math.floor(parseFloat(window.getComputedStyle(node).height)+iY+0.5),1);node.style.height=iHi+"px";node.setAttribute("_dsHeight",iHi+"")}else{if(canResizeY){var iHi=Math.max(Math.floor(parseFloat(window.getComputedStyle(node).height)+iY+0.5),1);node.style.height=iHi+"px";node.setAttribute("_height",iHi+"")}}if(zeroWidth||zeroHeight||canResizeX||canResizeY){tryResizePanel_(node);renewDesignPos(node);selectOneItem(node);setPageModified_()}}}}function handleDomMouseMove(event){if(itemInMoving_){if(!beenReadonly_&&itemMovingNode_){var detaX=(event._clientX||event.clientX)-itemMoveFromX_;var detaY=(event._clientY||event.clientY)-itemMoveFromY_;if(itemMoveActed_){holderNode_.style.left=(itemMoveFromLeft_+detaX)+"px";holderNode_.style.top=(itemMoveFromTop_+detaY)+"px"}else{if(Math.abs(detaX)>=4||Math.abs(detaY)>=4){itemMoveActed_=true}}}}else{if(itemInResizing_){if(!beenReadonly_&&itemResizedNode_){var canResizeX=false,canResizeY=false;if(itemResizedNode_.classList.contains("web-panel")){var owner=itemResizedNode_.parentNode;if(owner){if(owner.classList.contains("col-panel")){canResizeX=true}else{if(owner.classList.contains("row-panel")){if(itemResizedNode_.hasAttribute("_height")){canResizeY=true}}}}}else{canResizeX=true;if(itemResizedNode_.hasAttribute("_height")){canResizeY=true}}if(canResizeX){var detaX=(event._clientX||event.clientX)-itemResizeFromX_;var iWd=Math.max(itemResizeFromW_+detaX,1);itemResizedNode_.style.width=iWd+"px"}if(canResizeY){var detaY=(event._clientY||event.clientY)-itemResizeFromY_;var iHi=Math.max(itemResizeFromH_+detaY,1);itemResizedNode_.style.height=iHi+"px"}}}}}function webPanelDrop(targNode,sourNode){if(sourNode===targNode){return null}var owner_=targNode.parentNode;while(owner_){if(owner_===sourNode){return null}owner_=owner_.parentNode}var targIsRow=false,targIsCol=false,targOwner=targNode.parentNode;if(targOwner.classList.contains("row-panel")){targIsRow=true}else{if(targOwner.classList.contains("col-panel")){targIsCol=true}}var sourIsRow=false,sourIsCol=false,sourOwner=sourNode.parentNode;if(sourOwner.classList.contains("row-panel")){sourIsRow=true}else{if(sourOwner.classList.contains("col-panel")){sourIsCol=true}}if(sourIsRow){if(targIsRow){sourOwner.removeChild(sourNode);targOwner.insertBefore(sourNode,targNode)}else{if(targNode.classList.contains("row-panel")){sourOwner.removeChild(sourNode);targNode.appendChild(sourNode)}else{if(targNode.classList.contains("web-panel")&&!targNode.classList.contains("col-panel")){if(targNode.children.length==0){sourOwner.removeChild(sourNode);targNode.classList.add("row-panel");targNode.appendChild(sourNode)}else{return null}}else{return null}}}}else{if(sourIsCol){if(targIsCol){sourOwner.removeChild(sourNode);targOwner.insertBefore(sourNode,targNode)}else{if(targNode.classList.contains("col-panel")){sourOwner.removeChild(sourNode);targNode.appendChild(sourNode)}else{if(targNode.classList.contains("web-panel")&&!targNode.classList.contains("row-panel")){if(targNode.children.length==0){sourOwner.removeChild(sourNode);targNode.classList.add("col-panel");targNode.appendChild(sourNode)}else{return null}}else{return null}}}}else{if(targNode.classList.contains("web-panel")){if(targNode.classList.contains("col-panel")||targNode.classList.contains("row-panel")){return null}sourOwner.removeChild(sourNode);targNode.appendChild(sourNode)}else{if(targNode.classList.contains("web-item")){var targNode_=targNode.parentNode;if(targNode_.classList.contains("web-panel")){sourOwner.removeChild(sourNode);targNode_.insertBefore(sourNode,targNode)}else{return null}}else{return null}}}}if(sourOwner.children.length==0){sourOwner.classList.remove("row-panel");sourOwner.classList.remove("col-panel")}return sourOwner}var selectJustMoved_=false;function handleDomMouseUp(event){var hasAct=false;if(itemInMoving_){if(!beenReadonly_&&itemMovingNode_){hasAct=true;selectJustMoved_=true;setTimeout(function(){selectJustMoved_=false},500);if(itemMoveActed_){var iX=event._clientX||event.clientX;var iY=event._clientY||event.clientY;var succ=false,affectNode=null;if(itemMovingNode_.classList.contains("absolute-pos")){var detaX=iX-itemMoveFromX_;var detaY=iY-itemMoveFromY_;var x=parseInt(itemMovingNode_.getAttribute("_left")||"0")+detaX;var y=parseInt(itemMovingNode_.getAttribute("_top")||"0")+detaY;itemMovingNode_.setAttribute("_left",x+"");itemMovingNode_.style.left=x+"px";itemMovingNode_.setAttribute("_top",y+"");itemMovingNode_.style.top=y+"px";succ=true}else{if(itemMoveShiftKey_&&parseFloat(itemMovingNode_.getAttribute("_width")||"0")!=0){var detaX=iX-itemMoveFromX_;var detaY=iY-itemMoveFromY_;var r=bodyNode_.getBoundingClientRect(),r2=itemMovingNode_.getBoundingClientRect();var x=Math.floor(r2.left-r.left+detaX+0.5);var y=Math.floor(r2.top-r.top+detaY+0.5);affectNode=itemMovingNode_.parentNode;affectNode.removeChild(itemMovingNode_);itemMovingNode_.classList.add("absolute-pos");holderNode_.parentNode.appendChild(itemMovingNode_);itemMovingNode_.setAttribute("_left",x+"");itemMovingNode_.style.left=x+"px";itemMovingNode_.setAttribute("_top",y+"");itemMovingNode_.style.top=y+"px";succ=true}else{var b=[],nodes=document.querySelectorAll("div.web-panel");for(var i=0,item;item=nodes[i];i++){var rect=item.getBoundingClientRect();if(iX>=rect.left&&iX<rect.left+rect.width&&iY>=rect.top&&iY<rect.top+rect.height){b.push([GetParentNum_(item),item])}}if(b.length){b.sort(function(a,b){return a[0]-b[0]});var targNode=b[b.length-1][1];var items=targNode.querySelectorAll("div.web-item");for(var i=0,item;item=items[i];i++){if(item.parentNode!==targNode){continue}var rect=item.getBoundingClientRect();if(iY<rect.top){targNode=item;break}else{if(iX>=rect.left&&iX<rect.left+rect.width&&iY>=rect.top&&iY<rect.top+rect.height){targNode=item;break}}}affectNode=webPanelDrop(targNode,itemMovingNode_);if(affectNode){succ=true}}}}if(succ){if(affectNode){tryResizePanel_(affectNode,true);if(itemMovingNode_.parentNode!==affectNode){tryResizePanel_(itemMovingNode_)}}else{tryResizePanel_(itemMovingNode_)}renewDesignPos(itemMovingNode_);setPageModified_()}selectOneItem(itemMovingNode_)}}}else{if(itemInResizing_){if(itemResizedNode_){var modified=false;hasAct=true;var fWd=parseFloat(itemResizedNode_.getAttribute("_width")||"0");if(fWd>0){if(fWd<1){if(fWd>=0.9999){itemResizedNode_.style.width="100%"}else{itemResizedNode_.style.width=Math.floor(fWd*100+0.5)+"%"}}else{var fWdNew=parseFloat(itemResizedNode_.style.width);if(fWdNew!=fWd){modified=true;itemResizedNode_.setAttribute("_width",fWdNew+"")}}}else{if(itemResizedNode_.hasAttribute("_width")){modified=true;var fWdNew=parseFloat(itemResizedNode_.style.width);itemResizedNode_.setAttribute("_dsWidth",fWdNew+"")}if(itemResizedNode_.classList.contains("web-item")){if(!itemResizedNode_.classList.contains("resizable")){itemResizedNode_.style.width=""}}}var fHi=parseFloat(itemResizedNode_.getAttribute("_height")||"0");if(fHi>0){if(fHi<1){if(fHi>=0.9999){itemResizedNode_.style.height="100%"}else{itemResizedNode_.style.height=Math.floor(fHi*100+0.5)+"%"}}else{var fHiNew=parseFloat(itemResizedNode_.style.height);if(fHiNew!=fHi){modified=true;itemResizedNode_.setAttribute("_height",fHiNew+"")}}}else{if(itemResizedNode_.hasAttribute("_height")){modified=true;var fHiNew=parseFloat(itemResizedNode_.style.height);itemResizedNode_.setAttribute("_dsHeight",fHiNew+"")}if(itemResizedNode_.classList.contains("web-item")){if(!itemResizedNode_.classList.contains("resizable")){itemResizedNode_.style.height=""}}}if(modified){tryResizePanel_(itemResizedNode_);renewDesignPos(itemResizedNode_);setPageModified_()}selectOneItem(itemResizedNode_)}}}if(!hasAct&&event.button==0){var menuClick=false,targ=event.target;while(targ){if(targ.id=="webmaker-menu"){menuClick=true;break}targ=targ.parentNode}if(!menuClick&&!event.shiftKey&&!event.altKey&&!event.ctrlKey){apiNode.hideMenubar();apiNode.unselect()}}itemInResizing_=false;itemResizedNode_=null;itemInMoving_=false;itemMovingNode_=null}var itemInMoving_=false;var itemMovingNode_=null;var itemMoveActed_=false;var itemMoveShiftKey_=false;var itemMoveFromX_=0;var itemMoveFromY_=0;var itemMoveFromLeft_=0;var itemMoveFromTop_=0;function itemMovMouseDown(event){if(!beenReadonly_&&event.button==0&&!event.ctrlKey&&!event.altKey){var node=event.target;if(node.id=="item-holder"&&node._current){itemInMoving_=true;itemMovingNode_=node._current;itemMoveActed_=false;itemMoveShiftKey_=event.shiftKey;itemMoveFromX_=event.clientX;itemMoveFromY_=event.clientY;itemMoveFromLeft_=parseFloat(holderNode_.style.left);itemMoveFromTop_=parseFloat(holderNode_.style.top)}else{itemMovingNode_=null}}}var itemInResizing_=false;var itemResizedNode_=null;var itemResizeFromX_=0;var itemResizeFromY_=0;var itemResizeFromW_=0;var itemResizeFromH_=0;function itemResizeMouseDown(event){if(!beenReadonly_&&event.button==0&&!event.ctrlKey&&!event.shiftKey&&!event.altKey){var node=event.target;itemResizedNode_=getCurrSelected(0);if(itemResizedNode_){var st=window.getComputedStyle(itemResizedNode_);itemInResizing_=true;itemResizeFromX_=event.clientX;itemResizeFromY_=event.clientY;itemResizeFromW_=Math.floor(parseFloat(st.width)+0.5);itemResizeFromH_=Math.floor(parseFloat(st.height)+0.5);resizerNode_.style.display="none"}else{itemResizedNode_=null}}}function addDivPanel(panel,isRow){var currIsRow=false,currIsCol=false,currIsLeaf=false;if(panel.classList.contains("row-panel")){currIsRow=true}else{if(panel.classList.contains("col-panel")){currIsCol=true}else{currIsLeaf=true}}if(currIsLeaf){var nodes=[];for(var i=0,item;item=panel.children[i];i++){if(item.nodeName=="DIV"){nodes.push(item)}}if(nodes.length){var panelWd=panel.clientWidth,panelHi=panel.clientHeight;var newLayer=document.createElement("div");newLayer.className="web-panel p0-p1-p2-p3 in-design";if(isRow){var iHi=Math.max(12,panelHi-40);newLayer.style.height=iHi+"px";newLayer.setAttribute("_height",iHi+"")}else{var iWd=Math.max(12,panelWd-40);newLayer.style.width=iWd+"px";newLayer.setAttribute("_width",iWd+"")}for(var i=0,item;item=nodes[i];i++){panel.removeChild(item);newLayer.appendChild(item)}panel.appendChild(newLayer)}var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";if(isRow){panel.classList.add("row-panel");newDiv.style.height="40px";newDiv.setAttribute("_height","40")}else{panel.classList.add("col-panel");newDiv.style.width="40px";newDiv.setAttribute("_width","40")}panel.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_()}else{if(isRow){if(currIsRow||!currIsCol){var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.height="40px";newDiv.setAttribute("_height","40");panel.classList.add("row-panel");panel.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_()}else{var owner=panel.parentNode;if(owner.classList.contains("row-panel")){var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.height="40px";newDiv.setAttribute("_height","40");owner.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_();return}var newLayer=null,nodes=[],panelWd=panel.clientWidth,panelHi=panel.clientHeight;for(var i=0,item;item=panel.children[i];i++){if(item.nodeName=="DIV"){nodes.push(item)}}if(nodes.length){var iHi=Math.max(12,panelHi-40);newLayer=document.createElement("div");newLayer.className="web-panel p0-p1-p2-p3 col-panel in-design";newLayer.style.height=iHi+"px";newLayer.setAttribute("_height",iHi);for(var i=0,item;item=nodes[i];i++){panel.removeChild(item);newLayer.appendChild(item)}}panel.classList.remove("col-panel");panel.classList.add("row-panel");if(newLayer){panel.appendChild(newLayer)}var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.height="40px";newDiv.setAttribute("_height","40");panel.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_()}}else{if(currIsCol||!currIsRow){var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.width="40px";newDiv.setAttribute("_width","40");panel.classList.add("col-panel");panel.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_()}else{var owner=panel.parentNode;if(owner.classList.contains("col-panel")){var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.width="40px";newDiv.setAttribute("_width","40");owner.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_();return}var newLayer=null,nodes=[],panelWd=panel.clientWidth,panelHi=panel.clientHeight;for(var i=0,item;item=panel.children[i];i++){if(item.nodeName=="DIV"){nodes.push(item)}}if(nodes.length){var iWd=Math.max(12,panelWd-40);newLayer=document.createElement("div");newLayer.className="web-panel p0-p1-p2-p3 row-panel in-design";newLayer.style.width=iWd+"px";newLayer.setAttribute("_width",iWd+"");for(var i=0,item;item=nodes[i];i++){panel.removeChild(item);newLayer.appendChild(item)}}panel.classList.remove("row-panel");panel.classList.add("col-panel");if(newLayer){panel.appendChild(newLayer)}var newDiv=document.createElement("div");newDiv.className="web-panel p0-p1-p2-p3 in-design";newDiv.style.width="40px";newDiv.setAttribute("_width","40");panel.appendChild(newDiv);tryResizePanel_(newDiv);setPageModified_()}}}}var lastCutWidgets_=[];var lastCutWidgetsId_=-1;function cutDivPanel(panel){var iFlag=0;if(panel.classList.contains("row-panel")){iFlag=1}else{if(panel.classList.contains("col-panel")){iFlag=2}}lastCutWidgetsId_=iFlag;lastCutWidgets_=[];for(var i=0,item;item=panel.children[i];i++){if(item.nodeName=="DIV"){lastCutWidgets_.push(item)}}for(var i=0,item;item=lastCutWidgets_[i];i++){panel.removeChild(item)}tryResizePanel_(panel,true);setPageModified_();apiNode.copyToClipboard("BUFFER_OF_PINP_WEB,"+iFlag)}function divToolClick_(event){var sName="",node=event.target;if(node){if(node.nodeName=="IMG"){node=node.parentNode}sName=node.getAttribute("name")||""}if(sName=="toolA"){var panel=getSelectedPanel(true);if(!panel){panel=document.getElementById("web-body")}addDivPanel(panel,true)}else{if(sName=="toolB"){var panel=getSelectedPanel(true);if(!panel){panel=document.getElementById("web-body")}addDivPanel(panel,false)}else{if(sName=="toolC"){var panel=getSelectedPanel(false);if(panel){cutDivPanel(panel)}}else{if(sName=="toolD"){apiNode.delDesignItem(false,true)}else{if(sName=="toolE"){node=document.querySelector("div.web-panel > div.curr-design");if(node){selectOneItem(node.parentNode)}else{var panel=document.querySelector("div.web-panel.curr-design");if(panel){panel=panel.parentNode;if(panel&&!panel.classList.contains("web-panel")){panel=null}}if(!panel){panel=document.getElementById("web-body")}selectOneItem(panel)}}else{if(sName=="toolF"){node=getCurrSelected(1);if(node&&node.classList.contains("in-design")&&!beenReadonly_){editContent_(node,true,false)}}else{if(sName=="toolG"){node=getCurrSelected(0);if(node&&node.classList.contains("in-design")&&!beenReadonly_){editContent_(node,false,true)}}}}}}}}apiNode.hideMenubar();event.preventDefault();event.stopPropagation()}function handleDocKeyDown(event){switch(event.keyCode){case 39:case 40:case 37:case 38:if(!beenReadonly_&&event.ctrlKey&&!event.shiftKey&&!event.altKey){if(event.keyCode==39){moveDesignItem_(1,0)}else{if(event.keyCode==40){moveDesignItem_(0,1)}else{if(event.keyCode==37){moveDesignItem_(-1,0)}else{moveDesignItem_(0,-1)}}}showWidgetHint(null,4000)}else{if(!beenReadonly_&&!event.ctrlKey&&!event.shiftKey&&event.altKey){if(event.keyCode==39){resizeDesignItem_(1,0)}else{if(event.keyCode==40){resizeDesignItem_(0,1)}else{if(event.keyCode==37){resizeDesignItem_(-1,0)}else{resizeDesignItem_(0,-1)}}}showWidgetHint(null,4000)}}break;case 27:event.preventDefault();hideWidgetHint();apiNode.hideMenubar();break;case 46:if(!beenReadonly_&&event.ctrlKey&&!event.shiftKey&&!event.altKey){event.preventDefault();apiNode.delDesignItem(true)}break;case 67:if(!beenReadonly_&&event.ctrlKey&&!event.shiftKey&&!event.altKey){event.preventDefault();apiNode.copyItem()}break;case 88:if(!beenReadonly_&&event.ctrlKey&&!event.shiftKey&&!event.altKey){event.preventDefault();if(apiNode.copyItem()){apiNode.delDesignItem(true)}}break;case 86:if(!beenReadonly_&&event.ctrlKey&&!event.shiftKey&&!event.altKey){event.preventDefault();apiNode.pasteItem()}break;case 9:if(!beenReadonly_&&event.ctrlKey&&!event.altKey){event.preventDefault();var nodes=[],nodes_=bodyNode_.querySelectorAll("#web-body div.web-panel,div.web-item");for(var i=0,item;item=nodes_[i];i++){nodes.push([item.offsetTop,item.offsetLeft,item])}nodes.sort(function(a,b){if(a[0]==b[0]){if(a[1]==b[1]){return GetParentNum_(a[2])-GetParentNum_(b[2])}else{return a[1]-b[1]}}else{return a[0]-b[0]}});if(nodes.length==0){return}if(nodes.length==1){selectOneItem(nodes[0][2])}else{var waitSelect=null;for(var i=0,item;item=nodes[i];i++){item=item[2];if(item.classList.contains("curr-design")){if(event.shiftKey){var index=i-1;if(index<0){index=nodes.length-1}waitSelect=nodes[index][2]}else{var index=i+1;if(index>=nodes.length){index=0}waitSelect=nodes[index][2]}break}}if(!waitSelect){waitSelect=nodes[0][2]}selectOneItem(waitSelect,true)}}break}}function resizeWebPanel(node,noItemResize){if(node["on-resize"]){return node["on-resize"](node,noItemResize)}var isRow=false,isCol=false;if(node.classList.contains("row-panel")){isRow=true}else{if(node.classList.contains("col-panel")){isCol=true}}if(isRow||isCol){var sAttr=isRow?"height":"width";var sAttr2=isRow?"_height":"_width";var sAttr3=isRow?"_dsHeight":"_dsWidth";var iTotal=isRow?node.clientHeight:node.clientWidth;var b=[],iUsed=0;for(i=node.children.length-1;i>=0;i--){var item=node.children[i];if(item.classList.contains("web-panel")){var ii=parseFloat(item.getAttribute(sAttr2)||"0");if(ii<0){}else{if(ii==0){var ii2=0;if(!beenReadonly_&&item.hasAttribute(sAttr2)){ii2=parseFloat(item.getAttribute(sAttr3)||"0");if(ii2>0){if(sAttr3=="_dsWidth"){if(!item.style.width){item.style.width=ii2+"px"}}else{if(!item.style.height){item.style.height=ii2+"px"}}}}if(ii2==0){b.push(item)}}else{if(ii<1){if(ii>=0.9999){iUsed+=iTotal}else{iUsed+=Math.floor(iTotal*ii+0.5)}}else{iUsed+=ii}}}}}var iLen=b.length;if(iLen){iTotal-=iUsed;var iAvg=Math.floor(iTotal/iLen);for(var i=0;i<iLen;i++){var item=b[i];if(iAvg&&i==iLen-1){item.style[sAttr]=(iTotal-(iAvg*(iLen-1)))+"px"}else{item.style[sAttr]=iAvg+"px"}}}for(i=0,item;item=node.children[i];i++){resizeWebPanel(item,noItemResize)}}else{if(node.classList.contains("web-panel")){var iTotalWd=node.clientWidth,iTotalHi=node.clientHeight;for(i=0,item;item=node.children[i];i++){if(item.nodeName=="DIV"&&item.classList.contains("resizable")){var wd=null,hi=null,fRealWd=null,fRealHi=null;if(item.hasAttribute("_width")){wd=parseFloat(item.getAttribute("_width")||"0")}if(item.hasAttribute("_height")){hi=parseFloat(item.getAttribute("_height")||"0")}if((typeof wd=="number")&&wd>=0){if(wd==0){var wd2=0;if(!beenReadonly_){wd2=parseFloat(item.getAttribute("_dsWidth")||"0")}if(wd2){fRealWd=wd2}else{fRealWd=iTotalWd}item.style.width=fRealWd+"px"}else{if(wd<0.9999){fRealWd=fTotalWd*wd}else{if(wd<1){fRealWd=iTotalWd}}}}if((typeof hi=="number")&&hi>=0){if(hi==0){var hi2=0;if(!beenReadonly_){hi2=parseFloat(item.getAttribute("_dsHeight")||"0")}if(hi2){fRealHi=hi2}else{fRealHi=iTotalHi}item.style.height=fRealHi+"px"}else{if(hi<0.9999){fRealHi=iTotalHi*hi}else{if(hi<1){fRealHi=iTotalHi}}}}var ractive=item.r;if(!noItemResize&&ractive){var hasSetX=false,hasSetY=false,hasSetWd=false,hasSetHi=false;var off=apiNode.offsetOfNode(item);if(ractive.get("resizable.left")!==off.x){ractive.set("resizable.left",off.x);hasSetX=true}if(ractive.get("resizable.top")!==off.y){ractive.set("resizable.top",off.y);hasSetY=true}if((typeof fRealWd=="number")&&ractive.get("resizable.width")!==fRealWd){ractive.set("resizable.width",fRealWd);hasSetWd=true}if((typeof fRealHi=="number")&&ractive.get("resizable.height")!==fRealHi){ractive.set("resizable.height",fRealHi);hasSetHi=true}if(hasSetX||hasSetY||hasSetWd||hasSetHi){ractive.fire("resize")}}}}}}}function getRatedSize(fRate,iLen){if(fRate>0){if(fRate<1){if(fRate>=0.9999){return iLen}else{return Math.floor(fRate*iLen)}}else{if(fRate>iLen){return iLen}else{return Math.floor(fRate)}}}else{return fRate}}function setWidgetLeftTop(node){var x=parseFloat(node.getAttribute("_left")||"0");if(x>0&&x<1){if(x>=0.9999){node.style.left="100%"}else{node.style.left=(x*100)+"%"}}else{node.style.left=Math.floor(x)+"px"}var y=parseFloat(node.getAttribute("_top")||"0");if(y>0&&y<1){if(y>=0.9999){node.style.top="100%"}else{node.style.top=(y*100)+"%"}}else{node.style.top=Math.floor(y)+"px"}}function setWidgetWdHi(node){var wd=parseFloat(node.getAttribute("_width")||"0");if(wd){if(wd<1){if(wd>=0.9999){node.style.width="100%"}else{node.style.width=(wd*100)+"%"}}else{node.style.width=Math.floor(wd)+"px"}}var hi=parseFloat(node.getAttribute("_height")||"0");if(hi){if(hi<1){if(hi>=0.9999){node.style.height="100%"}else{node.style.height=(hi*100)+"%"}}else{node.style.height=Math.floor(hi)+"px"}}}function synRequest_(sUrl,sMethod){var req=null;if(window.XMLHttpRequest){req=new XMLHttpRequest()}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP")}}if(req){sMethod=sMethod||"GET";req.open(sMethod,sUrl,false);req.send(null);if(req.readyState==4&&req.status==200){return req.responseText}}return""}function changeDesignCls(event){event.preventDefault();event.stopPropagation();document.getElementById("webmaker-menu").style.display="none";var targ=event.target;while(targ){if(targ.nodeName=="LI"){break}targ=targ.parentNode}if(!targ){return}var sCls=targ.getAttribute("_config")||"";var node=getCurrSelected(0);if(!node){return}var b2=sCls.split("-"),iLen=b2.length;if(iLen>=2){b2.push(b2.shift());var sConfig,sCls2=b2.join("-");if(!node.classList.contains("web-panel")){sConfig=node.getAttribute("_config")||"";if(sConfig){sConfig=" "+sConfig+" "}sConfig=sConfig.replace(" "+sCls+" "," "+sCls2+" ").trim();node.setAttribute("_config",sConfig)}node.classList.remove(sCls);if(sCls2.indexOf("default-")!=0){node.classList.add(sCls2)}var frameNode=node.querySelector("iframe.build");if(frameNode&&frameNode.parentNode===node){var childWin=frameNode.contentWindow.window;if(childWin&&childWin.buildContent){childWin.buildContent()}}setPageModified_()}}function formatJsonDict_(s){var b=[],iFrom1=0,iFrom2=0,inStr=false,i1=s.indexOf(","),i2=s.indexOf('"');while(true){if(i1>0){if(i2>0){if(i1<i2){if(!inStr){b.push(i1)}iFrom1=i1+1;i1=s.indexOf(",",iFrom1)}else{if(!inStr||s[i2-1]!="\\"){inStr=!inStr}iFrom2=i2+1;i2=s.indexOf('"',iFrom2)}}else{if(!inStr){b.push(i1)}iFrom1=i1+1;i1=s.indexOf(",",iFrom1)}}else{break}}while(b.length){var i=b.pop()+1;s=s.slice(0,i)+"\n"+s.slice(i)}return s}function followPreholder(){var nodes=bodyNode_.querySelectorAll('img[id^="wd-"]');var nodes=document.querySelectorAll('img[id^="wd-"]');for(var i=0,item;item=nodes[i];i++){var sId=item.getAttribute("id");var targ=bodyNode_.querySelector('div.web-item[name="'+sId+'"]');if(targ){var off={x:0,y:0};GetOffset_(item,off);var x=off.x-WEB_BODY_LEFT,y=off.y-WEB_BODY_TOP;targ.style.left=x+"px";targ.style.top=Math.floor(y+item.clientHeight/2+0.5)+"px"}}}function handleDomLoaded(event){var sUA=navigator.userAgent;var i1=sUA.indexOf(" GROUP(");if(i1>0){var i2=sUA.indexOf(")",i1);if(i2>0){WEBMAKER_GROUP_ID=sUA.slice(i1+7,i2).split(",")[0]}}var startByReadonly=isWebMakerReadonly();beenReadonly_=startByReadonly;var bodyNode=document.getElementById("web-body");if(!bodyNode){return}bodyNode_=bodyNode;var el=document.getElementById("webmaker-api");window.apiNode=el;if(!beenReadonly_){el=document.createElement("script");el.setAttribute("type","text/cse");document.querySelector("head").appendChild(el);el.setAttribute("src","/software/webmaker10/$script/webmaker.cse");document.body.classList.add("noselect-txt")}el=document.createElement("style");el.innerHTML="body {font-family: "+window.PINP_SLIDE_FONT+(beenReadonly_?"":";overflow: hidden")+";} pre {font-family: "+window.PINP_SOURCECODE_FONT+";} img[id^='ch-'],img[id^='se-'],img[id^='wd-']{visibility:hidden;} div.in-design img[id^='wd-'],div.in-design img[id^='ch-'],div.in-design img[id^='se-']{visibility:visible; outline:gray dotted 1px;}";document.querySelector("head").appendChild(el);bWebPageId_=(bodyNode.getAttribute("_pageid")||"0").split(",");sWebPageId_=bWebPageId_[0];if(!beenReadonly_&&bWebPageId_!=0){setTimeout(function(){var s=synRequest_("/$pages");if(s){bWebPageId_=s.split(",")}},100)}var bodyWd=window.innerWidth,sideBarWd=0;var defWd=getRatedSize(parseFloat(bodyNode.getAttribute("_width")||"0"),bodyWd);if(defWd>0){if(!beenReadonly_){if(defWd>1024){defWd=1024}if(defWd>bodyWd-40){defWd=bodyWd-40}}sideBarWd=Math.floor((bodyWd-defWd)/2)}if(!beenReadonly_){var winHi=window.innerHeight;document.body.style.backgroundColor="#d3d3d3";el=document.createElement("div");el.className="side-area";el.id="bottom-side-area";el.style.left="0px";el.style.top=(winHi-20)+"px";el.style.width=bodyWd+"px";el.style.height="20px";document.body.appendChild(el);if(sideBarWd){el=document.createElement("div");el.className="side-area";el.id="left-side-area";el.style.left="0px";el.style.width=sideBarWd+"px";el.ondragover=sideAreaDragOver;el.ondrop=sideAreaDragDrop;document.body.appendChild(el);el=document.createElement("div");el.className="side-area";el.id="right-side-area";el.style.left=(sideBarWd+defWd)+"px";el.style.width=(bodyWd-sideBarWd-defWd)+"px";el.ondragover=sideAreaDragOver;el.ondrop=sideAreaDragDrop;document.body.appendChild(el)}el=document.createElement("div");el.className="side-area";el.id="top-side-area";el.style.left="0px";el.style.width=bodyWd+"px";el.style.height="58px";el.innerHTML='<div onclick="apiNode.divToolClick(event)" onmouseup="event.stopPropagation()"> <div class="div-tool" style="width:36px"></div><div name="toolE" class="div-tool"><img title="select uplevel" src="/software/webmaker10/$images/btn_select.png" /></div><div name="toolD" class="div-tool"><img title="delete selected" src="/software/webmaker10/$images/btn_delete.png" /></div><div name="toolC" class="div-tool"><img title="cut content" src="/software/webmaker10/$images/btn_cut.png" /></div><div name="toolB" class="div-tool"><img title="add column" src="/software/webmaker10/$images/btn_add2.png" /></div><div name="toolA" class="div-tool"><img title="add row" src="/software/webmaker10/$images/btn_add.png" /></div><div style="width:20px; height:52px; float:right"></div><div name="toolF" class="div-tool"><img title="edit content (ctrl+click)" src="/software/webmaker10/$images/btn_edit2.png" /></div><div name="toolG" class="div-tool"><img title="config widget (alt+click)" src="/software/webmaker10/$images/btn_edit.png" /></div></div>';document.body.appendChild(el);bodyNode.style.left=sideBarWd+"px";bodyNode.style.top="58px";bodyNode.style.width=defWd+"px";bodyNode.style.height=(winHi-78)+"px"}else{bodyNode.style.left=sideBarWd+"px";bodyNode.style.width=(defWd==0?bodyWd:defWd)+"px";if(bodyNode.hasAttribute("_height")){var defHi=getRatedSize(parseFloat(bodyNode.getAttribute("_height")),window.innerHeight);bodyNode.style.height=(defHi==0?window.innerHeight:defHi)+"px"}window.addEventListener("resize",function(event){var sideWd=0;var defWd=getRatedSize(parseFloat(bodyNode.getAttribute("_width")||"0"),window.innerWidth);if(defWd>0){sideWd=parseInt((window.innerWidth-defWd)/2)}bodyNode.style.left=sideWd+"px";bodyNode.style.width=(defWd==0?window.innerWidth:defWd)+"px";if(bodyNode.hasAttribute("_height")){var defHi=getRatedSize(parseFloat(bodyNode.getAttribute("_height")),window.innerHeight);bodyNode.style.height=(defHi==0?window.innerHeight:defHi)+"px"}resizeWebPanel(bodyNode)},false)}var off_={x:0,y:0};GetOffset_(bodyNode,off_);WEB_BODY_LEFT=off_.x;WEB_BODY_TOP=off_.y;var absWidgets=document.getElementById("abs-widgets");if(!absWidgets){absWidgets=document.createElement("section");absWidgets.id="abs-widgets";if(bodyNode.children.length){bodyNode.insertBefore(absWidgets,bodyNode.children[0])}else{bodyNode.appendChild(absWidgets)}}holderNode_=document.createElement("div");holderNode_.id="item-holder";holderNode_.style.zIndex="19999";holderNode_.onclick=holderNodeOnclick;holderNode_.onmousedown=itemMovMouseDown;absWidgets.appendChild(holderNode_);resizerNode_=document.createElement("div");resizerNode_.id="item-resizer";resizerNode_.style.zIndex="19999";resizerNode_.onclick=holderNodeOnclick;resizerNode_.onmousedown=itemResizeMouseDown;absWidgets.appendChild(resizerNode_);if(!beenReadonly_){bodyNode.classList.add("in-design");bodyNode.onclick=itemDivOnclick}var reLineComment=/##.*?\n/gm;var addRactiveObj_=function(c,t,cfg,onFinish){var sSrc=t.getAttribute("_src")||"";var sWidget=t.getAttribute("_widget")||"";if(sWidget){var succ=false,bDepends=[],b=sWidget.split("."),sName=b.pop(),sModule=b.join(".");if(!sName){}else{if(!sSrc&&sModule&&WEBMAKER_MAIN.config.sysModules.indexOf(sModule)>=0){var dPath={};dPath[sModule]="/software/webmaker10/$script/"+sModule;require.config({paths:dPath});bDepends.push(sModule);succ=true}else{if(sSrc||sModule){var sBase=WEBMAKER_MAIN.config.baseUrl||"";require.config({baseUrl:sBase});if(sSrc){bDepends.push(sSrc)}else{bDepends.push(sModule)}succ=true}}}if(succ){require(bDepends,function(mod){apiNode.registWebItem(c,t,cfg,mod[sName]);if(typeof onFinish=="function"){onFinish()}})}else{alert("invalid widget: "+sName)}}else{if(typeof onFinish=="function"){onFinish()}}};var initRactiveItem_=function(item,onFinish){var scriptNode=null,sComment="";for(var i2=0,item2;item2=item.childNodes[i2];i2++){if(item2.nodeType==8){sComment=item2.nodeValue}else{if(item2.nodeType==1&&item2.nodeName=="SCRIPT"){if((item2.getAttribute("type")||"").toLowerCase()=="text/ractive"){scriptNode=item2}}}}if(scriptNode){if(beenReadonly_){var s=item.getAttribute("_defs");if(s){var b=s.split(",");for(var i=b.length-1;i>=0;i--){var ss=b[i];var b2=ss.split(":");if(b2.length==2){var sSig=b2[0].trim();var sSlt=b2[1].trim();if(sSig&&sSlt&&sSig.indexOf("ss")==0){var bSlt=sSlt.split(".");var targ=bodyNode.querySelector('div.web-item[name="'+bSlt[0]+'"]');if(targ){var b3=item[sSig]||[];if(b3.indexOf(targ)<0){if(bSlt.length>=2){b3.push([targ,bSlt[1]])}else{b3.push(targ)}item[sSig]=b3}}}}}}}try{var container=document.createElement("div");container.classList.add("wd-container");item.insertBefore(container,item.children[0]);var cfg=sComment?JSON.parse(sComment.replace(reLineComment,"")):{};var iFlag=window.WEBMAKER_MASK||0;if(!beenReadonly_){iFlag=iFlag|1}cfg.__debug__=iFlag;addRactiveObj_(container,scriptNode,cfg,onFinish)}catch(e){console.log(e)}}else{if(typeof onFinish=="function"){onFinish()}}};var ractiveExtern_=function(cls){var base=cls.__base__;if(base instanceof Object){return ractiveExtern_(base).extend(cls)}else{return Ractive.extend(cls)}};apiNode.registWebItem=function(c,t,cfg,cls){cls=cls||{};cls.template=t.innerHTML;if(t.parentNode){var nxtNode=t.nextSibling;if(nxtNode&&nxtNode.nodeType==3){nxtNode=nxtNode.nextSibling}if(nxtNode&&nxtNode.nodeType==8){nxtNode.parentNode.removeChild(nxtNode)}t.parentNode.removeChild(t)}var AClass=ractiveExtern_(cls);return(c.parentNode.r=new AClass({el:c,data:cfg}))};var nodes=document.querySelectorAll("div.web-panel > div, #abs-widgets > div.web-item");for(var i=0,item;item=nodes[i];i++){if(!beenReadonly_){item.classList.add("in-design");item.onclick=itemDivOnclick;item.onmouseover=itemDivOnMouseOn;item.onmouseout=itemDivOnMouseOut}var isItem=item.classList.contains("web-item"),isAbs=item.parentNode===absWidgets;if(isAbs&&isItem){var x=parseFloat(item.getAttribute("_left")||"0");if(x>0&&x<1){if(x>=0.9999){item.style.left="100%"}else{item.style.left=(x*100)+"%"}}else{item.style.left=x+"px"}var y=parseFloat(item.getAttribute("_top")||"0");if(y>0&&y<1){if(y>=0.9999){item.style.top="100%"}else{item.style.top=(y*100)+"%"}}else{item.style.top=y+"px"}}var wd=parseFloat(item.getAttribute("_width")||"0");if(wd>0){if(wd<1){if(wd>=0.9999){item.style.width="100%"}else{item.style.width=(wd*100)+"%"}}else{item.style.width=wd+"px"}}var hi=parseFloat(item.getAttribute("_height")||"0");if(hi>0){if(hi<1){if(hi>=0.9999){item.style.height="100%"}else{item.style.height=(hi*100)+"%"}}else{item.style.height=hi+"px"}}if(isItem){initRactiveItem_(item)}}if(!beenReadonly_){document.addEventListener("keydown",handleDocKeyDown,false)}var cfgMenu=document.getElementById("webmaker-menu");var handleContextMenu=function(ev){ev.preventDefault();LastContentMenuAtX=ev._clientX||ev.clientX;LastContentMenuAtY=ev._clientY||ev.clientY;var menuItems=cfgMenu.getElementsByTagName("li");var bList=[];for(var index=0;index<menuItems.length;index++){var item=menuItems[index];if(item.classList.contains("design-item")){bList.push(item)}}while(bList.length){var item=bList.pop();item.parentNode.removeChild(item)}var node=getCurrSelected(0);var firstMenu=cfgMenu.querySelector("#menu-0");if(node&&firstMenu){var sCfg;firstMenu=firstMenu.parentNode;if(node.classList.contains("web-panel")){sCfg="p0-p1-p2-p3 default-raised-flat-lower default-closed-invisible default-scroll-hidden";if(node.id=="web-body"){sCfg="default-large-small S3-S4-S5-S6 "+sCfg}}else{sCfg=node.getAttribute("_config")||""}sCfg=sCfg.trim();if(sCfg){var addCount=0;var b=sCfg.split(/\u0020+/g);for(var i=0,item;item=b[i];i++){var b2=item.split("-"),iLen=b2.length;if(iLen){var sFound=item;for(var i2=0;i2<iLen;i2++){var ss=b2.join("-");if(node.classList.contains(ss)){sFound=ss;break}b2.push(b2.shift())}b2=sFound.split("-");if(b2.length>=2){var sMenuL=b2[0].replace("_"," ");var sMenuR=b2[1].replace("_"," ");var sTitle=sMenuL+" --&gt; "+sMenuR;if(b2.length>2){sTitle+=" --&gt; "}var newMenu=document.createElement("li");newMenu.className="design-item";newMenu.setAttribute("_config",sFound);newMenu.innerHTML="<a href='javascript:void(0)'>"+sTitle+"</a>";newMenu.onclick=changeDesignCls;cfgMenu.insertBefore(newMenu,firstMenu);addCount++}}}if(addCount){var newMenu=document.createElement("li");newMenu.className="design-item";newMenu.innerHTML="<hr/>";cfgMenu.insertBefore(newMenu,firstMenu)}}}if(!beenReadonly_){var isItem=false,isItem=node&&node.classList.contains("web-item");var wdgtItems=cfgMenu.querySelectorAll("li.by-widget");for(var index=0;index<wdgtItems.length;index++){wdgtItems[index].style.display=node?"block":"none"}var wdgtItems2=cfgMenu.querySelectorAll("li.by-page");for(var index2=0;index2<wdgtItems2.length;index2++){wdgtItems2[index2].style.display=node?"none":"block"}var wdgtItems3=cfgMenu.querySelectorAll("li.by-item");for(var index3=0;index3<wdgtItems3.length;index3++){wdgtItems3[index3].style.display=isItem?"block":"none"}}cfgMenu.style.display="block";cfgMenu.style.left=LastContentMenuAtX+"px";cfgMenu.style.top=LastContentMenuAtY+"px";menuItems=cfgMenu.getElementsByTagName("li");for(var index=0;index<menuItems.length;index++){menuItems[index].onmouseover=function(){this.classList.add("active")};menuItems[index].onmouseout=function(){this.classList.remove("active")}}};if(!beenReadonly_){cfgMenu.innerHTML="<li class='by-widget' onclick='apiNode.delDesignItem(false,true)'><a id='menu-0' href='javascript:void(0)'>delete selected (ctrl + del)</a></li><li class='by-page' onclick='apiNode.delCurrPage()'><a href='javascript:void(0)'>delete current page</a></li><li class='by-item' onclick='apiNode.setCurrName()'><a href='javascript:void(0)'>set widget name</a></li><li class='by-item' onclick='apiNode.setConnectTo()'><a href='javascript:void(0)'>connect signal/slot</a></li>";document.oncontextmenu=handleContextMenu}var localUrlHead_="url("+window.location.protocol+"//"+window.location.hostname;var inDesignRE=/\bin-design\u0020/g;var currDesignRE=/\bcurr-design\u0020/g;var getAttrDesc_=function(node,sAttr,replaceQ){var s=node.getAttribute(sAttr);if(s){if(replaceQ){return" "+sAttr+'="'+s.replace(/"/gm,"'")+'"'}else{return" "+sAttr+'="'+s+'"'}}else{return""}};var repeatStr_=function(s,times){return(new Array(times+1)).join(s)};var getSvgPaperHtml=function(paper,iLevel){iLevel=(iLevel||0)+1;var sHtml="";for(var i=0,item;item=paper.children[i];i++){if(item.classList.contains("svg-shape")){if(i==0){sHtml+="\n"+repeatStr_(" ",iLevel)}sHtml+=getCompnentHtml(item,true,iLevel)}}return sHtml};var getCompnentHtml=function(node,inPaper,iLevel){iLevel=iLevel||0;var sIndent=repeatStr_("  ",iLevel);var sClass=" "+node.className+" ";var isPanel=sClass.indexOf(" web-panel ")>=0;var isItem=sClass.indexOf(" web-item ")>=0;if(isPanel||isItem||inPaper){var sHtml=sIndent,anyChild=false;sClass=sClass.replace(inDesignRE,"").replace(currDesignRE,"").trim();sHtml+='<div class="'+sClass+'"'+getAttrDesc_(node,"id");if(isPanel&&node.id=="web-body"){sHtml+=getAttrDesc_(node,"_pageid")}sHtml+=getAttrDesc_(node,"name")+getAttrDesc_(node,"_width")+getAttrDesc_(node,"_height");var sStyle=node.getAttribute("_style");if(sStyle){sStyle=sStyle.replace(localUrlHead_,"url(/");sHtml+=' style="'+sStyle+'"'}if(isItem){sHtml+=getAttrDesc_(node,"_left")+getAttrDesc_(node,"_top")+getAttrDesc_(node,"_config")+getAttrDesc_(node,"_widget")+getAttrDesc_(node,"_defs");if(inPaper){sHtml+=getAttrDesc_(node,"_from")+getAttrDesc_(node,"_align")+getAttrDesc_(node,"_toarrow")+getAttrDesc_(node,"_fromarrow")}}if(isPanel||isItem){sHtml+=getAttrDesc_(node,"_dsWidth")+getAttrDesc_(node,"_dsHeight")}sHtml+=">";if(isItem&&!inPaper&&node.classList.contains("svg-paper")){sHtml+=getSvgPaperHtml(node,iLevel);anyChild=true}else{if(isPanel){for(var i=0,item;item=node.children[i];i++){var s=getCompnentHtml(item,inPaper,iLevel+1);if(s){anyChild=true;sHtml+="\n"+s}}}else{var inShape=node.classList.contains("pinp-shape")||node.classList.contains("svg-shape");for(var i=0,item;item=node.childNodes[i];i++){var iType=item.nodeType;if(iType==3){sHtml+=item.nodeValue}else{if(iType==8){sHtml+="<!--"+item.nodeValue+"-->"}else{if(iType==1){if(inShape){if(item.classList.contains("shape-canvas")){var shapeStyle=item.getAttribute("style");if(shapeStyle){sHtml+='<div class="shape-canvas" style="'+shapeStyle.replace(/"/gm,"'")+'"></div>'}else{sHtml+='<div class="shape-canvas"></div>'}}else{sHtml+=item.outerHTML}}else{if(item.nodeName=="IFRAME"){var ss,sCode="<iframe";var bTmp=["id","class","frameborder","border","display","_widget"];for(var i2=0,sAttr;sAttr=bTmp[i5];i2++){ss=item.getAttribute(sAttr);if(ss){sCode+=" "+sAttr+'="'+ss+'"'}}ss=item.getAttribute("_src");if(ss&&ss!="about:blank"){sCode+=' src="'+ss+'"'}else{ss=item.getAttribute("src");if(ss){sCode+=' src="'+ss+'"'}}sHtml+=sCode+">"+item.innerHTML+"</iframe>"}else{if(item.classList.contains("wd-container")){}else{sHtml+=item.outerHTML}}}}}}}}}if(anyChild){sHtml+="\n"+sIndent}return sHtml+"</div>"}else{if(node.id=="abs-widgets"){var sHtml='<section id="abs-widgets">';var nodes=node.querySelectorAll("div.web-item");for(var i=0,item;item=nodes[i];i++){sHtml+="\n"+getCompnentHtml(item,false,iLevel)}return sHtml+"\n</section>\n"}else{return""}}};apiNode.offsetOfNode=function(node){var off={x:0,y:0};GetOffset_(node,off);return{x:off.x-WEB_BODY_LEFT,y:off.y-WEB_BODY_TOP}};apiNode.divToolClick=divToolClick_;apiNode.onWidgetClick=function(event){if(!beenReadonly_){itemDivOnclick(event)}};apiNode.onWidgetKeydown=function(event){if(!beenReadonly_){handleDocKeyDown(event)}};apiNode.onWinContextMenu=function(event){if(!beenReadonly_){handleContextMenu(event)}};apiNode.onWinMouseMove=function(event){if(!beenReadonly_){handleDomMouseMove(event)}};apiNode.onWinMouseUp=function(event){if(!beenReadonly_){handleDomMouseUp(event)}};apiNode.hideMenubar=function(){cfgMenu.style.display="none"};apiNode.unselect=function(){resizerNode_.style.display="none";holderNode_.style.display="none";holderNode_._current=null;var node=document.querySelector("div.curr-design");if(!node){return false}node.classList.remove("curr-design");var currLayer=node.style.zIndex;if(currLayer){currLayer=parseInt(currLayer);if(currLayer>=10000){node.style.zIndex=(currLayer-10000)+""}}hideWidgetHint();return true};apiNode.newWidget=function(sHtml,targNode,x,y,isShift){if(!targNode.classList.contains("web-panel")){return}var i=sHtml.indexOf("\n"),i2=sHtml.indexOf("SOFTWARE-WEBMAKER-");if(i>0&&i2>0&&i2<i){return}if(!isShift&&(targNode.classList.contains("row-panel")||targNode.classList.contains("col-panel"))){alert("widget only created in leaf panel");return}else{if(!isShift&&targNode.id=="web-body"){alert("can not create widget in root panel");return}}apiNode.innerHTML=sHtml;var node;if(apiNode.children.length==1&&(node=apiNode.children[0]).classList.contains("web-item")){node.parentNode.removeChild(node);node.classList.add("in-design");setWidgetWdHi(node);if(isShift){if(!node.style.width){return}node.classList.add("absolute-pos");absWidgets.appendChild(node);var r=bodyNode.getBoundingClientRect(),iLeft=Math.floor(x-r.left+0.5),iTop=Math.floor(y-r.top+0.5);node.setAttribute("_left",iLeft+"");node.setAttribute("_top",iTop+"");node.style.left=iLeft+"px";node.style.top=iTop+"px";initRactiveItem_(node,function(){resizeWebPanel(node)});setPageModified_();return}var currItem=null;for(var i=0,item;item=targNode.children[i];i++){if(item.classList.contains("web-item")){var r=item.getBoundingClientRect();if(y<r.top){currItem=item;break}else{if(x>=r.left&&x<r.left+r.width&&y>=r.top&&y<r.top+r.height){currItem=item;break}}}}if(currItem){targNode.insertBefore(node,currItem)}else{targNode.appendChild(node)}initRactiveItem_(node,function(){resizeWebPanel(targNode)});setPageModified_();selectOneItem(targNode)}else{apiNode.innerHTML=""}};apiNode.newPage=function(sNewId,sTargId){var iOld=bWebPageId_.indexOf(sWebPageId_);var sPos=sTargId=="left-side-area"?"left":"right";var sRet=synRequest_("/$addpage?pos="+sPos+"&curr="+sWebPageId_+"&add="+sNewId);if(sRet){var b=sRet.split(",");var index=b.indexOf(sNewId);if(index>0){bWebPageId_=b;if(sWebPageId_=="0"){bodyNode.setAttribute("_pageid",b.join(","))}var resUrl=CURR_USR_PATH+"$res/article-"+sNewId+".png";setCookie__("nav_setimg"+WEBMAKER_GROUP_ID,"[-"+(index+1)+",'"+resUrl+"']");var iNew=bWebPageId_.indexOf(sWebPageId_);if(iOld!=iNew&&iNew>=0){setCookie__("nav_shift"+WEBMAKER_GROUP_ID,iNew+"")}}}};apiNode.exchangePage=function(iTarg,iSour){var sRet=synRequest_("/$movepage?from="+iSour+"&to="+iTarg);if(sRet){var b=sRet.split(",");var iOld=b.indexOf(sWebPageId_);if(iOld>=0){bWebPageId_=b;if(sWebPageId_=="0"){bodyNode.setAttribute("_pageid",b.join(","))}setCookie__("nav_moveto"+WEBMAKER_GROUP_ID,"["+iSour+","+iTarg+"]");var iNew=b.indexOf(sWebPageId_);if(iNew>=0){setCookie__("nav_shift"+WEBMAKER_GROUP_ID,iNew+"")}}}};apiNode.inEditing=function(){var node=document.getElementById("dialog-mask");if(node&&node.style.display=="block"){return true}else{return false}};apiNode.delDesignItem=function(noConfirm,isAlert){apiNode.hideMenubar();if(beenReadonly_||apiNode.inEditing()){return false}var node=document.querySelector("div.curr-design");if(node){if(isAlert&&!confirm("do you want delete selected node?")){return false}var isPanel=false;if(node.classList.contains("web-panel")){if(node.id=="web-body"){return false}isPanel=true;if(!noConfirm&&node.querySelector("div.web-panel > div:not(.web-panel)")){if(!confirm("web-panel not empty, do you want delete selected panel?")){return false}}}hideWidgetHint();apiNode.unselect();var owner=node.parentNode;owner.removeChild(node);if(isPanel&&owner.children.length==0){owner.classList.remove("row-panel");owner.classList.remove("col-panel")}tryResizePanel_(owner,true);setPageModified_();return true}return false};apiNode.delCurrPage=function(){apiNode.hideMenubar();if(beenReadonly_||apiNode.inEditing()){return}if(sWebPageId_=="0"){alert("can not delete first page (index.html)");return}if(!confirm("do you want delete current page?")){return}var sRet=synRequest_("/$delpage?curr="+sWebPageId_);if(sRet=="OK"){setCookie__("nav_remove"+WEBMAKER_GROUP_ID,"article-"+sWebPageId_+".png");apiNode.gotoPage(0)}};apiNode.setCurrName=function(){apiNode.hideMenubar();if(beenReadonly_||apiNode.inEditing()){return}var node=getCurrSelected(1);if(node){var sName=window.prompt("Please enter widget name",node.getAttribute("name")||"");if(typeof sName=="string"){if(sName){node.setAttribute("name",sName)}else{node.removeAttribute("name")}setPageModified_()}}};apiNode.setConnectTo=function(){apiNode.hideMenubar();if(beenReadonly_||apiNode.inEditing()){return}var node=getCurrSelected(1);if(node){var sValue=window.prompt("Such as: signal:slot,signal2:slot2",node.getAttribute("_defs")||"");if(typeof sValue=="string"){sValue=sValue.trim();if(sValue){node.setAttribute("_defs",sValue)}else{node.removeAttribute("_defs")}setPageModified_()}}};apiNode.copyItem=function(){if(apiNode.inEditing()){return false}var node=getCurrSelected(0);if(node){var s="COMPONENT_OF_PINP_WEB,";if(node.classList.contains("web-item")){if(node.parentNode.id=="abs-widgets"){s+="3,"}else{s+="0,"}}else{var owner=node.parentNode;if(owner.classList.contains("row-panel")){s+="1,"}else{if(owner.classList.contains("col-panel")){s+="2,"}else{apiNode.copyToClipboard("");return false}}}var x=parseInt(node.getAttribute("_left")||"0")||Math.floor(node.offsetLeft+0.5);var y=parseInt(node.getAttribute("_top")||"0")||Math.floor(node.offsetTop+0.5);var w=parseInt(node.getAttribute("_width")||"0")||Math.floor(node.clientWidth+0.5);var h=parseInt(node.getAttribute("_height")||"0")||Math.floor(node.clientHeight+0.5);s+=x+","+y+","+w+","+h+",";s+=getCompnentHtml(node);apiNode.copyToClipboard(s);return true}else{return false}};apiNode.pasteItem=function(){if(beenReadonly_||apiNode.inEditing()){return}var node=getCurrSelected(0);var s=apiNode.textOfClipboard();var sPrefix="COMPONENT_OF_PINP_WEB,";if(s.indexOf(sPrefix)!=0){if(s.length<64){var b=s.split(",");if(b.length>=2&&b[0]=="BUFFER_OF_PINP_WEB"){if(!node){return}var iFlag=parseInt(b[1]),canAdd=false;var isPanel=node.classList.contains("web-panel");var isRow=isPanel&&node.classList.contains("row-panel");var isCol=isPanel&&node.classList.contains("col-panel");if(iFlag!=lastCutWidgetsId_){canAdd=false}else{if(isRow){if(iFlag==1){canAdd=true}}else{if(isCol){if(iFlag==2){canAdd=true}}else{if(isPanel&&lastCutWidgets_.length){canAdd=true;if(iFlag==1){node.classList.add("row-panel")}else{if(iFlag==2){node.classList.add("col-panel")}}}}}}if(canAdd){for(var i=0,item;item=lastCutWidgets_[i];i++){node.appendChild(item)}lastCutWidgets_=[];lastCutWidgetsId_=-1;tryResizePanel_(node,true);setPageModified_();selectOneItem(node)}}}return}var x,y,w,h,sHead="",iFlag=99,b=s.slice(sPrefix.length,sPrefix.length+40).split(",");if(b.length>=5){iFlag=parseInt(b[0]);x=parseInt(b[1]);y=parseInt(b[2]);w=parseInt(b[3]);h=parseInt(b[4]);sHead=b[0]+","+b[1]+","+b[2]+","+b[3]+","+b[4]+","}if(iFlag<0||iFlag>3){return}if(iFlag!=3&&!node){return}var sHtml=s.slice(sPrefix.length+sHead.length);apiNode.innerHTML=sHtml;if(apiNode.children.length!=1){apiNode.innerHTML="";return}var wdgt=apiNode.children[0];var targNode=null,added=[];if(iFlag==0){var isPanel=node.classList.contains("web-panel");var isRow=isPanel&&node.classList.contains("row-panel");var isCol=isPanel&&node.classList.contains("col-panel");var isItem=!isPanel&&node.classList.contains("web-item");if(isItem){var owner=node.parentNode;if(owner.classList.contains("web-panel")){targNode=owner;owner.insertBefore(wdgt,node);added.push(wdgt)}}else{if(isPanel&&!isRow&&!isCol){targNode=node;node.appendChild(wdgt);added.push(wdgt)}}}else{if(iFlag==3){if(wdgt.classList.contains("absolute-pos")){targNode=wdgt;holderNode_.parentNode.appendChild(wdgt);added.push(wdgt)}}else{var owner=node.parentNode;var isPanel=owner.classList.contains("web-panel");var isRow=isPanel&&owner.classList.contains("row-panel");var isCol=isPanel&&owner.classList.contains("col-panel");if(!isPanel&&node.id=="web-body"){if((iFlag==1&&node.classList.contains("row-panel"))||(iFlag==2&&node.classList.contains("col-panel"))){targNode=node;node.appendChild(wdgt);added.push(wdgt)}}else{if((iFlag==1&&isRow)||(iFlag==2&&isCol)){targNode=owner;owner.insertBefore(wdgt,node);added.push(wdgt)}else{if(iFlag==1&&isCol){if(node.classList.contains("row-panel")){targNode=node;node.appendChild(wdgt);added.push(wdgt)}else{if(!node.classList.contains("col-panel")){node.classList.add("row-panel");targNode=node;node.appendChild(wdgt);added.push(wdgt)}}}else{if(iFlag==2&&isRow){if(node.classList.contains("col-panel")){targNode=node;node.appendChild(wdgt);added.push(wdgt)}else{if(!node.classList.contains("row-panel")){node.classList.add("col-panel");targNode=node;node.appendChild(wdgt);added.push(wdgt)}}}}}}}}apiNode.innerHTML="";if(added.length){var itemNum=0;var triggerReady=function(){itemNum-=1;if(itemNum<=0&&targNode){resizeWebPanel(targNode)}};var deepSetWdHi=function(node){var isItem=node.classList.contains("web-item");var isPanel=!isItem&&node.classList.contains("web-panel");if(isItem||isPanel){if(node.classList.contains("absolute-pos")){setWidgetLeftTop(node)}setWidgetWdHi(node);node.classList.add("in-design");if(isItem){itemNum+=1;initRactiveItem_(node,triggerReady)}else{if(isPanel){for(var i=0,item;item=node.children[i];i++){deepSetWdHi(item)}}}}};for(var i=0,item;item=added[i];i++){deepSetWdHi(item)}setPageModified_()}if(targNode){selectOneItem(targNode)}};apiNode.widgetModified=function(node,s){if(!beenReadonly_&&node.classList.contains("web-item")){apiNode.innerHTML=s;var scriptNode=null,commentNode=null;for(var i=0,item;item=apiNode.childNodes[i];i++){if(item.nodeType==1&&item.nodeName=="SCRIPT"&&(item.getAttribute("type")||"").toLowerCase()=="text/ractive"){scriptNode=item}else{if(item.nodeType==8){commentNode=item}}}apiNode.innerHTML="";if(scriptNode){var cfg={};var sComment=commentNode?commentNode.nodeValue.trim():"";if(sComment){try{cfg=JSON.parse(sComment.replace(reLineComment,""))}catch(e){alert(e);return}}var containNode=document.createElement("div");containNode.classList.add("wd-container");if(node.r){delete node.r}node.innerHTML="";node.appendChild(containNode);node.appendChild(scriptNode);if(commentNode){node.appendChild(commentNode)}var iFlag=window.WEBMAKER_MASK||0;if(!beenReadonly_){iFlag=iFlag|1}cfg.__debug__=iFlag;addRactiveObj_(containNode,scriptNode,cfg);tryResizePanel_(node);setPageModified_()}}};apiNode.updateTextNode=function(node){setPageModified_()};apiNode.widgetSetProp=function(node,b){if(beenReadonly_){return}var isItem=node.classList.contains("web-item");if(!isItem&&!node.classList.contains("web-panel")){return}var clsChanged=false,newResizable=false;var xyChanged=false,whChanged=false,defChanged=false,sVars="",iNum=b.length;for(var i=0;i<iNum;i++){var item=b[i],sKey=item[0],sValue=item[1];if(sKey){if(sKey=="_width"||sKey=="_height"){whChanged=true;if(!sValue){node.removeAttribute(sKey);if(sKey=="_width"){node.removeAttribute("_dsWidth")}else{node.removeAttribute("_dsHeight")}}else{var fValue=parseFloat(sValue);if(fValue!=0){if(sKey=="_width"){node.removeAttribute("_dsWidth")}else{node.removeAttribute("_dsHeight")}}node.setAttribute(sKey,fValue+"")}}else{if(sKey=="_left"||sKey=="_top"){xyChanged=true;if(!sValue){node.removeAttribute(sKey)}else{node.setAttribute(sKey,sValue)}}else{if(sKey=="_class"){var oldResizable=isItem&&node.classList.contains("resizable");var sCurr=node.classList.contains("curr-design")?"in-design curr-design ":"in-design ";if(node.classList.contains("absolute-pos")){sCurr+="absolute-pos "}if(isItem){node.className="web-item "+sCurr+sValue.trim()}else{if(node.classList.contains("col-panel")){sCurr+="col-panel "}else{if(node.classList.contains("row-panel")){sCurr+="row-panel "}}node.className="web-panel "+sCurr+sValue.trim()}clsChanged=true;if(!oldResizable&&node.classList.contains("resizable")){newResizable=true}}else{if(isItem&&(sKey=="_widget"||sKey=="_src")){var scriptNode=node.querySelector("script[_widget]");if(scriptNode){defChanged=true;if(!sValue){scriptNode.removeAttribute(sKey)}else{scriptNode.setAttribute(sKey,sValue)}}}else{if(isItem){var processed=false;if(sKey=="_widget"||sKey=="_src"){var scriptNode=node.querySelector("script[_widget]");if(scriptNode){defChanged=true;processed=true;if(!sValue){scriptNode.removeAttribute(sKey)}else{scriptNode.setAttribute(sKey,sValue)}}}if(!processed){if(sVars){sVars+=","}sVars+=sKey+":";if(!sValue){sVars+="null"}else{sVars+=sValue}}}}}}}}}if(whChanged){setWidgetWdHi(node)}if(xyChanged){setWidgetLeftTop(node)}if(sVars){var succ=false,commentNode=null,containNode=null,scriptNode=null;for(var i=0,item;item=node.childNodes[i];i++){if(item.nodeType==1){if(item.classList.contains("wd-container")){containNode=item}else{if(item.nodeName=="SCRIPT"&&(item.getAttribute("type")||"").toLowerCase()=="text/ractive"){scriptNode=item}}}else{if(item.nodeType==8){commentNode=item}}}if(containNode&&scriptNode){try{var cfg=window.eval("0,{"+sVars+"}");sVars=formatJsonDict_(JSON.stringify(cfg));if(!commentNode){commentNode=document.createComment(sVars);node.appendChild(commentNode)}else{commentNode.nodeValue=sVars}var oldRactive=node.r;if(oldRactive){var iFlag=window.WEBMAKER_MASK||0;if(!beenReadonly_){iFlag=iFlag|1}cfg.__debug__=iFlag;oldRactive.data=cfg;oldRactive.update()}succ=true}catch(e){alert(e)}}if(!succ){sVars=""}}if(whChanged||xyChanged){tryResizePanel_(node);setPageModified_()}else{if(clsChanged){if(newResizable){tryResizePanel_(node)}setPageModified_()}else{if(defChanged||sVars){setPageModified_()}}}};apiNode.notifySaveSlide=function(sId){var req=null;if(window.XMLHttpRequest){req=new XMLHttpRequest()}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP")}}if(req){req.onreadystatechange=function(){if(req.readyState==4){var succ=false;if(req.status==200){if(req.responseText=="OK"){succ=true}}if(!succ){alert("Save document failed!")}}};req.open("GET","/$update?id="+sId,true);req.send(null)}};apiNode.gotoPage=function(index){if(apiNode.inEditing()){return}if(index===undefined){index=0}var sId=bWebPageId_[index]||"0";if(sId!=sWebPageId_){var sUrl=(sId=="0"?CURR_USR_PATH:CURR_USR_PATH+"index"+sId+".html");if(!beenReadonly_){setCookie__("nav_shift"+WEBMAKER_GROUP_ID,index+"");if(sId!="0"){sUrl+="?preview=0";sUrl+="&pipe="+encodeURIComponent(window.sharedPipe__||"");sUrl+="&hash="+encodeURIComponent(window.sharedHash__||"")}}window.location.replace(sUrl)}};if(!beenReadonly_){document.onmousemove=handleDomMouseMove;document.onmouseup=handleDomMouseUp;bodyNode.ondragover=webPageDragOver;bodyNode.ondrop=webPageDragDrop}resizeWebPanel(bodyNode,true);if(beenReadonly_){followPreholder()}if(!beenReadonly_){setInterval(function(){if(apiNode.inEditing()){return}var sNav=getCookie__("nav_index"+WEBMAKER_GROUP_ID);if(lastModifyPageId&&!beenReadonly_){var nowTime=new Date();if(sNav||(nowTime.valueOf()-lastModifyTime.valueOf())>=800){if(apiNode.savePageImg(lastModifyPageId)){var resUrl=CURR_USR_PATH+"$res/article-"+lastModifyPageId+".png";var i=bWebPageId_.indexOf(lastModifyPageId);if(i<0){i=bWebPageId_.length}setCookie__("nav_setimg"+WEBMAKER_GROUP_ID,"["+i+",'"+resUrl+"']")}var sHtml="<!--ARTICLE-START-->\n"+getCompnentHtml(bodyNode)+"\n<!--ARTICLE-END-->";apiNode.saveWebPage(lastModifyPageId,sHtml);lastModifyPageId=""}}if(sNav){delCookie__("nav_index"+WEBMAKER_GROUP_ID);apiNode.gotoPage(parseInt(sNav))}},1000);setCookie__("list_goto"+WEBMAKER_GROUP_ID,"1,/software/"+SOFTWARE_PRJ_NAME+"/shared")}}function IECheckReadyState(event){if(document.readyState=="complete"){document.detachEvent("onreadystatechange",IECheckReadyState);handleDomLoaded(event)}}function initWebMaker(){var s=document.location.pathname;if(s.slice(-1)!="/"){s=s.slice(0,s.lastIndexOf("/")+1)}window.CURR_USR_PATH=s;if(!(window.WEBMAKER_MAIN instanceof Object)){window.WEBMAKER_MAIN={config:{jsonBaseUrl:"http://localhost:8072",baseUrl:""}}}WEBMAKER_MAIN.config.sysModules=["basic10"];if(document.addEventListener){document.addEventListener("DOMContentLoaded",handleDomLoaded,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",IECheckReadyState)}else{document.onload=handleDomLoaded}}}initWebMaker()})();
