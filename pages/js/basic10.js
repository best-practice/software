define(function(){function h(){this.data=window.WEBMAKER_MAIN||{}}h.prototype={get:function(z){var x=this.data;if(typeof z=="string"&&z){var w=z.split(".");for(var s=0,y;y=w[s];s++){var v=y.split("[");if(v.length==1){x=x[y]}else{var u=v.shift();if(u){x=x[u]}for(var r=0,t;t=v[r];r++){t=t.slice(0,t.length-1);if(t){x=x[parseInt(t)]}else{break}}}}}return x},set:function(C,z){var r=this.data;if(typeof C=="string"&&C){var y=C.split("."),t=y.length-1;for(var u=0,B;B=y[u];u++){var x=B.split("[");if(x.length==1){if(u==t){r[B]=z}else{r=r[B]}}else{var w=x.shift();if(w){r=r[w]}var A=x.length-1;for(var s=0,v;v=x[s];s++){v=v.slice(0,v.length-1);if(v){if(u==t&&s==A){r[parseInt(v)]=z}else{r=r[parseInt(v)]}}else{break}}}}}},setCSS:function(u,t){var r=document.getElementById("abs-widgets");if(r&&u){if(r.querySelector('style[name="'+u+'"]')){return}var s=document.createElement("style");s.setAttribute("name",u);s.innerHTML=t;r.appendChild(s)}},removeCSS:function(t){var r=document.getElementById("abs-widgets");if(r&&t){var s=r.querySelector('style[name="'+t+'"]');if(s){s.parentNode.removeChild(s)}}}};var n=new h();if(document.body){n.wd=document.body;document.body.r=n}var i=function(r){if(typeof r=="string"&&r){var s=document.querySelector('div.web-item[name="'+r+'"]');if(s){return s.r}else{if(document.body.getAttribute("name")==r){return document.body.r}else{return void (0)}}}else{if(r instanceof Ractive){return r}else{return r.r}}};var k=function(r){while(r){if(r.nodeName=="DIV"&&r.classList.contains("web-item")){return r}else{r=r.parentNode}}return null};var j=function(r){if((typeof r=="string")&&r){return document.querySelector('div.web-item[name="'+r+'"]')}else{return null}};var a=function(r){return apiNode.offsetOfNode(r)};var e=function(r){while(r){if(r.nodeName=="DIV"&&r.id=="web-body"){return true}else{r=r.parentNode}}return false};var g=function(x,w,v){var s=w.wd;if(!s||s.classList.contains("in-design")){return}var r=s[x];if(r){for(var t=r.length-1;t>=0;t--){var y,u=r[t];if(u instanceof Array){y=u[1]||x;u=u[0]}else{y=x}if(e(u)){if(s!==u&&u.r){u.r.fire(y,v)}}else{r.splice(t,1)}}}};var f=null;var q=function(){if(!f){f=new Messenger.DCF()}return f};var o={version:function(s){var r=Messenger.DCF.ver;if(s){Messenger.DCF.ver=s}return r},regist:function(r,s){q().regist(r,s);return this},isReady:function(r,s,t){q().isReady(r,s,t);return this},setPeerName:function(r,s,t,u){q().setPeerName(r,s,t,u);return this},call:function(v,r,u,w,x,t){var s=q();if(t){s.isReady(v,2000,function(y){if(y.isReady){s.call(v,r,u,w,x,t)}else{t(y)}})}else{s.call(v,r,u,w,x)}return this}};var m=null;var p=function(){if(!m){var r=function(){};r.prototype=o;m=new r()}return m};i.BaseWidget={__widget__:[],init:function(x){var s=k(x.el);this.wd=s;if(s){var r=s.querySelectorAll("div.wd-container > *[name]");for(var w=0,A;A=r[w];w++){var v=A.getAttribute("name");if(v){this[v]=A}}}var y=this.__widget__||[];for(var w=0,A;A=y[w];w++){var u=null;if(typeof A=="string"){if(A){u=j(A);if(!u&&document.body.getAttribute("name")==A){u=document.body}if(u){this[A]=u}else{console.log("can not find widget: web-item[name="+A+"]")}}}else{if(A.r instanceof Ractive){u=A;A=u.getAttribute("name");if(A){this[A]=u}}}}if(s&&s.classList.contains("resizable")){var t=a(s);this.set("resizable.left",t.x);this.set("resizable.top",t.y);this.set("resizable.width",s.clientWidth);this.set("resizable.height",s.clientHeight);var z=this;setTimeout(function(){z.fire("resize")},0)}}};if(!window.TRIGGER__){window.TRIGGER__={}}if(!window.TRIGGERID__){window.TRIGGERID__=1}function l(){var r=window.TRIGGERID__+1;window.TRIGGERID__=r;return r}function d(t,r,s){s.fire("error",t,r)}function c(r,s){s.fire("replied",r)}function b(z,u,w,y,v){var s=l();var r=(z&&z[0]==":")?(n.data.config.jsonBaseUrl||"")+z.slice(1):z,t=r;if(t.indexOf("?")>0){t+="&"}else{t+="?"}t+="callback=TRIGGER__%5B"+s+"%5D";var x=document.createElement("script");x.addEventListener("error",function(A){if(window.TRIGGER__[s]){document.body.removeChild(x);delete TRIGGER__[s];if(w){w("invalid","invalid JSON ("+r+")",v)}}},false);document.body.appendChild(x);setTimeout(function(){if(window.TRIGGER__[s]){document.body.removeChild(x);delete TRIGGER__[s];if(w){w("timeout","request JSON from ("+r+") timeout",v)}}},y||20000);window.TRIGGER__[s]=function(A){var B=TRIGGER__[s];if(B){document.body.removeChild(x);delete TRIGGER__[s];if(u){u(A,v)}}};x.src=t}i.JsonP={__base__:i.BaseWidget,init:function(r){this._super(r);var s=this;s.on("replied",function(t){if(t instanceof Object){s.set(t)}});s.on("error",function(t,u){alert(u)});if(r.data.__auto__){this.queryJSON()}},queryJSON:function(){b(this.data.__url__,c,d,this.data.__wait__,this);return this}};i.ClickableDiv={__base__:i.BaseWidget,init:function(r){this._super(r);var s=this;var t=(s.get("__debug__")||0)&1;s.on("ssActivate",function(u){if(!t&&u.original){if(s.get("stopPropagation")){u.original.stopPropagation()}if(s.get("preventDefault")){u.original.preventDefault()}g("ssActivate",s,u)}})}};i.PopDiv={__base__:i.BaseWidget,init:function(r){this._super(r);var s=this;var u=(s.get("__debug__")||0)&1;var t=function(v){s.fire("ssClose",{node:s.el,original:v,keypath:"",context:s.data,index:0})};if(!u){document.addEventListener("click",t,false);s.on("teardown",function(v){document.removeEventListener("click",t,false)})}s.on("ssActivate",function(v){if(!u){if(v.original){v.original.stopPropagation()}g("ssActivate",s,v)}});s.on("ssShow",function(v){s.visibility("visible");s.display("block");g("ssShow",s,v)});s.on("ssClose",function(v){s.display("none");g("ssClose",s,v)});s.on("ssHide",function(v){s.visibility("hidden");s.display("block");g("ssHide",s,v)})},zIndex:function(v){var t=0,r=this.wd;if(r){var u=r.style.zIndex;if(!u||u=="auto"||u=="inherit"){u="0"}t=parseInt(u);if(typeof v=="number"){r.style.zIndex=v+""}}return t},visibility:function(t){var s="",r=this.wd;if(r){s=r.style.visibility||"visible";if(typeof t=="string"){r.style.visibility=t}}return s},display:function(t){var s="",r=this.wd;if(r){s=r.style.display||"block";if(typeof t=="string"){r.style.display=t}}return s}};i.IFrame={__base__:i.BaseWidget,init:function(s){this._super(s);var t=this;var w=(this.get("__debug__")||0)&1;var x=t.wd;var u=t.el.querySelector("iframe");if(u){if(x){var v=x.getAttribute("name");if(v){u.setAttribute("id",v)}}var r="/software/pages/default_iframe.html";if(w){if(window.apiNode){u.onclick=window.apiNode.onWidgetClick}}else{r=s.data.url||r}u.src=r}},version:o.version,regist:o.regist,isReady:o.isReady,call:o.call,zIndex:function(v){var t=0,r=this.wd;if(r){var u=r.style.zIndex;if(!u||u=="auto"||u=="inherit"){u="0"}t=parseInt(u);if(typeof v=="number"){r.style.zIndex=v+""}}return t},visibility:function(t){var s="",r=this.wd;if(r){s=r.style.visibility||"visible";if(typeof t=="string"){r.style.visibility=t}}return s},display:function(t){var s="",r=this.wd;if(r){s=r.style.display||"block";if(typeof t=="string"){r.style.display=t}}return s},refreshUrl:function(s){var t=this.el.querySelector("iframe");var u=(this.get("__debug__")||0)&1;if(!u&&t){var r;if(typeof s=="string"){this.data.url=r=s}else{r=this.get("url")||""}if(r.slice(0,1)==":"){r=n.data.config.jsonBaseUrl+r.slice(1)}if(r){t.src=r}}}};i.queryJSON=b;i.getDCF=p;i.ownerWidget=k;i.widgetByName=j;i.offsetOfNode=a;i.isWidgetAlive=e;i.triggerSignal=g;return i});
