var regExprRgb=/\b(rgb|rgba)\s*\(([^)]*)\)/m;function parseRgbColor(e){var a=regExprRgb.exec(e);if(a){var c=a[2].split(",");for(var d=0,f;f=c[d];d++){if(d<3){c[d]=parseInt(f)||0}else{c[d]=parseFloat(f)}}return c}else{return null}}function setupSvgDataUrl(j,i,c,d,k){var h="",g=0,b=/<g\b.*?\b_widget=.*?>/gm;var a=/\bstroke='.*?'/m,f=/\bfill='.*?'/m,l=/\bstroke-width='.*?'/m,n=/\bstroke-dasharray='.*?'/m;var e=b.exec(j);while(e){var o=e[0];h+=j.slice(g,e.index);g=e.index+o.length;o=o.replace(a,"stroke='"+i+"'").replace(f,"fill='"+c+"'").replace(l,"stroke-width='"+d+"'").replace(n,"stroke-dasharray='"+k+"'");h+=o;e=b.exec(j)}if(g<j.length){h+=j.slice(g)}return h}function getAngleLen(b,j,a,h){var e=a-b,d=h-j;var k=Math.abs(e);var g=Math.abs(d);var f=Math.sqrt(k*k+g*g);var i=Math.acos(g/f);var c=180/(Math.PI/i);if(e>0){return[f,(d>0)?(90-c):(270+c)]}else{return[f,(d>0)?(90+c):(270-c)]}}function getCtrlPoint(v,f,t,e,r,d,q,c){var l=0.35,k=0.333;if(v===undefined){if(q===undefined){return[t,e,r,d]}var g=getAngleLen(t,e,r,d),A=g[0];var o=getAngleLen(r,d,q,c),h=o[0];var y=Math.abs(o[1]-g[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var x=(A*l)/h;var b=r-x*(q-r);var B=d-x*(c-d);var j=b-(b-t)*k;var i=B-(B-e)*k;var u=t+(b-t)*k;var s=e+(B-e)*k;return[u,s,j,i]}else{var w=getAngleLen(v,f,t,e),p=w[0];var g=getAngleLen(t,e,r,d),A=g[0];var y=Math.abs(g[1]-w[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var z=(A*l)/p;var n=t+z*(t-v);var m=e+z*(e-f);var u=n+(r-n)*k;var s=m+(d-m)*k;var j,i;if(q===undefined){j=r-(r-n)*k;i=d-(d-m)*k}else{var o=getAngleLen(r,d,q,c),h=o[0];var y=Math.abs(o[1]-g[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var x=(A*l)/h;var b=r-x*(q-r);var B=d-x*(c-d);j=b-(b-t)*k;i=B-(B-e)*k}return[u,s,j,i]}}var ARROW_SIDE_FACTOR=4;function buildShape2(node,rebuild,resizing){while(node){if(node.classList.contains("svg-shape")){break}node=node.parentNode}if(!node){return}var bTmp=[],imgNodes=node.querySelectorAll("div.img-resource > link");var imgNum=imgNodes.length;if(imgNum<1||imgNum>3){return}for(var i=0,item;item=imgNodes[i];i++){var data=jsonOfSvg_[item.href];if(!data||data instanceof Array){return}bTmp.push(data)}imgNodes=bTmp;if(node._hasBuild&&!rebuild){return}node._hasBuild=true;var sForeColor,sBackColor,iStyle,iStrokeWd=3,sStrokeDash="",fixFirst=false;var cfgData=node.getAttribute("_widget")||"null";cfgData=window.eval(cfgData);if(cfgData instanceof Array&&cfgData.length>=3){sForeColor=cfgData[0];sBackColor=cfgData[1];iStyle=parseInt(cfgData[2]);if(iStyle>=8){fixFirst=true;iStyle-=8}if(cfgData.length>=4){iStrokeWd=parseInt(cfgData[3]);if(iStrokeWd<=0){iStrokeWd=1}}if(cfgData.length>=5){var subCfg=cfgData[4];if(subCfg instanceof Array&&subCfg.length>=1){sStrokeDash=subCfg[0]}}}else{return}var iWholeWd,iWholeHi,ownerNode=node.querySelector("div.shape-canvas");if(!ownerNode){return}if(resizing){iWholeWd=node.clientWidth;iWholeHi=node.clientHeight}else{iWholeWd=parseInt(node.getAttribute("_width")||"200");iWholeHi=parseInt(node.getAttribute("_height")||"60")}if((iStyle==-1||iStyle==-2)&&cfgData.length>=5&&imgNum==1){var _svg=imgNodes[0],arrowCfg=cfgData[4],iLen=arrowCfg.length;if(iLen<8){return}var preType=arrowCfg[2],postType=arrowCfg[3];var sDashArray="stroke-dasharray='"+sStrokeDash+"' ";var defId=node.getAttribute("_defs")||"mrk_";var preMarker="",preDef="";if(preType>=1){var preTag="mrk"+preType+"_start";preDef=_svg[preTag];if(!preDef){return}var preTag2=defId+"_start";preDef=preDef.replace(preTag,preTag2);preMarker="marker-start='url(#"+preTag2+")' "}var postMarker="",postDef="";if(postType>=1){var postTag="mrk"+postType+"_end";postDef=_svg[postTag];if(!postDef){return}var postTag2=defId+"_end";postDef=postDef.replace(postTag,postTag2);postMarker="marker-end='url(#"+postTag2+")' "}var iSideGap=Math.floor(iStrokeWd*2.5+0.5);iSideGap*=ARROW_SIDE_FACTOR;if(iWholeWd<=iSideGap+iSideGap||iWholeHi<=iSideGap+iSideGap){ownerNode.innerHTML="";return}var iWd=0,iHi=0;for(var i=5;i<iLen;i+=2){var x=arrowCfg[i-1],y=arrowCfg[i];if(x>iWd){iWd=x}if(y>iHi){iHi=y}}var rateX=iWd==0?0:(iWholeWd-iSideGap-iSideGap)/iWd;var rateY=iHi==0?0:(iWholeHi-iSideGap-iSideGap)/iHi;var bNew=[],lastPtX=undefined,lastPtY=undefined;for(var i=5;i<iLen;i+=2){var iCurX=arrowCfg[i-1]*rateX+iSideGap;var iCurY=arrowCfg[i]*rateY+iSideGap;if(lastPtX!==iCurX||lastPtY!==iCurY){bNew.push(iCurX,iCurY);lastPtX=iCurX;lastPtY=iCurY}}var sPoints="",sPath="";if(iStyle==-1){var iNewLen=bNew.length;for(var i=1;i<iNewLen;i+=2){if(i>1){sPoints+=" "}sPoints+=bNew[i-1]+","+bNew[i]}}else{var iNewLen=bNew.length;if(iNewLen==4){sPath="M"+bNew[0]+" "+bNew[1]+"L"+bNew[2]+" "+bNew[3]}else{bNew.unshift(undefined,undefined);iNewLen+=2;sPath="M"+bNew[2]+" "+bNew[3];for(var i=3;i<iNewLen;i+=2){var x1=bNew[i-3],y1=bNew[i-2],x2=bNew[i-1],y2=bNew[i];if(i<=iNewLen-3){var x3=bNew[i+1],y3=bNew[i+2],x4=undefined,y4=undefined;if(i<=iNewLen-5){x4=bNew[i+3];y4=bNew[i+4]}var ctrls=getCtrlPoint(x1,y1,x2,y2,x3,y3,x4,y4);sPath+="C"+ctrls[0]+" "+ctrls[1]+" "+ctrls[2]+" "+ctrls[3]+" "+x3+" "+y3}else{break}}}}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWholeWd+" "+iWholeHi+'" ';var sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg">';sHtml+="<g _widget='null' stroke='rgb(54,54,54)' fill='rgb(54,54,54)' "+sDashArray+"stroke-width='3'>";if(preDef||postDef){sHtml+="<defs>"+preDef+postDef+"</defs>"}if(iStyle==-1){sHtml+="<polyline "+preMarker+postMarker+"fill='rgba(0,0,0,0)' points='"+sPoints+"'/>"}else{sHtml+="<path "+preMarker+postMarker+"fill='rgba(0,0,0,0)' d='"+sPath+"'/>"}sHtml+="</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash);return}if(imgNum==1){var _svg=imgNodes[0],sHtml=_svg.svg,iWd=_svg.width,iHi=_svg.height;var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+iHi+'" ';if(!_svg.scalable){sHtml='<g transform="scale('+iWholeWd/iWd+","+iWholeHi/iHi+')">'+sHtml+"</g>"}sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg">'+sHtml+"</svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(imgNum==2){var _svg=imgNodes[0],_svg2=imgNodes[1];var sHtml=_svg.svg,sHtml2=_svg2.svg;var iWd=_svg.width,iHi=_svg.height,iWd2=_svg2.width,iHi2=_svg2.height;if(iStyle==1){if(iHi!=iHi2){return}if(_svg.scalable||_svg2.scalable){return}var x,x2,svgWd=iHi*iWholeWd/iWholeHi;if(fixFirst){x=iWd;x2=svgWd-iWd;if(x2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate('+(x-1)+",0) scale("+((x2+1)/iWd2)+',1)">'+sHtml2+"</g>";sHtml=sHtml+sHtml2}else{x=svgWd-iWd2;x2=iWd2;if(x<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale('+((x+1)/iWd)+',1)">'+sHtml+"</g>";sHtml2='<g transform="translate('+x+',0)">'+sHtml2+"</g>";sHtml=sHtml2+sHtml}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+svgWd+" "+iHi+'" ';var fScale=iWholeHi/iHi;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(iStyle==2){if(iWd!=iWd2){return}if(_svg.scalable||_svg2.scalable){return}var y,y2,svgHi=iWd*iWholeHi/iWholeWd;if(fixFirst){y=iHi;y2=svgHi-iHi;if(y2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate(0,'+(y-1)+") scale(1,"+((y2+1)/iHi2)+')">'+sHtml2+"</g>";sHtml=sHtml+sHtml2}else{y=svgHi-iHi2;y2=iHi2;if(y<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale(1,'+((y+1)/iHi)+')">'+sHtml+"</g>";sHtml2='<g transform="translate(0,'+y+')">'+sHtml2+"</g>";sHtml=sHtml2+sHtml}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+svgHi+'" ';var fScale=iWholeWd/iWd;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}}}else{if(imgNum==3){var _svg=imgNodes[0],_svg2=imgNodes[1],_svg3=imgNodes[2];var sHtml=_svg.svg,sHtml2=_svg2.svg,sHtml3=_svg3.svg;var iWd=_svg.width,iHi=_svg.height,iWd2=_svg2.width,iHi2=_svg2.height,iWd3=_svg3.width,iHi3=_svg3.height;if(iStyle==1){if(iHi!=iHi2||iHi2!=iHi3){return}if(_svg.scalable||_svg2.scalable||_svg3.scalable){return}var x,x2,x3,svgWd=iHi*iWholeWd/iWholeHi;if(fixFirst){x=iWd;x2=svgWd-iWd-iWd3;x3=iWd3;if(x2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate('+(x-1)+",0) scale("+((x2+2)/iWd2)+',1)">'+sHtml2+"</g>";sHtml3='<g transform="translate('+(x+x2)+',0)">'+sHtml3+"</g>";sHtml=sHtml+sHtml3+sHtml2}else{x=(svgWd-iWd2)*iWd/(iWd+iWd3);x2=iWd2;x3=svgWd-x-iWd2;if(x<=0||x3<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale('+((x+1)/iWd)+',1)">'+sHtml+"</g>";sHtml2='<g transform="translate('+x+',0)">'+sHtml2+"</g>";sHtml3='<g transform="translate('+(x+x2-1)+",0) scale("+((x3+1)/iWd3)+',1)">'+sHtml3+"</g>";sHtml=sHtml2+sHtml+sHtml3}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+svgWd+" "+iHi+'" ';var fScale=iWholeHi/iHi;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(iStyle==2){if(iWd!=iWd2||iWd2!=iWd3){return}if(_svg.scalable||_svg2.scalable||_svg3.scalable){return}var y,y2,y3,svgHi=iWd*iWholeHi/iWholeWd;if(fixFirst){y=iHi;y2=svgHi-iHi-iHi3;y3=iHi3;if(y2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate(0,'+(y-1)+") scale(1,"+((y2+2)/iHi2)+')">'+sHtml2+"</g>";sHtml3='<g transform="translate(0,'+(y+y2)+')">'+sHtml3+"</g>";sHtml=sHtml+sHtml3+sHtml2}else{y=(svgHi-iHi2)*iHi/(iHi+iHi3);y2=iHi2;y3=svgHi-y-y2;if(y<=0||y3<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale(1,'+((y+1)/iHi)+')">'+sHtml+"</g>";sHtml2='<g transform="translate(0,'+y+')">'+sHtml2+"</g>";sHtml3='<g transform="translate(0,'+(y+y2-1)+") scale(1,"+((y3+1)/iHi3)+')">'+sHtml3+"</g>";sHtml=sHtml2+sHtml+sHtml3}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+svgHi+'" ';var fScale=iWholeWd/iWd;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}}}}}}var jsonOfSvg_={};function requestOneSvg(c){var d=jsonOfSvg_[c.href];if(d){if(d instanceof Array){d.push(c)}else{buildShape2(c)}return}var b=null;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}if(!b){return}var a=[c];jsonOfSvg_[c.href]=a;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){jsonOfSvg_[c.href]=JSON.parse(b.responseText);for(var e=0,f;f=a[e];e++){buildShape2(f)}}a=null;b=null}};b.open("GET",c.href,true);b.send(null)}function prepareSvgRes(c){if(jsonOfSvg_[c.href]){return}var b=null;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}if(!b){return}var a=[c];jsonOfSvg_[c.href]=a;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){jsonOfSvg_[c.href]=JSON.parse(b.responseText);for(var d=0,e;e=a[d];d++){buildShape2(e)}}a=null;b=null}};b.open("GET",c.href,true);b.send(null)}function resetSvgColor(node,sStrokeClr,sFillClr,fOpacity){var sWidget=node.getAttribute("_widget")||"null";var cfgData=window.eval(sWidget);var iStrokeWd=3;if(cfgData instanceof Array&&cfgData.length>=3){if(!sStrokeClr){sStrokeClr=cfgData[0]}if(!sFillClr){sFillClr=cfgData[1]}if(cfgData.length>=4){iStrokeWd=parseInt(cfgData[3]);if(iStrokeWd<1){iStrokeWd=1}}}else{return}if(typeof fOpacity=="number"){var b=parseRgbColor(sStrokeClr);if(b.length>=3){sStrokeClr="rgba("+b[0]+","+b[1]+","+b[2]+","+fOpacity+")"}else{return}b=parseRgbColor(sFillClr);if(b.length>=3){sFillClr="rgba("+b[0]+","+b[1]+","+b[2]+","+fOpacity+")"}else{return}}cfgData[0]=sStrokeClr;cfgData[1]=sFillClr;node.setAttribute("_widget",JSON.stringify(cfgData).replace(/"/gm,"'"));var groups=node.querySelectorAll("g[_widget]");for(var i=0,item;item=groups[i];i++){item.setAttribute("stroke",sStrokeClr);item.setAttribute("fill",sFillClr);if(item.hasAttribute("stroke-width")){item.setAttribute("stroke-width",iStrokeWd)}}}var hasInit=false;var currFontFamily="";var currSourFont="";var currContentFont="";var currExtendStyle="";var currPaperName="";var currPaperFontSize="default-large-small";var CURR_USR_PATH="";var SVG_PAPER_USE_CLASS="small-default-large p1-p2-p3-p0 center-right-default";var SVG_PAPER_CFG_CLASS="small-default-large default-looser-impacted p1-p2-p3-p0 center-right-default";if(typeof window.HTMLElement!=="undefined"){HTMLElement.prototype.toId=function(){return this}}else{if(typeof window.Element!=="undefined"){Element.prototype.toId=function(){return this}}}function stringHashCode(d){var e=0,b,c,a;if(d.length==0){return e}for(b=0,a=d.length;b<a;b++){c=d.charCodeAt(b);e=((e<<5)-e)+c;e|=0}return e}var WEB_BROWSER_TYPE="";var WEB_BROWSER_VER="";var WEB_BROWSER_PRE="";function initPaper(a){if(hasInit){return}hasInit=true;var n=navigator.userAgent;n=n.toLowerCase();var f=n.match(/trident.*rv[ :]*([\d.]+)/);if(f){if(parseFloat(f[1])>=11){WEB_BROWSER_TYPE="ie";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE="-ms-"}}else{f=n.match(/firefox\/([\d.]+)/);if(f){WEB_BROWSER_TYPE="firefox";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE=""}else{f=n.match(/chrome\/([\d.]+)/);if(f){WEB_BROWSER_TYPE="chrome";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE="-webkit-"}else{f=n.match(/opera.([\d.]+)/);if(f){WEB_BROWSER_TYPE="opera";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE="-o-"}else{f=n.match(/safari\/([\d.]+)/);if(f){WEB_BROWSER_TYPE="safari";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE="-webkit-"}else{f=n.match(/webkit\/([\d.]+)/);if(f){WEB_BROWSER_TYPE="webkit";WEB_BROWSER_VER=f[1];WEB_BROWSER_PRE="-webkit-"}}}}}}var c=document.getElementById("root-paper");var q=a[1];if(q){var o=q.split(" "),d=o.length;for(var k=0;k<d;k++){var p=o[k];if(p){c.classList.add(p);if(p=="default-large-small"||p=="large-small-default"||p=="small-default-large"){currPaperFontSize=p}}}SVG_PAPER_USE_CLASS=c.className.replace("svg-paper","svg-shape")}currPaperName=a[2]||"pp0";currFontFamily=a[3]||"";currSourFont=a[4]||"";currContentFont=a[5]||"";currExtendStyle=a[6]||"";CURR_USR_PATH=a[7]||"";if(currFontFamily){document.body.style.fontFamily=currFontFamily}if(currExtendStyle){var e=document.createElement("style");e.innerHTML=currExtendStyle;document.querySelector("head").appendChild(e)}c.innerHTML=(a[0]||"");for(var k=0,p;p=c.childNodes[k];k++){if(p.nodeType==1&&p.classList.contains("svg-shape")){initDesignPos(p,false,true);var o=p.querySelectorAll("div.img-resource > link");for(var g=0,l;l=o[g];g++){prepareSvgRes(l)}}}var j=getCookie__("PINP_DRAWBK"+stringHashCode(CURR_USR_PATH));if(j){c.style.backgroundColor=j;var h=document.querySelector(".popline-frame");if(h){setTimeout(function(){if(h.contentWindow.getContent){h.contentWindow.document.body.style.backgroundColor=j}},1000)}}}function finishEditing(a){unselectCurr();apiNode.setCloseState(a);window.close()}function getOutputHtml(){return document.getElementById("root-paper").innerHTML}var currDbClickClrDiv=null;var apiNode=null;var PAPER_OFFSET_TOP=70;function UpDownBtnHint(f){var d=f.target;var e=d.getBoundingClientRect();var c,b,a=f.clientX-e.left,g=f.clientY-e.top;if(e.width-a<18){if(e.height-g<=13){c="100% -36px"}else{c="100% -18px"}b="default"}else{c="100% 0px";b="auto"}d.style.backgroundPosition=c;d.style.cursor=b}function UpDownBtnHintOut(b){var a=b.target;a.style.backgroundPosition="100% 0px"}function showGridClick(e,d){var f=document.getElementById("root-paper");if(d.checked){f.style.backgroundImage='url("/software/slide11/$plugins/papergrid.svg")';f.style.backgroundRepeat="repeat"}else{f.style.backgroundImage="";f.style.backgroundRepeat=""}var c=d.checked?"block":"none";var a=document.getElementById("top-ruler");a.style.display=c;var b=document.getElementById("left-ruler");b.style.display=c}function switchGrid(b){var a=document.getElementById("group-grid");a.checked=!a.checked;showGridClick(b,a);hideInlineDialog();b.stopPropagation()}function hideInlineDialog(){var a=document.getElementById("color-dlg");a.style.display="none";currDbClickClrDiv=null;document.getElementById("opacity_dropdown").style.display="none";opacityInMove_=false;document.getElementById("linestyle_dropdown").style.display="none";document.getElementById("arrowstyle_dropdown").style.display="none"}function bodyOnResize(b){var a=document.getElementById("root-paper");a.style.height=(window.innerHeight-PAPER_OFFSET_TOP)+"px";var d=document.getElementById("text-area");d.style.left=(document.body.clientWidth-361)+"px";var c=document.getElementById("dlg-mask");c.style.width=document.body.clientWidth+"px";c.style.height=window.innerHeight+"px"}function bodyOnClick(a){hideInlineDialog();a.stopPropagation()}function bodyOnDblClick(a){hideInlineDialog();a.stopPropagation()}function switchEditorArea(b,a){var c=document.querySelector(".popline-frame");if(c.clientHeight<100){c.style.height="270px";c.parentNode.style.height="270px";a.style[WEB_BROWSER_PRE+"transform"]="rotate(90deg)"}else{c.style.height="70px";c.parentNode.style.height="70px";a.style[WEB_BROWSER_PRE+"transform"]="rotate(270deg)"}hideInlineDialog();b.preventDefault();b.stopPropagation()}var opacityInMove_=false;var opacityMoveX_=0;function opacityMouseDown(a){if(a.button==0&&!a.ctrlKey&&!a.shiftKey&&!a.altKey){opacityInMove_=true;opacityMoveX_=a.clientX}}function setWidgetPos(b,a,f){b.setAttribute("_left",a+"");b.setAttribute("_top",f+"");b.style.left=a+"px";b.style.top=f+"px";if(b.classList.contains("in-operation")){var e=document.querySelector("div.free-transform");e.style.left=(a-2)+"px";e.style.top=(f-2+PAPER_OFFSET_TOP)+"px";var c=b.getBoundingClientRect();var d=document.querySelector("div.halo");d.style.left=c.left+"px";d.style.top=c.top+"px"}}function setWidgetPos2(e,a,i,b,c){var g=document.querySelector("div.free-transform");g.style.left=(a-2)+"px";g.style.top=(i-2+PAPER_OFFSET_TOP)+"px";g.style.width=(b+4)+"px";g.style.height=(c+4)+"px";var d=e.getBoundingClientRect();var f=document.querySelector("div.halo");f.style.left=d.left+"px";f.style.top=d.top+"px";f.style.width=d.width+"px";f.style.height=d.height+"px"}var lastArrowStroke_="rgb(51,51,51)";var lastArrowFill_="rgb(51,51,51)";var lastArrowDash_="";var lastArrowStrokeWd_=3;var lastArrowStyle_=2;function resetArrowPos(l,e,g,f){var j=e[4],v=j.length;var o=parseInt(e[3]);if(o<=0){o=1}var k=Math.floor(2.5*o+0.5);k*=ARROW_SIDE_FACTOR;var u=65535,s=65535,t=0,r=0;for(var q=5;q<v;q+=2){var n=j[q-1],m=j[q];if(n<u){u=n}if(m<s){s=m}}for(var q=5;q<v;q+=2){var n=j[q-1]-u,m=j[q]-s;j[q-1]=n;j[q]=m;if(n>t){t=n}if(m>r){r=m}}pointOrgX_-=u;pointOrgY_-=s;var a=l.getBoundingClientRect();var c=Math.floor(a.left+u*g+0.5);var h=Math.floor(a.top-PAPER_OFFSET_TOP+s*f+0.5);var b=k+k+1;var p=Math.floor(Math.max(t*g+k+k,b)+0.5);var d=Math.floor(Math.max(r*f+k+k,b)+0.5);l.style.left=c+"px";l.style.top=h+"px";l.style.width=p+"px";l.style.height=d+"px";l.setAttribute("_widget",JSON.stringify(e).replace(/"/gm,"'"));l.setAttribute("_left",c+"");l.setAttribute("_top",h+"");l.setAttribute("_width",p+"");l.setAttribute("_height",d+"");buildShape2(l,true)}function getAngle(b,j,a,h){var e=a-b,d=h-j;var k=Math.abs(e);var g=Math.abs(d);var f=Math.sqrt(k*k+g*g);var i=Math.acos(g/f);var c=180/(Math.PI/i);if(e>0){return(d>0)?(90-c):(270+c)}else{return(d>0)?(90+c):(270-c)}}function moveWidgetLink(b,e,d){var c=parseInt(b.style.left)+e;var a=parseInt(b.style.top)+d;b.style.left=c+"px";b.style.top=a+"px";b.setAttribute("_left",c+"");b.setAttribute("_top",a+"")}function pointInRect(a,c,b){if(a>=b.left&&a<b.left+b.width&&c>=b.top&&c<b.top+b.height){return true}else{return false}}function linkTwoWidgets(sourNode,targNode,isSmooth){var sourName=sourNode.getAttribute("name");var toArrow=window.eval(sourNode.getAttribute("_toArrow")||"[]");var targName=targNode.getAttribute("name");var fromArrow=window.eval(targNode.getAttribute("_fromArrow")||"[]");var rect=sourNode.getBoundingClientRect();var rect2=targNode.getBoundingClientRect();var interacted=false;if(pointInRect(rect.left,rect.top,rect2)||pointInRect(rect.left+rect.width-1,rect.top,rect2)||pointInRect(rect.left+rect.width-1,rect.top+rect.height-1,rect2)||pointInRect(rect.left,rect.top+rect.height-1,rect2)){interacted=true}var sNewId="";var oldStroke=lastArrowStroke_,oldFill=lastArrowFill_,oldStrokeWd=lastArrowStrokeWd_,oldDash=lastArrowDash_,oldStyle=lastArrowStyle_;for(var i=0,item;item=toArrow[i];i++){var sTarg=item[2];if(sTarg&&sTarg==targName){var arrow=document.querySelector('div.svg-shape[name="'+item[0]+'"]');if(arrow){var cfgData=window.eval(arrow.getAttribute("_widget")||"null");if(cfgData instanceof Array){oldStroke=(cfgData.length>=1)?cfgData[0]:"rgb(51,51,51)";oldFill=(cfgData.length>=2)?cfgData[1]:"rgb(51,51,51)";oldStrokeWd=(cfgData.length>=4)?cfgData[3]:3;if(cfgData.length>=5){var subCfg=cfgData[4];oldDash=(subCfg.length>=1)?subCfg[0]:"";oldStyle=(subCfg.length>=4)?subCfg[3]:2}}arrow.parentNode.removeChild(arrow);if(interacted){if(item.length==3){item.push([oldStroke,oldFill,oldStrokeWd,oldDash,oldStyle])}}else{if(item.length==4){var bSaved=item[3];item.splice(3,1);oldStroke=bSaved[0];oldFill=bSaved[1];oldStrokeWd=bSaved[2];oldDash=bSaved[3];oldStyle=bSaved[4]}}}if(isSmooth===undefined){isSmooth=(item[1]==-2)}sNewId=item[0];if(sourName){var index=fromArrow.indexOf(sourName);if(index>=0){fromArrow.splice(index,1)}}break}}if(!sNewId){sNewId=newWidgetId();toArrow.push([sNewId,isSmooth?-2:-1,targName])}sourNode.setAttribute("_toArrow",JSON.stringify(toArrow).replace(/"/gm,"'"));fromArrow.push(sourName);targNode.setAttribute("_fromArrow",JSON.stringify(fromArrow).replace(/"/gm,"'"));if(interacted){return}var halfWd=rect.width/2,halfHi=rect.height/2;var centerX=rect.left+rect.width/2,centerY=rect.top+rect.height/2;var r1=getAngle(centerX,centerY,rect.left+rect.width,rect.top+rect.height);var r2=getAngle(centerX,centerY,rect.left,rect.top+rect.height);var r3=getAngle(centerX,centerY,rect.left,rect.top);var r4=getAngle(centerX,centerY,rect.left+rect.width,rect.top);var halfWd2=rect2.width/2,halfHi2=rect2.height/2;var centerX2=rect2.left+rect2.width/2,centerY2=rect2.top+rect2.height/2;var R1=getAngle(centerX2,centerY2,rect2.left+rect2.width,rect2.top+rect2.height);var R2=getAngle(centerX2,centerY2,rect2.left,rect2.top+rect2.height);var R3=getAngle(centerX2,centerY2,rect2.left,rect2.top);var R4=getAngle(centerX2,centerY2,rect2.left+rect2.width,rect2.top);var iSideGap=Math.floor(oldStrokeWd*2.5+0.5);var iSideGap_=iSideGap;iSideGap*=ARROW_SIDE_FACTOR;var fromX,fromY,midX,midY,toX,toY,offX=0,offY=0,offWd=-iSideGap_,offHi=-iSideGap_;var zeroSour=!!sourNode.querySelector("div.img-resource.zero-area");var zeroTarg=!!targNode.querySelector("div.img-resource.zero-area");if(zeroSour){fromX=centerX;fromY=centerY;var isHor=rect.width>=rect.height;var isDirect=false,horSmall=false,verSmall=false;if(centerX2>=centerX){if(zeroTarg){toX=centerX2;toY=centerY2;if(Math.abs(toY-fromY)<=iSideGap){isDirect=true;verSmall=true}if(toX-fromX<=iSideGap){isDirect=true;horSmall=true}}else{if(fromX>=rect2.left){toX=fromX;if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}isDirect=true}else{if(isHor){if(fromY>=rect2.top&&fromY<rect2.top+rect2.height){toX=rect2.left;toY=fromY;isDirect=true}else{toX=centerX2;if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}if(toX-fromX<10){toX=Math.min(rect2.left+rect2.width,fromX+20)}if(Math.abs(toY-fromY)<=iSideGap){toX=rect2.left;isDirect=true;verSmall=true}}}else{if(fromY>=rect2.top&&fromY<rect2.top+rect2.height){toX=rect2.left;toY=fromY;isDirect=true}else{toX=rect2.left;toY=centerY2;if(centerY2<centerY){if(fromY-toY<10){toY=Math.max(rect2.top,fromY-20)}}else{if(toY-fromY<10){toY=Math.min(rect2.top+rect2.height,fromY+20)}}if(Math.abs(toX-fromX)<=iSideGap){if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}isDirect=true;horSmall=true}}}}}}else{if(zeroTarg){toX=centerX2;toY=centerY2;if(Math.abs(toY-fromY)<=iSideGap){isDirect=true;verSmall=true}if(fromX-toX<=iSideGap){isDirect=true;horSmall=true}}else{if(fromX<rect2.left+rect2.width){toX=fromX;if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}isDirect=true}else{if(isHor){if(fromY>=rect2.top&&fromY<rect2.top+rect2.height){toX=rect2.left+rect2.width;toY=fromY;isDirect=true}else{toX=centerX2;if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}if(fromX-toX<10){toX=Math.max(rect2.left,fromX-20)}if(Math.abs(toY-fromY)<=iSideGap){toX=rect2.left+rect2.width;isDirect=true;verSmall=true}}}else{if(fromY>=rect2.top&&fromY<rect2.top+rect2.height){toX=rect2.left+rect2.width;toY=fromY;isDirect=true}else{toX=rect2.left+rect2.width;toY=centerY2;if(centerY2<centerY){if(fromY-toY<10){toY=Math.max(rect2.top,fromY-20)}}else{if(toY-fromY<10){toY=Math.min(rect2.top+rect2.height,fromY+20)}}if(Math.abs(toX-fromX)<=iSideGap){if(centerY2<centerY){toY=rect2.top+rect2.height}else{toY=rect2.top}isDirect=true;horSmall=true}}}}}}if(isDirect){midX=(fromX+toX)/2;midY=(fromY+toY)/2}else{if(isSmooth){if(isHor){midX=fromX+3*(toX-fromX)/5;midY=fromY+(toY-fromY)/5}else{midX=fromX+(toX-fromX)/5;midY=fromY+3*(toY-fromY)/5}}else{if(isHor){midX=toX;midY=fromY}else{midX=fromX;midY=toY}}}if(isDirect){if(horSmall){offWd=0}if(verSmall){offHi=0}if(toY<fromY&&!verSmall){offY=iSideGap_}if(toX<fromX&&!horSmall){offX=iSideGap_}}else{if(isHor){offWd=0;if(toY<fromY){offY=iSideGap_}}else{offHi=0;if(toX<fromX){offX=iSideGap_}}}}else{var r=getAngle(centerX,centerY,centerX2,centerY2);if((r>r4&&r<=360)||(r>=0&&r<=r1)){if(centerY2>=rect.top&&centerY2<rect.top+rect.height){fromX=rect.left+rect.width;fromY=centerY2;if(zeroTarg){toX=centerX2}else{toX=rect2.left}toY=centerY2;midX=(fromX+toX)/2;midY=centerY2}else{offHi=0;if(zeroTarg){toX=centerX2}else{toX=rect2.left}toY=centerY2;if(r>r4&&r<=360){fromX=centerX;fromY=rect.top;if(!zeroTarg&&fromY-toY<10){toY=Math.max(rect2.top,fromY-20)}}else{fromX=centerX;fromY=rect.top+rect.height;if(!zeroTarg&&toY-fromY<10){toY=Math.min(rect2.top+rect2.height,fromY+20)}}if(isSmooth){midX=fromX+(toX-fromX)/5;midY=fromY+3*(toY-fromY)/5}else{midX=fromX;midY=toY}}}else{if(r>r1&&r<=r2){if(centerX2>=rect.left&&centerX2<rect.left+rect.width){fromX=centerX2;fromY=rect.top+rect.height;toX=centerX2;if(zeroTarg){toY=centerY2}else{toY=rect2.top}midX=centerX2;midY=(fromY+toY)/2}else{offWd=0;toX=centerX2;if(zeroTarg){toY=centerY2}else{toY=rect2.top}if(r<=90){fromX=rect.left+rect.width;fromY=centerY;if(!zeroTarg&&toX-fromX<10){toX=Math.min(rect2.left+rect2.width,fromX+20)}}else{fromX=rect.left;fromY=centerY;if(!zeroTarg&&fromX-toX<10){toX=Math.max(rect2.left,fromX-20)}}if(isSmooth){midX=fromX+3*(toX-fromX)/5;midY=fromY+(toY-fromY)/5}else{midX=toX;midY=fromY}}}else{if(r>r2&&r<=r3){if(centerY2>=rect.top&&centerY2<rect.top+rect.height){fromX=rect.left;fromY=centerY2;if(zeroTarg){toX=centerX2}else{toX=rect2.left+rect2.width}toY=centerY2;midX=(fromX+toX)/2;midY=centerY2;offX=iSideGap_}else{offHi=0;if(zeroTarg){toX=centerX2}else{toX=rect2.left+rect2.width}toY=centerY2;if(r<=180){fromX=centerX;fromY=rect.top+rect.height;if(!zeroTarg&&toY-fromY<10){toY=Math.min(rect2.top+rect2.height,fromY+20)}offX=iSideGap_}else{fromX=centerX;fromY=rect.top;if(!zeroTarg&&fromY-toY<10){toY=Math.max(rect2.top,fromY-20)}offX=iSideGap_}if(isSmooth){midX=fromX+(toX-fromX)/5;midY=fromY+3*(toY-fromY)/5}else{midX=fromX;midY=toY}}}else{if(centerX2>=rect.left&&centerX2<rect.left+rect.width){fromX=centerX2;fromY=rect.top;toX=centerX2;if(zeroTarg){toY=centerY2}else{toY=rect2.top+rect2.height}midX=centerX2;midY=(fromY+toY)/2;offWd=0;offY=iSideGap_}else{offWd=0;toX=centerX2;if(zeroTarg){toY=centerY2}else{toY=rect2.top+rect2.height}if(r<=270){fromX=rect.left;fromY=centerY;if(!zeroTarg&&fromX-toX<10){toX=Math.max(rect2.left,fromX-20)}offY=iSideGap_}else{fromX=rect.left+rect.width;fromY=centerY;if(!zeroTarg&&toX-fromX<10){toX=Math.min(rect2.left+rect2.width,fromX+20)}offY=iSideGap_}if(isSmooth){midX=fromX+3*(toX-fromX)/5;midY=fromY+(toY-fromY)/5}else{midX=toX;midY=fromY}}}}}}fromX=Math.floor(fromX+0.5);fromY=Math.floor(fromY+0.5);midX=Math.floor(midX+0.5);midY=Math.floor(midY+0.5);toX=Math.floor(toX+0.5);toY=Math.floor(toY+0.5);var minX=Math.min(fromX,toX),minY=Math.min(fromY,toY);var iX=minX-iSideGap+offX;var iY=minY-iSideGap+offY-PAPER_OFFSET_TOP;var iDoubleGap=iSideGap+iSideGap+1;var iWd=Math.max(Math.abs(toX-fromX)+iSideGap+iSideGap+offWd,iDoubleGap);var iHi=Math.max(Math.abs(toY-fromY)+iSideGap+iSideGap+offHi,iDoubleGap);var bWidget=[oldStroke,oldFill,isSmooth?-2:-1,oldStrokeWd];bWidget.push([oldDash,0,0,oldStyle,fromX-minX,fromY-minY,midX-minX,midY-minY,toX-minX,toY-minY]);var sWidget=JSON.stringify(bWidget).replace(/"/gm,"'");var pending=document.createElement("div");pending.classList.add("svg-shape");pending.setAttribute("name",sNewId);pending.setAttribute("_from",sourName);pending.setAttribute("_widget",sWidget);pending.setAttribute("_zindex","997");pending.setAttribute("_left",iX+"");pending.setAttribute("_top",iY+"");pending.setAttribute("_width",iWd+"");pending.setAttribute("_height",iHi+"");pending.setAttribute("_defs",newMarkerId());pending.innerHTML="<div class='shape-canvas'></div><div class='rotate-txt'></div><div class='img-resource'><link rel='bookmark' type='text/xml' href='/software/slide11/$images/shape/arrows.svg.json' /></div>";var paper=document.getElementById("root-paper");paper.appendChild(pending);initDesignPos(pending,false,false);pending.onclick=itemDivOnclick;var node=pending.querySelector("div.img-resource > link");if(node){requestOneSvg(node)}}function resetWidgetSide(node,detaX,detaY,detaW,detaH){var toArrow=window.eval(node.getAttribute("_toArrow")||"[]");for(var i=0,item;item=toArrow[i];i++){var sTarg=item[2];if(sTarg){var targNode=document.querySelector('div.svg-shape[name="'+sTarg+'"]');if(targNode){linkTwoWidgets(node,targNode)}}else{var b=[],arrow=document.querySelector('div.svg-shape[name="'+item[0]+'"]');if(arrow){b=(arrow.getAttribute("_align")||"").split(",")}if(b.length==2){var sId=b[0],iPos=parseInt(b[1]);if(detaX!=0){if(detaW==detaX){if(sId=="right"){arrow.style.left=parseInt(arrow.getAttribute("_left"))+detaX+"px"}else{if(sId=="center"){arrow.style.left=Math.floor(parseInt(arrow.getAttribute("_left"))+detaX/2+0.5)+"px"}else{if(sId=="top"||sId=="bottom"){var iRight=parseInt(node.getAttribute("_left"))+parseInt(node.getAttribute("_width"))+detaW;if(iPos>iRight){arrow.style.left=parseInt(arrow.style.left)-(iPos-iRight)+"px";arrow.setAttribute("_align",sId+","+iRight)}}}}}else{if(sId=="left"){arrow.style.left=parseInt(arrow.getAttribute("_left"))+detaX+"px"}else{if(sId=="center"){arrow.style.left=Math.floor(parseInt(arrow.getAttribute("_left"))+detaX/2+0.5)+"px"}else{if(sId=="top"||sId=="bottom"){var iLeft=parseInt(node.getAttribute("_left"))+detaX;if(iLeft>iPos){arrow.style.left=parseInt(arrow.style.left)+(iLeft-iPos)+"px";arrow.setAttribute("_align",sId+","+iLeft)}}}}}}if(detaY!=0){if(detaH==detaY){if(sId=="bottom"){arrow.style.top=parseInt(arrow.getAttribute("_top"))+detaY+"px"}else{if(sId=="center"){arrow.style.top=Math.floor(parseInt(arrow.getAttribute("_top"))+detaY/2+0.5)+"px"}else{if(sId=="left"||sId=="right"){var iBottom=parseInt(node.getAttribute("_top"))+parseInt(node.getAttribute("_height"))+detaH;if(iPos>iBottom){arrow.style.top=parseInt(arrow.style.top)-(iPos-iBottom)+"px";arrow.setAttribute("_align",sId+","+iBottom)}}}}}else{if(sId=="top"){arrow.style.top=parseInt(arrow.getAttribute("_top"))+detaY+"px"}else{if(sId=="center"){arrow.style.top=Math.floor(parseInt(arrow.getAttribute("_top"))+detaY/2+0.5)+"px"}else{if(sId=="left"||sId=="right"){var iTop=parseInt(node.getAttribute("_top"))+detaY;if(iTop>iPos){arrow.style.top=parseInt(arrow.style.top)+(iTop-iPos)+"px";arrow.setAttribute("_align",sId+","+iTop)}}}}}}}}}var fromArrow=window.eval(node.getAttribute("_fromArrow")||"[]");for(var i=0,item;item=fromArrow[i];i++){var sourNode=document.querySelector('div.svg-shape[name="'+item+'"]');if(sourNode){linkTwoWidgets(sourNode,node)}}}function bodyMouseMove(event){if(opacityInMove_){var node=document.getElementById("opac-slider");var x=event.clientX,detaX=x-opacityMoveX_;var iX=parseInt(node.style.left);var iX2=Math.max(0,Math.min(100,iX+detaX));node.style.left=iX2+"px";var inputNode=document.getElementById("group-opacity");inputNode.value=iX2+"";opacityMoveX_=x}else{if(movingWidget_){var x=event.clientX,detaX=x-widgetMoveX_;var y=event.clientY,detaY=y-widgetMoveY_;if(detaX||detaY){var iX=parseInt(movingWidget_.getAttribute("_left"));var iY=parseInt(movingWidget_.getAttribute("_top"));iX+=detaX;iY+=detaY;setWidgetPos(movingWidget_,iX,iY);widgetMoveX_=x;widgetMoveY_=y;var toArrow=window.eval(movingWidget_.getAttribute("_toArrow")||"[]");for(var i=0,item;item=toArrow[i];i++){var sTarg=item[2];if(sTarg){var targNode=document.querySelector('div.svg-shape[name="'+sTarg+'"]');if(targNode){linkTwoWidgets(movingWidget_,targNode)}}else{var targNode=document.querySelector('div.svg-shape[name="'+item[0]+'"]');if(targNode){moveWidgetLink(targNode,detaX,detaY)}}}var fromArrow=window.eval(movingWidget_.getAttribute("_fromArrow")||"[]");for(var i=0,item;item=fromArrow[i];i++){var sourNode=document.querySelector('div.svg-shape[name="'+item+'"]');if(sourNode){linkTwoWidgets(sourNode,movingWidget_)}}}}else{if(rotatingWidget_){var rect=rotatingWidget_.getBoundingClientRect();var r1=getAngle(rect.left+rect.width/2,rect.top+rect.height/2,event.clientX,event.clientY);var r2=(rotateRotate_+r1-rotateAngle_)%360;if(r2<0){r2+=360}var resizer=document.querySelector("div.free-transform");if(r2==0){rotatingWidget_.removeAttribute("_rotate");rotatingWidget_.style[WEB_BROWSER_PRE+"transform"]="";resizer.style[WEB_BROWSER_PRE+"transform"]=""}else{rotatingWidget_.setAttribute("_rotate",r2+"");rotatingWidget_.style[WEB_BROWSER_PRE+"transform"]="rotate("+r2+"deg)";resizer.style[WEB_BROWSER_PRE+"transform"]="rotate("+r2+"deg)"}}else{if(resizingWidget_){var detaX=event.clientX-resizerMoveX_;var detaY=event.clientY-resizerMoveY_;detaX=Math.floor((detaX+5)/10)*10;detaY=Math.floor((detaY+5)/10)*10;var iX=parseInt(resizingWidget_.getAttribute("_left"));var iY=parseInt(resizingWidget_.getAttribute("_top"));var iW=parseInt(resizingWidget_.getAttribute("_width"));var iH=parseInt(resizingWidget_.getAttribute("_height"));if(resizerTag_=="top-left"){var w2=iW-detaX,h2=iH-detaY;if(w2>15&&h2>15){var x2=iX+detaX,y2=iY+detaY;resizingWidget_.style.left=x2+"px";resizingWidget_.style.top=y2+"px";resizingWidget_.style.width=w2+"px";resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,x2,y2,w2,h2);resetWidgetSide(resizingWidget_,detaX,detaY,-detaX,-detaY)}}else{if(resizerTag_=="top"){var h2=iH-detaY;if(h2>15){var y2=iY+detaY;resizingWidget_.style.top=y2+"px";resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,iX,y2,iW,h2);resetWidgetSide(resizingWidget_,0,detaY,0,-detaY)}}else{if(resizerTag_=="top-right"){var w2=iW+detaX,h2=iH-detaY;if(w2>15&&h2>15){var y2=iY+detaY;resizingWidget_.style.top=y2+"px";resizingWidget_.style.width=w2+"px";resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,iX,y2,w2,h2);resetWidgetSide(resizingWidget_,detaX,detaY,detaX,-detaY)}}else{if(resizerTag_=="right"){var w2=iW+detaX;if(w2>15){resizingWidget_.style.width=w2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,iX,iY,w2,iH);resetWidgetSide(resizingWidget_,detaX,0,detaX,0)}}else{if(resizerTag_=="bottom-right"){var w2=iW+detaX,h2=iH+detaY;if(w2>15&&h2>15){resizingWidget_.style.width=w2+"px";resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,iX,iY,w2,h2);resetWidgetSide(resizingWidget_,detaX,detaY,detaX,detaY)}}else{if(resizerTag_=="bottom"){var h2=iH+detaY;if(h2>15){resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,iX,iY,iW,h2);resetWidgetSide(resizingWidget_,0,detaY,0,detaY)}}else{if(resizerTag_=="bottom-left"){var w2=iW-detaX,h2=iH+detaY;if(w2>15&&h2>15){var x2=iX+detaX;resizingWidget_.style.left=x2+"px";resizingWidget_.style.top=iY+"px";resizingWidget_.style.width=w2+"px";resizingWidget_.style.height=h2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,x2,iY,w2,h2);resetWidgetSide(resizingWidget_,detaX,detaY,-detaX,detaY)}}else{if(resizerTag_=="left"){var w2=iW-detaX;if(w2>15){var x2=iX+detaX;resizingWidget_.style.left=x2+"px";resizingWidget_.style.width=w2+"px";buildShape2(resizingWidget_,true,true);setWidgetPos2(resizingWidget_,x2,iY,w2,iH);resetWidgetSide(resizingWidget_,detaX,0,-detaX,0)}}}}}}}}}}else{if(cloningWidget_){var detaX=event.clientX-cloneMoveX_,detaY=event.clientY-cloneMoveY_;var iX=parseInt(cloningWidget_.getAttribute("_left"));var iY=parseInt(cloningWidget_.getAttribute("_top"));cloningWidget_.style.left=(iX+detaX)+"px";cloningWidget_.style.top=(iY+detaY)+"px"}else{if(linkingWidget_){var paper=document.getElementById("root-paper");var pendings=paper.querySelectorAll("div.svg-shape.pending");for(var i=0,item;item=pendings[i];i++){if(linkingWidget_!==item){item.parentNode.removeChild(item)}}var fromX2,fromY2,sAlign="";if(linkfromFix_){fromX2=linkFixX_;fromY2=linkFixY_}else{var rect=linkingWidget_.getBoundingClientRect();if(event.clientX>=rect.left&&event.clientX<=rect.left+rect.width&&event.clientY>=rect.top&&event.clientY<=rect.top+rect.height){return}if(Math.abs(event.clientX-linkMoveX_)<20&&Math.abs(event.clientY-linkMoveY_)<20){return}var zeroArea=!!linkingWidget_.querySelector("div.img-resource.zero-area");var fromX,fromY,centerX=rect.left+rect.width/2,centerY=rect.top+rect.height/2;var halfWd=rect.width/2,halfHi=rect.height/2;if(zeroArea){sAlign="center,0";fromX=centerX;fromY=centerY;fromX2=Math.floor(fromX+0.5);fromY2=Math.floor(fromY+0.5)}else{var r1=getAngle(centerX,centerY,rect.left+rect.width,rect.top+rect.height);var r2=getAngle(centerX,centerY,rect.left,rect.top+rect.height);var r3=getAngle(centerX,centerY,rect.left,rect.top);var r4=getAngle(centerX,centerY,rect.left+rect.width,rect.top);var r=getAngle(centerX,centerY,event.clientX,event.clientY);if((r>r4&&r<=360)||(r>=0&&r<=r1)){sAlign="right";fromX=centerX+halfWd;if(event.clientY>rect.top+2&&event.clientY<rect.top+rect.height-2){fromY=event.clientY}else{fromY=centerY+halfWd*(event.clientY-centerY)/(event.clientX-centerX)}}else{if(r>r1&&r<=r2){sAlign="bottom";fromY=centerY+halfHi;if(event.clientX>rect.left+2&&event.clientX<rect.left+rect.width-2){fromX=event.clientX}else{fromX=centerX+halfHi*(event.clientX-centerX)/(event.clientY-centerY)}}else{if(r>r2&&r<=r3){sAlign="left";fromX=rect.left;if(event.clientY>rect.top+2&&event.clientY<rect.top+rect.height-2){fromY=event.clientY}else{fromY=centerY+halfWd*(event.clientY-centerY)/(centerX-event.clientX)}}else{sAlign="top";fromY=rect.top;if(event.clientX>rect.left+2&&event.clientX<rect.left+rect.width-2){fromX=event.clientX}else{fromX=centerX+halfHi*(event.clientX-centerX)/(centerY-event.clientY)}}}}fromX2=Math.floor(fromX+0.5);fromY2=Math.floor(fromY+0.5);if(sAlign=="right"||sAlign=="left"){sAlign+=","+(fromY2-PAPER_OFFSET_TOP)}else{sAlign+=","+fromX2}}}var iSideGap=Math.floor(lastArrowStrokeWd_*2.5+0.5);iSideGap*=ARROW_SIDE_FACTOR;var minX=Math.min(event.clientX,fromX2);var minY=Math.min(event.clientY,fromY2);var iX=minX-iSideGap;var iY=minY-iSideGap-PAPER_OFFSET_TOP;var iDoubleGap=iSideGap+iSideGap+1;var iWd=Math.max(Math.abs(event.clientX-fromX2)+iSideGap+iSideGap,iDoubleGap);var iHi=Math.max(Math.abs(event.clientY-fromY2)+iSideGap+iSideGap,iDoubleGap);var bWidget=[lastArrowStroke_,lastArrowFill_,linkSmooth_?-2:-1,lastArrowStrokeWd_];bWidget.push([lastArrowDash_,0,0,lastArrowStyle_,fromX2-minX,fromY2-minY,event.clientX-minX,event.clientY-minY]);var sWidget=JSON.stringify(bWidget).replace(/"/gm,"'");var pending=document.createElement("div");pending.classList.add("svg-shape");pending.classList.add("pending");if(sAlign){pending.setAttribute("_align",sAlign)}pending.setAttribute("_widget",sWidget);pending.setAttribute("_zindex","997");pending.setAttribute("_left",iX+"");pending.setAttribute("_top",iY+"");pending.setAttribute("_width",iWd+"");pending.setAttribute("_height",iHi+"");pending.setAttribute("_defs",newMarkerId());pending.innerHTML="<div class='shape-canvas'></div><div class='rotate-txt'></div><div class='img-resource'><link rel='bookmark' type='text/xml' href='/software/slide11/$images/shape/arrows.svg.json' /></div>";paper.appendChild(pending);initDesignPos(pending,false,false);pending.onclick=itemDivOnclick;var node=pending.querySelector("div.img-resource > link");if(node){requestOneSvg(node)}}else{if(movingArrowPoint_){var pointBin=movingArrowPoint_.parentNode;var sName=pointBin.fromWidget;if(sName&&pointBin.style.display=="block"){var arrowNode=document.querySelector('div.svg-shape[name="'+sName+'"]');if(arrowNode){var cfgData=window.eval(arrowNode.getAttribute("_widget")||"null");if((cfgData instanceof Array)&&cfgData.length>=5){var subCfg=cfgData[4],subLen=subCfg.length;var detaX=event.clientX-pointMoveX_,detaY=event.clientY-pointMoveY_;var pointId=parseInt(movingArrowPoint_.getAttribute("_pos")||"1");var index=pointId+pointId+5;if(index<subLen){var rateX=pointBin.rateX||1;var rateY=pointBin.rateY||1;subCfg[index-1]=pointOrgX_+detaX/rateX;subCfg[index]=pointOrgY_+detaY/rateY;resetArrowPos(arrowNode,cfgData,rateX,rateY);movingArrowPoint_.style.left=(pointStartLeft_+detaX)+"px";movingArrowPoint_.style.top=(pointStartTop_+detaY)+"px"}}}}}else{if(forkingWidget_){var detaX=event.clientX-forkMoveX_,detaY=event.clientY-forkMoveY_;var iX=parseInt(forkNewWidget_.getAttribute("_left"));var iY=parseInt(forkNewWidget_.getAttribute("_top"));forkNewWidget_.style.left=(iX+detaX)+"px";forkNewWidget_.style.top=(iY+detaY)+"px"}else{if(movingPaper_){var detaX=event.clientX-movingPaperX_,detaY=event.clientY-movingPaperY_;if(!movedPaper_){if(Math.abs(detaX)>5||Math.abs(detaY)>5){movedPaper_=true}}if(movedPaper_){movingPaper_.style.marginLeft=detaX+"px";movingPaper_.style.marginTop=detaY+"px"}}}}}}}}}}}function bodyMouseUp(event){if(opacityInMove_){var i=parseInt(document.getElementById("group-opacity").value);var nodes=[],node=document.querySelector("div.svg-shape.in-operation");if(node){nodes.push(node)}else{nodes=document.querySelectorAll("div.svg-shape")}if(nodes.length==1){var alpha=i/100;resetSvgColor(nodes[0],undefined,undefined,alpha);if(node){var cfgData=window.eval(node.getAttribute("_widget")||"null");if(cfgData instanceof Array&&cfgData.length>=3&&cfgData[2]<0){var b=parseRgbColor(cfgData[0]);if(b.length>=3){lastArrowStroke_="rgba("+b[0]+","+b[1]+","+b[2]+","+alpha+")"}b=parseRgbColor(cfgData[1]);if(b.length>=3){lastArrowFill_="rgba("+b[0]+","+b[1]+","+b[2]+","+alpha+")"}}}}hideInlineDialog()}else{if(movingWidget_){var x=parseInt(movingWidget_.getAttribute("_left"));var y=parseInt(movingWidget_.getAttribute("_top"));var iX=Math.floor(x/10)*10,iY=Math.floor(y/10)*10;var detaX=0,detaY=0;if(iX!=x){detaX=(x-iX<=5?iX:iX+10)-x}if(iY!=y){detaY=(y-iY<=5?iY:iY+10)-y}if(detaX||detaY){movingWidget_.setAttribute("_left",(x+detaX)+"");movingWidget_.setAttribute("_top",(y+detaY)+"");setWidgetPos(movingWidget_,x+detaX,y+detaY);var toArrow=window.eval(movingWidget_.getAttribute("_toArrow")||"[]");for(var i=0,item;item=toArrow[i];i++){var sTarg=item[2];if(sTarg){var targNode=document.querySelector('div.svg-shape[name="'+sTarg+'"]');if(targNode){linkTwoWidgets(movingWidget_,targNode)}}else{var targNode=document.querySelector('div.svg-shape[name="'+item[0]+'"]');if(targNode){moveWidgetLink(targNode,detaX,detaY)}}}var fromArrow=window.eval(movingWidget_.getAttribute("_fromArrow")||"[]");for(var i=0,item;item=fromArrow[i];i++){var sourNode=document.querySelector('div.svg-shape[name="'+item+'"]');if(sourNode){linkTwoWidgets(sourNode,movingWidget_)}}}}else{if(rotatingWidget_){var r2=parseFloat(rotatingWidget_.getAttribute("_rotate")||"0");if(r2!=0){var i=Math.floor(r2/15)*15;if(r2!=i){if(r2-i<7.5){r2=i}else{r2=i+15}}var resizer=document.querySelector("div.free-transform");if(r2==0){rotatingWidget_.removeAttribute("_rotate");rotatingWidget_.style[WEB_BROWSER_PRE+"transform"]="";resizer.style[WEB_BROWSER_PRE+"transform"]=""}else{rotatingWidget_.setAttribute("_rotate",r2+"");rotatingWidget_.style[WEB_BROWSER_PRE+"transform"]="rotate("+r2+"deg)";resizer.style[WEB_BROWSER_PRE+"transform"]="rotate("+r2+"deg)"}var rect=rotatingWidget_.getBoundingClientRect();var halo=document.querySelector("div.halo");halo.style.left=rect.left+"px";halo.style.top=rect.top+"px";halo.style.width=rect.width+"px";halo.style.height=rect.height+"px"}}else{if(resizingWidget_){resizingWidget_.setAttribute("_left",parseInt(resizingWidget_.style.left)+"");resizingWidget_.setAttribute("_top",parseInt(resizingWidget_.style.top)+"");resizingWidget_.setAttribute("_width",parseInt(resizingWidget_.style.width)+"");resizingWidget_.setAttribute("_height",parseInt(resizingWidget_.style.height)+"");var toArrow=window.eval(resizingWidget_.getAttribute("_toArrow")||"[]");for(var i=0,item;item=toArrow[i];i++){var arrow=document.querySelector('div.svg-shape[name="'+item[0]+'"]');if(arrow&&!item[2]){arrow.setAttribute("_left",parseInt(arrow.style.left)+"");arrow.setAttribute("_top",parseInt(arrow.style.top)+"");arrow.setAttribute("_width",parseInt(arrow.style.width)+"");arrow.setAttribute("_height",parseInt(arrow.style.height)+"")}}var cfgData=window.eval(resizingWidget_.getAttribute("_widget")||"[]");if((cfgData instanceof Array)&&cfgData.length>=3&&cfgData[2]<0){selectOneItem(resizingWidget_)}}else{if(cloningWidget_){var iX=parseInt(cloningWidget_.style.left);var iY=parseInt(cloningWidget_.style.top);var x2=Math.floor(iX/10)*10;var y2=Math.floor(iY/10)*10;if(iX-x2>=5){x2+=10}if(iY-y2>=5){y2+=10}cloningWidget_.style.left=x2+"px";cloningWidget_.style.top=y2+"px";cloningWidget_.setAttribute("_left",x2+"");cloningWidget_.setAttribute("_top",y2+"")}else{if(linkingWidget_){if(linkfromFix_){var paper=document.getElementById("root-paper");var pendings=paper.querySelectorAll("div.svg-shape.pending");for(var i=0,item;item=pendings[i];i++){if(linkingWidget_!==item){item.parentNode.removeChild(item)}}var detaX=event.clientX-linkFixX_,detaY=event.clientY-linkFixY_;if(Math.abs(detaX)>=5||Math.abs(detaY)>=5){var cfgData=window.eval(linkingWidget_.getAttribute("_widget"));if(cfgData instanceof Array&&cfgData.length>=5){var subCfg=cfgData[4],lastX=subCfg[subCfg.length-2],lastY=subCfg[subCfg.length-1];var pointBin=document.querySelector("div.point-nodes");subCfg.push(lastX+detaX/pointBin.rateX,lastY+detaY/pointBin.rateY);resetArrowPos(linkingWidget_,cfgData,pointBin.rateX,pointBin.rateY);var ptNode=document.createElement("div");ptNode.classList.add("pointer");ptNode.setAttribute("_pos",((subCfg.length-6)/2)+"");ptNode.style.left=event.clientX+"px";ptNode.style.top=(event.clientY-PAPER_OFFSET_TOP)+"px";pointBin.appendChild(ptNode);var resizer=document.querySelector("div.free-transform");if(resizer.style.display=="block"){var x=parseInt(linkingWidget_.getAttribute("_left")||"0");var y=parseInt(linkingWidget_.getAttribute("_top")||"0");var w=parseInt(linkingWidget_.getAttribute("_width")||"100");var h=parseInt(linkingWidget_.getAttribute("_height")||"60");var r=parseFloat(linkingWidget_.getAttribute("_rotate")||"0");resizer.style.left=(x-2)+"px";resizer.style.top=(y-2+PAPER_OFFSET_TOP)+"px";resizer.style.width=(w+4)+"px";resizer.style.height=(h+4)+"px";if(r==0){resizer.style[WEB_BROWSER_PRE+"transform"]=""}else{resizer.style[WEB_BROWSER_PRE+"transform"]="rotate("+r+"deg)"}}var rect=linkingWidget_.getBoundingClientRect();var halo=document.querySelector("div.halo");halo.style.left=rect.left+"px";halo.style.top=rect.top+"px";halo.style.width=rect.width+"px";halo.style.height=rect.height+"px"}}}else{var pending=document.querySelector("div.svg-shape.pending");if(pending){var forkNewWidget=null;var x=event.clientX,y=event.clientY;var iLevel=0,b=document.querySelectorAll("div.svg-shape");for(var i=0,item;item=b[i];i++){if(item.hasAttribute("_align")){continue}var r=item.getBoundingClientRect(),gapX=r.width/10,gapY=r.height/10;if(x>=r.left+gapX&&x<r.left+r.width-gapX&&y>=r.top+gapY&&y<r.top+r.height-gapY){var ii=parseInt(item.getAttribute("_zindex")||"1000");if(ii>=iLevel){forkNewWidget=item;iLevel=ii}}}if(forkNewWidget){pending.parentNode.removeChild(pending);linkTwoWidgets(linkingWidget_,forkNewWidget,linkSmooth_)}else{var sOwner=linkingWidget_.getAttribute("name");var sId=newWidgetId();pending.setAttribute("name",sId);pending.classList.remove("pending");pending.onclick=itemDivOnclick;if(sOwner){pending.setAttribute("_from",sOwner)}var b=window.eval(linkingWidget_.getAttribute("_toArrow")||"[]");b.push([sId,linkSmooth_?-2:-1]);linkingWidget_.setAttribute("_toArrow",JSON.stringify(b).replace(/"/gm,"'"))}}}}else{if(movingArrowPoint_){var ownerOfPoint=movingArrowPoint_.parentNode;var sName=ownerOfPoint.fromWidget||"";if(sName){var arrowNode=document.querySelector('div.svg-shape[name="'+sName+'"]');if(arrowNode){var resizer=document.querySelector("div.free-transform");if(resizer.style.display=="block"){var x=parseInt(arrowNode.getAttribute("_left")||"0");var y=parseInt(arrowNode.getAttribute("_top")||"0");var w=parseInt(arrowNode.getAttribute("_width")||"100");var h=parseInt(arrowNode.getAttribute("_height")||"60");var r=parseFloat(arrowNode.getAttribute("_rotate")||"0");resizer.style.left=(x-2)+"px";resizer.style.top=(y-2+PAPER_OFFSET_TOP)+"px";resizer.style.width=(w+4)+"px";resizer.style.height=(h+4)+"px";if(r==0){resizer.style[WEB_BROWSER_PRE+"transform"]=""}else{resizer.style[WEB_BROWSER_PRE+"transform"]="rotate("+r+"deg)"}}var rect=arrowNode.getBoundingClientRect();var halo=document.querySelector("div.halo");halo.style.left=rect.left+"px";halo.style.top=rect.top+"px";halo.style.width=rect.width+"px";halo.style.height=rect.height+"px"}}}else{if(forkingWidget_){var iX=parseInt(forkNewWidget_.style.left);var iY=parseInt(forkNewWidget_.style.top);var x2=Math.floor((iX+5)/10)*10;var y2=Math.floor((iY+5)/10)*10;forkNewWidget_.style.left=x2+"px";forkNewWidget_.style.top=y2+"px";forkNewWidget_.setAttribute("_left",x2+"");forkNewWidget_.setAttribute("_top",y2+"");linkTwoWidgets(forkingWidget_,forkNewWidget_,forkSmooth_)}else{if(movingPaper_){if(movedPaper_){var detaX=event.clientX-movingPaperX_,detaY=event.clientY-movingPaperY_;detaX=Math.floor((detaX+5)/10)*10;detaY=Math.floor((detaY+5)/10)*10;if(detaX||detaY){var nodes=movingPaper_.querySelectorAll("div.svg-shape");for(var i=0,item;item=nodes[i];i++){var iX=parseInt(item.getAttribute("_left","0"))+detaX;var iY=parseInt(item.getAttribute("_top","0"))+detaY;item.setAttribute("_left",iX+"");item.setAttribute("_top",iY+"");item.style.left=iX+"px";item.style.top=iY+"px"}}}movingPaper_.style.marginLeft="";movingPaper_.style.marginTop="";movingPaper_.style.cursor="default"}}}}}}}}}opacityInMove_=false;movingWidget_=null;rotatingWidget_=null;resizingWidget_=null;cloningWidget_=null;linkingWidget_=null;movingArrowPoint_=null;forkingWidget_=null;movingPaper_=null}function opacityDropdownClick(c){hideInlineDialog();var a=parseInt(document.getElementById("group-opacity").value);a=Math.max(0,Math.min(100,a));var d=document.getElementById("opacity_dropdown");d.style.display="block";var b=d.querySelector("a.slider-handle");b.style.left=a+"px";c.preventDefault();c.stopPropagation()}function opacityToolClick(a){var f=a.target;var h=f.getBoundingClientRect();var j=a.clientX-h.left,g=a.clientY-h.top;if(h.width-j<18){var e=parseInt(f.value),d=Math.floor(e/5)*5;if(h.height-g<=13){if(e!=d){e=d}else{e-=5}if(e<0){e=0}}else{if(e!=d){e=d+5}else{e+=5}if(e>100){e=100}}f.value=e+"";var b=[],c=document.querySelector("div.svg-shape.in-operation");if(c){b.push(c)}else{b=document.querySelectorAll("div.svg-shape")}if(b.length==1){resetSvgColor(b[0],undefined,undefined,e/100)}}}function resetSvgStrokeWd(node,wd){var retArrow=null,oldWd=3;var cfgData=window.eval(node.getAttribute("_widget")||"null");if(cfgData instanceof Array&&cfgData.length>=4){oldWd=cfgData[3];cfgData[3]=wd;node.setAttribute("_widget",JSON.stringify(cfgData).replace(/"/gm,"'"));var iStyle=cfgData[2];if(iStyle<0){retArrow=node;var sourNode=null,sSour=node.getAttribute("_from"),sName=node.getAttribute("name");if(sSour){sourNode=document.querySelector('div.svg-shape[name="'+sSour+'"]')}if(sourNode&&sName){var bArrow=window.eval(sourNode.getAttribute("_toArrow")||"[]");for(var i=0,item;item=bArrow[i];i++){if(item[0]==sName){var sTarg=item[2];if(sTarg){var targNode=document.querySelector('div.svg-shape[name="'+sTarg+'"]');if(targNode){linkTwoWidgets(sourNode,targNode);var bArrow2=window.eval(sourNode.getAttribute("_toArrow")||"[]");for(var i2=0,item2;item2=bArrow2[i2];i2++){if(item2[2]==sTarg){retArrow=document.querySelector('div.svg-shape[name="'+item2[0]+'"]');break}}return retArrow}}else{var oldSideGap=Math.floor(oldWd*2.5+0.5);oldSideGap*=ARROW_SIDE_FACTOR;var newSideGap=Math.floor(wd*2.5+0.5);newSideGap*=ARROW_SIDE_FACTOR;var iDoubleGap=newSideGap+newSideGap+1;var rect=node.getBoundingClientRect();var iNewX=Math.max(rect.width-oldSideGap-oldSideGap+newSideGap+newSideGap,iDoubleGap);var iNewY=Math.max(rect.height-oldSideGap-oldSideGap+newSideGap+newSideGap,iDoubleGap);node.style.left=(rect.left+oldSideGap-newSideGap)+"px";node.style.top=(rect.top-PAPER_OFFSET_TOP+oldSideGap-newSideGap)+"px";node.style.width=iNewX+"px";node.style.height=iNewY+"px";node.setAttribute("_width",iNewX+"");node.setAttribute("_height",iNewY+"")}break}}}}buildShape2(node,true)}return retArrow}function frameWdToolClick(a){var f=a.target;var h=f.getBoundingClientRect();var j=a.clientX-h.left,g=a.clientY-h.top;if(h.width-j<18){var d=parseInt(f.value);if(h.height-g<=13){if(d>=2){d--}}else{if(d<360){d++}}f.value=d+"";var b=[],c=document.querySelector("div.svg-shape.in-operation");if(c){b.push(c)}else{b=document.querySelectorAll("div.svg-shape")}if(b.length==1){var e=resetSvgStrokeWd(b[0],d);if(e&&c){lastArrowStrokeWd_=d;selectOneItem(e)}}}}function confirmSetBkg(a){if(window.confirm("do you want set background color?")){setCookie__("PINP_DRAWBK"+stringHashCode(CURR_USR_PATH),a,14);var c=document.getElementById("root-paper");c.style.backgroundColor=a;var b=document.querySelector(".popline-frame");if(b){b.contentWindow.document.body.style.backgroundColor=a}}}function selectClrPalette(targ,isShift){while(targ){if(targ.nodeName=="DIV"){break}targ=targ.parentNode}if(targ&&targ.classList.contains("palette-item")){var sColor="rgba(0,0,0,0)",svg=targ.querySelector("svg");if(!svg){sColor=window.getComputedStyle(targ).backgroundColor}var nodes=[],node=document.querySelector("div.svg-shape.in-operation");if(node){nodes.push(node)}else{nodes=document.querySelectorAll("div.svg-shape")}if(nodes.length==0){if(isShift){confirmSetBkg(sColor)}}else{var sType=isShift?"frame":"fill";if(!node&&!window.confirm("do you want set "+sType+" color for all object?")){if(isShift){confirmSetBkg(sColor)}return}for(var i=0,item;item=nodes[i];i++){if(sType=="fill"){resetSvgColor(item,undefined,sColor)}else{resetSvgColor(item,sColor,undefined)}}if(node){if(!isShift){var opacNode=document.querySelector("#group-opacity");if(sColor=="rgba(0,0,0,0)"){opacNode.value="0"}else{opacNode.value="100"}}var cfgData=window.eval(node.getAttribute("_widget")||"null");if(cfgData instanceof Array&&cfgData.length>=3&&cfgData[2]<0){if(sType=="fill"){lastArrowFill_=sColor}else{lastArrowStroke_=sColor}}}}}}function showClrPalette(b){while(b){if(b.nodeName=="DIV"){break}b=b.parentNode}if(b&&b.classList.contains("palette-item")){var a=b.querySelector("svg");if(!a){var c=document.querySelector("#color-dlg");c.style.left="0px";c.style.display="block";currDbClickClrDiv=b}}}var paletteLastClick_=0;var paletteLastDbClick_=0;function selectOrSetColor(e){if(e.ctrlKey||e.altKey){paletteLastClick_=e.timeStamp;return}var d=e.target;var a=e.shiftKey;var c=false;if(e.timeStamp-paletteLastClick_<250){c=true;paletteLastClick_=e.timeStamp;paletteLastDbClick_=paletteLastClick_;showClrPalette(d)}else{var b=opacityInMove_;setTimeout(function(){if(!c&&paletteLastDbClick_!=paletteLastClick_){if(!b){selectClrPalette(d,a)}}},250);paletteLastClick_=e.timeStamp}}function setClrPalette(c){var a=c.target;if(currDbClickClrDiv&&a.nodeName=="TD"){var b=a.bgColor||"#FFFFFF";currDbClickClrDiv.style.backgroundColor=b}hideInlineDialog();c.preventDefault();c.stopPropagation()}function itemDivOnclick(f){var a=f.target;while(a){if(a.classList.contains("svg-shape")){break}a=a.parentNode}if(!a){return}hideInlineDialog();if(a.classList.contains("in-operation")&&f.ctrlKey&&!f.shiftKey&&!f.altKey){var h=a.querySelector("div.rotate-txt");if(h){editingWidget_=null;hideInlineEditor();var g=document.getElementById("dlg-mask");g.style.display="block";var e=parseInt(window.getComputedStyle(h).fontSize)+"px";apiNode.editContent(h.toId(),g.toId(),currSourFont,currFontFamily,currContentFont,currExtendStyle,e,CURR_USR_PATH)}}else{var b=document.querySelectorAll("div.svg-shape.in-operation");for(var c=0,d;d=b[c];c++){d.classList.remove("in-operation")}selectOneItem(a)}f.preventDefault();f.stopPropagation()}var movingWidget_=null;var widgetMoveX_=0;var widgetMoveY_=0;function itemOnMouseDown(d){if(d.button!=0||d.ctrlKey||d.shiftKey||d.altKey){return}var b=d.target;while(b){if(b.nodeType==1&&b.nodeName=="DIV"&&b.classList.contains("svg-shape")){break}b=b.parentNode}var a=document.querySelector("div.svg-shape.in-operation");if(a&&a!==b&&!a.getAttribute("_from")){var c=a.getBoundingClientRect();if(d.clientX>=c.left&&d.clientX<c.left+c.width&&d.clientY>=c.top&&d.clientY<c.top+c.height){b=a}}if(b&&!b.getAttribute("_from")){movingWidget_=b;widgetMoveX_=d.clientX;widgetMoveY_=d.clientY;var f=document.querySelector("div.halo");f.style.display="none";var e=document.querySelector("div.point-nodes");e.style.display="none"}}function initDesignPos(k,h,i){var c=parseInt(k.getAttribute("_zindex")||"1000");var g=parseInt(k.getAttribute("_left")||"0");var f=parseInt(k.getAttribute("_top")||"0");var a=parseInt(k.getAttribute("_width")||"100");var b=parseInt(k.getAttribute("_height")||"60");if(h){var e=Math.floor(g/10)*10,d=Math.floor(f/10)*10;if(e!=g){g=(g-e<=5)?e:e+10;k.setAttribute("_left",g+"")}if(d!=f){f=(f-d<=5)?d:d+10;k.setAttribute("_top",f+"")}}k.style.zIndex=c+"";k.style.left=g+"px";k.style.top=f+"px";k.style.width=a+"px";k.style.height=b+"px";var j=k.getAttribute("_rotate");if(j){k.style[WEB_BROWSER_PRE+"transform"]="rotate("+j+"deg)"}if(i){k.onclick=itemDivOnclick;k.onmousedown=itemOnMouseDown}}var svgWidgetId_=-1;function newWidgetId(){if(svgWidgetId_<0){var a=document.querySelectorAll("div.svg-shape");svgWidgetId_=a.length}while(document.querySelector('div.svg-shape[name="svg_'+svgWidgetId_+'"]')){svgWidgetId_+=1}var b="svg_"+svgWidgetId_;svgWidgetId_+=1;return b}var svgMarkerId_=-1;function newMarkerId(){if(svgMarkerId_<0){var a=document.querySelectorAll("div.svg-shape[_defs]");svgMarkerId_=a.length}while(document.querySelector('div.svg-shape[_defs="'+currPaperName+"-"+svgMarkerId_+'"]')){svgMarkerId_+=1}return currPaperName+"-"+svgMarkerId_}function handleDocKeyDown(b){switch(b.keyCode){case 46:if(b.ctrlKey&&!b.shiftKey&&!b.altKey){b.preventDefault();removeCurrItem(b)}break;case 67:if(b.ctrlKey&&!b.shiftKey&&!b.altKey){b.preventDefault();apiNode.copyItem()}break;case 88:if(b.ctrlKey&&!b.shiftKey&&!b.altKey){b.preventDefault();apiNode.cutItem()}break;case 86:if(b.ctrlKey&&!b.shiftKey&&!b.altKey){b.preventDefault();apiNode.pasteItem()}break;case 9:if(b.ctrlKey&&!b.altKey){b.preventDefault();var k=null;var c=document.querySelectorAll("div.svg-paper > div.svg-shape");if(c.length==1){k=c[0]}else{if(c.length>1){var h=[];for(var e=0,l;l=c[e];e++){var j=false;var a=l.getBoundingClientRect();for(var d=0,f;f=h[d];d++){var m=f[0];if(a.top<m){h.splice(d,0,[a.top,a.left,l]);j=true;break}else{if(a.top==m){if(a.left<f[1]){h.splice(d,0,[a.top,a.left,l]);j=true;break}}}}if(!j){h.push([a.top,a.left,l])}}for(var e=0,l;l=h[e];e++){l=l[2];if(l.classList.contains("in-operation")){if(b.shiftKey){var g=e-1;if(g<0){g=h.length-1}k=h[g][2]}else{var g=e+1;if(g>=h.length){g=0}k=h[g][2]}break}}if(!k){k=h[0][2]}}}unselectCurr();if(k){selectOneItem(k)}}break}}function noReplyEvent(a){a.stopPropagation();a.preventDefault()}function initSvgPaper(){var a=document.getElementById("root-paper");a.style.height=(window.innerHeight-PAPER_OFFSET_TOP)+"px";var d=document.getElementById("text-area");d.style.left=(document.body.clientWidth-361)+"px";var c=document.getElementById("dlg-mask");c.onclick=noReplyEvent;c.ondblclick=noReplyEvent;c.onmousedown=noReplyEvent;c.onmouseup=noReplyEvent;c.oncontextmenu=noReplyEvent;c.style.width=document.body.clientWidth+"px";c.style.height=window.innerHeight+"px";document.addEventListener("keydown",handleDocKeyDown,false);apiNode=document.getElementById("slide-api");apiNode.currSlideId=function(){return""};apiNode.newMarker=newMarkerId;apiNode.addSvgWidget=function(){var k=[];for(var f=0,j;j=apiNode.childNodes[f];f++){if(j.nodeType==1&&j.classList.contains("svg-shape")){a.appendChild(j);j.setAttribute("name",newWidgetId());initDesignPos(j,true,true);j.removeAttribute("_config");j.setAttribute("class","svg-shape");var e=j.querySelectorAll("div.img-resource > link");for(var g=0,h;h=e[g];g++){k.push(h)}}}apiNode.innerHTML="";for(var f=0,j;j=k[f];f++){requestOneSvg(j)}};function b(f){var q="";if(f.classList.contains("svg-shape")){var m=SVG_PAPER_CFG_CLASS;var g=f.getAttribute("_zindex")||"1000";var l=f.getAttribute("_widget")||"";var n=f.getAttribute("_left")||"0";var p=f.getAttribute("_top")||"0";var e=f.getAttribute("_width")||"100";var j=f.getAttribute("_height")||"60";var s=f.getAttribute("_rotate");var o=f.getAttribute("_defs");q='<div class="'+SVG_PAPER_USE_CLASS+'" _zindex="'+g+'" ';if(m){q+='_config="'+m+'" '}if(l){q+='_widget="'+l+'" '}if(s){q+='_rotate="'+s+'" '}if(o){q+='_defs="'+newMarkerId()+'" '}q+='_left="'+n+'" _top="'+p+'" _width="'+e+'" _height="'+j+'">';for(var h=0,t;t=f.childNodes[h];h++){var r=t.nodeType;if(r==3){q+=t.nodeValue}else{if(r==1){if(t.classList.contains("shape-canvas")){var k=t.getAttribute("style");if(k){q+="<div class='shape-canvas' style=\""+k.replace(/"/gm,"'")+'"></div>'}else{q+="<div class='shape-canvas'></div>"}}else{q+=t.outerHTML}}}}q+="</div>"}return q}apiNode.delDesignItem=function(){var e=a.querySelector("div.svg-shape.in-operation");if(e){unselectCurr();e.parentNode.removeChild(e);return true}return false};apiNode.copyItem=function(){var f=a.querySelector("div.svg-shape.in-operation");if(f){var e="COMPONENT_OF_PINP_SLIDE,0,"+b(f);apiNode.copyToClipboard(e);return true}else{return false}};apiNode.cutItem=function(){if(apiNode.copyItem()){apiNode.delDesignItem()}};apiNode.pasteItem=function(m,l,h){var w=m||apiNode.textOfClipboard();var n=l===undefined?"100":l+"";var q=h===undefined?"100":h+"";var e="COMPONENT_OF_PINP_SLIDE,";if(w.indexOf(e)==0){w=w.slice(e.length);var j=w.indexOf(",");if(j>=0){w=w.slice(j+1)}apiNode.innerHTML=w;var r=apiNode.childElementCount;if(r){var p=null,u=[];for(var t=0,v;v=apiNode.childNodes[t];t++){if(v.nodeType==1&&v.classList.contains("svg-shape")){var o=v.querySelectorAll("div.img-resource > link");for(var g=0,k;k=o[g];g++){u.push(k)}a.appendChild(v);var f=parseInt(v.getAttribute("_zindex")||"1000");if(f>=10000){f-=10000;v.setAttribute("_zindex",f+"")}v.setAttribute("_left",n);v.setAttribute("_top",q);initDesignPos(v,true,true);v.removeAttribute("_config");v.setAttribute("class","svg-shape");v.setAttribute("name",newWidgetId());p=v}}if(p){unselectCurr();selectOneItem(p)}for(var g=0,k;k=u[g];g++){requestOneSvg(k)}}apiNode.innerHTML=""}}}var editingWidget_=null;function getCookie__(c){if(document.cookie.length>0){var b,a=document.cookie.indexOf(c+"=");if(a!=-1){a=a+c.length+1;b=document.cookie.indexOf(";",a);if(b==-1){b=document.cookie.length}return unescape(document.cookie.substring(a,b))}}return""}function setCookie__(a,c,e,d){e=e||1;var b=new Date();b.setTime(b.getTime()+e*24*60*60*1000);d=d||"/";document.cookie=a+"="+escape(c)+";expires="+b.toGMTString()+";path="+d+";"}function location__(b){var a=document.createElement("a");a.href=b;if(a.host==""){a.href=a.href}return a}function itemMovDragOver(a){var b=getCookie__("drag_task");if(b=="run_cse"||b=="put_img"||b=="run_js"){a.preventDefault()}}function itemMovDragDrop(a){var p,f="";if(WEB_BROWSER_TYPE=="ie"){p=a.dataTransfer.getData("text")||""}else{p=a.dataTransfer.getData("text/args")||""}var j=p.split(",");var d=j.slice(3).join(",");if(j[0]=="image"){f=getCookie__("drag_task");if(d){d=location__(d).pathname;if(d[0]!="/"){d="/"+d}}else{if(j.length>=3){var g=parseInt(j[1]);if(g==0||g==1){d=location__(j[2]).pathname;if(d[0]!="/"){d="/"+d}}else{f=""}}}}if(d){if(f=="run_cse"){a.preventDefault();apiNode.setDropMouseXY(a.clientX,Math.max(a.clientY-PAPER_OFFSET_TOP,0));apiNode.runCseFile(window.decodeURI(d)+".cse")}else{if(f=="run_js"){a.preventDefault();apiNode.newTaskConfig(true);apiNode.setDropMouseXY(a.clientX,Math.max(a.clientY-PAPER_OFFSET_TOP,0));apiNode.runJsFile(window.decodeURI(d)+".js")}else{if(f=="put_img"){a.preventDefault();var k=a.clientX,i=a.clientY;if(CURR_USR_PATH&&d.indexOf(CURR_USR_PATH)==0&&d.length>CURR_USR_PATH.length){d=d.slice(CURR_USR_PATH.length)}var o=false,n=document.querySelector("div.svg-shape.in-operation");if(n){var h=n.getBoundingClientRect();if(k>=h.left&&k<h.left+h.width&&i>=h.top&&i<h.top+h.height){var e=n.querySelector("div.shape-canvas");if(e&&e.style.backgroundImage){var c="background-image:url("+d+");",m=window.getComputedStyle(e);if(m.backgroundColor){c="background-color:"+m.backgroundColor+";"+c}if(m.backgroundRepeat){c+="background-repeat:"+m.backgroundRepeat+";"}if(m.backgroundAttachment){c+="background-attachment:"+m.backgroundAttachment+";"}if(m.backgroundPosition){c+="background-position:"+m.backgroundPosition+";"}if(m.backgroundSize){c+="background-size:"+m.backgroundSize+";"}e.setAttribute("style",c);o=true}}}if(!o){var l='COMPONENT_OF_PINP_SLIDE,0,<div class="svg-shape" _zindex="998" _widget="[\'rgba(0,0,0,0)\',\'rgba(0,0,0,0)\',0,3,[\'\']]" _left="100" _top="100" _width="60" _height="60"><div class="shape-canvas" style="background-image:url(';l+=d+'); background-repeat:no-repeat; background-position:0px 0px; background-size:100% 100%;"></div>';l+='<div class="rotate-txt S5"></div><div class="img-resource"><link rel="bookmark" type="text/xml" href="/software/slide11/$images/shape/rect.svg.json"></div></div>';apiNode.pasteItem(l,k,i-PAPER_OFFSET_TOP)}}}}}hideInlineDialog();a.stopPropagation()}function hideInlineEditor(){var c=document.getElementById("text-area");var b=c.querySelector("iframe");if(b.contentWindow.unselectText){b.contentWindow.unselectText()}if(editingWidget_&&editingWidget_.parentNode&&c.style.display=="block"){var a=editingWidget_.querySelector("div.rotate-txt");if(a&&b.contentWindow.getContent){a.innerHTML=b.contentWindow.getContent()}}editingWidget_=null;c.style.display="none"}function unselectCurr(){var a=document.querySelectorAll("div.svg-shape.in-operation");for(var b=0,c;c=a[b];b++){c.classList.remove("in-operation")}document.querySelector("div.free-transform").style.display="none";document.querySelector("div.halo").style.display="none";var d=document.querySelector("div.point-nodes");d.innerHTML="";d.style.display="none";hideInlineEditor();document.getElementById("extend-tool").style.visibility="visible";document.getElementById("tool-frameWd").style.display="none";document.getElementById("tool-split2").style.display="none";document.getElementById("tool-lineId").style.display="none";document.getElementById("tool-split3").style.display="none";document.getElementById("tool-arrowIdE").style.display="none";document.getElementById("tool-split4E").style.display="none";document.getElementById("tool-arrowIdS").style.display="none";document.getElementById("tool-split4S").style.display="none";document.getElementById("tool-alignleft").style.display="none";document.getElementById("tool-alignmid").style.display="none";document.getElementById("tool-alignright").style.display="none";document.getElementById("tool-split5").style.display="none";document.getElementById("tool-poptop").style.display="none";document.getElementById("tool-pushbtm").style.display="none"}function setHaloStyle(b,a){if(a=="widget"){b.querySelector("div.link").style.display="block";b.querySelector("div.clone").style.display="block";b.querySelector("div.fork").style.display="block";b.querySelector("div.rotate").style.display="block"}else{if(a=="arrow"){b.querySelector("div.link").style.display="block";b.querySelector("div.clone").style.display="none";b.querySelector("div.fork").style.display="none";b.querySelector("div.rotate").style.display="none"}else{if(a=="auto-arrow"){b.querySelector("div.link").style.display="none";b.querySelector("div.clone").style.display="none";b.querySelector("div.fork").style.display="none";b.querySelector("div.rotate").style.display="none"}else{if(a=="iso-arrow"){b.querySelector("div.link").style.display="block";b.querySelector("div.clone").style.display="block";b.querySelector("div.fork").style.display="none";b.querySelector("div.rotate").style.display="none"}}}}}var arrowDataList_=["m0,50l100,0","m100,50l-100,40l30,-40l-30,-40z","m20,50c0,-16.57458 13.42542,-30 30,-30c16.57458,0 30,13.42542 30,30c0,16.57458 -13.42542,30 -30,30c-16.57458,0 -30,-13.42542 -30,-30z","m20,20l0,60l60,0l0,-60z","m20,80l60,-60m0,60l-60,-60","m50,0l0,100"];var arrowDataList2_=["m0,50l100,0","m0,50l100,40l-30,-40l30,-40z","m20,50c0,-16.57458 13.42542,-30 30,-30c16.57458,0 30,13.42542 30,30c0,16.57458 -13.42542,30 -30,30c-16.57458,0 -30,-13.42542 -30,-30z","m20,20l0,60l60,0l0,-60z","m20,80l60,-60m0,60l-60,-60","m50,0l0,100"];function getArrowPointHtml(n,p,j,f,g,h){var e=p.length;var d=1,c=1;for(var k=1;k<e;k+=2){var o=p[k-1],m=p[k];if(o>d){d=o}if(m>c){c=m}}var a=g/d,r=h/c;n.rateX=a;n.rateY=r;var q="",l=1;for(var k=3;k<e;k+=2){var o=p[k-1]*a+j,m=p[k]*r+f;q+='<div class="pointer" _pos="'+l+'" style="left:'+o+"px; top:"+m+'px"></div>';l+=1}return q}function onPoplineClicked(){document.querySelector("#text-area > div.popline-expand").style.display="none"}function selectOneItem(select){select.classList.add("in-operation");var cfgData=window.eval(select.getAttribute("_widget")||"null");var iStyle=0,sFillClr="",iStrokeWd=0,iStartArrow=0,iEndArrow=0,useLnDash=false,sLnDash="",bPoints=[];if(cfgData instanceof Array){iStyle=parseInt(cfgData[2]);if(cfgData.length>=2){sFillClr=cfgData[1]}if(cfgData.length>=4){iStrokeWd=parseInt(cfgData[3]);if(iStrokeWd<=0){iStrokeWd=1}if(cfgData.length>=5){var subCfg=cfgData[4];if(subCfg.length>=1){useLnDash=true;sLnDash=subCfg[0];if(subCfg.length>=4){iStartArrow=parseInt(subCfg[2]);iEndArrow=parseInt(subCfg[3]);bPoints=subCfg.slice(4)}}}}}document.getElementById("extend-tool").style.visibility="hidden";if(iStrokeWd>0){document.getElementById("tool-frameWd").style.display="block";document.getElementById("tool-split2").style.display="block";document.getElementById("group-frameWd").value=iStrokeWd+""}var textNode=document.getElementById("text-area");var frmNode=textNode.querySelector("iframe");if(editingWidget_&&editingWidget_.parentNode&&textNode.style.display=="block"){frmNode.contentWindow.unselectText();var tmp=editingWidget_.querySelector("div.rotate-txt");if(tmp){tmp.innerHTML=frmNode.contentWindow.getContent()}}if(sFillClr){var bTmp=parseRgbColor(sFillClr);if(bTmp.length>=3){var iOpacity=100;if(bTmp.length>=4){iOpacity=Math.min(100,Math.max(0,Math.floor(bTmp[3]*100+0.5)))}document.getElementById("group-opacity").value=iOpacity+""}}if(useLnDash){var sHtml='<svg width="60" height="14"><line stroke="#ff7f00" stroke-width="1" ';if(sLnDash){sHtml+='stroke-dasharray="'+sLnDash+'" '}sHtml+='x1="0%" y1="60%" x2="100%" y2="60%"/></svg>';var lnNode=document.getElementById("tool-lineId");lnNode.innerHTML=sHtml;lnNode.style.display="block";document.getElementById("tool-split3").style.display="block"}var arrNode=document.getElementById("tool-arrowIdE");if(iEndArrow>=1&&iEndArrow<=6){var sStyle=arrowDataList_[iEndArrow-1];var sHtml='<svg width="18" height="18" viewBox="0 0 100 100"><path stroke="#ff7f00" fill="#ff7f00" stroke-width="10" d="';sHtml+=sStyle+'"/></svg>';arrNode.innerHTML=sHtml;arrNode.style.display="block";document.getElementById("tool-split4E").style.display="block"}else{arrNode.style.display="none";document.getElementById("tool-split4E").style.display="none"}var sFrom=select.getAttribute("_from");var arrNode2=document.getElementById("tool-arrowIdS");if(iStyle<0&&!sFrom){if(iStartArrow<1){iStartArrow=1}var sStyle=arrowDataList2_[iStartArrow-1];var sHtml='<svg width="18" height="18" viewBox="0 0 100 100"><path stroke="#ff7f00" fill="#ff7f00" stroke-width="10" d="';sHtml+=sStyle+'"/></svg>';arrNode2.innerHTML=sHtml;arrNode2.style.display="block";document.getElementById("tool-split4S").style.display="block"}else{arrNode2.style.display="none";document.getElementById("tool-split4S").style.display="none"}document.getElementById("tool-alignleft").style.display=iStyle<0?"none":"block";document.getElementById("tool-alignmid").style.display=iStyle<0?"none":"block";document.getElementById("tool-alignright").style.display=iStyle<0?"none":"block";document.getElementById("tool-split5").style.display=iStyle<0?"none":"block";document.getElementById("tool-poptop").style.display="block";document.getElementById("tool-pushbtm").style.display="block";var rect=select.getBoundingClientRect();var pointBin=document.querySelector("div.point-nodes");if(iStyle<0){var iSideGap=Math.floor(iStrokeWd*2.5+0.5);iSideGap*=ARROW_SIDE_FACTOR;pointBin.innerHTML=getArrowPointHtml(pointBin,bPoints,rect.left+iSideGap,rect.top-PAPER_OFFSET_TOP+iSideGap,rect.width-iSideGap-iSideGap,rect.height-iSideGap-iSideGap);pointBin.fromWidget=select.getAttribute("name");pointBin.style.display="block";pointBin.classList.remove("no-move")}else{pointBin.style.display="none"}if(sFrom&&iStyle<0){textNode.style.display="none";var resizer=document.querySelector("div.free-transform");resizer.style.display="none";var autoLink=!select.getAttribute("_align");var halo=document.querySelector("div.halo");halo.style.display="block";if(autoLink){setHaloStyle(halo,"auto-arrow")}else{setHaloStyle(halo,"arrow")}halo.style.left=rect.left+"px";halo.style.top=rect.top+"px";halo.style.width=rect.width+"px";halo.style.height=rect.height+"px";if(autoLink){pointBin.classList.add("no-move")}}else{textNode.style.display="block";if(editingWidget_!==select){var rotNode=select.querySelector("div.rotate-txt");var sCls="",b=["S1","S2","S3","S4","S5"],sTmp=" "+rotNode.className+" ";for(var i=0,ss;ss=b[i];i++){if(sTmp.indexOf(" "+ss+" ")>=0){sCls=ss}}frmNode.contentWindow.setContent(rotNode.innerHTML,currPaperFontSize,sCls,currFontFamily,currExtendStyle);editingWidget_=select}document.querySelector("#text-area > div.popline-expand").style.display="block";var x=parseInt(select.getAttribute("_left")||"0");var y=parseInt(select.getAttribute("_top")||"0");var w=parseInt(select.getAttribute("_width")||"40");var h=parseInt(select.getAttribute("_height")||"60");var r=parseFloat(select.getAttribute("_rotate")||"0");var resizer=document.querySelector("div.free-transform");resizer.style.left=(x-2)+"px";resizer.style.top=(y-2+PAPER_OFFSET_TOP)+"px";resizer.style.width=(w+4)+"px";resizer.style.height=(h+4)+"px";if(r==0){resizer.style[WEB_BROWSER_PRE+"transform"]=""}else{resizer.style[WEB_BROWSER_PRE+"transform"]="rotate("+r+"deg)"}resizer.style.display="block";var rect=select.getBoundingClientRect();var halo=document.querySelector("div.halo");halo.style.display="block";if(iStyle<0){setHaloStyle(halo,"iso-arrow")}else{setHaloStyle(halo,"widget")}halo.style.left=rect.left+"px";halo.style.top=rect.top+"px";halo.style.width=rect.width+"px";halo.style.height=rect.height+"px"}}function paperOnClick(a){unselectCurr();hideInlineDialog();a.preventDefault();a.stopPropagation()}var movingPaper_=null;var movedPaper_=false;var movingPaperX_=0;var movingPaperY_=0;function paperMouseDown(b){var a=document.querySelector("div.svg-shape.in-operation");if(!a){movingPaper_=document.getElementById("root-paper");movedPaper_=false;movingPaperX_=b.clientX;movingPaperY_=b.clientY;movingPaper_.style.cursor="pointer"}}function removeCurrItem(event){var node=document.querySelector("div.svg-shape.in-operation");if(node){unselectCurr();var sFrom=node.getAttribute("_from")||"";var sName=node.getAttribute("name");node.parentNode.removeChild(node);var b=window.eval(node.getAttribute("_toArrow")||"[]");for(var i=0,item;item=b[i];i++){var s=item[0],s2=item[2];var arrNode=document.querySelector('div.svg-shape[name="'+s+'"]');if(arrNode){arrNode.parentNode.removeChild(arrNode)}if(s2){var targNode=document.querySelector('div.svg-shape[name="'+s2+'"]');if(targNode){var b2=window.eval(targNode.getAttribute("_fromArrow")||"[]");var iTmp=b2.indexOf(s);if(iTmp>=0){b2.splice(iTmp,1);if(b2.length==0){targNode.removeAttribute("_fromArrow")}else{targNode.setAttribute("_fromArrow",JSON.stringify(b2).replace(/"/gm,"'"))}}}}}b=window.eval(node.getAttribute("_fromArrow")||"[]");for(var i=0,item;item=b[i];i++){var fromNode=document.querySelector('div.svg-shape[name="'+item+'"]');if(fromNode){var changed=false;var b2=window.eval(fromNode.getAttribute("_toArrow")||"[]");for(var i2=b2.length-1;i2>=0;i2--){var item2=b2[i2];if(item2[2]===sName){var arrowNode=document.querySelector('div.svg-shape[name="'+item2[0]+'"]');if(arrowNode){arrowNode.parentNode.removeChild(arrowNode)}b2.splice(i2,1);changed=true;break}}if(changed){if(b2.length==0){fromNode.removeAttribute("_toArrow")}else{fromNode.setAttribute("_toArrow",JSON.stringify(b2).replace(/"/gm,"'"))}}}}if(sFrom&&sName){var fromNode=document.querySelector('div.svg-shape[name="'+sFrom+'"]');if(fromNode){var sOwner=fromNode.getAttribute("name");b=window.eval(fromNode.getAttribute("_toArrow")||"[]");for(var i=0,item;item=b[i];i++){if(item[0]==sName){var s2=item[2];b.splice(i,1);if(b.length==0){fromNode.removeAttribute("_toArrow")}else{fromNode.setAttribute("_toArrow",JSON.stringify(b).replace(/"/gm,"'"))}var targNode=null;if(s2){targNode=document.querySelector('div.svg-shape[name="'+s2+'"]')}if(targNode&&sOwner){var b2=window.eval(targNode.getAttribute("_fromArrow")||"[]");var iTmp=b2.indexOf(sOwner);if(iTmp>=0){b2.splice(iTmp,1);if(b2.length==0){targNode.removeAttribute("_fromArrow")}else{targNode.setAttribute("_fromArrow",JSON.stringify(b2).replace(/"/gm,"'"))}}}break}}}}}}var rotatingWidget_=null;var rotateRotate_=0;var rotateAngle_=0;function rotateMouseDown(c){if(c.button==0&&!c.ctrlKey&&!c.shiftKey&&!c.altKey){var b=document.querySelector("div.svg-shape.in-operation");if(b){var a=b.getBoundingClientRect();rotateRotate_=parseFloat(b.getAttribute("_rotate")||"0");rotateAngle_=getAngle(a.left+a.width/2,a.top+a.height/2,c.clientX,c.clientY);rotatingWidget_=b}}}var resizingWidget_=null;var resizerTag_="";var resizerMoveX_=0;var resizerMoveY_=0;function resizerMouseDown(c){var a=c.target;if(a.classList.contains("resize")&&c.button==0&&!c.ctrlKey&&!c.shiftKey&&!c.altKey){var b=document.querySelector("div.svg-shape.in-operation");if(b){document.querySelector("div.point-nodes").style.display="none";resizingWidget_=b;resizerTag_=a.getAttribute("data-position");resizerMoveX_=c.clientX;resizerMoveY_=c.clientY}}}var cloningWidget_=null;var cloneMoveX_=0;var cloneMoveY_=0;function cloneMouseDown(c){if(c.button==0&&!c.ctrlKey&&!c.shiftKey&&!c.altKey){var b=document.querySelector("div.svg-shape.in-operation");if(b){var a=document.createElement("div");a.classList.add("svg-shape");a.setAttribute("_widget",b.getAttribute("_widget"));a.setAttribute("_zindex",b.getAttribute("_zindex"));a.setAttribute("_left",b.getAttribute("_left"));a.setAttribute("_top",b.getAttribute("_top"));a.setAttribute("_width",b.getAttribute("_width"));a.setAttribute("_height",b.getAttribute("_height"));var d=b.getAttribute("_rotate");if(d){a.setAttribute("_rotate",d)}if(b.getAttribute("_defs")){a.setAttribute("_defs",newMarkerId())}a.innerHTML=b.innerHTML;initDesignPos(a,false,true);a.setAttribute("name",newWidgetId());var e=document.getElementById("root-paper");e.appendChild(a);cloningWidget_=a;cloneMoveX_=c.clientX;cloneMoveY_=c.clientY}}}var linkingWidget_=null;var linkSmooth_=false;var linkfromFix_=false;var linkFixX_=0;var linkFixY_=0;var linkMoveX_=0;var linkMoveY_=0;function linkMouseDown(event){if(event.button==0&&!event.ctrlKey&&!event.altKey){var node=document.querySelector("div.svg-shape.in-operation");if(node){linkfromFix_=false;var lastCfgStr=node.getAttribute("_widget")||"";if(lastCfgStr){var cfgData=window.eval(lastCfgStr);if(cfgData instanceof Array&&cfgData.length>=5&&cfgData[2]<0){var pointBin=document.querySelector("div.point-nodes");if(pointBin.style.display=="block"){var strokeWd=cfgData[3];if(strokeWd<=0){strokeWd=1}var sideGap=Math.floor(strokeWd*2.5+0.5);sideGap*=ARROW_SIDE_FACTOR;var rect=node.getBoundingClientRect();var subCfg=cfgData[4];linkfromFix_=true;linkFixX_=rect.left+sideGap+subCfg[subCfg.length-2]*pointBin.rateX;linkFixY_=rect.top+sideGap+subCfg[subCfg.length-1]*pointBin.rateY}}}linkingWidget_=node;linkSmooth_=event.shiftKey;linkMoveX_=event.clientX;linkMoveY_=event.clientY}}}function lineStyleClick(a){hideInlineDialog();document.getElementById("linestyle_dropdown").style.display="block";a.preventDefault();a.stopPropagation()}var currStartArrowStyle_=false;function arrowStyleClick(b,a){hideInlineDialog();currStartArrowStyle_=a;document.getElementById("arrowstyle_dropdown").style.display="block";b.preventDefault();b.stopPropagation()}function lineStyleListClick(event){var targ=event.target;while(targ){if(targ.nodeType==1&&targ.nodeName=="svg"){break}targ=targ.parentNode}if(!targ){return}var lineDashList=["","1,1","2,2","5,5","5,10","10,5","5,1","15,10,5,10,15"];var iStyle=parseInt(targ.getAttribute("_style")||"0");var sStyle=lineDashList[iStyle]||"";var sHtml='<svg width="60" height="14"><line stroke="#ff7f00" stroke-width="1" ';if(sStyle){sHtml+='stroke-dasharray="'+sStyle+'" '}sHtml+='x1="0%" y1="60%" x2="100%" y2="60%"/></svg>';var toolNode=document.getElementById("tool-lineId");toolNode.innerHTML=sHtml;var node=document.querySelector("div.svg-shape.in-operation");if(node){var cfgData=window.eval(node.getAttribute("_widget")||"null");if(cfgData instanceof Array){if(cfgData.length==4){cfgData.push([sStyle])}else{if(cfgData.length>=5){var subCfg=cfgData[4];if(subCfg instanceof Array&&subCfg.length>=1){subCfg[0]=sStyle}}}node.setAttribute("_widget",JSON.stringify(cfgData).replace(/"/gm,"'"));buildShape2(node,true);if(cfgData.length>=3&&cfgData[2]<0){lastArrowDash_=sStyle}}}hideInlineDialog();event.preventDefault();event.stopPropagation()}function arrowStyleListClick(event){var targ=event.target;while(targ){if(targ.nodeType==1&&targ.nodeName=="svg"){break}targ=targ.parentNode}if(!targ){return}var sStyle,iStyle=parseInt(targ.getAttribute("_style")||"1");if(currStartArrowStyle_){sStyle=arrowDataList2_[iStyle]||arrowDataList2_[0]}else{sStyle=arrowDataList_[iStyle]||arrowDataList_[1]}var sHtml='<svg width="18" height="18" viewBox="0 0 100 100"><path stroke="#ff7f00" fill="#ff7f00" stroke-width="10" d="';sHtml+=sStyle+'"/></svg>';var toolNode,subIndex=3;if(currStartArrowStyle_){subIndex=2;toolNode=document.getElementById("tool-arrowIdS")}else{toolNode=document.getElementById("tool-arrowIdE")}toolNode.innerHTML=sHtml;var node=document.querySelector("div.svg-shape.in-operation");if(node){var cfgData=window.eval(node.getAttribute("_widget")||"null");if(cfgData instanceof Array&&cfgData.length>=5){var subCfg=cfgData[4];if(subCfg instanceof Array&&subCfg.length>=4){if(currStartArrowStyle_&&iStyle==0){subCfg[subIndex]=0}else{subCfg[subIndex]=iStyle+1}node.setAttribute("_widget",JSON.stringify(cfgData).replace(/"/gm,"'"));buildShape2(node,true)}}}hideInlineDialog();event.preventDefault();event.stopPropagation()}var movingArrowPoint_=null;var pointOrgX_=0;var pointOrgY_=0;var pointMoveX_=0;var pointMoveY_=0;var pointStartLeft_=0;var pointStartTop_=0;function pointsMouseDown(event){var targ=event.target;if(targ.classList.contains("pointer")){var ownerOfPoint=targ.parentNode;var sName=ownerOfPoint.fromWidget;if(sName&&ownerOfPoint.style.display=="block"&&!ownerOfPoint.classList.contains("no-move")){var arrowNode=document.querySelector('div.svg-shape[name="'+sName+'"]');if(arrowNode){var cfgData=window.eval(arrowNode.getAttribute("_widget")||"null");if((cfgData instanceof Array)&&cfgData.length>=5){var subCfg=cfgData[4],subLen=subCfg.length;var pointId=parseInt(targ.getAttribute("_pos")||"1");var index=pointId+pointId+5;if(index<subLen){pointOrgX_=subCfg[index-1];pointOrgY_=subCfg[index];movingArrowPoint_=targ;pointMoveX_=event.clientX;pointMoveY_=event.clientY;pointStartLeft_=parseInt(targ.style.left);pointStartTop_=parseInt(targ.style.top)}}}}}}var forkingWidget_=null;var forkNewWidget_=null;var forkSmooth_=false;var forkMoveX_=0;var forkMoveY_=0;function forkMouseDown(c){if(c.button==0&&!c.ctrlKey&&!c.altKey){var b=document.querySelector("div.svg-shape.in-operation");if(b){var a=document.createElement("div");a.classList.add("svg-shape");a.setAttribute("_widget",b.getAttribute("_widget"));a.setAttribute("_zindex",b.getAttribute("_zindex"));a.setAttribute("_left",b.getAttribute("_left"));a.setAttribute("_top",b.getAttribute("_top"));a.setAttribute("_width",b.getAttribute("_width"));a.setAttribute("_height",b.getAttribute("_height"));var d=b.getAttribute("_rotate");if(d){a.setAttribute("_rotate",d)}a.innerHTML=b.innerHTML;initDesignPos(a,false,true);a.setAttribute("name",newWidgetId());var e=document.getElementById("root-paper");e.appendChild(a);forkSmooth_=c.shiftKey;forkingWidget_=b;forkNewWidget_=a;forkMoveX_=c.clientX;forkMoveY_=c.clientY}}}function textAlignClick(b,c){hideInlineDialog();var a=document.querySelector("div.svg-shape.in-operation > div.rotate-txt");if(a){if(c==0){a.classList.add("txt-left")}else{a.classList.remove("txt-left")}if(c==1){a.classList.add("txt-center")}else{a.classList.remove("txt-center")}if(c==2){a.classList.add("txt-right")}else{a.classList.remove("txt-right")}}b.preventDefault();b.stopPropagation()}function popTopmostClick(h){hideInlineDialog();var g=document.querySelector("div.svg-shape.in-operation");if(g){var c=1,a=parseInt(g.getAttribute("_zindex")||"1000");var b=document.querySelectorAll("div.svg-shape");for(var d=0,f;f=b[d];d++){if(f===g){continue}var e=parseInt(f.getAttribute("_zindex")||"1000");if(e==a){c+=1}else{if(e>a){c=2;a=e}}}if(c>1){a+=1}g.setAttribute("_zindex",a+"");g.style.zIndex=a+""}h.preventDefault();h.stopPropagation()}function pushBottomClick(h){hideInlineDialog();var g=document.querySelector("div.svg-shape.in-operation");if(g){var c=1,a=parseInt(g.getAttribute("_zindex")||"1000");var b=document.querySelectorAll("div.svg-shape");for(var d=0,f;f=b[d];d++){if(f===g){continue}var e=parseInt(f.getAttribute("_zindex")||"1000");if(e==a){c+=1}else{if(e<a){c=2;a=e}}}if(c>1){a-=1}g.setAttribute("_zindex",a+"");g.style.zIndex=a+""}h.preventDefault();h.stopPropagation()};