var hasInit=false;var styleRet="";var styleRet2="";var replacedImgRet="";var backBgkColorRet="";var backColorRet="";var frontColorRet="";var svgShapeStyle=0;var svgShapeData=null;var currentScale=0;var currentFlipCfg=0;var currentBackGate=1;var currentFrontGate=2;var currentIsSvg=false;var currentCanDragImg=false;var currentSvgScale=0;var WEB_IE_BROWSER=false;function hslToRgb(i,m,f){var a,j,k;if(m==0){a=j=k=f}else{function e(h,g,b){if(b<0){b+=1}else{if(b>1){b-=1}}if(b<1/6){return h+(g-h)*6*b}else{if(b<1/2){return g}else{if(b<2/3){return h+(g-h)*(2/3-b)*6}else{return h}}}}var c=f<0.5?f*(1+m):f+m-f*m;var d=2*f-c;i/=360;a=e(d,c,i+1/3);j=e(d,c,i);k=e(d,c,i-1/3)}return[Math.floor(a*255+0.5),Math.floor(j*255+0.5),Math.floor(k*255+0.5)]}function rgbToHsl(a,i,k){a/=255,i/=255,k/=255;var m=Math.max(a,i,k),e=Math.min(a,i,k);var f,n,c=(m+e)/2;if(m==e){f=n=0}else{var j=m-e;n=c>=0.5?j/(2-m-e):j/(m+e);if(m==a){f=(i-k)/j}else{if(m==i){f=(k-a)/j+2}else{f=(a-i)/j+4}}f*=60;if(f<0){f+=360}}return[Math.floor(f+0.5),n,c]}function setColorPos(t,o,z,B,C,f){var v=t.querySelector("div.s-slider");var q=t.querySelector("div.l-slider");var k=t.querySelector("div.a-slider");var c=t.querySelector("div.h-slider > div.handle");var A=t.querySelector("div.s-slider > div.handle");var n=t.querySelector("div.l-slider > div.handle");var x=t.querySelector("div.a-slider > div.handle");var d=t.querySelector("div.h-slider > p");var p=t.querySelector("div.s-slider > p");var w=t.querySelector("div.l-slider > p");var j=t.querySelector("div.a-slider > p");var y=f[0],m=f[1],u=f[2],e=Math.floor(m*100+0.5);c.style.left=y+"px";d.innerHTML="H="+y;A.style.left=parseInt(m*360+0.5)+"px";v.style.background="-webkit-linear-gradient(0deg,rgb(128,128,128),hsl("+y+",20%,50%),hsl("+y+",40%,50%),hsl("+y+",60%,50%),hsl("+y+",80%,50%),hsl("+y+",100%,50%))";p.innerHTML="S="+(m+"").slice(0,4);n.style.left=parseInt(u*360+0.5)+"px";q.style.background="-webkit-linear-gradient(0deg,rgb(0,0,0),hsl("+y+","+e+"%,20%),hsl("+y+","+e+"%,40%),hsl("+y+","+e+"%,60%),hsl("+y+","+e+"%,80%),rgb(255,255,255))";w.innerHTML="L="+(u+"").slice(0,4);x.style.left=parseInt(C*360+0.5)+"px";var i="rgba("+o+","+z+","+B+",";k.style.background="-webkit-linear-gradient(0deg,"+i+"0),"+i+"0.2),"+i+"0.4),"+i+"0.6),"+i+"0.8),"+i+"1))";j.innerHTML="A="+((C+0.005)+"").slice(0,4)}function initColorPos(i,e){var h=128,f=128,c=128,d=1;rgb=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);if(rgb){h=parseInt(rgb[1]);f=parseInt(rgb[2]);c=parseInt(rgb[3])}else{rgba=e.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([.0-9]+)\s*\)$/);if(rgba){h=parseInt(rgba[1]);f=parseInt(rgba[2]);c=parseInt(rgba[3]);d=parseFloat(rgba[4])}}setColorPos(i,h,f,c,d,rgbToHsl(h,f,c));return[h,f,c,d]}function makeRgbColor(d){var h=d[0],f=d[1],c=d[2],e=d[3];if(typeof e!="number"){e=1}if(Math.floor(e*100+0.5)==100){return"rgb("+h+","+f+","+c+")"}else{return"rgba("+h+","+f+","+c+","+(e+"").slice(0,4)+")"}}var regExprRotate=/\brotate\s*\(\s*([-0-9]+)\s*deg\s*\)/m;var regExprFlipX=/\bscaleX\s*\(\s*-1\s*\)/m;var regExprFlipY=/\bscaleY\s*\(\s*-1\s*\)/m;function getRotateFromCss(g,d){if(d){var h=regExprFlipX.exec(g);if(h){currentFlipCfg=1}else{h=regExprFlipY.exec(g);if(h){currentFlipCfg=2}}var c=document.querySelectorAll("#flip-cfg > input");for(var e=0,f;f=c[e];e++){f.checked=(currentFlipCfg==e)}}var a=regExprRotate.exec(g);if(a){var e=parseInt(a[1]);if(e<0){e+=360}return e}return 0}function initMask(bCfg){if(hasInit){return}hasInit=true;var sUA=navigator.userAgent.toLowerCase();if(sUA.match(/trident.*rv[ :]*([\d.]+)/)||sUA.match(/msie ([\d.]+)/)){WEB_IE_BROWSER=true}var node=document.getElementById("designed-mask");var sCls=bCfg[0]||"";var sImgList=bCfg[1]||"";var sWidget=bCfg[2]||"";var sStyle=bCfg[3]||"";var sStyle2=bCfg[4]||"";currentIsSvg=sCls.indexOf("svg-shape")>=0;var bBackColor,bFrontColor,bBackBkgColor,fScaleRate,svgStrokeWd=0;var cfgData=window.eval(sWidget);if(cfgData instanceof Array){if(currentIsSvg&&cfgData.length>=3){currentFrontGate=2;bFrontColor=parseRgbColor(cfgData[0]);if(!(bFrontColor instanceof Array)){return}currentBackGate=1;bBackColor=parseRgbColor(cfgData[1]);if(!(bBackColor instanceof Array)){return}svgShapeStyle=parseInt(cfgData[2]);if(cfgData.length>=4){svgStrokeWd=parseInt(cfgData[3])}bBackBkgColor=parseRgbColor("rgba(0,0,0,0)");fScaleRate=0;if(cfgData.length>=5){svgShapeData=cfgData[4]}}else{if(!currentIsSvg&&cfgData.length>=4){currentFrontGate=(cfgData[0]=="outline"?2:(cfgData[0]=="shape"?1:0));bFrontColor=parseRgbColor(cfgData[1]);if(!(bFrontColor instanceof Array)){return}currentBackGate=(cfgData[2]=="outline"?2:(cfgData[2]=="shape"?1:0));bBackColor=parseRgbColor(cfgData[3]);if(!(bBackColor instanceof Array)){return}bBackBkgColor=parseRgbColor(cfgData[4]||"rgba(0,0,0,0)");if(!(bBackBkgColor instanceof Array)){return}fScaleRate=parseFloat(cfgData[5]||"0");if(fScaleRate!=0){fScaleRate=Math.min(10,Math.max(0.2,fScaleRate))}}else{return}}}else{return}backBgkColorRet=makeRgbColor(bBackBkgColor);var bkgClrNode=document.getElementById("back-bkg-color");document.getElementById("back-bkg-color").value=backBgkColorRet;if(currentIsSvg){document.getElementById("back-bkg-div").style.display="none"}var gateNodes=document.getElementById("back-gate").querySelectorAll("input");for(var i=0,item;item=gateNodes[i];i++){item.checked=(i==currentBackGate)}gateNodes=document.getElementById("front-gate").querySelectorAll("input");for(var i=0,item;item=gateNodes[i];i++){item.checked=(i==currentFrontGate)}node.setAttribute("_widget",sWidget);if(fScaleRate){document.getElementById("scale-slider").style.display="block";currentScale=fScaleRate;var iPos=Math.floor(((fScaleRate-0.2)/9.8)*360+0.5);var scaleNode=document.getElementById("scale-rate");scaleNode.querySelector("div.handle").style.left=iPos+"px";scaleNode.querySelector("p").innerHTML="W="+((fScaleRate+0.005)+"").slice(0,4)}else{if(currentIsSvg&&svgStrokeWd){currentSvgScale=svgStrokeWd;document.getElementById("scale-slider").style.display="block";var iPos=Math.max(0,Math.min(currentSvgScale-1,180));var scaleNode=document.getElementById("scale-rate");scaleNode.querySelector("div.handle").style.left=(iPos+iPos)+"px";scaleNode.querySelector("p").innerHTML="W="+currentSvgScale}}var sHtml="<div class='rotate-txt'><p><span style='font-weight:600; background-color:rgba(255,255,255,0.4)'>&nbsp;Sample text&nbsp;</span></p></div>";if(currentIsSvg){node.classList.remove("pinp-shape");node.classList.add("svg-shape");sHtml="<div class='shape-canvas'>"+sImgList+"</div>"+sHtml+"<div class='img-resource'></div>";node.innerHTML=sHtml;var img=node.querySelector("svg");if(img){var rate=1;if(img.clientWidth>=img.clientHeight){rate=200/img.clientWidth;img.style.marginTop=Math.floor((200-img.clientHeight*rate)/2)+"px"}else{rate=200/img.clientHeight;img.style.marginLeft=Math.floor((200-img.clientWidth*rate)/2)+"px"}img.style["-webkit-transform-origin"]="0% 0%";img.style["-webkit-transform"]="scale("+rate+","+rate+")"}}else{sHtml="<div class='shape-canvas'></div>"+sHtml+"<div class='img-resource'>"+sImgList+"</div>";node.innerHTML=sHtml}var imgNode=node.querySelector("div.shape-canvas");var txtNode=node.querySelector("div.rotate-txt");var iRotate=0;if(sStyle){iRotate=getRotateFromCss(sStyle,true)}var rotateNode=document.getElementById("img-rotate");rotateNode.querySelector("div.handle").style.left=iRotate+"px";rotateNode.querySelector("p").innerHTML="IMG R="+iRotate;var sScale="";if(currentFlipCfg==1){sScale=" scaleX(-1)"}else{if(currentFlipCfg==2){sScale=" scaleY(-1)"}}if(iRotate!=0){styleRet="rotate("+iRotate+"deg)"+sScale;imgNode.setAttribute("style","-webkit-transform:"+styleRet)}else{if(sScale){styleRet=sScale.trim();imgNode.setAttribute("style","-webkit-transform:"+styleRet)}}var iRotate2=0;if(sStyle2){iRotate2=getRotateFromCss(sStyle2,false)}var rotateNode2=document.getElementById("txt-rotate");rotateNode2.querySelector("div.handle").style.left=iRotate2+"px";rotateNode2.querySelector("p").innerHTML="TXT R="+iRotate2;if(iRotate2!=0){styleRet2="rotate("+iRotate2+"deg)";txtNode.setAttribute("style","-webkit-transform:"+styleRet2)}backColorRet=makeRgbColor(bBackColor);frontColorRet=makeRgbColor(bFrontColor);var clrNode=document.getElementById("bkg-clr");initColorPos(clrNode,backColorRet);clrNode=document.getElementById("border-clr");initColorPos(clrNode,frontColorRet);var imgList=node.querySelectorAll("div.img-resource > img");currentCanDragImg=(imgList.length==1)}function setupWidgetCfg(){if(currentIsSvg){var d=[frontColorRet,backColorRet,svgShapeStyle,currentSvgScale];if(svgShapeData){d.push(svgShapeData)}return JSON.stringify(d).replace(/"/gm,"'")}else{var g=(currentFrontGate==2?"outline":(currentFrontGate==1?"shape":"none"));var e=(currentBackGate==2?"outline":(currentBackGate==1?"shape":"none"));var c="['"+g+"','"+frontColorRet+"','"+e+"','"+backColorRet+"'";var f=document.getElementById("back-bkg-color").value;var a=parseRgbColor(f);if(a){backBgkColorRet=f}else{a=parseRgbColor(backBgkColorRet)}if(a&&a[0]==0&&a[1]==0&&a[2]==0&&a[3]===0){if(currentScale==0){c+="]"}else{c+=",'rgba(0,0,0,0)',"+((currentScale+0.005)+"").slice(0,4)+"]"}}else{c+=",'"+backBgkColorRet+"'";if(currentScale==0){c+="]"}else{c+=","+((currentScale+0.005)+"").slice(0,4)+"]"}}return c}}function getMaskData(){return[setupWidgetCfg(),styleRet,styleRet2,replacedImgRet]}function finishEditing(a){var b=document.getElementById("api-node");b.setCloseState(a);window.close()}var currMovedNode=null;var currMoveLastX=0;var currMoveChanged=false;function sliderMouseDn(a){if(!a.ctrlKey&&!a.altKey){currMovedNode=a.target;currMoveLastX=a.clientX;currMoveChanged=false;a.preventDefault()}}function updateColorTxt(b){var d=b.parentNode;var e=d.className;var a=0;if(e.indexOf("h-slider")>=0){a=1}else{if(e.indexOf("s-slider")>=0){a=2}else{if(e.indexOf("l-slider")>=0){a=3}else{if(e.indexOf("a-slider")>=0){a=4}else{if(e.indexOf("r-slider")>=0){a=5}}}}}if(a){var h=d.querySelector("p");if(h){if(a==1){h.innerHTML="H="+b.offsetLeft}else{if(a==5){if(d.id=="img-rotate"){h.innerHTML="IMG R="+b.offsetLeft}else{if(d.id=="txt-rotate"){h.innerHTML="TXT R="+b.offsetLeft}else{if(currentIsSvg){if(currentSvgScale){var g=Math.min(b.offsetLeft,358);h.innerHTML="W="+(Math.floor(g/2)+1)}}else{var g=(b.offsetLeft/360)*9.8+0.2;h.innerHTML="W="+((g+0.005)+"").slice(0,4)}}}}else{var c=((b.offsetLeft/360)+"").slice(0,4);if(a==2){h.innerHTML="S="+c}else{if(a==3){h.innerHTML="L="+c}else{h.innerHTML="A="+c}}}}}}return a}function sliderMouseMove(c){if(!c.ctrlKey&&!c.altKey&&currMovedNode){var b=c.clientX-currMoveLastX;if(b!=0){var a=currMovedNode.offsetLeft+b;if(a<0){a=0}else{if(a>360){a=360}}currMovedNode.style.left=a+"px";currMoveLastX+=b;currMoveChanged=true;updateColorTxt(currMovedNode)}}}function updateColor(c){var b=c.parentNode;var d=b.parentNode;var r=d.parentNode;var e=updateColorTxt(c);if(e){var m=r.querySelector("div.h-slider > div.handle");var n=r.querySelector("div.s-slider > div.handle");var g=r.querySelector("div.l-slider > div.handle");var f=r.querySelector("div.a-slider > div.handle");var k=m.offsetLeft;var t=n.offsetLeft/360;var i=g.offsetLeft/360;var q=f.offsetLeft/360;var o=hslToRgb(k,t,i);setColorPos(r,o[0],o[1],o[2],q,[k,t,i]);var p=document.getElementById("designed-mask");var j;if(Math.floor(q*100+0.5)==100){j="rgb("+o[0]+","+o[1]+","+o[2]+")"}else{j="rgba("+o[0]+","+o[1]+","+o[2]+","+(q+"").slice(0,4)+")"}if(currentIsSvg){if(r.id=="bkg-clr"){resetSvgColor(p,frontColorRet,j);backColorRet=j}else{if(r.id=="border-clr"){resetSvgColor(p,j,backColorRet);frontColorRet=j}}}else{if(r.id=="bkg-clr"){backColorRet=j;p.setAttribute("_widget",setupWidgetCfg());buildShape(p,true)}else{if(r.id=="border-clr"){frontColorRet=j;p.setAttribute("_widget",setupWidgetCfg());buildShape(p,true)}}}}}function updateRotate(g,h){var e=document.getElementById("designed-mask");if(h=="img-rotate"){if(g>=360){g-=360}var b="";if(currentFlipCfg==1){b=" scaleX(-1)"}else{if(currentFlipCfg==2){b=" scaleY(-1)"}}e=e.querySelector("div.shape-canvas");if(g==0){styleRet=b.trim();if(styleRet){e.setAttribute("style","-webkit-transform:"+styleRet)}else{e.setAttribute("style","")}}else{styleRet="rotate("+g+"deg)"+b;e.setAttribute("style","-webkit-transform:"+styleRet)}}else{if(h=="txt-rotate"){if(g>=360){g-=360}e=e.querySelector("div.rotate-txt");if(g==0){styleRet2="";e.setAttribute("style","")}else{styleRet2="rotate("+g+"deg)";e.setAttribute("style","-webkit-transform:"+styleRet2)}}else{if(h=="scale-rate"){if(currentIsSvg){if(currentSvgScale){g=Math.max(0,Math.min(358,g));currentSvgScale=Math.floor(g/2)+1;var f=document.getElementById("designed-mask");f.setAttribute("_widget",setupWidgetCfg());var a=f.querySelectorAll("g[_widget]");for(var c=0,d;d=a[c];c++){if(d.hasAttribute("stroke-width")){d.setAttribute("stroke-width",currentSvgScale+"")}}}}else{g=Math.max(0,Math.min(360,g));currentScale=(g/360)*9.8+0.2;var f=document.getElementById("designed-mask");f.setAttribute("_widget",setupWidgetCfg());buildShape(f,true)}}}}}function sliderMouseUp(b){if(currMovedNode&&currMoveChanged){currMoveChanged=false;var a=currMovedNode.parentNode;if(a.className.indexOf("r-slider")>=0){updateRotate(currMovedNode.offsetLeft,a.id)}else{updateColor(currMovedNode)}}currMovedNode=null;currMoveLastX=0}function PatternDragOver(a){if(currentCanDragImg){a.preventDefault()}}function location__(b){var a=document.createElement("a");a.href=b;if(a.host==""){a.href=a.href}return a}function PatternDragDrop(g){g.stopPropagation();g.preventDefault();if(!currentCanDragImg){return}var f="";if(g.dataTransfer){if(WEB_IE_BROWSER){f=g.dataTransfer.getData("text")||""}else{f=g.dataTransfer.getData("text/args")||""}}var a=f.split(",");if(a.length==3&&a[0]=="image"&&a[1]=="0"){var e=a[2].trim();var c=location__(e);if(c.host==window.location.host){e=c.pathname;if(e[0]!="/"){e="/"+e}}else{e=c.href}var d=document.querySelector("div.pinp-shape > div.img-resource");if(d){replacedImgRet=e;d.innerHTML='<img src="'+e+'" onload="buildShape(this)" />';setTimeout(function(){buildShape(document.getElementById("designed-mask"),true)},500)}}}function setFlipConfig(f){currentFlipCfg=f;var e=document.querySelectorAll("#flip-cfg > input");for(var b=0,c;c=e[b];b++){c.checked=(b==f)}var a="";if(currentFlipCfg==1){a=" scaleX(-1)"}else{if(currentFlipCfg==2){a=" scaleY(-1)"}}imgNode=document.querySelector("#designed-mask > div.shape-canvas");handleNode=document.querySelector("#img-rotate > div.handle");var d=handleNode.offsetLeft;if(d==0){styleRet=a.trim();if(styleRet){imgNode.setAttribute("style","-webkit-transform:"+styleRet)}else{imgNode.setAttribute("style","")}}else{styleRet="rotate("+d+"deg)"+a;imgNode.setAttribute("style","-webkit-transform:"+styleRet)}}function setMaskGate(a,g){var e="";if(a=="back"){currentBackGate=g;e="#back-gate"}else{if(a=="front"){currentFrontGate=g;e="#front-gate"}else{return}}if(currentIsSvg){if(a=="back"){g=1}else{g=2}}var f=document.querySelectorAll(e+" > input");for(var b=0,c;c=f[b];b++){c.checked=(b==g)}if(!currentIsSvg){var d=document.getElementById("designed-mask");d.setAttribute("_widget",setupWidgetCfg());buildShape(d,true)}}function maskEditorInit(){var a=document.querySelectorAll("div.handle");for(var b=0,c;c=a[b];b++){c.onmousedown=sliderMouseDn}document.body.onmousemove=sliderMouseMove;document.body.onmouseup=sliderMouseUp}var regExprRgb=/\b(rgb|rgba)\s*\(([^)]*)\)/m;function parseRgbColor(e){var a=regExprRgb.exec(e);if(a){var c=a[2].split(",");for(var d=0,f;f=c[d];d++){if(d<3){c[d]=parseInt(f)||0}else{c[d]=parseFloat(f)}}return c}else{return null}}function quickShapeData(e,y,k,z){var v=e[0];var c=e[1];var j=e[2];var D=e[3];if(D===undefined){D=1}D=Math.min(Math.max(0,D),1);var h=Math.floor(D*255+0.5);var t=y[0];var E=y[1];var f=y[2];var C=y[3];if(C===undefined){C=1}C=Math.min(Math.max(0,C),1);var p=Math.floor(C*255+0.5);var n=z.data;var w=n.length/4;for(var u=0,q=-1;u<w;u++){var m=n[++q];var x=n[++q];var A=n[++q];var B=n[++q];var o=false,d=false,l=false,s=false;if(B==255){if(x==0&&A==0&&m==0){d=true}else{if(m==192&&x==192&&A==192){l=true}else{if(m==255&&x==255&&A==255){o=true}else{if(m==128&&x==128&&A==128){s=true}}}}}if(o){n[q]=0;n[q-3]=0;n[q-2]=0;n[q-1]=0}else{if(l){n[q]=h;n[q-3]=v;n[q-2]=c;n[q-1]=j}else{if(d){n[q]=p;n[q-3]=t;n[q-2]=E;n[q-1]=f}else{if(s){n[q]=Math.floor(C*128+0.5);n[q-3]=t;n[q-2]=E;n[q-1]=f}}}}}}function buildShape(node,rebuild){while(node){if(node.classList.contains("pinp-shape")){break}node=node.parentNode}if(!node){return}var imgNodes=node.querySelectorAll("div.img-resource > img");var imgNum=imgNodes.length;if(imgNum<1||imgNum>5){return}for(var i=0,img;img=imgNodes[i];i++){if(!img.complete){return}}if(node._hasBuild&&!rebuild){return}node._hasBuild=true;var iForeGate,bForeColor,iBackGate,bBackColor,bBackFill,scaleRate;var cfgData=node.getAttribute("_widget")||"null";cfgData=window.eval(cfgData);if(cfgData instanceof Array&&cfgData.length>=4){iForeGate=cfgData[0];iForeGate=iForeGate=="outline"?2:(iForeGate=="shape"?1:0);bForeColor=parseRgbColor(cfgData[1]);if(!(bForeColor instanceof Array)){return}iBackGate=cfgData[2];iBackGate=iBackGate=="outline"?2:(iBackGate=="shape"?1:0);bBackColor=parseRgbColor(cfgData[3]);if(!(bBackColor instanceof Array)){return}bBackFill=parseRgbColor(cfgData[4]||"rgba(0,0,0,0)");if(!(bBackFill instanceof Array)){return}scaleRate=parseFloat(cfgData[5]||"0")}else{return}if(imgNum==1&&iForeGate==2&&iBackGate==1){var item=imgNodes[0];item.crossOrigin="Anonymous";var cvs=document.createElement("canvas");cvs.width=item.naturalWidth;cvs.height=item.naturalHeight;var ctx=cvs.getContext("2d");ctx.drawImage(item,0,0);var imgData=ctx.getImageData(0,0,cvs.width,cvs.height);quickShapeData(bBackColor,bForeColor,cvs,imgData);ctx.putImageData(imgData,0,0);var ownerNode=node.querySelector("div.shape-canvas");ownerNode.innerHTML="";var targCanvas=document.createElement("canvas");targCanvas.width=parseInt(node.getAttribute("_width")||"0")||ownerNode.clientWidth;targCanvas.height=parseInt(node.getAttribute("_height")||"0")||ownerNode.clientHeight;var targCtx=targCanvas.getContext("2d");targCtx.drawImage(cvs,0,0,targCanvas.width,targCanvas.height);ownerNode.appendChild(targCanvas)}}function setupSvgDataUrl(j,i,c,d,k){var h="",g=0,b=/<g\b.*?\b_widget=.*?>/gm;var a=/\bstroke='.*?'/m,f=/\bfill='.*?'/m,l=/\bstroke-width='.*?'/m,n=/\bstroke-dasharray='.*?'/m;var e=b.exec(j);while(e){var o=e[0];h+=j.slice(g,e.index);g=e.index+o.length;o=o.replace(a,"stroke='"+i+"'").replace(f,"fill='"+c+"'").replace(l,"stroke-width='"+d+"'").replace(n,"stroke-dasharray='"+k+"'");h+=o;e=b.exec(j)}if(g<j.length){h+=j.slice(g)}return h}function getAngleLen(b,j,a,h){var e=a-b,d=h-j;var k=Math.abs(e);var g=Math.abs(d);var f=Math.sqrt(k*k+g*g);var i=Math.acos(g/f);var c=180/(Math.PI/i);if(e>0){return[f,(d>0)?(90-c):(270+c)]}else{return[f,(d>0)?(90+c):(270-c)]}}function getCtrlPoint(v,f,t,e,r,d,q,c){var l=0.35,k=0.333;if(v===undefined){if(q===undefined){return[t,e,r,d]}var g=getAngleLen(t,e,r,d),A=g[0];var o=getAngleLen(r,d,q,c),h=o[0];var y=Math.abs(o[1]-g[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var x=(A*l)/h;var b=r-x*(q-r);var B=d-x*(c-d);var j=b-(b-t)*k;var i=B-(B-e)*k;var u=t+(b-t)*k;var s=e+(B-e)*k;return[u,s,j,i]}else{var w=getAngleLen(v,f,t,e),p=w[0];var g=getAngleLen(t,e,r,d),A=g[0];var y=Math.abs(g[1]-w[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var z=(A*l)/p;var n=t+z*(t-v);var m=e+z*(e-f);var u=n+(r-n)*k;var s=m+(d-m)*k;var j,i;if(q===undefined){j=r-(r-n)*k;i=d-(d-m)*k}else{var o=getAngleLen(r,d,q,c),h=o[0];var y=Math.abs(o[1]-g[1]);if(y>180){y=360-y}if(y>=90){l=0.38;k=0.333-0.266*(y-90)/180}else{k=0.2+0.266*y/180}var x=(A*l)/h;var b=r-x*(q-r);var B=d-x*(c-d);j=b-(b-t)*k;i=B-(B-e)*k}return[u,s,j,i]}}var ARROW_SIDE_FACTOR=4;function buildShape2(node,rebuild,resizing){while(node){if(node.classList.contains("svg-shape")){break}node=node.parentNode}if(!node){return}var bTmp=[],imgNodes=node.querySelectorAll("div.img-resource > link");var imgNum=imgNodes.length;if(imgNum<1||imgNum>3){return}for(var i=0,item;item=imgNodes[i];i++){var data=jsonOfSvg_[item.href];if(!data||data instanceof Array){return}bTmp.push(data)}imgNodes=bTmp;if(node._hasBuild&&!rebuild){return}node._hasBuild=true;var sForeColor,sBackColor,iStyle,iStrokeWd=3,sStrokeDash="",fixFirst=false;var cfgData=node.getAttribute("_widget")||"null";cfgData=window.eval(cfgData);if(cfgData instanceof Array&&cfgData.length>=3){sForeColor=cfgData[0];sBackColor=cfgData[1];iStyle=parseInt(cfgData[2]);if(iStyle>=8){fixFirst=true;iStyle-=8}if(cfgData.length>=4){iStrokeWd=parseInt(cfgData[3]);if(iStrokeWd<=0){iStrokeWd=1}}if(cfgData.length>=5){var subCfg=cfgData[4];if(subCfg instanceof Array&&subCfg.length>=1){sStrokeDash=subCfg[0]}}}else{return}var iWholeWd,iWholeHi,ownerNode=node.querySelector("div.shape-canvas");if(!ownerNode){return}if(resizing){iWholeWd=node.clientWidth;iWholeHi=node.clientHeight}else{iWholeWd=parseInt(node.getAttribute("_width")||"200");iWholeHi=parseInt(node.getAttribute("_height")||"60")}if((iStyle==-1||iStyle==-2)&&cfgData.length>=5&&imgNum==1){var _svg=imgNodes[0],arrowCfg=cfgData[4],iLen=arrowCfg.length;if(iLen<8){return}var preType=arrowCfg[2],postType=arrowCfg[3];var sDashArray="stroke-dasharray='"+sStrokeDash+"' ";var defId=node.getAttribute("_defs")||"mrk_";var preMarker="",preDef="";if(preType>=1){var preTag="mrk"+preType+"_start";preDef=_svg[preTag];if(!preDef){return}var preTag2=defId+"_start";preDef=preDef.replace(preTag,preTag2);preMarker="marker-start='url(#"+preTag2+")' "}var postMarker="",postDef="";if(postType>=1){var postTag="mrk"+postType+"_end";postDef=_svg[postTag];if(!postDef){return}var postTag2=defId+"_end";postDef=postDef.replace(postTag,postTag2);postMarker="marker-end='url(#"+postTag2+")' "}var iSideGap=Math.floor(iStrokeWd*2.5+0.5);iSideGap*=ARROW_SIDE_FACTOR;if(iWholeWd<=iSideGap+iSideGap||iWholeHi<=iSideGap+iSideGap){ownerNode.innerHTML="";return}var iWd=0,iHi=0;for(var i=5;i<iLen;i+=2){var x=arrowCfg[i-1],y=arrowCfg[i];if(x>iWd){iWd=x}if(y>iHi){iHi=y}}var rateX=iWd==0?0:(iWholeWd-iSideGap-iSideGap)/iWd;var rateY=iHi==0?0:(iWholeHi-iSideGap-iSideGap)/iHi;var bNew=[],lastPtX=undefined,lastPtY=undefined;for(var i=5;i<iLen;i+=2){var iCurX=arrowCfg[i-1]*rateX+iSideGap;var iCurY=arrowCfg[i]*rateY+iSideGap;if(lastPtX!==iCurX||lastPtY!==iCurY){bNew.push(iCurX,iCurY);lastPtX=iCurX;lastPtY=iCurY}}var sPoints="",sPath="";if(iStyle==-1){var iNewLen=bNew.length;for(var i=1;i<iNewLen;i+=2){if(i>1){sPoints+=" "}sPoints+=bNew[i-1]+","+bNew[i]}}else{var iNewLen=bNew.length;if(iNewLen==4){sPath="M"+bNew[0]+" "+bNew[1]+"L"+bNew[2]+" "+bNew[3]}else{bNew.unshift(undefined,undefined);iNewLen+=2;sPath="M"+bNew[2]+" "+bNew[3];for(var i=3;i<iNewLen;i+=2){var x1=bNew[i-3],y1=bNew[i-2],x2=bNew[i-1],y2=bNew[i];if(i<=iNewLen-3){var x3=bNew[i+1],y3=bNew[i+2],x4=undefined,y4=undefined;if(i<=iNewLen-5){x4=bNew[i+3];y4=bNew[i+4]}var ctrls=getCtrlPoint(x1,y1,x2,y2,x3,y3,x4,y4);sPath+="C"+ctrls[0]+" "+ctrls[1]+" "+ctrls[2]+" "+ctrls[3]+" "+x3+" "+y3}else{break}}}}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWholeWd+" "+iWholeHi+'" ';var sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg">';sHtml+="<g _widget='null' stroke='rgb(54,54,54)' fill='rgb(54,54,54)' "+sDashArray+"stroke-width='3'>";if(preDef||postDef){sHtml+="<defs>"+preDef+postDef+"</defs>"}if(iStyle==-1){sHtml+="<polyline "+preMarker+postMarker+"fill='rgba(0,0,0,0)' points='"+sPoints+"'/>"}else{sHtml+="<path "+preMarker+postMarker+"fill='rgba(0,0,0,0)' d='"+sPath+"'/>"}sHtml+="</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash);return}if(imgNum==1){var _svg=imgNodes[0],sHtml=_svg.svg,iWd=_svg.width,iHi=_svg.height;var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+iHi+'" ';if(!_svg.scalable){sHtml='<g transform="scale('+iWholeWd/iWd+","+iWholeHi/iHi+')">'+sHtml+"</g>"}sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg">'+sHtml+"</svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(imgNum==2){var _svg=imgNodes[0],_svg2=imgNodes[1];var sHtml=_svg.svg,sHtml2=_svg2.svg;var iWd=_svg.width,iHi=_svg.height,iWd2=_svg2.width,iHi2=_svg2.height;if(iStyle==1){if(iHi!=iHi2){return}if(_svg.scalable||_svg2.scalable){return}var x,x2,svgWd=iHi*iWholeWd/iWholeHi;if(fixFirst){x=iWd;x2=svgWd-iWd;if(x2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate('+(x-1)+",0) scale("+((x2+1)/iWd2)+',1)">'+sHtml2+"</g>";sHtml=sHtml+sHtml2}else{x=svgWd-iWd2;x2=iWd2;if(x<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale('+((x+1)/iWd)+',1)">'+sHtml+"</g>";sHtml2='<g transform="translate('+x+',0)">'+sHtml2+"</g>";sHtml=sHtml2+sHtml}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+svgWd+" "+iHi+'" ';var fScale=iWholeHi/iHi;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(iStyle==2){if(iWd!=iWd2){return}if(_svg.scalable||_svg2.scalable){return}var y,y2,svgHi=iWd*iWholeHi/iWholeWd;if(fixFirst){y=iHi;y2=svgHi-iHi;if(y2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate(0,'+(y-1)+") scale(1,"+((y2+1)/iHi2)+')">'+sHtml2+"</g>";sHtml=sHtml+sHtml2}else{y=svgHi-iHi2;y2=iHi2;if(y<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale(1,'+((y+1)/iHi)+')">'+sHtml+"</g>";sHtml2='<g transform="translate(0,'+y+')">'+sHtml2+"</g>";sHtml=sHtml2+sHtml}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+svgHi+'" ';var fScale=iWholeWd/iWd;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}}}else{if(imgNum==3){var _svg=imgNodes[0],_svg2=imgNodes[1],_svg3=imgNodes[2];var sHtml=_svg.svg,sHtml2=_svg2.svg,sHtml3=_svg3.svg;var iWd=_svg.width,iHi=_svg.height,iWd2=_svg2.width,iHi2=_svg2.height,iWd3=_svg3.width,iHi3=_svg3.height;if(iStyle==1){if(iHi!=iHi2||iHi2!=iHi3){return}if(_svg.scalable||_svg2.scalable||_svg3.scalable){return}var x,x2,x3,svgWd=iHi*iWholeWd/iWholeHi;if(fixFirst){x=iWd;x2=svgWd-iWd-iWd3;x3=iWd3;if(x2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate('+(x-1)+",0) scale("+((x2+2)/iWd2)+',1)">'+sHtml2+"</g>";sHtml3='<g transform="translate('+(x+x2)+',0)">'+sHtml3+"</g>";sHtml=sHtml+sHtml3+sHtml2}else{x=(svgWd-iWd2)*iWd/(iWd+iWd3);x2=iWd2;x3=svgWd-x-iWd2;if(x<=0||x3<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale('+((x+1)/iWd)+',1)">'+sHtml+"</g>";sHtml2='<g transform="translate('+x+',0)">'+sHtml2+"</g>";sHtml3='<g transform="translate('+(x+x2-1)+",0) scale("+((x3+1)/iWd3)+',1)">'+sHtml3+"</g>";sHtml=sHtml2+sHtml+sHtml3}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+svgWd+" "+iHi+'" ';var fScale=iWholeHi/iHi;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}else{if(iStyle==2){if(iWd!=iWd2||iWd2!=iWd3){return}if(_svg.scalable||_svg2.scalable||_svg3.scalable){return}var y,y2,y3,svgHi=iWd*iWholeHi/iWholeWd;if(fixFirst){y=iHi;y2=svgHi-iHi-iHi3;y3=iHi3;if(y2<=0){ownerNode.innerHTML="";return}sHtml2='<g transform="translate(0,'+(y-1)+") scale(1,"+((y2+2)/iHi2)+')">'+sHtml2+"</g>";sHtml3='<g transform="translate(0,'+(y+y2)+')">'+sHtml3+"</g>";sHtml=sHtml+sHtml3+sHtml2}else{y=(svgHi-iHi2)*iHi/(iHi+iHi3);y2=iHi2;y3=svgHi-y-y2;if(y<=0||y3<=0){ownerNode.innerHTML="";return}sHtml='<g transform="scale(1,'+((y+1)/iHi)+')">'+sHtml+"</g>";sHtml2='<g transform="translate(0,'+y+')">'+sHtml2+"</g>";sHtml3='<g transform="translate(0,'+(y+y2-1)+") scale(1,"+((y3+1)/iHi3)+')">'+sHtml3+"</g>";sHtml=sHtml2+sHtml+sHtml3}var sRect='width="'+iWholeWd+'" height="'+iWholeHi+'" viewPort="0 0 '+iWd+" "+svgHi+'" ';var fScale=iWholeWd/iWd;sHtml="<svg "+sRect+'version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="scale('+fScale+","+fScale+')">'+sHtml+"</g></svg>";ownerNode.innerHTML=setupSvgDataUrl(sHtml,sForeColor,sBackColor,iStrokeWd,sStrokeDash)}}}}}}var jsonOfSvg_={};function requestOneSvg(c){var d=jsonOfSvg_[c.href];if(d){if(d instanceof Array){d.push(c)}else{buildShape2(c)}return}var b=null;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}if(!b){return}var a=[c];jsonOfSvg_[c.href]=a;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){jsonOfSvg_[c.href]=JSON.parse(b.responseText);for(var e=0,f;f=a[e];e++){buildShape2(f)}}a=null;b=null}};b.open("GET",c.href,true);b.send(null)}function prepareSvgRes(c){if(jsonOfSvg_[c.href]){return}var b=null;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}if(!b){return}var a=[c];jsonOfSvg_[c.href]=a;b.onreadystatechange=function(){if(b.readyState==4){if(b.status==200||b.status==0){jsonOfSvg_[c.href]=JSON.parse(b.responseText);for(var d=0,e;e=a[d];d++){buildShape2(e)}}a=null;b=null}};b.open("GET",c.href,true);b.send(null)}function resetSvgColor(node,sStrokeClr,sFillClr,fOpacity){var sWidget=node.getAttribute("_widget")||"null";var cfgData=window.eval(sWidget);var iStrokeWd=3;if(cfgData instanceof Array&&cfgData.length>=3){if(!sStrokeClr){sStrokeClr=cfgData[0]}if(!sFillClr){sFillClr=cfgData[1]}if(cfgData.length>=4){iStrokeWd=parseInt(cfgData[3]);if(iStrokeWd<1){iStrokeWd=1}}}else{return}if(typeof fOpacity=="number"){var b=parseRgbColor(sStrokeClr);if(b.length>=3){sStrokeClr="rgba("+b[0]+","+b[1]+","+b[2]+","+fOpacity+")"}else{return}b=parseRgbColor(sFillClr);if(b.length>=3){sFillClr="rgba("+b[0]+","+b[1]+","+b[2]+","+fOpacity+")"}else{return}}cfgData[0]=sStrokeClr;cfgData[1]=sFillClr;node.setAttribute("_widget",JSON.stringify(cfgData).replace(/"/gm,"'"));var groups=node.querySelectorAll("g[_widget]");for(var i=0,item;item=groups[i];i++){item.setAttribute("stroke",sStrokeClr);item.setAttribute("fill",sFillClr);if(item.hasAttribute("stroke-width")){item.setAttribute("stroke-width",iStrokeWd)}}};
